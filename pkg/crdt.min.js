var wo=Object.defineProperty;var vo=(N,a,n)=>a in N?wo(N,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):N[a]=n;var cr=(N,a,n)=>(vo(N,typeof a!="symbol"?a+"":a,n),n);var Io=[function(N,a,n){let p=n(1),v=n(5),{OPTIONS:y}=n(6),{encodeChange:F,decodeChange:Q}=n(15),{isObject:U}=n(7),L=n(34);function Z(_){if(typeof _=="string")_={actorId:_};else if(_===void 0)_={};else if(!U(_))throw new TypeError(`Unsupported options for init(): ${_}`);return v.init(Object.assign({backend:L},_))}function J(_,j,W){let[w]=v.change(_,j,W);return w}function q(_){return L.getAllChanges(v.getBackendState(_,"getAllChanges"))}function S(_,j,W,w,I){let h=v.applyPatch(_,j,W),i=I.patchCallback||_[y].patchCallback;return i&&i(j,_,h,!1,w),h}function u(_,j,W={}){let w=v.getBackendState(_,"applyChanges"),[I,h]=L.applyChanges(w,j);return[S(_,h,I,j,W),h]}N.exports={init:Z,from:function(_,j){return J(Z(j),{message:"Initialization"},W=>Object.assign(W,_))},change:J,emptyChange:function(_,j){let[W]=v.emptyChange(_,j);return W},clone:function(_,j={}){let W=L.clone(v.getBackendState(_,"clone"));return S(Z(j),L.getPatch(W),W,[],j)},free:function(_){L.free(v.getBackendState(_,"free"))},load:function(_,j={}){let W=L.load(_);return S(Z(j),L.getPatch(W),W,[_],j)},save:function(_){return L.save(v.getBackendState(_,"save"))},merge:function(_,j){let W=v.getBackendState(_,"merge"),w=v.getBackendState(j,"merge","second");if(v.getActorId(_)===v.getActorId(j))throw new RangeError("Cannot merge an actor with itself");let I=L.getChangesAdded(W,w),[h]=u(_,I);return h},getChanges:function(_,j){let W=v.getBackendState(_,"getChanges"),w=v.getBackendState(j,"getChanges","second");return L.getChanges(w,L.getHeads(W))},getAllChanges:q,applyChanges:u,encodeChange:F,decodeChange:Q,equals:function _(j,W){if(!U(j)||!U(W))return j===W;let w=Object.keys(j).sort(),I=Object.keys(W).sort();if(w.length!==I.length)return!1;for(let h=0;h<w.length;h++)if(w[h]!==I[h]||!_(j[w[h]],W[I[h]]))return!1;return!0},getHistory:function(_){let j=v.getActorId(_),W=q(_);return W.map((w,I)=>({get change(){return Q(w)},get snapshot(){let h=L.loadChanges(L.init(),W.slice(0,I+1));return v.applyPatch(Z(j),L.getPatch(h),h)}}))},uuid:p,Frontend:v,setDefaultBackend:function(_){L=_},generateSyncMessage:function(_,j){let W=v.getBackendState(_,"generateSyncMessage");return L.generateSyncMessage(W,j)},receiveSyncMessage:function(_,j,W){let w=v.getBackendState(_,"receiveSyncMessage"),[I,h,i]=L.receiveSyncMessage(w,j,W);if(!i)return[_,h,i];let c=null;return _[y].patchCallback&&(c=L.decodeSyncMessage(W).changes),[S(_,i,I,c,{}),h,i]},initSyncState:function(){return L.initSyncState()},get Backend(){return L}};for(let _ of["getObjectId","getObjectById","getActorId","setActorId","getConflicts","getLastLocalChange","Text","Table","Counter","Observable"])N.exports[_]=v[_]},function(N,a,n){let p=n(2);function v(){return p().replace(/-/g,"")}let y=v;function F(){return y()}F.setFactory=Q=>{y=Q},F.reset=()=>{y=v},N.exports=F},function(N,a,n){var p=n(3),v=n(4);N.exports=function(y,F,Q){var U=F&&Q||0;typeof y=="string"&&(F=y==="binary"?new Array(16):null,y=null);var L=(y=y||{}).random||(y.rng||p)();if(L[6]=15&L[6]|64,L[8]=63&L[8]|128,F)for(var Z=0;Z<16;++Z)F[U+Z]=L[Z];return F||v(L)}},function(N){var a=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(a){var n=new Uint8Array(16);N.exports=function(){return a(n),n}}else{var p=new Array(16);N.exports=function(){for(var v,y=0;y<16;y++)(3&y)==0&&(v=4294967296*Math.random()),p[y]=v>>>((3&y)<<3)&255;return p}}},function(N){for(var a=[],n=0;n<256;++n)a[n]=(n+256).toString(16).substr(1);N.exports=function(p,v){var y=v||0,F=a;return[F[p[y++]],F[p[y++]],F[p[y++]],F[p[y++]],"-",F[p[y++]],F[p[y++]],"-",F[p[y++]],F[p[y++]],"-",F[p[y++]],F[p[y++]],"-",F[p[y++]],F[p[y++]],F[p[y++]],F[p[y++]],F[p[y++]],F[p[y++]]].join("")}},function(N,a,n){let{OPTIONS:p,CACHE:v,STATE:y,OBJECT_ID:F,CONFLICTS:Q,CHANGE:U,ELEM_IDS:L}=n(6),{isObject:Z,copyObject:J}=n(7),q=n(1),{interpretPatch:S,cloneRootObject:u}=n(8),{rootObjectProxy:_}=n(12),{Context:j}=n(13),{Text:W}=n(9),{Table:w}=n(10),{Counter:I}=n(11),{Observable:h}=n(14);function i(H){if(typeof H!="string")throw new TypeError("Unsupported type of actorId: "+typeof H);if(!/^[0-9a-f]+$/.test(H))throw new RangeError("actorId must consist only of lowercase hex digits");if(H.length%2!=0)throw new RangeError("actorId must consist of an even number of digits")}function c(H,ee,ce){let B=ee._root;if(B||(B=u(H[v]._root),ee._root=B),Object.defineProperty(B,p,{value:H[p]}),Object.defineProperty(B,v,{value:ee}),Object.defineProperty(B,y,{value:ce}),H[p].freeze)for(let te of Object.keys(ee))ee[te]instanceof w?ee[te]._freeze():ee[te]instanceof W?(Object.freeze(ee[te].elems),Object.freeze(ee[te])):(Object.freeze(ee[te]),Object.freeze(ee[te][Q]));for(let te of Object.keys(H[v]))ee[te]||(ee[te]=H[v][te]);return H[p].freeze&&Object.freeze(ee),B}function b(H,ee,ce){let B=re(H);if(!B)throw new Error("Actor ID must be initialized with setActorId() before making a change");let te=J(H[y]);te.seq+=1;let d={actor:B,seq:te.seq,startOp:te.maxOp+1,deps:te.deps,time:ce&&typeof ce.time=="number"?ce.time:Math.round(new Date().getTime()/1e3),message:ce&&typeof ce.message=="string"?ce.message:"",ops:ee.ops};if(H[p].backend){let[pe,G,M]=H[p].backend.applyLocalChange(te.backendState,d);te.backendState=pe,te.lastLocalChange=M;let l=P(H,G,te,!0),m=ce&&ce.patchCallback||H[p].patchCallback;return m&&m(G,H,l,!0,[M]),[l,d]}{let pe={actor:B,seq:d.seq,before:H};return te.requests=te.requests.concat([pe]),te.maxOp=te.maxOp+function(G){let M=0;for(let l of G)l.action==="set"&&l.values?M+=l.values.length:M+=1;return M}(d.ops),te.deps=[],[c(H,ee?ee.updated:{},te),d]}}function P(H,ee,ce,B){let te=re(H),d={};if(S(ee.diffs,H,d),B){if(!ee.clock)throw new RangeError("patch is missing clock field");ee.clock[te]&&ee.clock[te]>ce.seq&&(ce.seq=ee.clock[te]),ce.clock=ee.clock,ce.deps=ee.deps,ce.maxOp=Math.max(ce.maxOp,ee.maxOp)}return c(H,d,ce)}function D(H){if(typeof H=="string")H={actorId:H};else if(H===void 0)H={};else if(!Z(H))throw new TypeError(`Unsupported value for init() options: ${H}`);if(H.deferActorId||(H.actorId===void 0&&(H.actorId=q()),i(H.actorId)),H.observable){let te=H.patchCallback,d=H.observable;H.patchCallback=(pe,G,M,l,m)=>{te&&te(pe,G,M,l,m),d.patchCallback(pe,G,M,l,m)}}let ee={},ce={_root:ee},B={seq:0,maxOp:0,requests:[],clock:{},deps:[]};return H.backend&&(B.backendState=H.backend.init(),B.lastLocalChange=null),Object.defineProperty(ee,F,{value:"_root"}),Object.defineProperty(ee,p,{value:Object.freeze(H)}),Object.defineProperty(ee,Q,{value:Object.freeze({})}),Object.defineProperty(ee,v,{value:Object.freeze(ce)}),Object.defineProperty(ee,y,{value:Object.freeze(B)}),Object.freeze(ee)}function V(H,ee,ce){if(H[F]!=="_root")throw new TypeError("The first argument to Automerge.change must be the document root");if(H[U])throw new TypeError("Calls to Automerge.change cannot be nested");if(typeof ee=="function"&&ce===void 0&&([ee,ce]=[ce,ee]),typeof ee=="string"&&(ee={message:ee}),ee!==void 0&&!Z(ee))throw new TypeError("Unsupported type of options");let B=re(H);if(!B)throw new Error("Actor ID must be initialized with setActorId() before making a change");let te=new j(H,B);return ce(_(te)),Object.keys(te.updated).length===0?[H,null]:b(H,te,ee)}function re(H){return H[y].actorId||H[p].actorId}N.exports={init:D,from:function(H,ee){return V(D(ee),"Initialization",ce=>Object.assign(ce,H))},change:V,emptyChange:function(H,ee){if(H[F]!=="_root")throw new TypeError("The first argument to Automerge.emptyChange must be the document root");if(typeof ee=="string"&&(ee={message:ee}),ee!==void 0&&!Z(ee))throw new TypeError("Unsupported type of options");let ce=re(H);if(!ce)throw new Error("Actor ID must be initialized with setActorId() before making a change");return b(H,new j(H,ce),ee)},applyPatch:function(H,ee,ce){if(H[F]!=="_root")throw new TypeError("The first argument to Frontend.applyPatch must be the document root");let B=J(H[y]);if(H[p].backend){if(!ce)throw new RangeError("applyPatch must be called with the updated backend state");return B.backendState=ce,P(H,ee,B,!0)}let te;if(B.requests.length>0)if(te=B.requests[0].before,ee.actor===re(H)){if(B.requests[0].seq!==ee.seq)throw new RangeError(`Mismatched sequence number: patch ${ee.seq} does not match next request ${B.requests[0].seq}`);B.requests=B.requests.slice(1)}else B.requests=B.requests.slice();else te=H,B.requests=[];let d=P(te,ee,B,!0);return B.requests.length===0?d:(B.requests[0]=J(B.requests[0]),B.requests[0].before=d,c(H,{},B))},getObjectId:function(H){return H[F]},getObjectById:function(H,ee){if(H[U])throw new TypeError("Cannot use getObjectById in a change callback");return H[v][ee]},getActorId:re,setActorId:function(H,ee){return i(ee),c(H,{},Object.assign({},H[y],{actorId:ee}))},getConflicts:function(H,ee){if(H[Q]&&H[Q][ee]&&Object.keys(H[Q][ee]).length>1)return H[Q][ee]},getLastLocalChange:function(H){return H[y]&&H[y].lastLocalChange?H[y].lastLocalChange:null},getBackendState:function(H,ee=null,ce="first"){if(H[F]!=="_root"){let B=Array.isArray(H)?". Note: Automerge.applyChanges now returns an array.":"";throw ee?new TypeError(`The ${ce} argument to Automerge.${ee} must be the document root${B}`):new TypeError(`Argument is not an Automerge document root${B}`)}return H[y].backendState},getElementIds:function(H){return H instanceof W?H.elems.map(ee=>ee.elemId):H[L]},Text:W,Table:w,Counter:I,Observable:h}},function(N){let a=Symbol("_options"),n=Symbol("_cache"),p=Symbol("_state"),v=Symbol("_objectId"),y=Symbol("_conflicts"),F=Symbol("_change"),Q=Symbol("_elemIds");N.exports={OPTIONS:a,CACHE:n,STATE:p,OBJECT_ID:v,CONFLICTS:y,CHANGE:F,ELEM_IDS:Q}},function(N){function a(n){return typeof n=="object"&&n!==null}N.exports={isObject:a,copyObject:function(n){if(!a(n))return{};let p={};for(let v of Object.keys(n))p[v]=n[v];return p},parseOpId:function(n){let p=/^(\d+)@(.*)$/.exec(n||"");if(!p)throw new RangeError(`Not a valid opId: ${n}`);return{counter:parseInt(p[1],10),actorId:p[2]}},equalBytes:function(n,p){if(!(n instanceof Uint8Array&&p instanceof Uint8Array))throw new TypeError("equalBytes can only compare Uint8Arrays");if(n.byteLength!==p.byteLength)return!1;for(let v=0;v<n.byteLength;v++)if(n[v]!==p[v])return!1;return!0}}},function(N,a,n){let{isObject:p,copyObject:v,parseOpId:y}=n(7),{OBJECT_ID:F,CONFLICTS:Q,ELEM_IDS:U}=n(6),{instantiateText:L}=n(9),{instantiateTable:Z}=n(10),{Counter:J}=n(11);function q(w,I,h){if(w.objectId)return I&&I[F]!==w.objectId&&(I=void 0),W(w,I,h);if(w.datatype==="timestamp")return new Date(w.value);if(w.datatype==="counter")return new J(w.value);if(w.datatype!==void 0)throw new TypeError(`Unknown datatype: ${w.datatype}`);return w.value}function S(w,I){let h=/^(\d+)@(.*)$/,i=h.test(w)?y(w):{counter:0,actorId:w},c=h.test(I)?y(I):{counter:0,actorId:I};return i.counter<c.counter?-1:i.counter>c.counter?1:i.actorId<c.actorId?-1:i.actorId>c.actorId?1:0}function u(w,I){let h=v(w),i=v(w?w[Q]:void 0);return Object.defineProperty(h,F,{value:I}),Object.defineProperty(h,Q,{value:i}),h}function _(w,I,h){let i=w.objectId;h[i]||(h[i]=u(I,i));let c=h[i];return function(b,P,D,V){if(b)for(let re of Object.keys(b)){let H={},ee=Object.keys(b[re]).sort(S).reverse();for(let ce of ee){let B=b[re][ce];D[re]&&D[re][ce]?H[ce]=q(B,D[re][ce],V):H[ce]=q(B,void 0,V)}ee.length===0?(delete P[re],delete D[re]):(P[re]=H[ee[0]],D[re]=H)}}(w.props,c,c[Q],h),c}function j(w,I,h){let i=w.objectId;h[i]||(h[i]=function(D,V){let re=D?D.slice():[],H=D&&D[Q]?D[Q].slice():[],ee=D&&D[U]?D[U].slice():[];return Object.defineProperty(re,F,{value:V}),Object.defineProperty(re,Q,{value:H}),Object.defineProperty(re,U,{value:ee}),re}(I,i));let c=h[i],b=c[Q],P=c[U];for(let D=0;D<w.edits.length;D++){let V=w.edits[D];if(V.action==="insert"||V.action==="update"){let re=b[V.index]&&b[V.index][V.opId],H=q(V.value,re,h),ee={[V.opId]:H};for(;D<w.edits.length-1&&w.edits[D+1].index===V.index&&w.edits[D+1].action==="update";){D++;let ce=w.edits[D],B=b[ce.index]&&b[ce.index][ce.opId];H=q(ce.value,B,h),ee[ce.opId]=H}V.action==="insert"?(c.splice(V.index,0,H),b.splice(V.index,0,ee),P.splice(V.index,0,V.elemId)):(c[V.index]=H,b[V.index]=ee)}else if(V.action==="multi-insert"){let re=y(V.elemId),H=[],ee=[],ce=[];V.values.forEach((B,te)=>{let d=`${re.counter+te}@${re.actorId}`;ee.push(B),ce.push({[d]:{value:B,type:"value"}}),H.push(d)}),c.splice(V.index,0,...ee),b.splice(V.index,0,...ce),P.splice(V.index,0,...H)}else V.action==="remove"&&(c.splice(V.index,V.count),b.splice(V.index,V.count),P.splice(V.index,V.count))}return c}function W(w,I,h){if(p(I)&&(!w.props||Object.keys(w.props).length===0)&&(!w.edits||w.edits.length===0)&&!h[w.objectId])return I;if(w.type==="map")return _(w,I,h);if(w.type==="table")return function(i,c,b){let P=i.objectId;b[P]||(b[P]=c?c._clone():Z(P));let D=b[P];for(let V of Object.keys(i.props||{})){let re=Object.keys(i.props[V]);if(re.length===0)D.remove(V);else{if(re.length!==1)throw new RangeError("Conflicts are not supported on properties of a table");{let H=i.props[V][re[0]];D._set(V,q(H,D.byId(V),b),re[0])}}}return D}(w,I,h);if(w.type==="list")return j(w,I,h);if(w.type==="text")return function(i,c,b){let P=i.objectId,D;D=b[P]?b[P].elems:c?c.elems.slice():[];for(let V of i.edits)if(V.action==="insert"){let re=q(V.value,void 0,b),H={elemId:V.elemId,pred:[V.opId],value:re};D.splice(V.index,0,H)}else if(V.action==="multi-insert"){let re=y(V.elemId),H=V.values.map((ee,ce)=>{let B=`${re.counter+ce}@${re.actorId}`;return{elemId:B,pred:[B],value:ee}});D.splice(V.index,0,...H)}else if(V.action==="update"){let re=D[V.index].elemId,H=q(V.value,D[V.index].value,b);D[V.index]={elemId:re,pred:[V.opId],value:H}}else V.action==="remove"&&D.splice(V.index,V.count);return b[P]=L(P,D),b[P]}(w,I,h);throw new TypeError(`Unknown object type: ${w.type}`)}N.exports={interpretPatch:W,cloneRootObject:function(w){if(w[F]!=="_root")throw new RangeError(`Not the root object: ${w[F]}`);return u(w,"_root")}}},function(N,a,n){let{OBJECT_ID:p}=n(6),{isObject:v}=n(7);class y{constructor(U){if(typeof U=="string")return F(void 0,[...U].map(L=>({value:L})));if(Array.isArray(U))return F(void 0,U.map(L=>({value:L})));if(U===void 0)return F(void 0,[]);throw new TypeError(`Unsupported initial value for Text: ${U}`)}get length(){return this.elems.length}get(U){let L=this.elems[U].value;if(this.context&&v(L)){let Z=L[p],J=this.path.concat([{key:U,objectId:Z}]);return this.context.instantiateObject(J,Z)}return L}getElemId(U){return this.elems[U].elemId}[Symbol.iterator](){let U=this.elems,L=-1;return{next:()=>(L+=1,L<U.length?{done:!1,value:U[L].value}:{done:!0})}}toString(){let U="";for(let L of this.elems)typeof L.value=="string"&&(U+=L.value);return U}toSpans(){let U=[],L="";for(let Z of this.elems)typeof Z.value=="string"?L+=Z.value:(L.length>0&&(U.push(L),L=""),U.push(Z.value));return L.length>0&&U.push(L),U}toJSON(){return this.toString()}getWriteable(U,L){if(!this[p])throw new RangeError("getWriteable() requires the objectId to be set");let Z=F(this[p],this.elems);return Z.context=U,Z.path=L,Z}set(U,L){if(this.context)this.context.setListIndex(this.path,U,L);else{if(this[p])throw new TypeError("Automerge.Text object cannot be modified outside of a change block");this.elems[U].value=L}return this}insertAt(U,...L){if(this.context)this.context.splice(this.path,U,0,L);else{if(this[p])throw new TypeError("Automerge.Text object cannot be modified outside of a change block");this.elems.splice(U,0,...L.map(Z=>({value:Z})))}return this}deleteAt(U,L=1){if(this.context)this.context.splice(this.path,U,L,[]);else{if(this[p])throw new TypeError("Automerge.Text object cannot be modified outside of a change block");this.elems.splice(U,L)}return this}}for(let Q of["concat","every","filter","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString"])y.prototype[Q]=function(...U){return[...this][Q](...U)};function F(Q,U){let L=Object.create(y.prototype);return L[p]=Q,L.elems=U,L}N.exports={Text:y,instantiateText:F}},function(N,a,n){let{OBJECT_ID:p,CONFLICTS:v}=n(6),{isObject:y,copyObject:F}=n(7);function Q(J,q,S){for(let u of J)if(q[u]!==S[u]){if(typeof q[u]=="number"&&typeof S[u]=="number")return q[u]-S[u];{let _=""+q[u],j=""+S[u];if(_===j)continue;return _<j?-1:1}}return 0}class U{constructor(){this.entries=Object.freeze({}),this.opIds=Object.freeze({}),Object.freeze(this)}byId(q){return this.entries[q]}get ids(){return Object.keys(this.entries).filter(q=>{let S=this.entries[q];return y(S)&&S.id===q})}get count(){return this.ids.length}get rows(){return this.ids.map(q=>this.byId(q))}filter(q,S){return this.rows.filter(q,S)}find(q,S){return this.rows.find(q,S)}map(q,S){return this.rows.map(q,S)}sort(q){if(typeof q=="function")return this.rows.sort(q);if(typeof q=="string")return this.rows.sort((S,u)=>Q([q],S,u));if(Array.isArray(q))return this.rows.sort((S,u)=>Q(q,S,u));if(q===void 0)return this.rows.sort((S,u)=>Q(["id"],S,u));throw new TypeError(`Unsupported sorting argument: ${q}`)}[Symbol.iterator](){let q=this.rows,S=-1;return{next:()=>(S+=1,S<q.length?{done:!1,value:q[S]}:{done:!0})}}_clone(){if(!this[p])throw new RangeError("clone() requires the objectId to be set");return Z(this[p],F(this.entries),F(this.opIds))}_set(q,S,u){if(Object.isFrozen(this.entries))throw new Error("A table can only be modified in a change function");y(S)&&!Array.isArray(S)&&Object.defineProperty(S,"id",{value:q,enumerable:!0}),this.entries[q]=S,this.opIds[q]=u}remove(q){if(Object.isFrozen(this.entries))throw new Error("A table can only be modified in a change function");delete this.entries[q],delete this.opIds[q]}_freeze(){Object.freeze(this.entries),Object.freeze(this.opIds),Object.freeze(this)}getWriteable(q,S){if(!this[p])throw new RangeError("getWriteable() requires the objectId to be set");let u=Object.create(L.prototype);return u[p]=this[p],u.context=q,u.entries=this.entries,u.opIds=this.opIds,u.path=S,u}toJSON(){let q={};for(let S of this.ids)q[S]=this.byId(S);return q}}class L extends U{byId(q){if(y(this.entries[q])&&this.entries[q].id===q){let S=this.entries[q][p],u=this.path.concat([{key:q,objectId:S}]);return this.context.instantiateObject(u,S,["id"])}}add(q){return this.context.addTableRow(this.path,q)}remove(q){if(!y(this.entries[q])||this.entries[q].id!==q)throw new RangeError(`There is no row with ID ${q} in this table`);this.context.deleteTableRow(this.path,q,this.opIds[q])}}function Z(J,q,S){let u=Object.create(U.prototype);if(!J)throw new RangeError("instantiateTable requires an objectId to be given");return u[p]=J,u[v]=Object.freeze({}),u.entries=q||{},u.opIds=S||{},u}N.exports={Table:U,instantiateTable:Z}},function(N){class a{constructor(v){this.value=v||0,Object.freeze(this)}valueOf(){return this.value}toString(){return this.valueOf().toString()}toJSON(){return this.value}}class n extends a{increment(v){return v=typeof v=="number"?v:1,this.context.increment(this.path,this.key,v),this.value+=v,this.value}decrement(v){return this.increment(typeof v=="number"?-v:-1)}}N.exports={Counter:a,getWriteableCounter:function(p,v,y,F,Q){let U=Object.create(n.prototype);return U.value=p,U.context=v,U.path=y,U.objectId=F,U.key=Q,U}}},function(N,a,n){let{OBJECT_ID:p,CHANGE:v,STATE:y}=n(6),{Text:F}=n(9),{Table:Q}=n(10);function U(S){if(typeof S=="string"&&/^[0-9]+$/.test(S)&&(S=parseInt(S,10)),typeof S!="number")throw new TypeError("A list index must be a number, but you passed "+JSON.stringify(S));if(S<0||isNaN(S)||S===1/0||S===-1/0)throw new RangeError("A list index must be positive, but you passed "+S);return S}let L={get(S,u){let{context:_,objectId:j,path:W}=S;return u===p?j:u===v?_:u===y?{actorId:_.actorId}:_.getObjectField(W,j,u)},set(S,u,_){let{context:j,path:W,readonly:w}=S;if(Array.isArray(w)&&w.indexOf(u)>=0)throw new RangeError(`Object property "${u}" cannot be modified`);return j.setMapKey(W,u,_),!0},deleteProperty(S,u){let{context:_,path:j,readonly:W}=S;if(Array.isArray(W)&&W.indexOf(u)>=0)throw new RangeError(`Object property "${u}" cannot be modified`);return _.deleteMapKey(j,u),!0},has(S,u){let{context:_,objectId:j}=S;return[p,v].includes(u)||u in _.getObject(j)},getOwnPropertyDescriptor(S,u){let{context:_,objectId:j}=S;if(u in _.getObject(j))return{configurable:!0,enumerable:!0,value:_.getObjectField(j,u)}},ownKeys(S){let{context:u,objectId:_}=S;return Object.keys(u.getObject(_))}},Z={get(S,u){let[_,j,W]=S;return u===Symbol.iterator?_.getObject(j)[Symbol.iterator]:u===p?j:u===v?_:u==="length"?_.getObject(j).length:typeof u=="string"&&/^[0-9]+$/.test(u)?_.getObjectField(W,j,U(u)):function(w,I,h){let i={deleteAt(c,b){return w.splice(h,U(c),b||1,[]),this},fill(c,b,P){let D=w.getObject(I);for(let V=U(b||0);V<U(P||D.length);V++)w.setListIndex(h,V,c);return this},indexOf(c,b=0){let P=c[p];if(P){let D=w.getObject(I);for(let V=b;V<D.length;V++)if(D[V][p]===P)return V;return-1}return w.getObject(I).indexOf(c,b)},insertAt(c,...b){return w.splice(h,U(c),0,b),this},pop(){let c=w.getObject(I);if(c.length==0)return;let b=w.getObjectField(h,I,c.length-1);return w.splice(h,c.length-1,1,[]),b},push(...c){let b=w.getObject(I);return w.splice(h,b.length,0,c),w.getObject(I).length},shift(){if(w.getObject(I).length==0)return;let c=w.getObjectField(h,I,0);return w.splice(h,0,1,[]),c},splice(c,b,...P){let D=w.getObject(I);c=U(c),(b===void 0||b>D.length-c)&&(b=D.length-c);let V=[];for(let re=0;re<b;re++)V.push(w.getObjectField(h,I,c+re));return w.splice(h,c,b,P),V},unshift:(...c)=>(w.splice(h,0,0,c),w.getObject(I).length)};for(let c of["entries","keys","values"]){let b=w.getObject(I);i[c]=()=>b[c]()}for(let c of["concat","every","filter","find","findIndex","forEach","includes","join","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString","toString"])i[c]=(...b)=>w.getObject(I).map((P,D)=>w.getObjectField(h,I,D))[c](...b);return i}(_,j,W)[u]},set(S,u,_){let[j,,W]=S;return j.setListIndex(W,U(u),_),!0},deleteProperty(S,u){let[_,,j]=S;return _.splice(j,U(u),1,[]),!0},has(S,u){let[_,j]=S;return typeof u=="string"&&/^[0-9]+$/.test(u)?U(u)<_.getObject(j).length:["length",p,v].includes(u)},getOwnPropertyDescriptor(S,u){let[_,j]=S,W=_.getObject(j);if(u==="length")return{writable:!0,value:W.length};if(u===p)return{configurable:!1,enumerable:!1,value:j};if(typeof u=="string"&&/^[0-9]+$/.test(u)){let w=U(u);if(w<W.length)return{configurable:!0,enumerable:!0,value:_.getObjectField(j,w)}}},ownKeys(S){let[u,_]=S,j=u.getObject(_),W=["length"];for(let w of Object.keys(j))W.push(w);return W}};function J(S,u,_,j){return new Proxy({context:S,objectId:u,path:_,readonly:j},L)}function q(S,u,_){let j=this.getObject(u);return Array.isArray(j)?function(W,w,I){return new Proxy([W,w,I],Z)}(this,u,S):j instanceof F||j instanceof Q?j.getWriteable(this,S):J(this,u,S,_)}N.exports={rootObjectProxy:function(S){return S.instantiateObject=q,J(S,"_root",[])}}},function(N,a,n){let{CACHE:p,OBJECT_ID:v,CONFLICTS:y,ELEM_IDS:F,STATE:Q}=n(6),{interpretPatch:U}=n(8),{Text:L}=n(9),{Table:Z}=n(10),{Counter:J,getWriteableCounter:q}=n(11),{isObject:S,parseOpId:u}=n(7),_=n(1);function j(w,I){return w instanceof Z?[w.opIds[I]]:w instanceof L?w.elems[I].pred:w[y]&&w[y][I]?Object.keys(w[y][I]):[]}function W(w,I,h=!1){if(h){if(I===0)return"_head";I-=1}if(w[F])return w[F][I];if(w.getElemId)return w.getElemId(I);throw new RangeError(`Cannot find elemId at list index ${I}`)}N.exports={Context:class{constructor(w,I,h){this.actorId=I,this.maxOp=w[Q].maxOp,this.cache=w[p],this.updated={},this.ops=[],this.applyPatch=h||U}addOp(w){this.ops.push(w)}nextOpId(){let w=this.maxOp+1;for(let I of this.ops)I.action==="set"&&I.values?w+=I.values.length:I.action==="del"&&I.multiOp?w+=I.multiOp:w+=1;return`${w}@${this.actorId}`}getValueDescription(w){if(!["object","boolean","number","string"].includes(typeof w))throw new TypeError("Unsupported type of value: "+typeof w);if(S(w)){if(w instanceof Date)return{type:"value",value:w.getTime(),datatype:"timestamp"};if(w instanceof J)return{type:"value",value:w.value,datatype:"counter"};{let I=w[v],h=this.getObjectType(I);if(!I)throw new RangeError(`Object ${JSON.stringify(w)} has no objectId`);return h==="list"||h==="text"?{objectId:I,type:h,edits:[]}:{objectId:I,type:h,props:{}}}}return{type:"value",value:w}}getValuesDescriptions(w,I,h){if(I instanceof Z){let i=I.byId(h);return i?{[h]:this.getValueDescription(i)}:{}}if(I instanceof L){let i=I.get(h),c=I.getElemId(h);return i?{[c]:this.getValueDescription(i)}:{}}{let i=I[y][h],c={};if(!i)throw new RangeError(`No children at key ${h} of path ${JSON.stringify(w)}`);for(let b of Object.keys(i))c[b]=this.getValueDescription(i[b]);return c}}getPropertyValue(w,I,h){return w instanceof Z?w.byId(I):w instanceof L?w.get(I):w[y][I][h]}getSubpatch(w,I){if(I.length==0)return w;let h=w,i=this.getObject("_root");for(let c of I){let b=this.getValuesDescriptions(I,i,c.key);if(h.props)h.props[c.key]||(h.props[c.key]=b);else if(h.edits)for(let D of Object.keys(b))h.edits.push({action:"update",index:c.key,opId:D,value:b[D]});let P=null;for(let D of Object.keys(b))b[D].objectId===c.objectId&&(P=D);if(!P)throw new RangeError(`Cannot find path object with objectId ${c.objectId}`);h=b[P],i=this.getPropertyValue(i,c.key,P)}return h}getObject(w){let I=this.updated[w]||this.cache[w];if(!I)throw new RangeError(`Target object does not exist: ${w}`);return I}getObjectType(w){if(w==="_root")return"map";let I=this.getObject(w);return I instanceof L?"text":I instanceof Z?"table":Array.isArray(I)?"list":"map"}getObjectField(w,I,h){if(!["string","number"].includes(typeof h))return;let i=this.getObject(I);if(i[h]instanceof J)return q(i[h].value,this,w,I,h);if(S(i[h])){let c=i[h][v],b=w.concat([{key:h,objectId:c}]);return this.instantiateObject(b,c)}return i[h]}createNestedObjects(w,I,h,i,c,b){if(h[v])throw new RangeError("Cannot create a reference to an existing document object");let P=this.nextOpId();if(h instanceof L){this.addOp(b?{action:"makeText",obj:w,elemId:b,insert:i,pred:c}:{action:"makeText",obj:w,key:I,insert:i,pred:c});let D={objectId:P,type:"text",edits:[]};return this.insertListItems(D,0,[...h],!0),D}if(h instanceof Z){if(h.count>0)throw new RangeError("Assigning a non-empty Table object is not supported");return this.addOp(b?{action:"makeTable",obj:w,elemId:b,insert:i,pred:c}:{action:"makeTable",obj:w,key:I,insert:i,pred:c}),{objectId:P,type:"table",props:{}}}if(Array.isArray(h)){this.addOp(b?{action:"makeList",obj:w,elemId:b,insert:i,pred:c}:{action:"makeList",obj:w,key:I,insert:i,pred:c});let D={objectId:P,type:"list",edits:[]};return this.insertListItems(D,0,h,!0),D}{this.addOp(b?{action:"makeMap",obj:w,elemId:b,insert:i,pred:c}:{action:"makeMap",obj:w,key:I,insert:i,pred:c});let D={};for(let V of Object.keys(h).sort()){let re=this.nextOpId(),H=this.setValue(P,V,h[V],!1,[]);D[V]={[re]:H}}return{objectId:P,type:"map",props:D}}}setValue(w,I,h,i,c,b){if(!w)throw new RangeError("setValue needs an objectId");if(I==="")throw new RangeError("The key of a map entry must not be an empty string");if(!S(h)||h instanceof Date||h instanceof J){let P=this.getValueDescription(h),D={action:"set",obj:w,insert:i,value:P.value,pred:c};return b?D.elemId=b:D.key=I,P.datatype&&(D.datatype=P.datatype),this.addOp(D),P}return this.createNestedObjects(w,I,h,i,c,b)}applyAtPath(w,I){let h={objectId:"_root",type:"map",props:{}};I(this.getSubpatch(h,w)),this.applyPatch(h,this.cache._root,this.updated)}setMapKey(w,I,h){if(typeof I!="string")throw new RangeError("The key of a map entry must be a string, not "+typeof I);let i=w.length===0?"_root":w[w.length-1].objectId,c=this.getObject(i);if(c[I]instanceof J)throw new RangeError("Cannot overwrite a Counter object; use .increment() or .decrement() to change its value.");(c[I]!==h||Object.keys(c[y][I]||{}).length>1||h===void 0)&&this.applyAtPath(w,b=>{let P=j(c,I),D=this.nextOpId(),V=this.setValue(i,I,h,!1,P);b.props[I]={[D]:V}})}deleteMapKey(w,I){let h=w.length===0?"_root":w[w.length-1].objectId,i=this.getObject(h);if(i[I]!==void 0){let c=j(i,I);this.addOp({action:"del",obj:h,key:I,insert:!1,pred:c}),this.applyAtPath(w,b=>{b.props[I]={}})}}insertListItems(w,I,h,i){let c=i?[]:this.getObject(w.objectId);if(I<0||I>c.length)throw new RangeError(`List index ${I} is out of bounds for list of length ${c.length}`);let b=W(c,I,!0);if(h.every(P=>typeof P=="string"||typeof P=="number"||typeof P=="boolean"||P===null)&&h.length>1){let P=this.nextOpId();this.addOp({action:"set",obj:w.objectId,elemId:b,insert:!0,values:h,pred:[]}),w.edits.push({action:"multi-insert",elemId:P,index:I,values:h})}else for(let P=0;P<h.length;P++){let D=this.nextOpId(),V=this.setValue(w.objectId,I+P,h[P],!0,[],b);b=D,w.edits.push({action:"insert",index:I+P,elemId:b,opId:b,value:V})}}setListIndex(w,I,h){let i=w.length===0?"_root":w[w.length-1].objectId,c=this.getObject(i);if(I===c.length)return this.splice(w,I,0,[h]);if(I<0||I>c.length)throw new RangeError(`List index ${I} is out of bounds for list of length ${c.length}`);if(c[I]instanceof J)throw new RangeError("Cannot overwrite a Counter object; use .increment() or .decrement() to change its value.");(c[I]!==h||Object.keys(c[y][I]||{}).length>1||h===void 0)&&this.applyAtPath(w,b=>{let P=j(c,I),D=this.nextOpId(),V=this.setValue(i,I,h,!1,P,W(c,I));b.edits.push({action:"update",index:I,opId:D,value:V})})}splice(w,I,h,i){let c=w.length===0?"_root":w[w.length-1].objectId,b=this.getObject(c);if(I<0||h<0||I>b.length-h)throw new RangeError(`${h} deletions starting at index ${I} are out of bounds for list of length ${b.length}`);if(h===0&&i.length===0)return;let P={objectId:"_root",type:"map",props:{}},D=this.getSubpatch(P,w);if(h>0){let V,re,H;for(let ee=0;ee<h;ee++){if(this.getObjectField(w,c,I+ee)instanceof J)throw new TypeError("Unsupported operation: deleting a counter from a list");let ce=W(b,I+ee),B=u(ce),te=j(b,I+ee),d=te.length===1?u(te[0]):void 0;V&&re&&H&&d&&re.actorId===B.actorId&&re.counter+1===B.counter&&H.actorId===d.actorId&&H.counter+1===d.counter?V.multiOp=(V.multiOp||1)+1:(V&&this.addOp(V),V={action:"del",obj:c,elemId:ce,insert:!1,pred:te}),re=B,H=d}this.addOp(V),D.edits.push({action:"remove",index:I,count:h})}i.length>0&&this.insertListItems(D,I,i,!1),this.applyPatch(P,this.cache._root,this.updated)}addTableRow(w,I){if(!S(I)||Array.isArray(I))throw new TypeError("A table row must be an object");if(I[v])throw new TypeError("Cannot reuse an existing object as table row");if(I.id)throw new TypeError('A table row must not have an "id" property; it is generated automatically');let h=_(),i=this.setValue(w[w.length-1].objectId,h,I,!1,[]);return this.applyAtPath(w,c=>{c.props[h]={[i.objectId]:i}}),h}deleteTableRow(w,I,h){let i=w[w.length-1].objectId;this.getObject(i).byId(I)&&(this.addOp({action:"del",obj:i,key:I,insert:!1,pred:[h]}),this.applyAtPath(w,c=>{c.props[I]={}}))}increment(w,I,h){let i=w.length===0?"_root":w[w.length-1].objectId,c=this.getObject(i);if(!(c[I]instanceof J))throw new TypeError("Only counter values can be incremented");let b=this.getObjectType(i),P=c[I].value+h,D=this.nextOpId(),V=j(c,I);if(b==="list"||b==="text"){let re=W(c,I,!1);this.addOp({action:"inc",obj:i,elemId:re,value:h,insert:!1,pred:V})}else this.addOp({action:"inc",obj:i,key:I,value:h,insert:!1,pred:V});this.applyAtPath(w,re=>{b==="list"||b==="text"?re.edits.push({action:"update",index:I,opId:D,value:{value:P,datatype:"counter"}}):re.props[I]={[D]:{value:P,datatype:"counter"}}})}}}},function(N,a,n){let{OBJECT_ID:p,CONFLICTS:v}=n(6);N.exports={Observable:class{constructor(){this.observers={}}patchCallback(y,F,Q,U,L){this._objectUpdate(y.diffs,F,Q,U,L)}_objectUpdate(y,F,Q,U,L){if(y.objectId){if(this.observers[y.objectId])for(let Z of this.observers[y.objectId])Z(y,F,Q,U,L);if(y.type==="map"&&y.props)for(let Z of Object.keys(y.props))for(let J of Object.keys(y.props[Z]))this._objectUpdate(y.props[Z][J],F&&F[v]&&F[v][Z]&&F[v][Z][J],Q&&Q[v]&&Q[v][Z]&&Q[v][Z][J],U,L);else if(y.type==="table"&&y.props)for(let Z of Object.keys(y.props))for(let J of Object.keys(y.props[Z]))this._objectUpdate(y.props[Z][J],F&&F.byId(Z),Q&&Q.byId(Z),U,L);else if(y.type==="list"&&y.edits){let Z=0;for(let J of y.edits)J.action==="insert"?(Z-=1,this._objectUpdate(J.value,void 0,Q&&Q[v]&&Q[v][J.index]&&Q[v][J.index][J.elemId],U,L)):J.action==="multi-insert"?Z-=J.values.length:J.action==="update"?this._objectUpdate(J.value,F&&F[v]&&F[v][J.index+Z]&&F[v][J.index+Z][J.opId],Q&&Q[v]&&Q[v][J.index]&&Q[v][J.index][J.opId],U,L):J.action==="remove"&&(Z+=J.count)}else if(y.type==="text"&&y.edits){let Z=0;for(let J of y.edits)J.action==="insert"?(Z-=1,this._objectUpdate(J.value,void 0,Q&&Q.get(J.index),U,L)):J.action==="multi-insert"?Z-=J.values.length:J.action==="update"?this._objectUpdate(J.value,F&&F.get(J.index+Z),Q&&Q.get(J.index),U,L):J.action==="remove"&&(Z+=J.count)}}}observe(y,F){let Q=y[p];if(!Q)throw new TypeError("The observed object must be part of an Automerge document");this.observers[Q]||(this.observers[Q]=[]),this.observers[Q].push(F)}}}},function(N,a,n){let p=n(16),{copyObject:v,parseOpId:y,equalBytes:F}=n(7),{utf8ToString:Q,hexStringToBytes:U,bytesToHexString:L,Encoder:Z,Decoder:J,RLEEncoder:q,RLEDecoder:S,DeltaEncoder:u,DeltaDecoder:_,BooleanEncoder:j,BooleanDecoder:W}=n(32),{Hash:w}=n(33),I=new Uint8Array([133,111,74,131]),h={GROUP_CARD:0,ACTOR_ID:1,INT_RLE:2,INT_DELTA:3,BOOLEAN:4,STRING_RLE:5,VALUE_LEN:6,VALUE_RAW:7},i={NULL:0,FALSE:1,TRUE:2,LEB128_UINT:3,LEB128_INT:4,IEEE754:5,UTF8:6,BYTES:7,COUNTER:8,TIMESTAMP:9,MIN_UNKNOWN:10,MAX_UNKNOWN:15},c=["makeMap","set","makeList","del","makeText","inc","makeTable","link"],b={makeMap:"map",makeList:"list",makeText:"text",makeTable:"table"},P={objActor:0|h.ACTOR_ID,objCtr:0|h.INT_RLE,keyActor:16|h.ACTOR_ID,keyCtr:16|h.INT_DELTA,keyStr:16|h.STRING_RLE,idActor:32|h.ACTOR_ID,idCtr:32|h.INT_DELTA,insert:48|h.BOOLEAN,action:64|h.INT_RLE,valLen:80|h.VALUE_LEN,valRaw:80|h.VALUE_RAW,chldActor:96|h.ACTOR_ID,chldCtr:96|h.INT_DELTA},D=Object.assign({predNum:112|h.GROUP_CARD,predActor:112|h.ACTOR_ID,predCtr:112|h.INT_DELTA},P),V=Object.assign({succNum:128|h.GROUP_CARD,succActor:128|h.ACTOR_ID,succCtr:128|h.INT_DELTA},P),re=Object.entries(V).reduce((A,[O,z])=>(A[z]=O,A),[]),H={actor:0|h.ACTOR_ID,seq:0|h.INT_DELTA,maxOp:16|h.INT_DELTA,time:32|h.INT_DELTA,message:48|h.STRING_RLE,depsNum:64|h.GROUP_CARD,depsIndex:64|h.INT_DELTA,extraLen:80|h.VALUE_LEN,extraRaw:80|h.VALUE_RAW};function ee(A,O,z){if(O.length===1)A[O[0]]=z;else{let x=Object.assign({},A[O[0]]);ee(x,O.slice(1),z),A[O[0]]=x}}function ce(A,O){if(!A||!A.actorId)return A;let z=A.counter,x=O.indexOf(A.actorId);if(x<0)throw new RangeError("missing actorId");return{counter:z,actorNum:x,actorId:A.actorId}}function B(A,O){return A.counter<O.counter?-1:A.counter>O.counter?1:A.actorId<O.actorId?-1:A.actorId>O.actorId?1:0}function te(A,O){let z={},x=[];for(let T of A)T=v(T),z[T.actor]=!0,T.ops=k(T.ops,T.startOp,T.actor),T.ops=T.ops.map(K=>{(K=v(K)).obj!=="_root"&&(K.obj=y(K.obj)),K.elemId&&K.elemId!=="_head"&&(K.elemId=y(K.elemId)),K.child&&(K.child=y(K.child)),K.pred&&(K.pred=K.pred.map(y)),K.obj.actorId&&(z[K.obj.actorId]=!0),K.elemId&&K.elemId.actorId&&(z[K.elemId.actorId]=!0),K.child&&K.child.actorId&&(z[K.child.actorId]=!0);for(let ne of K.pred)z[ne.actorId]=!0;return K}),x.push(T);let C=Object.keys(z).sort();O&&(C=[A[0].actor].concat(C.filter(T=>T!==A[0].actor)));for(let T of x){T.actorNum=C.indexOf(T.actor);for(let K=0;K<T.ops.length;K++){let ne=T.ops[K];ne.id={counter:T.startOp+K,actorNum:T.actorNum,actorId:T.actor},ne.obj=ce(ne.obj,C),ne.elemId=ce(ne.elemId,C),ne.child=ce(ne.child,C),ne.pred=ne.pred.map(oe=>ce(oe,C))}}return{changes:x,actorIds:C}}function d(A,O){if(A.obj==="_root")O.objActor.appendValue(null),O.objCtr.appendValue(null);else{if(!(A.obj.actorNum>=0&&A.obj.counter>0))throw new RangeError(`Unexpected objectId reference: ${JSON.stringify(A.obj)}`);O.objActor.appendValue(A.obj.actorNum),O.objCtr.appendValue(A.obj.counter)}}function pe(A,O){if(A.key)O.keyActor.appendValue(null),O.keyCtr.appendValue(null),O.keyStr.appendValue(A.key);else if(A.elemId==="_head"&&A.insert)O.keyActor.appendValue(null),O.keyCtr.appendValue(0),O.keyStr.appendValue(null);else{if(!(A.elemId&&A.elemId.actorNum>=0&&A.elemId.counter>0))throw new RangeError(`Unexpected operation key: ${JSON.stringify(A)}`);O.keyActor.appendValue(A.elemId.actorNum),O.keyCtr.appendValue(A.elemId.counter),O.keyStr.appendValue(null)}}function G(A,O){let z=c.indexOf(A.action);if(z>=0)O.action.appendValue(z);else{if(typeof A.action!="number")throw new RangeError(`Unexpected operation action: ${A.action}`);O.action.appendValue(A.action)}}function M(A,O,z){let x;A<0||O>0?(x=z.valRaw.appendInt53(A),O||(O=i.LEB128_INT)):(x=z.valRaw.appendUint53(A),O=i.LEB128_UINT),z.valLen.appendValue(x<<4|O)}function l(A,O){if(A.action!=="set"&&A.action!=="inc"||A.value===null)O.valLen.appendValue(i.NULL);else if(A.value===!1)O.valLen.appendValue(i.FALSE);else if(A.value===!0)O.valLen.appendValue(i.TRUE);else if(typeof A.value=="string"){let z=O.valRaw.appendRawString(A.value);O.valLen.appendValue(z<<4|i.UTF8)}else if(ArrayBuffer.isView(A.value)){let z=O.valRaw.appendRawBytes(new Uint8Array(A.value.buffer));O.valLen.appendValue(z<<4|i.BYTES)}else if(A.datatype==="counter"&&typeof A.value=="number")M(A.value,i.COUNTER,O);else if(A.datatype==="timestamp"&&typeof A.value=="number")M(A.value,i.TIMESTAMP,O);else if(typeof A.datatype=="number"&&A.datatype>=i.MIN_UNKNOWN&&A.datatype<=i.MAX_UNKNOWN&&A.value instanceof Uint8Array){let z=O.valRaw.appendRawBytes(A.value);O.valLen.appendValue(z<<4|A.datatype)}else{if(A.datatype)throw new RangeError(`Unknown datatype ${A.datatype} for value ${A.value}`);if(typeof A.value!="number")throw new RangeError(`Unsupported value in operation: ${A.value}`);if(Number.isInteger(A.value)&&A.value<=Number.MAX_SAFE_INTEGER&&A.value>=Number.MIN_SAFE_INTEGER)M(A.value,0,O);else{let z=new ArrayBuffer(4),x=new DataView(z);if(x.setFloat32(0,A.value,!0),x.getFloat32(0,!0)===A.value)O.valRaw.appendRawBytes(new Uint8Array(z)),O.valLen.appendValue(64|i.IEEE754);else{let C=new ArrayBuffer(8);new DataView(C).setFloat64(0,A.value,!0),O.valRaw.appendRawBytes(new Uint8Array(C)),O.valLen.appendValue(128|i.IEEE754)}}}}function m(A,O){if(A===i.NULL)return{value:null};if(A===i.FALSE)return{value:!1};if(A===i.TRUE)return{value:!0};if(A%16===i.UTF8)return{value:Q(O)};if(A%16===i.LEB128_UINT)return{value:new J(O).readUint53()};if(A%16===i.LEB128_INT)return{value:new J(O).readInt53()};if(A%16===i.IEEE754){let z=new DataView(O.buffer,O.byteOffset,O.byteLength);if(O.byteLength===4)return{value:z.getFloat32(0,!0)};if(O.byteLength===8)return{value:z.getFloat64(0,!0)};throw new RangeError(`Invalid length for floating point number: ${O.byteLength}`)}return A%16===i.COUNTER?{value:new J(O).readInt53(),datatype:"counter"}:A%16===i.TIMESTAMP?{value:new J(O).readInt53(),datatype:"timestamp"}:{value:O,datatype:A%16}}function X(A,O,z,x){let{columnId:C,columnName:T,decoder:K}=A[O];if(C%8===h.VALUE_LEN&&O+1<A.length&&A[O+1].columnId===C+1){let ne=K.readValue(),oe=A[O+1].decoder.readRawBytes(ne>>4),{value:de,datatype:se}=m(ne,oe);return x[T]=de,se&&(x[T+"_datatype"]=se),2}if(C%8===h.ACTOR_ID){let ne=K.readValue();if(ne===null)x[T]=null;else{if(!z[ne])throw new RangeError(`No actor index ${ne}`);x[T]=z[ne]}}else x[T]=K.readValue();return 1}function g(A,O){let z={objActor:new q("uint"),objCtr:new q("uint"),keyActor:new q("uint"),keyCtr:new u,keyStr:new q("utf8"),insert:new j,action:new q("uint"),valLen:new q("uint"),valRaw:new Z,chldActor:new q("uint"),chldCtr:new u};O?(z.idActor=new q("uint"),z.idCtr=new u,z.succNum=new q("uint"),z.succActor=new q("uint"),z.succCtr=new u):(z.predNum=new q("uint"),z.predCtr=new u,z.predActor=new q("uint"));for(let C of A)if(d(C,z),pe(C,z),z.insert.appendValue(!!C.insert),G(C,z),l(C,z),C.child&&C.child.counter?(z.chldActor.appendValue(C.child.actorNum),z.chldCtr.appendValue(C.child.counter)):(z.chldActor.appendValue(null),z.chldCtr.appendValue(null)),O){z.idActor.appendValue(C.id.actorNum),z.idCtr.appendValue(C.id.counter),z.succNum.appendValue(C.succ.length),C.succ.sort(B);for(let T=0;T<C.succ.length;T++)z.succActor.appendValue(C.succ[T].actorNum),z.succCtr.appendValue(C.succ[T].counter)}else{z.predNum.appendValue(C.pred.length),C.pred.sort(B);for(let T=0;T<C.pred.length;T++)z.predActor.appendValue(C.pred[T].actorNum),z.predCtr.appendValue(C.pred[T].counter)}let x=[];for(let[C,T]of Object.entries(O?V:D))z[C]&&x.push({id:T,name:C,encoder:z[C]});return x.sort((C,T)=>C.id-T.id)}function k(A,O,z){let x=O,C=[];for(let T of A)if(T.action==="set"&&T.values&&T.insert){if(T.pred.length!==0)throw new RangeError("multi-insert pred must be empty");let K=T.elemId;for(let ne of T.values)C.push({action:"set",obj:T.obj,elemId:K,value:ne,pred:[],insert:!0}),K=`${x}@${z}`,x+=1}else if(T.action==="del"&&T.multiOp>1){if(T.pred.length!==1)throw new RangeError("multiOp deletion must have exactly one pred");let K=y(T.elemId),ne=y(T.pred[0]);for(let oe=0;oe<T.multiOp;oe++){let de=`${K.counter+oe}@${K.actorId}`,se=[`${ne.counter+oe}@${ne.actorId}`];C.push({action:"del",obj:T.obj,elemId:de,pred:se}),x+=1}}else C.push(T),x+=1;return C}function Ie(A,O){let z=[];for(let x of A){let C=x.objCtr===null?"_root":`${x.objCtr}@${x.objActor}`,T=x.keyStr?void 0:x.keyCtr===0?"_head":`${x.keyCtr}@${x.keyActor}`,K=c[x.action]||x.action,ne=T?{obj:C,elemId:T,action:K}:{obj:C,key:x.keyStr,action:K};if(ne.insert=!!x.insert,c[x.action]!=="set"&&c[x.action]!=="inc"||(ne.value=x.valLen,x.valLen_datatype&&(ne.datatype=x.valLen_datatype)),!!x.chldCtr!=!!x.chldActor)throw new RangeError(`Mismatched child columns: ${x.chldCtr} and ${x.chldActor}`);x.chldCtr!==null&&(ne.child=`${x.chldCtr}@${x.chldActor}`),O?(ne.id=`${x.idCtr}@${x.idActor}`,ne.succ=x.succNum.map(oe=>`${oe.succCtr}@${oe.succActor}`),ye(x.succNum.map(oe=>({counter:oe.succCtr,actorId:oe.succActor})))):(ne.pred=x.predNum.map(oe=>`${oe.predCtr}@${oe.predActor}`),ye(x.predNum.map(oe=>({counter:oe.predCtr,actorId:oe.predActor})))),z.push(ne)}return z}function ye(A){let O=null;for(let z of A){if(O&&B(O,z)!==-1)throw new RangeError("operation IDs are not in ascending order");O=z}}function ie(A){return(7&A)===h.INT_DELTA?new u:(7&A)===h.BOOLEAN?new j:(7&A)===h.STRING_RLE?new q("utf8"):(7&A)===h.VALUE_RAW?new Z:new q("uint")}function we(A,O){return(7&A)===h.INT_DELTA?new _(O):(7&A)===h.BOOLEAN?new W(O):(7&A)===h.STRING_RLE?new S("utf8",O):(7&A)===h.VALUE_RAW?new J(O):new S("uint",O)}function Ae(A,O){let z=new Uint8Array(0),x={};for(let T of Object.values(O))x[T]=we(T,z);for(let T of A)x[T.columnId]=we(T.columnId,T.buffer);let C=[];for(let T of Object.keys(x).map(K=>parseInt(K,10)).sort((K,ne)=>K-ne)){let[K]=Object.entries(O).find(([,ne])=>ne===T);K||(K=T.toString()),C.push({columnId:T,columnName:K,decoder:x[T]})}return C}function Oe(A,O,z){A=Ae(A,z);let x=[];for(;A.some(C=>!C.decoder.done);){let C={},T=0;for(;T<A.length;){let K=A[T].columnId,ne=K>>4,oe=1;for(;T+oe<A.length&&A[T+oe].columnId>>4===ne;)oe++;if(K%8===h.GROUP_CARD){let de=[],se=A[T].decoder.readValue();for(let be=0;be<se;be++){let ve={};for(let ue=1;ue<oe;ue++)X(A,T+ue,O,ve);de.push(ve)}C[A[T].columnName]=de,T+=oe}else T+=X(A,T,O,C)}x.push(C)}return x}function xe(A){let z=-1,x=[],C=A.readUint53();for(let T=0;T<C;T++){let K=A.readUint53(),ne=A.readUint53();if((K&4294967287)<=(z&4294967287))throw new RangeError("Columns must be in ascending order");z=K,x.push({columnId:K,bufferLen:ne})}return x}function ke(A,O){let z=O.filter(x=>x.encoder.buffer.byteLength>0);A.appendUint53(z.length);for(let x of z)A.appendUint53(x.id),A.appendUint53(x.encoder.buffer.byteLength)}function Se(A){let O=A.readUint53(),z=[];for(let K=0;K<O;K++)z.push(L(A.readRawBytes(32)));let x={actor:A.readHexString(),seq:A.readUint53(),startOp:A.readUint53(),time:A.readInt53(),message:A.readPrefixedString(),deps:z},C=[x.actor],T=A.readUint53();for(let K=0;K<T;K++)C.push(A.readHexString());return x.actorIds=C,x}function qe(A,O){let z=I.byteLength+4+1+5,x=new Z;x.appendRawBytes(new Uint8Array(z)),O(x);let C=x.buffer,T=new Z;T.appendByte(A),T.appendUint53(C.byteLength-z);let K=T.buffer,ne=new w;ne.update(K),ne.update(C.subarray(z));let oe=ne.digest(),de=oe.subarray(0,4);return C.set(I,z-K.byteLength-4-I.byteLength),C.set(de,z-K.byteLength-4),C.set(K,z-K.byteLength),{hash:oe,bytes:C.subarray(z-K.byteLength-4-I.byteLength)}}function We(A,O){if(!F(A.readRawBytes(I.byteLength),I))throw new RangeError("Data does not begin with magic bytes 85 6f 4a 83");let z=A.readRawBytes(4),x=A.offset,C=A.readByte(),T=A.readUint53(),K={chunkType:C,chunkLength:T,chunkData:A.readRawBytes(T)};if(O){let ne=new w;ne.update(A.buf.subarray(x,A.offset));let oe=ne.digest();if(!F(oe.subarray(0,4),z))throw new RangeError("checksum does not match data");K.hash=L(oe)}return K}function o(A){let{changes:O,actorIds:z}=te([A],!0),x=O[0],{hash:C,bytes:T}=qe(1,ne=>{if(!Array.isArray(x.deps))throw new TypeError("deps is not an array");ne.appendUint53(x.deps.length);for(let de of x.deps.slice().sort())ne.appendRawBytes(U(de));ne.appendHexString(x.actor),ne.appendUint53(x.seq),ne.appendUint53(x.startOp),ne.appendInt53(x.time),ne.appendPrefixedString(x.message||""),ne.appendUint53(z.length-1);for(let de of z.slice(1))ne.appendHexString(de);let oe=g(x.ops,!1);ke(ne,oe);for(let de of oe)ne.appendRawBytes(de.encoder.buffer);x.extraBytes&&ne.appendRawBytes(x.extraBytes)}),K=L(C);if(A.hash&&A.hash!==K)throw new RangeError(`Change hash does not match encoding: ${A.hash} != ${K}`);return T.byteLength>=256?function(ne){let oe=We(new J(ne),!1);if(oe.chunkType!==1)throw new RangeError(`Unexpected chunk type: ${oe.chunkType}`);let de=p.deflateRaw(oe.chunkData),se=new Z;return se.appendRawBytes(ne.subarray(0,8)),se.appendByte(2),se.appendUint53(de.byteLength),se.appendRawBytes(de),se.buffer}(T):T}function he(A){let O=new J(A),z=We(O,!0),x=new J(z.chunkData);if(!O.done)throw new RangeError("Encoded change has trailing data");if(z.chunkType!==1)throw new RangeError(`Unexpected chunk type: ${z.chunkType}`);let C=Se(x),T=xe(x);for(let K=0;K<T.length;K++){if((8&T[K].columnId)!=0)throw new RangeError("change must not contain deflated columns");T[K].buffer=x.readRawBytes(T[K].bufferLen)}if(!x.done){let K=x.buf.byteLength-x.offset;C.extraBytes=x.readRawBytes(K)}return C.columns=T,C.hash=z.hash,C}function ae(A){A[8]===2&&(A=le(A));let O=he(A);return O.ops=Ie(Oe(O.columns,O.actorIds,D),!1),delete O.actorIds,delete O.columns,O}function le(A){let O=We(new J(A),!1);if(O.chunkType!==2)throw new RangeError(`Unexpected chunk type: ${O.chunkType}`);let z=p.inflateRaw(O.chunkData),x=new Z;return x.appendRawBytes(A.subarray(0,8)),x.appendByte(1),x.appendUint53(z.byteLength),x.appendRawBytes(z),x.buffer}function R(A){let O=new J(A),z=[],x=0;for(;!O.done;)We(O,!1),z.push(A.subarray(x,O.offset)),x=O.offset;return z}function Ve(A){let O=[];for(let z of A)for(let x of R(z))x[8]===0?O=O.concat(Me(x)):x[8]!==1&&x[8]!==2||O.push(ae(x));return O}function je(A,O){if(A===O)return 0;if(A==="_root")return-1;if(O==="_root")return 1;let z=y(A),x=y(O);return z.counter<x.counter?-1:z.counter>x.counter?1:z.actorId<x.actorId?-1:z.actorId>x.actorId?1:0}function _e(A){let{changes:O,actorIds:z}=te(Ve(A),!1),{changesColumns:x,heads:C}=function(K){let ne={actor:new q("uint"),seq:new u,maxOp:new u,time:new u,message:new q("utf8"),depsNum:new q("uint"),depsIndex:new u,extraLen:new q("uint"),extraRaw:new Z},oe={},de={};for(let be=0;be<K.length;be++){let ve=K[be];oe[ve.hash]=be,de[ve.hash]=!0,ne.actor.appendValue(ve.actorNum),ne.seq.appendValue(ve.seq),ne.maxOp.appendValue(ve.startOp+ve.ops.length-1),ne.time.appendValue(ve.time),ne.message.appendValue(ve.message),ne.depsNum.appendValue(ve.deps.length);for(let ue of ve.deps){if(typeof oe[ue]!="number")throw new RangeError(`Unknown dependency hash: ${ue}`);ne.depsIndex.appendValue(oe[ue]),de[ue]&&delete de[ue]}ve.extraBytes?(ne.extraLen.appendValue(ve.extraBytes.byteLength<<4|i.BYTES),ne.extraRaw.appendRawBytes(ve.extraBytes)):ne.extraLen.appendValue(i.BYTES)}let se=[];for(let[be,ve]of Object.entries(H))se.push({id:ve,name:be,encoder:ne[be]});return se.sort((be,ve)=>be.id-ve.id),{changesColumns:se,heads:Object.keys(de).sort()}}(O),T=g(function(K){let ne={},oe={},de={};for(let be of K)for(let ve=0;ve<be.ops.length;ve++){let ue=be.ops[ve],ze=`${ue.id.counter}@${ue.id.actorId}`,Re=ue.obj==="_root"?"_root":`${ue.obj.counter}@${ue.obj.actorId}`,Te;if(ue.action.startsWith("make")&&(de[ze]=ue.action,ue.action!=="makeList"&&ue.action!=="makeText"||(oe[ze]={_head:[]})),Re==="_root"||de[Re]==="makeMap"||de[Re]==="makeTable")Te=ue.key;else{if(de[Re]!=="makeList"&&de[Re]!=="makeText")throw new RangeError(`Unknown object type for object ${Re}`);if(ue.insert){Te=ze;let Pe=ue.elemId==="_head"?"_head":`${ue.elemId.counter}@${ue.elemId.actorId}`;oe[Re][Pe].push(ze),oe[Re][ze]=[]}else Te=`${ue.elemId.counter}@${ue.elemId.actorId}`}ne[Re]||(ne[Re]={}),ne[Re][Te]||(ne[Re][Te]={}),ne[Re][Te][ze]=ue,ue.succ=[];for(let Pe of ue.pred){let $e=`${Pe.counter}@${Pe.actorId}`;if(!ne[Re][Te][$e])throw new RangeError(`No predecessor operation ${$e}`);ne[Re][Te][$e].succ.push(ue.id)}}let se=[];for(let be of Object.keys(ne).sort(je)){let ve=[];if(de[be]==="makeList"||de[be]==="makeText"){let ue=["_head"];for(;ue.length>0;){let ze=ue.pop();ze!=="_head"&&ve.push(ze);for(let Re of oe[be][ze].sort(je))ue.push(Re)}}else ve=Object.keys(ne[be]).sort();for(let ue of ve)for(let ze of Object.keys(ne[be][ue]).sort(je)){let Re=ne[be][ue][ze];Re.action!=="del"&&se.push(Re)}}return se}(O),!0);for(let K of x)at(K);for(let K of T)at(K);return qe(0,K=>{K.appendUint53(z.length);for(let ne of z)K.appendHexString(ne);K.appendUint53(C.length);for(let ne of C.sort())K.appendRawBytes(U(ne));ke(K,x),ke(K,T);for(let ne of x)K.appendRawBytes(ne.encoder.buffer);for(let ne of T)K.appendRawBytes(ne.encoder.buffer)}).bytes}function Je(A){let O=new J(A),z=We(O,!0),x=new J(z.chunkData);if(!O.done)throw new RangeError("Encoded document has trailing data");if(z.chunkType!==0)throw new RangeError(`Unexpected chunk type: ${z.chunkType}`);let C=[],T=x.readUint53();for(let se=0;se<T;se++)C.push(x.readHexString());let K=[],ne=x.readUint53();for(let se=0;se<ne;se++)K.push(L(x.readRawBytes(32)));let oe=xe(x),de=xe(x);for(let se=0;se<oe.length;se++)oe[se].buffer=x.readRawBytes(oe[se].bufferLen),it(oe[se]);for(let se=0;se<de.length;se++)de[se].buffer=x.readRawBytes(de[se].bufferLen),it(de[se]);return{changesColumns:oe,opsColumns:de,actorIds:C,heads:K,extraBytes:x.readRawBytes(x.buf.byteLength-x.offset)}}function Me(A){let{changesColumns:O,opsColumns:z,actorIds:x,heads:C}=Je(A),T=Oe(O,x,H);return function(K,ne){let oe={};for(let se of K){if(se.ops=[],oe[se.actor]||(oe[se.actor]=[]),se.seq!==oe[se.actor].length+1)throw new RangeError(`Expected seq = ${oe[se.actor].length+1}, got ${se.seq}`);if(se.seq>1&&oe[se.actor][se.seq-2].maxOp>se.maxOp)throw new RangeError("maxOp must increase monotonically per actor");oe[se.actor].push(se)}let de={};for(let se of ne){if(se.action==="del")throw new RangeError("document should not contain del operations");se.pred=de[se.id]?de[se.id].pred:[],de[se.id]=se;for(let be of se.succ){if(!de[be])if(se.elemId){let ve=se.insert?se.id:se.elemId;de[be]={id:be,action:"del",obj:se.obj,elemId:ve,pred:[]}}else de[be]={id:be,action:"del",obj:se.obj,key:se.key,pred:[]};de[be].pred.push(se.id)}delete se.succ}for(let se of Object.values(de))se.action==="del"&&ne.push(se);for(let se of ne){let{counter:be,actorId:ve}=y(se.id),ue=oe[ve],ze=0,Re=ue.length;for(;ze<Re;){let Te=Math.floor((ze+Re)/2);ue[Te].maxOp<be?ze=Te+1:Re=Te}if(ze>=ue.length)throw new RangeError(`Operation ID ${se.id} outside of allowed range`);ue[ze].ops.push(se)}for(let se of K){se.ops.sort((be,ve)=>je(be.id,ve.id)),se.startOp=se.maxOp-se.ops.length+1,delete se.maxOp;for(let be=0;be<se.ops.length;be++){let ve=se.ops[be],ue=`${se.startOp+be}@${se.actor}`;if(ve.id!==ue)throw new RangeError(`Expected opId ${ue}, got ${ve.id}`);delete ve.id}}}(T,Ie(Oe(z,x,V),!0)),function(K,ne){let oe={};for(let ve=0;ve<K.length;ve++){let ue=K[ve];ue.deps=[];for(let ze of ue.depsNum.map(Re=>Re.depsIndex)){if(!K[ze]||!K[ze].hash)throw new RangeError(`No hash for index ${ze} while processing index ${ve}`);let Re=K[ze].hash;ue.deps.push(Re),oe[Re]&&delete oe[Re]}if(ue.deps.sort(),delete ue.depsNum,ue.extraLen_datatype!==i.BYTES)throw new RangeError(`Bad datatype for extra bytes: ${i.BYTES}`);ue.extraBytes=ue.extraLen,delete ue.extraLen_datatype,K[ve]=ae(o(ue)),oe[K[ve].hash]=!0}let de=Object.keys(oe).sort(),se=de.length===ne.length,be=0;for(;se&&be<de.length;)se=de[be]===ne[be],be++;if(!se)throw new RangeError(`Mismatched heads hashes: expected ${ne.join(", ")}, got ${de.join(", ")}`)}(T,C),T}function at(A){A.encoder.buffer.byteLength>=256&&(A.encoder={buffer:p.deflateRaw(A.encoder.buffer)},A.id|=8)}function it(A){(8&A.columnId)!=0&&(A.buffer=p.inflateRaw(A.buffer),A.columnId^=8)}function pt(A,O){let z={},x=null;for(let C of O.ops)if(C.actionName==="set"&&C.value.datatype==="counter"){x||(x={opId:C.opId,value:0,succ:{}}),x.value+=C.value.value;for(let T of C.succ)x.succ[T]=!0}else if(C.actionName==="inc"){if(!x)throw new RangeError(`inc operation ${C.opId} without a counter`);x.value+=C.value.value,delete x.succ[C.opId];for(let T of C.succ)x.succ[T]=!0}else if(C.succ.length===0)if(C.actionName.startsWith("make"))z[C.opId]=A[C.opId];else if(C.actionName==="set")z[C.opId]={value:C.value.value,type:"value"},C.value.datatype&&(z[C.opId].datatype=C.value.datatype);else{if(C.actionName!=="link")throw new RangeError(`Unexpected action type: ${C.actionName}`);if(!C.childId)throw new RangeError(`link operation ${C.opId} without a childId`);z[C.opId]=A[C.childId]}if(x&&Object.keys(x.succ).length===0&&(z[x.opId]={type:"value",value:x.value,datatype:"counter"}),Object.keys(z).length>0){let C=A[O.objId];return C.type==="map"||C.type==="table"?C.props[O.key]=z:C.type!=="list"&&C.type!=="text"||function(T,K,ne,oe){let de=!0,se=Object.keys(K).sort((be,ve)=>B(y(be),y(ve)));for(let be of se)de?T.edits.push({action:"insert",value:K[be],elemId:ne,opId:be,index:oe}):T.edits.push({action:"update",value:K[be],opId:be,index:oe}),de=!1}(C,z,O.key,O.index),!0}return!1}function st(A){if(A.type==="list"||A.type==="text"){A.edits.forEach(z=>st(z.value));let O=A.edits;A.edits=[];for(let z of O)jt(A.edits,z)}else if(A.type==="map"||A.type==="table")for(let O of Object.keys(A.props))for(let z of Object.keys(A.props[O]))st(A.props[O][z])}function jt(A,O){if(A.length===0)return void A.push(O);let z=A[A.length-1];z.action==="insert"&&O.action==="insert"&&z.index===O.index-1&&z.value.type==="value"&&O.value.type==="value"&&z.elemId===z.opId&&O.elemId===O.opId&&Vt(z.elemId,O.elemId,1)?(z.action="multi-insert",z.values=[z.value.value,O.value.value],delete z.value,delete z.opId):z.action==="multi-insert"&&O.action==="insert"&&z.index+z.values.length===O.index&&O.value.type==="value"&&O.elemId===O.opId&&Vt(z.elemId,O.elemId,z.values.length)?z.values.push(O.value.value):z.action==="remove"&&O.action==="remove"&&z.index===O.index?z.count+=O.count:A.push(O)}function Vt(A,O,z=1){let x=y(A),C=y(O);return x.actorId===C.actorId&&x.counter+z===C.counter}function Ut(A,O,z){let{objActor:x,objCtr:C,keyActor:T,keyCtr:K,keyStr:ne,idActor:oe,idCtr:de,insert:se}=A,[be,ve,,,ue,ze,Re,Te,Pe,,,,,$e]=O.map(wt=>wt.decoder),Ee=0,Ke=0,et=!1,Ye=null,He=null,Ue=null,Ne=null,rt=null,Ze=null,De=0;if(C!==null)for(;(!ve.done||!be.done||!Pe.done)&&(He=ve.readValue(),Ye=z[be.readValue()],Pe.skipValues(1),He===null||!Ye||He<C||He===C&&Ye<x);)Ee+=1;if(He!==C||Ye!==x)return{skipCount:Ee,visibleCount:Ke};if(ne!==null){for(ue.skipValues(Ee);!ue.done;){let wt=be.readValue();if(Ye=wt===null?null:z[wt],He=ve.readValue(),rt=ue.readValue(),!(rt!==null&&rt<ne&&He===C&&Ye===x))break;Ee+=1}return{skipCount:Ee,visibleCount:Ke}}if(Re.skipValues(Ee),ze.skipValues(Ee),Te.skipValues(Ee),$e.skipValues(Ee),Ne=Re.readValue(),Ue=z[ze.readValue()],Ze=Te.readValue(),De=$e.readValue(),se){if(K!==null&&K>0&&T!==null){for(Ee+=1;!(Re.done||ze.done||Ne===K&&Ue===T)&&(Ze&&(et=!1),De!==0||et||(Ke+=1,et=!0),Ne=Re.readValue(),Ue=z[ze.readValue()],He=ve.readValue(),Ye=z[be.readValue()],Ze=Te.readValue(),De=$e.readValue(),He===C&&Ye===x);)Ee+=1;if(He!==C||Ye!==x||Ne!==K||Ue!==T||!Ze)throw new RangeError(`Reference element not found: ${K}@${T}`);if(Ze&&(et=!1),De!==0||et||(Ke+=1,et=!0),Re.done||ze.done)return{skipCount:Ee,visibleCount:Ke};Ne=Re.readValue(),Ue=z[ze.readValue()],He=ve.readValue(),Ye=z[be.readValue()],Ze=Te.readValue(),De=$e.readValue()}for(;(!Ze||Ne>de||Ne===de&&Ue>oe)&&He===C&&Ye===x&&(Ee+=1,Ze&&(et=!1),De!==0||et||(Ke+=1,et=!0),!Re.done&&!ze.done);)Ne=Re.readValue(),Ue=z[ze.readValue()],He=ve.readValue(),Ye=z[be.readValue()],Ze=Te.readValue(),De=$e.readValue()}else if(K!==null&&K>0&&T!==null){for(;!(Ze&&Ne===K&&Ue===T||He!==C||Ye!==x||(Ee+=1,Ze&&(et=!1),De!==0||et||(Ke+=1,et=!0),Re.done||ze.done));)Ne=Re.readValue(),Ue=z[ze.readValue()],He=ve.readValue(),Ye=z[be.readValue()],Ze=Te.readValue(),De=$e.readValue();if(He!==C||Ye!==x||Ne!==K||Ue!==T||!Ze)throw new RangeError(`Element not found for update: ${K}@${T}`)}return{skipCount:Ee,visibleCount:Ke}}function Dt(A,O,z){if(z===0)return;let x=0,C=-1,T=0,K=-1,ne=0;for(let oe of A){for(;x<O.length&&O[x].columnId<oe.columnId;)x++;let de=null;x<O.length&&O[x].columnId===oe.columnId&&O[x].decoder.buf.byteLength>0&&(de=O[x].decoder);let se=oe.columnId>>4===C?T:z;if(oe.columnId%8===h.GROUP_CARD)C=oe.columnId>>4,de?T=oe.encoder.copyFrom(de,{count:z,sumValues:!0}).sum:(oe.encoder.appendValue(0,z),T=0);else if(oe.columnId%8===h.VALUE_LEN)if(de){if(x+1===O.length||O[x+1].columnId!==oe.columnId+1)throw new RangeError("VALUE_LEN column without accompanying VALUE_RAW column");K=oe.columnId+1,ne=oe.encoder.copyFrom(de,{count:se,sumValues:!0,sumShift:4}).sum}else oe.encoder.appendValue(null,se),K=oe.columnId+1,ne=0;else if(oe.columnId%8===h.VALUE_RAW){if(oe.columnId!==K)throw new RangeError("VALUE_RAW column without accompanying VALUE_LEN column");ne>0&&oe.encoder.appendRawBytes(de.readRawBytes(ne))}else if(de)oe.encoder.copyFrom(de,{count:se});else{let be=oe.columnId%8!==h.BOOLEAN&&null;oe.encoder.appendValue(be,se)}}}function $t(A,O){let z,x=[],C=-1,T=0,K=-1,ne=0;for(let oe of A){if(oe.columnId%8===h.VALUE_RAW){if(oe.columnId!==K)throw new RangeError("unexpected VALUE_RAW column");z=oe.decoder.readRawBytes(ne)}else if(oe.columnId%8===h.GROUP_CARD)C=oe.columnId>>4,T=oe.decoder.readValue()||0,z=T;else if(oe.columnId>>4===C){z=[],oe.columnId%8===h.VALUE_LEN&&(K=oe.columnId+1,ne=0);for(let de=0;de<T;de++){let se=oe.decoder.readValue();oe.columnId%8===h.ACTOR_ID&&O&&typeof se=="number"&&(se=O[se]),oe.columnId%8===h.VALUE_LEN&&(ne+=z>>>4),z.push(se)}}else z=oe.decoder.readValue(),oe.columnId%8===h.ACTOR_ID&&O&&typeof z=="number"&&(z=O[z]),oe.columnId%8===h.VALUE_LEN&&(K=oe.columnId+1,ne=z>>>4);x.push(z)}return x}function Qe(A,O,z){let x=0,C=-1,T=0;for(let K of A){for(;x<O.length&&O[x].columnId<K.columnId;)x++;if(x<O.length&&O[x].columnId===K.columnId){let ne=z[x];if(K.columnId%8===h.GROUP_CARD)C=K.columnId>>4,T=ne,K.encoder.appendValue(ne);else if(K.columnId>>4===C){if(!Array.isArray(ne)||ne.length!==T)throw new RangeError("bad group value");for(let oe of ne)K.encoder.appendValue(oe)}else K.columnId%8===h.VALUE_RAW?K.encoder.appendRawBytes(ne):K.encoder.appendValue(ne)}else if(K.columnId%8===h.GROUP_CARD)C=K.columnId>>4,T=0,K.encoder.appendValue(0);else if(K.columnId%8!==h.VALUE_RAW){let ne=K.columnId>>4===C?T:1,oe=null;K.columnId%8===h.BOOLEAN&&(oe=!1),K.columnId%8===h.VALUE_LEN&&(oe=0),K.encoder.appendValue(oe,ne)}}}function Zt(A,O,z){let x=A.actorIds[0],[C,T,K,ne,oe,,,de,se]=O.map(Pe=>Pe.decoder),be={},ve=null,ue=null,ze=A.startOp,Re=[],Te={};for(;!se.done;){let Pe=C.readValue(),$e=K.readValue(),Ee={objActor:Pe===null?null:A.actorIds[Pe],objCtr:T.readValue(),keyActor:$e===null?null:A.actorIds[$e],keyCtr:ne.readValue(),keyStr:oe.readValue(),idActor:x,idCtr:ze,insert:de.readValue(),action:se.readValue(),idActorIndex:-1,consecutiveOps:1};if(Ee.objCtr===null&&Ee.objActor!==null||Ee.objCtr!==null&&typeof Ee.objActor!="string")throw new RangeError(`Mismatched object reference: (${Ee.objCtr}, ${Ee.objActor})`);if(Ee.keyCtr===null&&Ee.keyActor!==null||Ee.keyCtr===0&&Ee.keyActor!==null||Ee.keyCtr>0&&typeof Ee.keyActor!="string")throw new RangeError(`Mismatched operation key: (${Ee.keyCtr}, ${Ee.keyActor})`);if(Ee.opId=`${Ee.idCtr}@${Ee.idActor}`,Ee.objId=Ee.objCtr===null?"_root":`${Ee.objCtr}@${Ee.objActor}`,Te[Ee.objId]=!0,Ee.action%2==0){let Ke;Ke=Ee.keyStr!==null?Ee.keyStr:Ee.insert?Ee.opId:`${Ee.keyCtr}@${Ee.keyActor}`;let et=Ee.action<c.length?b[c[Ee.action]]:null;z[Ee.opId]={parentObj:Ee.objId,parentKey:Ke,opId:Ee.opId,type:et,children:{}},Te[Ee.opId]=!0,ee(z,[Ee.objId,"children",Ke,Ee.opId],{objectId:Ee.opId,type:et,props:{}})}ve?Ee.objActor===ue.objActor&&Ee.objCtr===ue.objCtr&&(Ee.keyStr!==null&&ue.keyStr!==null&&ue.keyStr<=Ee.keyStr||Ee.keyStr===null&&ue.keyStr===null&&!ue.insert&&!Ee.insert||Ee.keyStr===null&&ue.keyStr===null&&ue.insert&&Ee.insert&&Ee.keyActor===ue.idActor&&Ee.keyCtr===ue.idCtr)?(ve.consecutiveOps+=1,ue=Ee):(be[Ee.objId]=!0,Re.push(ve),ve=Ee,ue=Ee):(ve=Ee,ue=Ee),ze+=1}return ve&&Re.push(ve),{opSequences:Re,objectIds:Object.keys(Te)}}class ct{constructor(O){if(this.maxOp=0,this.changes=[],this.changeByHash={},this.hashesByActor={},this.actorIds=[],this.heads=[],this.clock={},O){let z=Je(O);for(let x of Ve([O])){let C=o(x);this.changes.push(C),this.changeByHash[x.hash]=C,this.clock[x.actor]=Math.max(x.seq,this.clock[x.actor]||0)}this.actorIds=z.actorIds,this.heads=z.heads,this.docColumns=Ae(z.opsColumns,V),this.numOps=0,this.objectMeta={}}else this.docColumns=Ae([],V),this.numOps=0,this.objectMeta={_root:{parentObj:null,parentKey:null,opId:null,type:"map",children:{}}}}clone(){let O=new ct;return O.maxOp=this.maxOp,O.changes=this.changes,O.changeByHash=this.changeByHash,O.actorIds=this.actorIds,O.heads=this.heads,O.clock=this.clock,O.docColumns=this.docColumns,O.numOps=this.numOps,O.objectMeta=this.objectMeta,O}updatePatchProperty(O,z,x,C,T,K,ne){let oe=z.objId,de=x[4]?x[4]:x[7]?`${x[6]}@${C.actorIds[x[5]]}`:`${x[3]}@${C.actorIds[x[2]]}`,se=ne!==void 0&&x[13]>0;O[oe]||(O[oe]={objectId:oe,type:C.objectMeta[oe].type,props:{}});let be=O[oe];if(x[4]===null?(be.edits||(be.edits=[]),se||(T[de]?T[de].action==="remove"&&(be.edits.pop(),T[de].action="update"):(be.edits.push({action:"insert",index:K,elemId:de}),T[de]={action:"insert",visibleOps:[],hasChild:!1})),ne===0&&(T[de]?T[de].action==="insert"&&(be.edits.pop(),T[de].action="update"):(be.edits.push({action:"remove",index:K}),T[de]={action:"remove",visibleOps:[],hasChild:!1})),!be.props[K]&&T[de]&&["insert","update"].includes(T[de].action)&&(be.props[K]={})):be.props[x[4]]||(be.props[x[4]]={}),!se&&(T[de]||(T[de]={visibleOps:[],hasChild:!1}),T[de].visibleOps.push(x),T[de].hasChild=T[de].hasChild||x[8]%2==0,T[de].hasChild)){let ze={};for(let Re of T[de].visibleOps){let Te=`${Re[6]}@${C.actorIds[Re[5]]}`;if(c[Re[8]]==="set")ze[Te]=m(Re[9],Re[10]);else if(Re[8]%2==0){let Pe=Re[8]<c.length?b[c[Re[8]]]:null;ze[Te]={objectId:Te,type:Pe,props:{}}}}ee(C.objectMeta,[oe,"children",de],ze)}let ve=`${x[6]}@${C.actorIds[x[5]]}`,ue=x[4]!==null?x[4]:K;if(se&&c[x[8]]==="set"&&(15&x[9])===i.COUNTER){T[de]||(T[de]={visibleOps:[],hasChild:!1}),T[de].counterStates||(T[de].counterStates={});let ze=T[de].counterStates,Re={opId:ve,value:m(x[9],x[10]).value,succs:{}};for(let Te=0;Te<x[13];Te++){let Pe=`${x[15][Te]}@${C.actorIds[x[14][Te]]}`;ze[Pe]=Re,Re.succs[Pe]=!0}}else if(c[x[8]]==="inc"){if(!T[de]||!T[de].counterStates||!T[de].counterStates[ve])throw new RangeError(`increment operation ${ve} for unknown counter`);let ze=T[de].counterStates[ve];ze.value+=m(x[9],x[10]).value,delete ze.succs[ve],Object.keys(ze.succs).length===0&&be.props[ue]&&(be.props[ue][ze.opId]={datatype:"counter",value:ze.value})}else if(be.props[ue]&&!se){if(c[x[8]]==="set")be.props[ue][ve]=m(x[9],x[10]);else if(x[8]%2==0){if(!O[ve]){let ze=x[8]<c.length?b[c[x[8]]]:null;O[ve]={objectId:ve,type:ze,props:{}}}be.props[ue][ve]=O[ve]}}}mergeDocChangeOps(O,z,x,C,T,K){if(T.opsCols[0].columnId!==V.objActor||C[0].columnId!==D.objActor||T.opsCols[1].columnId!==V.objCtr||C[1].columnId!==D.objCtr||T.opsCols[2].columnId!==V.keyActor||C[2].columnId!==D.keyActor||T.opsCols[3].columnId!==V.keyCtr||C[3].columnId!==D.keyCtr||T.opsCols[4].columnId!==V.keyStr||C[4].columnId!==D.keyStr||T.opsCols[5].columnId!==V.idActor||C[5].columnId!==D.idActor||T.opsCols[6].columnId!==V.idCtr||C[6].columnId!==D.idCtr||T.opsCols[7].columnId!==V.insert||C[7].columnId!==D.insert||T.opsCols[8].columnId!==V.action||C[8].columnId!==D.action||T.opsCols[9].columnId!==V.valLen||C[9].columnId!==D.valLen||T.opsCols[10].columnId!==V.valRaw||C[10].columnId!==D.valRaw||T.opsCols[13].columnId!==V.succNum||C[13].columnId!==D.predNum||T.opsCols[14].columnId!==V.succActor||C[14].columnId!==D.predActor||T.opsCols[15].columnId!==V.succCtr||C[15].columnId!==D.predCtr)throw new RangeError("unexpected columnId");let ne=x.consecutiveOps,oe=0,de=x.idCtr,se=!1,be=!1,ve={},ue=T.opsCols[8].decoder.done?null:$t(T.opsCols),ze=ue===null?0:1,Re=ue===null?0:ue[13],Te=null,Pe=null,$e=[],Ee=[];for(;;){if($e.length===0)for(se=!1;$e.length===0||x.insert||Pe[4]!==null&&Pe[4]===$e[0][4]||Pe[4]===null&&Pe[2]===$e[0][2]&&Pe[3]===$e[0][3];){if(Pe!==null&&($e.push(Pe),Ee.push(new Array(Pe[13]))),ne===0){Pe=null;break}Pe=$t(C,T.actorTable),Pe[5]=x.idActorIndex,Pe[6]=de,ne--,de++}$e.length>0&&(Te=$e[0]);let Ke=ue&&ue[0]===Te[0]&&ue[1]===Te[1],et=ue&&ue[4]!==null&&ue[4]===Te[4],Ye=ue&&ue[4]===null&&Te[4]===null&&(!ue[7]&&ue[2]===Te[2]&&ue[3]===Te[3]||ue[7]&&ue[5]===Te[2]&&ue[6]===Te[3]);if($e.length===0&&(!Ke||!et&&!Ye))break;let He=!1,Ue=0;if(x.insert||!Ke||ue[4]===null&&Te[4]!==null||ue[4]!==null&&Te[4]!==null&&Te[4]<ue[4]){if(Ue=$e.length,!Ke&&!se&&Te[4]===null&&!Te[7])throw new RangeError(`could not find list element with ID: ${Te[3]}@${T.actorIds[Te[2]]}`)}else if(et||Ye||se){for(let Ne=0;Ne<$e.length;Ne++){let rt=$e[Ne];for(let Ze=0;Ze<rt[13];Ze++)if(rt[14][Ze]===ue[5]&&rt[15][Ze]===ue[6]){let De=0;for(;De<ue[13]&&(ue[15][De]<rt[6]||ue[15][De]===rt[6]&&T.actorIds[ue[14][De]]<x.idActor);)De++;ue[15].splice(De,0,rt[6]),ue[14].splice(De,0,x.idActorIndex),ue[13]++,Ee[Ne][Ze]=!0;break}}if(Ye&&(se=!0),se&&!Ye)Ue=$e.length;else if($e.length===0||ue[6]<Te[6]||ue[6]===Te[6]&&T.actorIds[ue[5]]<x.idActor){He=!0,this.updatePatchProperty(O,x,ue,T,ve,K,Re);for(let Ne=$e.length-1;Ne>=0;Ne--){let rt=!0;for(let Ze=0;Ze<$e[Ne][13];Ze++)Ee[Ne][Ze]||(rt=!1);c[$e[Ne][8]]==="del"&&rt&&($e.splice(Ne,1),Ee.splice(Ne,1))}}else{if(ue[6]===Te[6]&&T.actorIds[ue[5]]===x.idActor)throw new RangeError(`duplicate operation ID: ${Te[6]}@${x.idActor}`);Ue=1}}else He=!0;if(He&&(Qe(z,T.opsCols,ue),ue[7]&&be&&(be=!1,K++),ue[13]===0&&(be=!0),oe++,ue=T.opsCols[8].decoder.done?null:$t(T.opsCols),ue!==null&&(ze++,Re=ue[13])),Ue>0){for(let Ne=0;Ne<Ue;Ne++){let rt=$e[Ne];for(let Ze=0;Ze<rt[13];Ze++)if(!Ee[Ne][Ze])throw new RangeError(`no matching operation for pred: ${rt[15][Ze]}@${T.actorIds[rt[14][Ze]]}`);this.updatePatchProperty(O,x,rt,T,ve,K),Qe(z,C,rt),rt[7]?(be=!1,K++):be=!0}Ue===$e.length?($e.length=0,Ee.length=0):($e.splice(0,Ue),Ee.splice(0,Ue)),oe+=Ue}}return ue&&(Qe(z,T.opsCols,ue),oe++),{opsAppended:oe,docOpsConsumed:ze}}applyOps(O,z,x,C){for(let se of C.opsCols)se.decoder.reset();let{skipCount:T,visibleCount:K}=Ut(z,C.opsCols,C.actorIds);if(C.lastIndex[z.objId]&&K<C.lastIndex[z.objId])throw new RangeError("list element accesses must occur in ascending order");C.lastIndex[z.objId]=K;for(let se of C.opsCols)se.decoder.reset();let ne=C.allCols.map(se=>({columnId:se,encoder:ie(se)}));Dt(ne,C.opsCols,T);let{opsAppended:oe,docOpsConsumed:de}=this.mergeDocChangeOps(O,ne,z,x,C,K);Dt(ne,C.opsCols,C.numOps-T-de);for(let se of C.opsCols)if(!se.decoder.done)throw new RangeError(`excess ops in ${se.columnName} column`);C.opsCols=ne.map(se=>{let be=we(se.columnId,se.encoder.buffer);return{columnId:se.columnId,columnName:re[se.columnId],decoder:be}}),C.numOps=C.numOps+oe-de}getAllColumns(O){let z=["objActor","objCtr","keyActor","keyCtr","keyStr","idActor","idCtr","insert","action","valLen","valRaw","chldActor","chldCtr","predNum","predActor","predCtr"],x={};for(let C=0;C<z.length;C++)if(O[C].columnName!==z[C])throw new RangeError(`Expected column ${z[C]} at index ${C}, got ${O[C].columnName}`);for(let C of O)x[C.columnId]=!0;for(let C of Object.values(V))x[C]=!0;return delete x[D.predNum],delete x[D.predActor],delete x[D.predCtr],Object.keys(x).map(C=>parseInt(C,10)).sort((C,T)=>C-T)}getActorTable(O,z){if(O.indexOf(z.actorIds[0])<0){if(z.seq!==1)throw new RangeError(`Seq ${z.seq} is the first change for actor ${z.actorIds[0]}`);O=O.concat([z.actorIds[0]])}let x=[];for(let C of z.actorIds){let T=O.indexOf(C);if(T<0)throw new RangeError(`actorId ${C} is not known to document`);x.push(T)}return{actorIds:O,actorTable:x}}setupPatches(O,z,x){for(let C of z){let T=x.objectMeta[C],K=null,ne=!1;for(;;){if(O[C]||(O[C]={objectId:C,type:T.type,props:{}}),K){let oe=K.parentKey;if(T.type==="list"||T.type==="text"){let se=y(C),be=y(oe),ve={objActor:se.actorId,objCtr:se.counter,keyActor:be.actorId,keyCtr:be.counter,keyStr:null,insert:!1},{visibleCount:ue}=Ut(ve,x.opsCols,x.actorIds);oe=ue}O[C].props[oe]||(O[C].props[oe]={});let de=O[C].props[oe];for(let[se,be]of Object.entries(T.children[K.parentKey]))de[se]?ne=!0:be.objectId?(O[be.objectId]||(O[be.objectId]=Object.assign({},be,{props:{}})),de[se]=O[be.objectId]):de[se]=be;if(!de[K.opId])throw new RangeError(`object metadata did not contain child entry for ${K.opId}`)}if(ne||!T.parentObj)break;K=T,C=T.parentObj,T=x.objectMeta[C]}}return O}applyChanges(O,z=!1){let x={_root:{objectId:"_root",type:"map",props:{}}},C={actorIds:this.actorIds,opsCols:this.docColumns,numOps:this.numOps,objectMeta:Object.assign({},this.objectMeta),lastIndex:{}},T={},K=Object.assign({},this.changeByHash),ne=this.maxOp,oe={},de=Object.assign({},this.clock);for(let ve of this.heads)oe[ve]=!0;let se=[];for(let ve of O){let ue=he(ve);se.push(ue);for(let Ke of ue.deps){if(!K[Ke])throw new RangeError(`missing dependency ${Ke}`);delete oe[Ke]}K[ue.hash]=ve,oe[ue.hash]=!0;let ze=(de[ue.actor]||0)+1;if(ue.seq!==ze)throw new RangeError(`Expected seq ${ze}, got seq ${ue.seq} from actor ${ue.actor}`);de[ue.actor]=ue.seq;let Re=Ae(ue.columns,D);C.allCols=this.getAllColumns(Re),Object.assign(C,this.getActorTable(C.actorIds,ue));let Te=C.actorIds.indexOf(ue.actorIds[0]),{opSequences:Pe,objectIds:$e}=Zt(ue,Re,C.objectMeta);for(let Ke of $e)T[Ke]=!0;let Ee=Pe[Pe.length-1];Ee&&(ne=Math.max(ne,Ee.idCtr+Ee.consecutiveOps-1));for(let Ke of Re)Ke.decoder.reset();for(let Ke of Pe)Ke.idActorIndex=Te,this.applyOps(x,Ke,Re,C)}this.setupPatches(x,Object.keys(T),C),this.maxOp=ne,this.changes=this.changes.concat(O),this.changeByHash=K,this.actorIds=C.actorIds,this.heads=Object.keys(oe).sort(),this.clock=de,this.docColumns=C.opsCols,this.numOps=C.numOps,this.objectMeta=C.objectMeta;for(let ve of se)ve.seq===1&&(this.hashesByActor[ve.actor]=[]),this.hashesByActor[ve.actor].push(ve.hash);let be={maxOp:ne,clock:de,deps:this.heads,diffs:x._root};return z&&se.length===1&&(be.actor=se[0].actor,be.seq=se[0].seq),be}getChanges(O){let z={},x=this.changes.map(he);for(let T of O)z[T]=!0;for(let T=x.length-1;T>=0;T--)if(z[x[T].hash])for(let K of x[T].deps)z[K]=!0;let C=[];for(let T=0;T<x.length;T++)z[x[T].hash]||C.push(this.changes[T]);return C}getMissingDeps(){return[]}save(){return _e(this.changes)}}N.exports={COLUMN_TYPE:h,VALUE_TYPE:i,ACTIONS:c,DOC_OPS_COLUMNS:V,CHANGE_COLUMNS:D,DOCUMENT_COLUMNS:H,splitContainers:R,encodeChange:o,decodeChange:ae,decodeChangeMeta:function(A,O){A[8]===2&&(A=le(A));let z=We(new J(A),O);if(z.chunkType!==1)throw new RangeError("Buffer chunk type is not a change");let x=Se(new J(z.chunkData));return x.change=A,O&&(x.hash=z.hash),x},decodeChanges:Ve,encodeDocument:_e,decodeDocument:Me,getChangeChecksum:function(A){if(A[0]!==I[0]||A[1]!==I[1]||A[2]!==I[2]||A[3]!==I[3])throw new RangeError("Data does not begin with magic bytes 85 6f 4a 83");return(A[4]<<24|A[5]<<16|A[6]<<8|A[7])>>>0},appendEdit:jt,constructPatch:function(A){let{opsColumns:O,actorIds:z}=Je(A),x=Ae(O,V).reduce((K,ne)=>Object.assign(K,{[ne.columnName]:ne.decoder}),{}),C={_root:{objectId:"_root",type:"map",props:{}}},T=null;for(;!x.idActor.done;){let K=`${x.idCtr.readValue()}@${z[x.idActor.readValue()]}`,ne=x.action.readValue(),oe=c[ne];if(ne%2==0){let Ne=b[oe]||"unknown";C[K]=Ne==="list"||Ne==="text"?{objectId:K,type:Ne,edits:[]}:{objectId:K,type:Ne,props:{}}}let de=x.objActor.readValue(),se=x.objCtr.readValue(),be=de===null?"_root":`${se}@${z[de]}`,ve=C[be];if(!ve)throw new RangeError(`Operation for nonexistent object: ${be}`);let ue=x.keyActor.readValue(),ze=x.keyCtr.readValue(),Re=x.keyStr.readValue(),Te=!!x.insert.readValue(),Pe=x.chldActor.readValue(),$e=x.chldCtr.readValue(),Ee=Pe===null?null:`${$e}@${z[Pe]}`,Ke=x.valLen.readValue(),et=m(Ke,x.valRaw.readRawBytes(Ke>>4)),Ye=x.succNum.readValue(),He,Ue=[];for(let Ne=0;Ne<Ye;Ne++)Ue.push(`${x.succCtr.readValue()}@${z[x.succActor.readValue()]}`);if(oe&&ve.type!=="unknown"){if(ve.type==="list"||ve.type==="text"){if(ze===null||ze===0&&!Te)throw new RangeError(`Operation ${K} on ${ve.type} object has no key`);He=Te?K:`${ze}@${z[ue]}`}else{if(Re===null)throw new RangeError(`Operation ${K} on ${ve.type} object has no key`);He=Re}if(!T||T.objId!==be||T.key!==He){let Ne=0;T&&(Ne=T.index,pt(C,T)&&(Ne+=1),T.objId!==be&&(Ne=0)),T={objId:be,key:He,index:Ne,ops:[]}}T.ops.push({opId:K,actionName:oe,value:et,childId:Ee,succ:Ue})}}return T&&pt(C,T),st(C._root),C._root},BackendDoc:ct}},function(N,a,n){let{Deflate:p,deflate:v,deflateRaw:y,gzip:F}=n(17),{Inflate:Q,inflate:U,inflateRaw:L,ungzip:Z}=n(27),J=n(23);N.exports.Deflate=p,N.exports.deflate=v,N.exports.deflateRaw=y,N.exports.gzip=F,N.exports.Inflate=Q,N.exports.inflate=U,N.exports.inflateRaw=L,N.exports.ungzip=Z,N.exports.constants=J},function(N,a,n){let p=n(18),v=n(24),y=n(25),F=n(22),Q=n(26),U=Object.prototype.toString,{Z_NO_FLUSH:L,Z_SYNC_FLUSH:Z,Z_FULL_FLUSH:J,Z_FINISH:q,Z_OK:S,Z_STREAM_END:u,Z_DEFAULT_COMPRESSION:_,Z_DEFAULT_STRATEGY:j,Z_DEFLATED:W}=n(23);function w(h){this.options=v.assign({level:_,method:W,chunkSize:16384,windowBits:15,memLevel:8,strategy:j},h||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;let c=p.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(c!==S)throw new Error(F[c]);if(i.header&&p.deflateSetHeader(this.strm,i.header),i.dictionary){let b;if(b=typeof i.dictionary=="string"?y.string2buf(i.dictionary):U.call(i.dictionary)==="[object ArrayBuffer]"?new Uint8Array(i.dictionary):i.dictionary,c=p.deflateSetDictionary(this.strm,b),c!==S)throw new Error(F[c]);this._dict_set=!0}}function I(h,i){let c=new w(i);if(c.push(h,!0),c.err)throw c.msg||F[c.err];return c.result}w.prototype.push=function(h,i){let c=this.strm,b=this.options.chunkSize,P,D;if(this.ended)return!1;for(D=i===~~i?i:i===!0?q:L,typeof h=="string"?c.input=y.string2buf(h):U.call(h)==="[object ArrayBuffer]"?c.input=new Uint8Array(h):c.input=h,c.next_in=0,c.avail_in=c.input.length;;)if(c.avail_out===0&&(c.output=new Uint8Array(b),c.next_out=0,c.avail_out=b),(D===Z||D===J)&&c.avail_out<=6)this.onData(c.output.subarray(0,c.next_out)),c.avail_out=0;else{if(P=p.deflate(c,D),P===u)return c.next_out>0&&this.onData(c.output.subarray(0,c.next_out)),P=p.deflateEnd(this.strm),this.onEnd(P),this.ended=!0,P===S;if(c.avail_out!==0){if(D>0&&c.next_out>0)this.onData(c.output.subarray(0,c.next_out)),c.avail_out=0;else if(c.avail_in===0)break}else this.onData(c.output)}return!0},w.prototype.onData=function(h){this.chunks.push(h)},w.prototype.onEnd=function(h){h===S&&(this.result=v.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},N.exports.Deflate=w,N.exports.deflate=I,N.exports.deflateRaw=function(h,i){return(i=i||{}).raw=!0,I(h,i)},N.exports.gzip=function(h,i){return(i=i||{}).gzip=!0,I(h,i)},N.exports.constants=n(23)},function(N,a,n){let{_tr_init:p,_tr_stored_block:v,_tr_flush_block:y,_tr_tally:F,_tr_align:Q}=n(19),U=n(20),L=n(21),Z=n(22),{Z_NO_FLUSH:J,Z_PARTIAL_FLUSH:q,Z_FULL_FLUSH:S,Z_FINISH:u,Z_BLOCK:_,Z_OK:j,Z_STREAM_END:W,Z_STREAM_ERROR:w,Z_DATA_ERROR:I,Z_BUF_ERROR:h,Z_DEFAULT_COMPRESSION:i,Z_FILTERED:c,Z_HUFFMAN_ONLY:b,Z_RLE:P,Z_FIXED:D,Z_DEFAULT_STRATEGY:V,Z_UNKNOWN:re,Z_DEFLATED:H}=n(23),ee=258,ce=262,B=103,te=113,d=666,pe=(o,he)=>(o.msg=Z[he],he),G=o=>(o<<1)-(o>4?9:0),M=o=>{let he=o.length;for(;--he>=0;)o[he]=0},l=(o,he,ae)=>(he<<o.hash_shift^ae)&o.hash_mask,m=o=>{let he=o.state,ae=he.pending;ae>o.avail_out&&(ae=o.avail_out),ae!==0&&(o.output.set(he.pending_buf.subarray(he.pending_out,he.pending_out+ae),o.next_out),o.next_out+=ae,he.pending_out+=ae,o.total_out+=ae,o.avail_out-=ae,he.pending-=ae,he.pending===0&&(he.pending_out=0))},X=(o,he)=>{y(o,o.block_start>=0?o.block_start:-1,o.strstart-o.block_start,he),o.block_start=o.strstart,m(o.strm)},g=(o,he)=>{o.pending_buf[o.pending++]=he},k=(o,he)=>{o.pending_buf[o.pending++]=he>>>8&255,o.pending_buf[o.pending++]=255&he},Ie=(o,he,ae,le)=>{let R=o.avail_in;return R>le&&(R=le),R===0?0:(o.avail_in-=R,he.set(o.input.subarray(o.next_in,o.next_in+R),ae),o.state.wrap===1?o.adler=U(o.adler,he,R,ae):o.state.wrap===2&&(o.adler=L(o.adler,he,R,ae)),o.next_in+=R,o.total_in+=R,R)},ye=(o,he)=>{let ae,le,R=o.max_chain_length,Ve=o.strstart,je=o.prev_length,_e=o.nice_match,Je=o.strstart>o.w_size-ce?o.strstart-(o.w_size-ce):0,Me=o.window,at=o.w_mask,it=o.prev,pt=o.strstart+ee,st=Me[Ve+je-1],jt=Me[Ve+je];o.prev_length>=o.good_match&&(R>>=2),_e>o.lookahead&&(_e=o.lookahead);do if(ae=he,Me[ae+je]===jt&&Me[ae+je-1]===st&&Me[ae]===Me[Ve]&&Me[++ae]===Me[Ve+1]){Ve+=2,ae++;do;while(Me[++Ve]===Me[++ae]&&Me[++Ve]===Me[++ae]&&Me[++Ve]===Me[++ae]&&Me[++Ve]===Me[++ae]&&Me[++Ve]===Me[++ae]&&Me[++Ve]===Me[++ae]&&Me[++Ve]===Me[++ae]&&Me[++Ve]===Me[++ae]&&Ve<pt);if(le=ee-(pt-Ve),Ve=pt-ee,le>je){if(o.match_start=he,je=le,le>=_e)break;st=Me[Ve+je-1],jt=Me[Ve+je]}}while((he=it[he&at])>Je&&--R!=0);return je<=o.lookahead?je:o.lookahead},ie=o=>{let he=o.w_size,ae,le,R,Ve,je;do{if(Ve=o.window_size-o.lookahead-o.strstart,o.strstart>=he+(he-ce)){o.window.set(o.window.subarray(he,he+he),0),o.match_start-=he,o.strstart-=he,o.block_start-=he,le=o.hash_size,ae=le;do R=o.head[--ae],o.head[ae]=R>=he?R-he:0;while(--le);le=he,ae=le;do R=o.prev[--ae],o.prev[ae]=R>=he?R-he:0;while(--le);Ve+=he}if(o.strm.avail_in===0)break;if(le=Ie(o.strm,o.window,o.strstart+o.lookahead,Ve),o.lookahead+=le,o.lookahead+o.insert>=3)for(je=o.strstart-o.insert,o.ins_h=o.window[je],o.ins_h=l(o,o.ins_h,o.window[je+1]);o.insert&&(o.ins_h=l(o,o.ins_h,o.window[je+3-1]),o.prev[je&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=je,je++,o.insert--,!(o.lookahead+o.insert<3)););}while(o.lookahead<ce&&o.strm.avail_in!==0)},we=(o,he)=>{let ae,le;for(;;){if(o.lookahead<ce){if(ie(o),o.lookahead<ce&&he===J)return 1;if(o.lookahead===0)break}if(ae=0,o.lookahead>=3&&(o.ins_h=l(o,o.ins_h,o.window[o.strstart+3-1]),ae=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),ae!==0&&o.strstart-ae<=o.w_size-ce&&(o.match_length=ye(o,ae)),o.match_length>=3)if(le=F(o,o.strstart-o.match_start,o.match_length-3),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=3){o.match_length--;do o.strstart++,o.ins_h=l(o,o.ins_h,o.window[o.strstart+3-1]),ae=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart;while(--o.match_length!=0);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=l(o,o.ins_h,o.window[o.strstart+1]);else le=F(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(le&&(X(o,!1),o.strm.avail_out===0))return 1}return o.insert=o.strstart<2?o.strstart:2,he===u?(X(o,!0),o.strm.avail_out===0?3:4):o.last_lit&&(X(o,!1),o.strm.avail_out===0)?1:2},Ae=(o,he)=>{let ae,le,R;for(;;){if(o.lookahead<ce){if(ie(o),o.lookahead<ce&&he===J)return 1;if(o.lookahead===0)break}if(ae=0,o.lookahead>=3&&(o.ins_h=l(o,o.ins_h,o.window[o.strstart+3-1]),ae=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=2,ae!==0&&o.prev_length<o.max_lazy_match&&o.strstart-ae<=o.w_size-ce&&(o.match_length=ye(o,ae),o.match_length<=5&&(o.strategy===c||o.match_length===3&&o.strstart-o.match_start>4096)&&(o.match_length=2)),o.prev_length>=3&&o.match_length<=o.prev_length){R=o.strstart+o.lookahead-3,le=F(o,o.strstart-1-o.prev_match,o.prev_length-3),o.lookahead-=o.prev_length-1,o.prev_length-=2;do++o.strstart<=R&&(o.ins_h=l(o,o.ins_h,o.window[o.strstart+3-1]),ae=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart);while(--o.prev_length!=0);if(o.match_available=0,o.match_length=2,o.strstart++,le&&(X(o,!1),o.strm.avail_out===0))return 1}else if(o.match_available){if(le=F(o,0,o.window[o.strstart-1]),le&&X(o,!1),o.strstart++,o.lookahead--,o.strm.avail_out===0)return 1}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(le=F(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<2?o.strstart:2,he===u?(X(o,!0),o.strm.avail_out===0?3:4):o.last_lit&&(X(o,!1),o.strm.avail_out===0)?1:2};function Oe(o,he,ae,le,R){this.good_length=o,this.max_lazy=he,this.nice_length=ae,this.max_chain=le,this.func=R}let xe=[new Oe(0,0,0,0,(o,he)=>{let ae=65535;for(ae>o.pending_buf_size-5&&(ae=o.pending_buf_size-5);;){if(o.lookahead<=1){if(ie(o),o.lookahead===0&&he===J)return 1;if(o.lookahead===0)break}o.strstart+=o.lookahead,o.lookahead=0;let le=o.block_start+ae;if((o.strstart===0||o.strstart>=le)&&(o.lookahead=o.strstart-le,o.strstart=le,X(o,!1),o.strm.avail_out===0)||o.strstart-o.block_start>=o.w_size-ce&&(X(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,he===u?(X(o,!0),o.strm.avail_out===0?3:4):(o.strstart>o.block_start&&(X(o,!1),o.strm.avail_out),1)}),new Oe(4,4,8,4,we),new Oe(4,5,16,8,we),new Oe(4,6,32,32,we),new Oe(4,4,16,16,Ae),new Oe(8,16,32,32,Ae),new Oe(8,16,128,128,Ae),new Oe(8,32,128,256,Ae),new Oe(32,128,258,1024,Ae),new Oe(32,258,258,4096,Ae)];function ke(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=H,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),M(this.dyn_ltree),M(this.dyn_dtree),M(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),M(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),M(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let Se=o=>{if(!o||!o.state)return pe(o,w);o.total_in=o.total_out=0,o.data_type=re;let he=o.state;return he.pending=0,he.pending_out=0,he.wrap<0&&(he.wrap=-he.wrap),he.status=he.wrap?42:te,o.adler=he.wrap===2?0:1,he.last_flush=J,p(he),j},qe=o=>{let he=Se(o);var ae;return he===j&&((ae=o.state).window_size=2*ae.w_size,M(ae.head),ae.max_lazy_match=xe[ae.level].max_lazy,ae.good_match=xe[ae.level].good_length,ae.nice_match=xe[ae.level].nice_length,ae.max_chain_length=xe[ae.level].max_chain,ae.strstart=0,ae.block_start=0,ae.lookahead=0,ae.insert=0,ae.match_length=ae.prev_length=2,ae.match_available=0,ae.ins_h=0),he},We=(o,he,ae,le,R,Ve)=>{if(!o)return w;let je=1;if(he===i&&(he=6),le<0?(je=0,le=-le):le>15&&(je=2,le-=16),R<1||R>9||ae!==H||le<8||le>15||he<0||he>9||Ve<0||Ve>D)return pe(o,w);le===8&&(le=9);let _e=new ke;return o.state=_e,_e.strm=o,_e.wrap=je,_e.gzhead=null,_e.w_bits=le,_e.w_size=1<<_e.w_bits,_e.w_mask=_e.w_size-1,_e.hash_bits=R+7,_e.hash_size=1<<_e.hash_bits,_e.hash_mask=_e.hash_size-1,_e.hash_shift=~~((_e.hash_bits+3-1)/3),_e.window=new Uint8Array(2*_e.w_size),_e.head=new Uint16Array(_e.hash_size),_e.prev=new Uint16Array(_e.w_size),_e.lit_bufsize=1<<R+6,_e.pending_buf_size=4*_e.lit_bufsize,_e.pending_buf=new Uint8Array(_e.pending_buf_size),_e.d_buf=1*_e.lit_bufsize,_e.l_buf=3*_e.lit_bufsize,_e.level=he,_e.strategy=Ve,_e.method=ae,qe(o)};N.exports.deflateInit=(o,he)=>We(o,he,H,15,8,V),N.exports.deflateInit2=We,N.exports.deflateReset=qe,N.exports.deflateResetKeep=Se,N.exports.deflateSetHeader=(o,he)=>o&&o.state?o.state.wrap!==2?w:(o.state.gzhead=he,j):w,N.exports.deflate=(o,he)=>{let ae,le;if(!o||!o.state||he>_||he<0)return o?pe(o,w):w;let R=o.state;if(!o.output||!o.input&&o.avail_in!==0||R.status===d&&he!==u)return pe(o,o.avail_out===0?h:w);R.strm=o;let Ve=R.last_flush;if(R.last_flush=he,R.status===42)if(R.wrap===2)o.adler=0,g(R,31),g(R,139),g(R,8),R.gzhead?(g(R,(R.gzhead.text?1:0)+(R.gzhead.hcrc?2:0)+(R.gzhead.extra?4:0)+(R.gzhead.name?8:0)+(R.gzhead.comment?16:0)),g(R,255&R.gzhead.time),g(R,R.gzhead.time>>8&255),g(R,R.gzhead.time>>16&255),g(R,R.gzhead.time>>24&255),g(R,R.level===9?2:R.strategy>=b||R.level<2?4:0),g(R,255&R.gzhead.os),R.gzhead.extra&&R.gzhead.extra.length&&(g(R,255&R.gzhead.extra.length),g(R,R.gzhead.extra.length>>8&255)),R.gzhead.hcrc&&(o.adler=L(o.adler,R.pending_buf,R.pending,0)),R.gzindex=0,R.status=69):(g(R,0),g(R,0),g(R,0),g(R,0),g(R,0),g(R,R.level===9?2:R.strategy>=b||R.level<2?4:0),g(R,3),R.status=te);else{let je=H+(R.w_bits-8<<4)<<8,_e=-1;_e=R.strategy>=b||R.level<2?0:R.level<6?1:R.level===6?2:3,je|=_e<<6,R.strstart!==0&&(je|=32),je+=31-je%31,R.status=te,k(R,je),R.strstart!==0&&(k(R,o.adler>>>16),k(R,65535&o.adler)),o.adler=1}if(R.status===69)if(R.gzhead.extra){for(ae=R.pending;R.gzindex<(65535&R.gzhead.extra.length)&&(R.pending!==R.pending_buf_size||(R.gzhead.hcrc&&R.pending>ae&&(o.adler=L(o.adler,R.pending_buf,R.pending-ae,ae)),m(o),ae=R.pending,R.pending!==R.pending_buf_size));)g(R,255&R.gzhead.extra[R.gzindex]),R.gzindex++;R.gzhead.hcrc&&R.pending>ae&&(o.adler=L(o.adler,R.pending_buf,R.pending-ae,ae)),R.gzindex===R.gzhead.extra.length&&(R.gzindex=0,R.status=73)}else R.status=73;if(R.status===73)if(R.gzhead.name){ae=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>ae&&(o.adler=L(o.adler,R.pending_buf,R.pending-ae,ae)),m(o),ae=R.pending,R.pending===R.pending_buf_size)){le=1;break}le=R.gzindex<R.gzhead.name.length?255&R.gzhead.name.charCodeAt(R.gzindex++):0,g(R,le)}while(le!==0);R.gzhead.hcrc&&R.pending>ae&&(o.adler=L(o.adler,R.pending_buf,R.pending-ae,ae)),le===0&&(R.gzindex=0,R.status=91)}else R.status=91;if(R.status===91)if(R.gzhead.comment){ae=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>ae&&(o.adler=L(o.adler,R.pending_buf,R.pending-ae,ae)),m(o),ae=R.pending,R.pending===R.pending_buf_size)){le=1;break}le=R.gzindex<R.gzhead.comment.length?255&R.gzhead.comment.charCodeAt(R.gzindex++):0,g(R,le)}while(le!==0);R.gzhead.hcrc&&R.pending>ae&&(o.adler=L(o.adler,R.pending_buf,R.pending-ae,ae)),le===0&&(R.status=B)}else R.status=B;if(R.status===B&&(R.gzhead.hcrc?(R.pending+2>R.pending_buf_size&&m(o),R.pending+2<=R.pending_buf_size&&(g(R,255&o.adler),g(R,o.adler>>8&255),o.adler=0,R.status=te)):R.status=te),R.pending!==0){if(m(o),o.avail_out===0)return R.last_flush=-1,j}else if(o.avail_in===0&&G(he)<=G(Ve)&&he!==u)return pe(o,h);if(R.status===d&&o.avail_in!==0)return pe(o,h);if(o.avail_in!==0||R.lookahead!==0||he!==J&&R.status!==d){let je=R.strategy===b?((_e,Je)=>{let Me;for(;;){if(_e.lookahead===0&&(ie(_e),_e.lookahead===0)){if(Je===J)return 1;break}if(_e.match_length=0,Me=F(_e,0,_e.window[_e.strstart]),_e.lookahead--,_e.strstart++,Me&&(X(_e,!1),_e.strm.avail_out===0))return 1}return _e.insert=0,Je===u?(X(_e,!0),_e.strm.avail_out===0?3:4):_e.last_lit&&(X(_e,!1),_e.strm.avail_out===0)?1:2})(R,he):R.strategy===P?((_e,Je)=>{let Me,at,it,pt,st=_e.window;for(;;){if(_e.lookahead<=ee){if(ie(_e),_e.lookahead<=ee&&Je===J)return 1;if(_e.lookahead===0)break}if(_e.match_length=0,_e.lookahead>=3&&_e.strstart>0&&(it=_e.strstart-1,at=st[it],at===st[++it]&&at===st[++it]&&at===st[++it])){pt=_e.strstart+ee;do;while(at===st[++it]&&at===st[++it]&&at===st[++it]&&at===st[++it]&&at===st[++it]&&at===st[++it]&&at===st[++it]&&at===st[++it]&&it<pt);_e.match_length=ee-(pt-it),_e.match_length>_e.lookahead&&(_e.match_length=_e.lookahead)}if(_e.match_length>=3?(Me=F(_e,1,_e.match_length-3),_e.lookahead-=_e.match_length,_e.strstart+=_e.match_length,_e.match_length=0):(Me=F(_e,0,_e.window[_e.strstart]),_e.lookahead--,_e.strstart++),Me&&(X(_e,!1),_e.strm.avail_out===0))return 1}return _e.insert=0,Je===u?(X(_e,!0),_e.strm.avail_out===0?3:4):_e.last_lit&&(X(_e,!1),_e.strm.avail_out===0)?1:2})(R,he):xe[R.level].func(R,he);if(je!==3&&je!==4||(R.status=d),je===1||je===3)return o.avail_out===0&&(R.last_flush=-1),j;if(je===2&&(he===q?Q(R):he!==_&&(v(R,0,0,!1),he===S&&(M(R.head),R.lookahead===0&&(R.strstart=0,R.block_start=0,R.insert=0))),m(o),o.avail_out===0))return R.last_flush=-1,j}return he!==u?j:R.wrap<=0?W:(R.wrap===2?(g(R,255&o.adler),g(R,o.adler>>8&255),g(R,o.adler>>16&255),g(R,o.adler>>24&255),g(R,255&o.total_in),g(R,o.total_in>>8&255),g(R,o.total_in>>16&255),g(R,o.total_in>>24&255)):(k(R,o.adler>>>16),k(R,65535&o.adler)),m(o),R.wrap>0&&(R.wrap=-R.wrap),R.pending!==0?j:W)},N.exports.deflateEnd=o=>{if(!o||!o.state)return w;let he=o.state.status;return he!==42&&he!==69&&he!==73&&he!==91&&he!==B&&he!==te&&he!==d?pe(o,w):(o.state=null,he===te?pe(o,I):j)},N.exports.deflateSetDictionary=(o,he)=>{let ae=he.length;if(!o||!o.state)return w;let le=o.state,R=le.wrap;if(R===2||R===1&&le.status!==42||le.lookahead)return w;if(R===1&&(o.adler=U(o.adler,he,ae,0)),le.wrap=0,ae>=le.w_size){R===0&&(M(le.head),le.strstart=0,le.block_start=0,le.insert=0);let Je=new Uint8Array(le.w_size);Je.set(he.subarray(ae-le.w_size,ae),0),he=Je,ae=le.w_size}let Ve=o.avail_in,je=o.next_in,_e=o.input;for(o.avail_in=ae,o.next_in=0,o.input=he,ie(le);le.lookahead>=3;){let Je=le.strstart,Me=le.lookahead-2;do le.ins_h=l(le,le.ins_h,le.window[Je+3-1]),le.prev[Je&le.w_mask]=le.head[le.ins_h],le.head[le.ins_h]=Je,Je++;while(--Me);le.strstart=Je,le.lookahead=2,ie(le)}return le.strstart+=le.lookahead,le.block_start=le.strstart,le.insert=le.lookahead,le.lookahead=0,le.match_length=le.prev_length=2,le.match_available=0,o.next_in=je,o.input=_e,o.avail_in=Ve,le.wrap=R,j},N.exports.deflateInfo="pako deflate (from Nodeca project)"},function(N){function a(l){let m=l.length;for(;--m>=0;)l[m]=0}let n=256,p=286,v=30,y=15,F=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Q=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Z=new Array(576);a(Z);let J=new Array(60);a(J);let q=new Array(512);a(q);let S=new Array(256);a(S);let u=new Array(29);a(u);let _=new Array(v);function j(l,m,X,g,k){this.static_tree=l,this.extra_bits=m,this.extra_base=X,this.elems=g,this.max_length=k,this.has_stree=l&&l.length}let W,w,I;function h(l,m){this.dyn_tree=l,this.max_code=0,this.stat_desc=m}a(_);let i=l=>l<256?q[l]:q[256+(l>>>7)],c=(l,m)=>{l.pending_buf[l.pending++]=255&m,l.pending_buf[l.pending++]=m>>>8&255},b=(l,m,X)=>{l.bi_valid>16-X?(l.bi_buf|=m<<l.bi_valid&65535,c(l,l.bi_buf),l.bi_buf=m>>16-l.bi_valid,l.bi_valid+=X-16):(l.bi_buf|=m<<l.bi_valid&65535,l.bi_valid+=X)},P=(l,m,X)=>{b(l,X[2*m],X[2*m+1])},D=(l,m)=>{let X=0;do X|=1&l,l>>>=1,X<<=1;while(--m>0);return X>>>1},V=(l,m,X)=>{let g=new Array(16),k,Ie,ye=0;for(k=1;k<=y;k++)g[k]=ye=ye+X[k-1]<<1;for(Ie=0;Ie<=m;Ie++){let ie=l[2*Ie+1];ie!==0&&(l[2*Ie]=D(g[ie]++,ie))}},re=l=>{let m;for(m=0;m<p;m++)l.dyn_ltree[2*m]=0;for(m=0;m<v;m++)l.dyn_dtree[2*m]=0;for(m=0;m<19;m++)l.bl_tree[2*m]=0;l.dyn_ltree[512]=1,l.opt_len=l.static_len=0,l.last_lit=l.matches=0},H=l=>{l.bi_valid>8?c(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},ee=(l,m,X,g)=>{let k=2*m,Ie=2*X;return l[k]<l[Ie]||l[k]===l[Ie]&&g[m]<=g[X]},ce=(l,m,X)=>{let g=l.heap[X],k=X<<1;for(;k<=l.heap_len&&(k<l.heap_len&&ee(m,l.heap[k+1],l.heap[k],l.depth)&&k++,!ee(m,g,l.heap[k],l.depth));)l.heap[X]=l.heap[k],X=k,k<<=1;l.heap[X]=g},B=(l,m,X)=>{let g,k,Ie,ye,ie=0;if(l.last_lit!==0)do g=l.pending_buf[l.d_buf+2*ie]<<8|l.pending_buf[l.d_buf+2*ie+1],k=l.pending_buf[l.l_buf+ie],ie++,g===0?P(l,k,m):(Ie=S[k],P(l,Ie+n+1,m),ye=F[Ie],ye!==0&&(k-=u[Ie],b(l,k,ye)),g--,Ie=i(g),P(l,Ie,X),ye=Q[Ie],ye!==0&&(g-=_[Ie],b(l,g,ye)));while(ie<l.last_lit);P(l,256,m)},te=(l,m)=>{let X=m.dyn_tree,g=m.stat_desc.static_tree,k=m.stat_desc.has_stree,Ie=m.stat_desc.elems,ye,ie,we,Ae=-1;for(l.heap_len=0,l.heap_max=573,ye=0;ye<Ie;ye++)X[2*ye]!==0?(l.heap[++l.heap_len]=Ae=ye,l.depth[ye]=0):X[2*ye+1]=0;for(;l.heap_len<2;)we=l.heap[++l.heap_len]=Ae<2?++Ae:0,X[2*we]=1,l.depth[we]=0,l.opt_len--,k&&(l.static_len-=g[2*we+1]);for(m.max_code=Ae,ye=l.heap_len>>1;ye>=1;ye--)ce(l,X,ye);we=Ie;do ye=l.heap[1],l.heap[1]=l.heap[l.heap_len--],ce(l,X,1),ie=l.heap[1],l.heap[--l.heap_max]=ye,l.heap[--l.heap_max]=ie,X[2*we]=X[2*ye]+X[2*ie],l.depth[we]=(l.depth[ye]>=l.depth[ie]?l.depth[ye]:l.depth[ie])+1,X[2*ye+1]=X[2*ie+1]=we,l.heap[1]=we++,ce(l,X,1);while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],((Oe,xe)=>{let ke=xe.dyn_tree,Se=xe.max_code,qe=xe.stat_desc.static_tree,We=xe.stat_desc.has_stree,o=xe.stat_desc.extra_bits,he=xe.stat_desc.extra_base,ae=xe.stat_desc.max_length,le,R,Ve,je,_e,Je,Me=0;for(je=0;je<=y;je++)Oe.bl_count[je]=0;for(ke[2*Oe.heap[Oe.heap_max]+1]=0,le=Oe.heap_max+1;le<573;le++)R=Oe.heap[le],je=ke[2*ke[2*R+1]+1]+1,je>ae&&(je=ae,Me++),ke[2*R+1]=je,R>Se||(Oe.bl_count[je]++,_e=0,R>=he&&(_e=o[R-he]),Je=ke[2*R],Oe.opt_len+=Je*(je+_e),We&&(Oe.static_len+=Je*(qe[2*R+1]+_e)));if(Me!==0){do{for(je=ae-1;Oe.bl_count[je]===0;)je--;Oe.bl_count[je]--,Oe.bl_count[je+1]+=2,Oe.bl_count[ae]--,Me-=2}while(Me>0);for(je=ae;je!==0;je--)for(R=Oe.bl_count[je];R!==0;)Ve=Oe.heap[--le],Ve>Se||(ke[2*Ve+1]!==je&&(Oe.opt_len+=(je-ke[2*Ve+1])*ke[2*Ve],ke[2*Ve+1]=je),R--)}})(l,m),V(X,Ae,l.bl_count)},d=(l,m,X)=>{let g,k,Ie=-1,ye=m[1],ie=0,we=7,Ae=4;for(ye===0&&(we=138,Ae=3),m[2*(X+1)+1]=65535,g=0;g<=X;g++)k=ye,ye=m[2*(g+1)+1],++ie<we&&k===ye||(ie<Ae?l.bl_tree[2*k]+=ie:k!==0?(k!==Ie&&l.bl_tree[2*k]++,l.bl_tree[32]++):ie<=10?l.bl_tree[34]++:l.bl_tree[36]++,ie=0,Ie=k,ye===0?(we=138,Ae=3):k===ye?(we=6,Ae=3):(we=7,Ae=4))},pe=(l,m,X)=>{let g,k,Ie=-1,ye=m[1],ie=0,we=7,Ae=4;for(ye===0&&(we=138,Ae=3),g=0;g<=X;g++)if(k=ye,ye=m[2*(g+1)+1],!(++ie<we&&k===ye)){if(ie<Ae)do P(l,k,l.bl_tree);while(--ie!=0);else k!==0?(k!==Ie&&(P(l,k,l.bl_tree),ie--),P(l,16,l.bl_tree),b(l,ie-3,2)):ie<=10?(P(l,17,l.bl_tree),b(l,ie-3,3)):(P(l,18,l.bl_tree),b(l,ie-11,7));ie=0,Ie=k,ye===0?(we=138,Ae=3):k===ye?(we=6,Ae=3):(we=7,Ae=4)}},G=!1,M=(l,m,X,g)=>{b(l,0+(g?1:0),3),((k,Ie,ye,ie)=>{H(k),ie&&(c(k,ye),c(k,~ye)),k.pending_buf.set(k.window.subarray(Ie,Ie+ye),k.pending),k.pending+=ye})(l,m,X,!0)};N.exports._tr_init=l=>{G||((()=>{let m,X,g,k,Ie,ye=new Array(16);for(g=0,k=0;k<28;k++)for(u[k]=g,m=0;m<1<<F[k];m++)S[g++]=k;for(S[g-1]=k,Ie=0,k=0;k<16;k++)for(_[k]=Ie,m=0;m<1<<Q[k];m++)q[Ie++]=k;for(Ie>>=7;k<v;k++)for(_[k]=Ie<<7,m=0;m<1<<Q[k]-7;m++)q[256+Ie++]=k;for(X=0;X<=y;X++)ye[X]=0;for(m=0;m<=143;)Z[2*m+1]=8,m++,ye[8]++;for(;m<=255;)Z[2*m+1]=9,m++,ye[9]++;for(;m<=279;)Z[2*m+1]=7,m++,ye[7]++;for(;m<=287;)Z[2*m+1]=8,m++,ye[8]++;for(V(Z,287,ye),m=0;m<v;m++)J[2*m+1]=5,J[2*m]=D(m,5);W=new j(Z,F,257,p,y),w=new j(J,Q,0,v,y),I=new j(new Array(0),U,0,19,7)})(),G=!0),l.l_desc=new h(l.dyn_ltree,W),l.d_desc=new h(l.dyn_dtree,w),l.bl_desc=new h(l.bl_tree,I),l.bi_buf=0,l.bi_valid=0,re(l)},N.exports._tr_stored_block=M,N.exports._tr_flush_block=(l,m,X,g)=>{let k,Ie,ye=0;l.level>0?(l.strm.data_type===2&&(l.strm.data_type=(ie=>{let we,Ae=4093624447;for(we=0;we<=31;we++,Ae>>>=1)if(1&Ae&&ie.dyn_ltree[2*we]!==0)return 0;if(ie.dyn_ltree[18]!==0||ie.dyn_ltree[20]!==0||ie.dyn_ltree[26]!==0)return 1;for(we=32;we<n;we++)if(ie.dyn_ltree[2*we]!==0)return 1;return 0})(l)),te(l,l.l_desc),te(l,l.d_desc),ye=(ie=>{let we;for(d(ie,ie.dyn_ltree,ie.l_desc.max_code),d(ie,ie.dyn_dtree,ie.d_desc.max_code),te(ie,ie.bl_desc),we=18;we>=3&&ie.bl_tree[2*L[we]+1]===0;we--);return ie.opt_len+=3*(we+1)+5+5+4,we})(l),k=l.opt_len+3+7>>>3,Ie=l.static_len+3+7>>>3,Ie<=k&&(k=Ie)):k=Ie=X+5,X+4<=k&&m!==-1?M(l,m,X,g):l.strategy===4||Ie===k?(b(l,2+(g?1:0),3),B(l,Z,J)):(b(l,4+(g?1:0),3),((ie,we,Ae,Oe)=>{let xe;for(b(ie,we-257,5),b(ie,Ae-1,5),b(ie,Oe-4,4),xe=0;xe<Oe;xe++)b(ie,ie.bl_tree[2*L[xe]+1],3);pe(ie,ie.dyn_ltree,we-1),pe(ie,ie.dyn_dtree,Ae-1)})(l,l.l_desc.max_code+1,l.d_desc.max_code+1,ye+1),B(l,l.dyn_ltree,l.dyn_dtree)),re(l),g&&H(l)},N.exports._tr_tally=(l,m,X)=>(l.pending_buf[l.d_buf+2*l.last_lit]=m>>>8&255,l.pending_buf[l.d_buf+2*l.last_lit+1]=255&m,l.pending_buf[l.l_buf+l.last_lit]=255&X,l.last_lit++,m===0?l.dyn_ltree[2*X]++:(l.matches++,m--,l.dyn_ltree[2*(S[X]+n+1)]++,l.dyn_dtree[2*i(m)]++),l.last_lit===l.lit_bufsize-1),N.exports._tr_align=l=>{b(l,2,3),P(l,256,Z),(m=>{m.bi_valid===16?(c(m,m.bi_buf),m.bi_buf=0,m.bi_valid=0):m.bi_valid>=8&&(m.pending_buf[m.pending++]=255&m.bi_buf,m.bi_buf>>=8,m.bi_valid-=8)})(l)}},function(N){N.exports=(a,n,p,v)=>{let y=65535&a|0,F=a>>>16&65535|0,Q=0;for(;p!==0;){Q=p>2e3?2e3:p,p-=Q;do y=y+n[v++]|0,F=F+y|0;while(--Q);y%=65521,F%=65521}return y|F<<16|0}},function(N){let a=new Uint32Array((()=>{let n,p=[];for(var v=0;v<256;v++){n=v;for(var y=0;y<8;y++)n=1&n?3988292384^n>>>1:n>>>1;p[v]=n}return p})());N.exports=(n,p,v,y)=>{let F=a,Q=y+v;n^=-1;for(let U=y;U<Q;U++)n=n>>>8^F[255&(n^p[U])];return-1^n}},function(N){N.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(N){N.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(N){let a=(n,p)=>Object.prototype.hasOwnProperty.call(n,p);N.exports.assign=function(n){let p=Array.prototype.slice.call(arguments,1);for(;p.length;){let v=p.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(let y in v)a(v,y)&&(n[y]=v[y])}}return n},N.exports.flattenChunks=n=>{let p=0;for(let y=0,F=n.length;y<F;y++)p+=n[y].length;let v=new Uint8Array(p);for(let y=0,F=0,Q=n.length;y<Q;y++){let U=n[y];v.set(U,F),F+=U.length}return v}},function(N){let a=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}let n=new Uint8Array(256);for(let p=0;p<256;p++)n[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;n[254]=n[254]=1,N.exports.string2buf=p=>{let v,y,F,Q,U,L=p.length,Z=0;for(Q=0;Q<L;Q++)y=p.charCodeAt(Q),(64512&y)==55296&&Q+1<L&&(F=p.charCodeAt(Q+1),(64512&F)==56320&&(y=65536+(y-55296<<10)+(F-56320),Q++)),Z+=y<128?1:y<2048?2:y<65536?3:4;for(v=new Uint8Array(Z),U=0,Q=0;U<Z;Q++)y=p.charCodeAt(Q),(64512&y)==55296&&Q+1<L&&(F=p.charCodeAt(Q+1),(64512&F)==56320&&(y=65536+(y-55296<<10)+(F-56320),Q++)),y<128?v[U++]=y:y<2048?(v[U++]=192|y>>>6,v[U++]=128|63&y):y<65536?(v[U++]=224|y>>>12,v[U++]=128|y>>>6&63,v[U++]=128|63&y):(v[U++]=240|y>>>18,v[U++]=128|y>>>12&63,v[U++]=128|y>>>6&63,v[U++]=128|63&y);return v},N.exports.buf2string=(p,v)=>{let y,F,Q=v||p.length,U=new Array(2*Q);for(F=0,y=0;y<Q;){let L=p[y++];if(L<128){U[F++]=L;continue}let Z=n[L];if(Z>4)U[F++]=65533,y+=Z-1;else{for(L&=Z===2?31:Z===3?15:7;Z>1&&y<Q;)L=L<<6|63&p[y++],Z--;Z>1?U[F++]=65533:L<65536?U[F++]=L:(L-=65536,U[F++]=55296|L>>10&1023,U[F++]=56320|1023&L)}}return((L,Z)=>{if(Z<65534&&L.subarray&&a)return String.fromCharCode.apply(null,L.length===Z?L:L.subarray(0,Z));let J="";for(let q=0;q<Z;q++)J+=String.fromCharCode(L[q]);return J})(U,F)},N.exports.utf8border=(p,v)=>{(v=v||p.length)>p.length&&(v=p.length);let y=v-1;for(;y>=0&&(192&p[y])==128;)y--;return y<0||y===0?v:y+n[p[y]]>v?y:v}},function(N){N.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(N,a,n){let p=n(28),v=n(24),y=n(25),F=n(22),Q=n(26),U=n(31),L=Object.prototype.toString,{Z_NO_FLUSH:Z,Z_FINISH:J,Z_OK:q,Z_STREAM_END:S,Z_NEED_DICT:u,Z_STREAM_ERROR:_,Z_DATA_ERROR:j,Z_MEM_ERROR:W}=n(23);function w(h){this.options=v.assign({chunkSize:65536,windowBits:15,to:""},h||{});let i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||h&&h.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(15&i.windowBits)==0&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;let c=p.inflateInit2(this.strm,i.windowBits);if(c!==q)throw new Error(F[c]);if(this.header=new U,p.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=y.string2buf(i.dictionary):L.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(c=p.inflateSetDictionary(this.strm,i.dictionary),c!==q)))throw new Error(F[c])}function I(h,i){let c=new w(i);if(c.push(h),c.err)throw c.msg||F[c.err];return c.result}w.prototype.push=function(h,i){let c=this.strm,b=this.options.chunkSize,P=this.options.dictionary,D,V,re;if(this.ended)return!1;for(V=i===~~i?i:i===!0?J:Z,L.call(h)==="[object ArrayBuffer]"?c.input=new Uint8Array(h):c.input=h,c.next_in=0,c.avail_in=c.input.length;;){for(c.avail_out===0&&(c.output=new Uint8Array(b),c.next_out=0,c.avail_out=b),D=p.inflate(c,V),D===u&&P&&(D=p.inflateSetDictionary(c,P),D===q?D=p.inflate(c,V):D===j&&(D=u));c.avail_in>0&&D===S&&c.state.wrap>0&&h[c.next_in]!==0;)p.inflateReset(c),D=p.inflate(c,V);switch(D){case _:case j:case u:case W:return this.onEnd(D),this.ended=!0,!1}if(re=c.avail_out,c.next_out&&(c.avail_out===0||D===S))if(this.options.to==="string"){let H=y.utf8border(c.output,c.next_out),ee=c.next_out-H,ce=y.buf2string(c.output,H);c.next_out=ee,c.avail_out=b-ee,ee&&c.output.set(c.output.subarray(H,H+ee),0),this.onData(ce)}else this.onData(c.output.length===c.next_out?c.output:c.output.subarray(0,c.next_out));if(D!==q||re!==0){if(D===S)return D=p.inflateEnd(this.strm),this.onEnd(D),this.ended=!0,!0;if(c.avail_in===0)break}}return!0},w.prototype.onData=function(h){this.chunks.push(h)},w.prototype.onEnd=function(h){h===q&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=v.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},N.exports.Inflate=w,N.exports.inflate=I,N.exports.inflateRaw=function(h,i){return(i=i||{}).raw=!0,I(h,i)},N.exports.ungzip=I,N.exports.constants=n(23)},function(N,a,n){let p=n(20),v=n(21),y=n(29),F=n(30),{Z_FINISH:Q,Z_BLOCK:U,Z_TREES:L,Z_OK:Z,Z_STREAM_END:J,Z_NEED_DICT:q,Z_STREAM_ERROR:S,Z_DATA_ERROR:u,Z_MEM_ERROR:_,Z_BUF_ERROR:j,Z_DEFLATED:W}=n(23),w=12,I=30,h=B=>(B>>>24&255)+(B>>>8&65280)+((65280&B)<<8)+((255&B)<<24);function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let c=B=>{if(!B||!B.state)return S;let te=B.state;return B.total_in=B.total_out=te.total=0,B.msg="",te.wrap&&(B.adler=1&te.wrap),te.mode=1,te.last=0,te.havedict=0,te.dmax=32768,te.head=null,te.hold=0,te.bits=0,te.lencode=te.lendyn=new Int32Array(852),te.distcode=te.distdyn=new Int32Array(592),te.sane=1,te.back=-1,Z},b=B=>{if(!B||!B.state)return S;let te=B.state;return te.wsize=0,te.whave=0,te.wnext=0,c(B)},P=(B,te)=>{let d;if(!B||!B.state)return S;let pe=B.state;return te<0?(d=0,te=-te):(d=1+(te>>4),te<48&&(te&=15)),te&&(te<8||te>15)?S:(pe.window!==null&&pe.wbits!==te&&(pe.window=null),pe.wrap=d,pe.wbits=te,b(B))},D=(B,te)=>{if(!B)return S;let d=new i;B.state=d,d.window=null;let pe=P(B,te);return pe!==Z&&(B.state=null),pe},V,re,H=!0,ee=B=>{if(H){V=new Int32Array(512),re=new Int32Array(32);let te=0;for(;te<144;)B.lens[te++]=8;for(;te<256;)B.lens[te++]=9;for(;te<280;)B.lens[te++]=7;for(;te<288;)B.lens[te++]=8;for(F(1,B.lens,0,288,V,0,B.work,{bits:9}),te=0;te<32;)B.lens[te++]=5;F(2,B.lens,0,32,re,0,B.work,{bits:5}),H=!1}B.lencode=V,B.lenbits=9,B.distcode=re,B.distbits=5},ce=(B,te,d,pe)=>{let G,M=B.state;return M.window===null&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new Uint8Array(M.wsize)),pe>=M.wsize?(M.window.set(te.subarray(d-M.wsize,d),0),M.wnext=0,M.whave=M.wsize):(G=M.wsize-M.wnext,G>pe&&(G=pe),M.window.set(te.subarray(d-pe,d-pe+G),M.wnext),(pe-=G)?(M.window.set(te.subarray(d-pe,d),0),M.wnext=pe,M.whave=M.wsize):(M.wnext+=G,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=G))),0};N.exports.inflateReset=b,N.exports.inflateReset2=P,N.exports.inflateResetKeep=c,N.exports.inflateInit=B=>D(B,15),N.exports.inflateInit2=D,N.exports.inflate=(B,te)=>{let d,pe,G,M,l,m,X,g,k,Ie,ye,ie,we,Ae,Oe,xe,ke,Se,qe,We,o,he,ae=0,le=new Uint8Array(4),R,Ve,je=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!B||!B.state||!B.output||!B.input&&B.avail_in!==0)return S;d=B.state,d.mode===w&&(d.mode=13),l=B.next_out,G=B.output,X=B.avail_out,M=B.next_in,pe=B.input,m=B.avail_in,g=d.hold,k=d.bits,Ie=m,ye=X,he=Z;e:for(;;)switch(d.mode){case 1:if(d.wrap===0){d.mode=13;break}for(;k<16;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if(2&d.wrap&&g===35615){d.check=0,le[0]=255&g,le[1]=g>>>8&255,d.check=v(d.check,le,2,0),g=0,k=0,d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&g)<<8)+(g>>8))%31){B.msg="incorrect header check",d.mode=I;break}if((15&g)!==W){B.msg="unknown compression method",d.mode=I;break}if(g>>>=4,k-=4,o=8+(15&g),d.wbits===0)d.wbits=o;else if(o>d.wbits){B.msg="invalid window size",d.mode=I;break}d.dmax=1<<d.wbits,B.adler=d.check=1,d.mode=512&g?10:w,g=0,k=0;break;case 2:for(;k<16;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if(d.flags=g,(255&d.flags)!==W){B.msg="unknown compression method",d.mode=I;break}if(57344&d.flags){B.msg="unknown header flags set",d.mode=I;break}d.head&&(d.head.text=g>>8&1),512&d.flags&&(le[0]=255&g,le[1]=g>>>8&255,d.check=v(d.check,le,2,0)),g=0,k=0,d.mode=3;case 3:for(;k<32;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}d.head&&(d.head.time=g),512&d.flags&&(le[0]=255&g,le[1]=g>>>8&255,le[2]=g>>>16&255,le[3]=g>>>24&255,d.check=v(d.check,le,4,0)),g=0,k=0,d.mode=4;case 4:for(;k<16;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}d.head&&(d.head.xflags=255&g,d.head.os=g>>8),512&d.flags&&(le[0]=255&g,le[1]=g>>>8&255,d.check=v(d.check,le,2,0)),g=0,k=0,d.mode=5;case 5:if(1024&d.flags){for(;k<16;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}d.length=g,d.head&&(d.head.extra_len=g),512&d.flags&&(le[0]=255&g,le[1]=g>>>8&255,d.check=v(d.check,le,2,0)),g=0,k=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&(ie=d.length,ie>m&&(ie=m),ie&&(d.head&&(o=d.head.extra_len-d.length,d.head.extra||(d.head.extra=new Uint8Array(d.head.extra_len)),d.head.extra.set(pe.subarray(M,M+ie),o)),512&d.flags&&(d.check=v(d.check,pe,ie,M)),m-=ie,M+=ie,d.length-=ie),d.length))break e;d.length=0,d.mode=7;case 7:if(2048&d.flags){if(m===0)break e;ie=0;do o=pe[M+ie++],d.head&&o&&d.length<65536&&(d.head.name+=String.fromCharCode(o));while(o&&ie<m);if(512&d.flags&&(d.check=v(d.check,pe,ie,M)),m-=ie,M+=ie,o)break e}else d.head&&(d.head.name=null);d.length=0,d.mode=8;case 8:if(4096&d.flags){if(m===0)break e;ie=0;do o=pe[M+ie++],d.head&&o&&d.length<65536&&(d.head.comment+=String.fromCharCode(o));while(o&&ie<m);if(512&d.flags&&(d.check=v(d.check,pe,ie,M)),m-=ie,M+=ie,o)break e}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;k<16;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if(g!==(65535&d.check)){B.msg="header crc mismatch",d.mode=I;break}g=0,k=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0),B.adler=d.check=0,d.mode=w;break;case 10:for(;k<32;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}B.adler=d.check=h(g),g=0,k=0,d.mode=11;case 11:if(d.havedict===0)return B.next_out=l,B.avail_out=X,B.next_in=M,B.avail_in=m,d.hold=g,d.bits=k,q;B.adler=d.check=1,d.mode=w;case w:if(te===U||te===L)break e;case 13:if(d.last){g>>>=7&k,k-=7&k,d.mode=27;break}for(;k<3;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}switch(d.last=1&g,g>>>=1,k-=1,3&g){case 0:d.mode=14;break;case 1:if(ee(d),d.mode=20,te===L){g>>>=2,k-=2;break e}break;case 2:d.mode=17;break;case 3:B.msg="invalid block type",d.mode=I}g>>>=2,k-=2;break;case 14:for(g>>>=7&k,k-=7&k;k<32;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if((65535&g)!=(g>>>16^65535)){B.msg="invalid stored block lengths",d.mode=I;break}if(d.length=65535&g,g=0,k=0,d.mode=15,te===L)break e;case 15:d.mode=16;case 16:if(ie=d.length,ie){if(ie>m&&(ie=m),ie>X&&(ie=X),ie===0)break e;G.set(pe.subarray(M,M+ie),l),m-=ie,M+=ie,X-=ie,l+=ie,d.length-=ie;break}d.mode=w;break;case 17:for(;k<14;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if(d.nlen=257+(31&g),g>>>=5,k-=5,d.ndist=1+(31&g),g>>>=5,k-=5,d.ncode=4+(15&g),g>>>=4,k-=4,d.nlen>286||d.ndist>30){B.msg="too many length or distance symbols",d.mode=I;break}d.have=0,d.mode=18;case 18:for(;d.have<d.ncode;){for(;k<3;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}d.lens[je[d.have++]]=7&g,g>>>=3,k-=3}for(;d.have<19;)d.lens[je[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,R={bits:d.lenbits},he=F(0,d.lens,0,19,d.lencode,0,d.work,R),d.lenbits=R.bits,he){B.msg="invalid code lengths set",d.mode=I;break}d.have=0,d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;ae=d.lencode[g&(1<<d.lenbits)-1],Oe=ae>>>24,xe=ae>>>16&255,ke=65535&ae,!(Oe<=k);){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if(ke<16)g>>>=Oe,k-=Oe,d.lens[d.have++]=ke;else{if(ke===16){for(Ve=Oe+2;k<Ve;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if(g>>>=Oe,k-=Oe,d.have===0){B.msg="invalid bit length repeat",d.mode=I;break}o=d.lens[d.have-1],ie=3+(3&g),g>>>=2,k-=2}else if(ke===17){for(Ve=Oe+3;k<Ve;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}g>>>=Oe,k-=Oe,o=0,ie=3+(7&g),g>>>=3,k-=3}else{for(Ve=Oe+7;k<Ve;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}g>>>=Oe,k-=Oe,o=0,ie=11+(127&g),g>>>=7,k-=7}if(d.have+ie>d.nlen+d.ndist){B.msg="invalid bit length repeat",d.mode=I;break}for(;ie--;)d.lens[d.have++]=o}}if(d.mode===I)break;if(d.lens[256]===0){B.msg="invalid code -- missing end-of-block",d.mode=I;break}if(d.lenbits=9,R={bits:d.lenbits},he=F(1,d.lens,0,d.nlen,d.lencode,0,d.work,R),d.lenbits=R.bits,he){B.msg="invalid literal/lengths set",d.mode=I;break}if(d.distbits=6,d.distcode=d.distdyn,R={bits:d.distbits},he=F(2,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,R),d.distbits=R.bits,he){B.msg="invalid distances set",d.mode=I;break}if(d.mode=20,te===L)break e;case 20:d.mode=21;case 21:if(m>=6&&X>=258){B.next_out=l,B.avail_out=X,B.next_in=M,B.avail_in=m,d.hold=g,d.bits=k,y(B,ye),l=B.next_out,G=B.output,X=B.avail_out,M=B.next_in,pe=B.input,m=B.avail_in,g=d.hold,k=d.bits,d.mode===w&&(d.back=-1);break}for(d.back=0;ae=d.lencode[g&(1<<d.lenbits)-1],Oe=ae>>>24,xe=ae>>>16&255,ke=65535&ae,!(Oe<=k);){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if(xe&&(240&xe)==0){for(Se=Oe,qe=xe,We=ke;ae=d.lencode[We+((g&(1<<Se+qe)-1)>>Se)],Oe=ae>>>24,xe=ae>>>16&255,ke=65535&ae,!(Se+Oe<=k);){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}g>>>=Se,k-=Se,d.back+=Se}if(g>>>=Oe,k-=Oe,d.back+=Oe,d.length=ke,xe===0){d.mode=26;break}if(32&xe){d.back=-1,d.mode=w;break}if(64&xe){B.msg="invalid literal/length code",d.mode=I;break}d.extra=15&xe,d.mode=22;case 22:if(d.extra){for(Ve=d.extra;k<Ve;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}d.length+=g&(1<<d.extra)-1,g>>>=d.extra,k-=d.extra,d.back+=d.extra}d.was=d.length,d.mode=23;case 23:for(;ae=d.distcode[g&(1<<d.distbits)-1],Oe=ae>>>24,xe=ae>>>16&255,ke=65535&ae,!(Oe<=k);){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if((240&xe)==0){for(Se=Oe,qe=xe,We=ke;ae=d.distcode[We+((g&(1<<Se+qe)-1)>>Se)],Oe=ae>>>24,xe=ae>>>16&255,ke=65535&ae,!(Se+Oe<=k);){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}g>>>=Se,k-=Se,d.back+=Se}if(g>>>=Oe,k-=Oe,d.back+=Oe,64&xe){B.msg="invalid distance code",d.mode=I;break}d.offset=ke,d.extra=15&xe,d.mode=24;case 24:if(d.extra){for(Ve=d.extra;k<Ve;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}d.offset+=g&(1<<d.extra)-1,g>>>=d.extra,k-=d.extra,d.back+=d.extra}if(d.offset>d.dmax){B.msg="invalid distance too far back",d.mode=I;break}d.mode=25;case 25:if(X===0)break e;if(ie=ye-X,d.offset>ie){if(ie=d.offset-ie,ie>d.whave&&d.sane){B.msg="invalid distance too far back",d.mode=I;break}ie>d.wnext?(ie-=d.wnext,we=d.wsize-ie):we=d.wnext-ie,ie>d.length&&(ie=d.length),Ae=d.window}else Ae=G,we=l-d.offset,ie=d.length;ie>X&&(ie=X),X-=ie,d.length-=ie;do G[l++]=Ae[we++];while(--ie);d.length===0&&(d.mode=21);break;case 26:if(X===0)break e;G[l++]=d.length,X--,d.mode=21;break;case 27:if(d.wrap){for(;k<32;){if(m===0)break e;m--,g|=pe[M++]<<k,k+=8}if(ye-=X,B.total_out+=ye,d.total+=ye,ye&&(B.adler=d.check=d.flags?v(d.check,G,ye,l-ye):p(d.check,G,ye,l-ye)),ye=X,(d.flags?g:h(g))!==d.check){B.msg="incorrect data check",d.mode=I;break}g=0,k=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;k<32;){if(m===0)break e;m--,g+=pe[M++]<<k,k+=8}if(g!==(4294967295&d.total)){B.msg="incorrect length check",d.mode=I;break}g=0,k=0}d.mode=29;case 29:he=J;break e;case I:he=u;break e;case 31:return _;case 32:default:return S}return B.next_out=l,B.avail_out=X,B.next_in=M,B.avail_in=m,d.hold=g,d.bits=k,(d.wsize||ye!==B.avail_out&&d.mode<I&&(d.mode<27||te!==Q))&&ce(B,B.output,B.next_out,ye-B.avail_out)?(d.mode=31,_):(Ie-=B.avail_in,ye-=B.avail_out,B.total_in+=Ie,B.total_out+=ye,d.total+=ye,d.wrap&&ye&&(B.adler=d.check=d.flags?v(d.check,G,ye,B.next_out-ye):p(d.check,G,ye,B.next_out-ye)),B.data_type=d.bits+(d.last?64:0)+(d.mode===w?128:0)+(d.mode===20||d.mode===15?256:0),(Ie===0&&ye===0||te===Q)&&he===Z&&(he=j),he)},N.exports.inflateEnd=B=>{if(!B||!B.state)return S;let te=B.state;return te.window&&(te.window=null),B.state=null,Z},N.exports.inflateGetHeader=(B,te)=>{if(!B||!B.state)return S;let d=B.state;return(2&d.wrap)==0?S:(d.head=te,te.done=!1,Z)},N.exports.inflateSetDictionary=(B,te)=>{let d=te.length,pe,G,M;return B&&B.state?(pe=B.state,pe.wrap!==0&&pe.mode!==11?S:pe.mode===11&&(G=1,G=p(G,te,d,0),G!==pe.check)?u:(M=ce(B,te,d,d),M?(pe.mode=31,_):(pe.havedict=1,Z))):S},N.exports.inflateInfo="pako inflate (from Nodeca project)"},function(N){N.exports=function(a,n){let p,v,y,F,Q,U,L,Z,J,q,S,u,_,j,W,w,I,h,i,c,b,P,D,V,re=a.state;p=a.next_in,D=a.input,v=p+(a.avail_in-5),y=a.next_out,V=a.output,F=y-(n-a.avail_out),Q=y+(a.avail_out-257),U=re.dmax,L=re.wsize,Z=re.whave,J=re.wnext,q=re.window,S=re.hold,u=re.bits,_=re.lencode,j=re.distcode,W=(1<<re.lenbits)-1,w=(1<<re.distbits)-1;e:do{u<15&&(S+=D[p++]<<u,u+=8,S+=D[p++]<<u,u+=8),I=_[S&W];t:for(;;){if(h=I>>>24,S>>>=h,u-=h,h=I>>>16&255,h===0)V[y++]=65535&I;else{if(!(16&h)){if((64&h)==0){I=_[(65535&I)+(S&(1<<h)-1)];continue t}if(32&h){re.mode=12;break e}a.msg="invalid literal/length code",re.mode=30;break e}i=65535&I,h&=15,h&&(u<h&&(S+=D[p++]<<u,u+=8),i+=S&(1<<h)-1,S>>>=h,u-=h),u<15&&(S+=D[p++]<<u,u+=8,S+=D[p++]<<u,u+=8),I=j[S&w];r:for(;;){if(h=I>>>24,S>>>=h,u-=h,h=I>>>16&255,!(16&h)){if((64&h)==0){I=j[(65535&I)+(S&(1<<h)-1)];continue r}a.msg="invalid distance code",re.mode=30;break e}if(c=65535&I,h&=15,u<h&&(S+=D[p++]<<u,u+=8,u<h&&(S+=D[p++]<<u,u+=8)),c+=S&(1<<h)-1,c>U){a.msg="invalid distance too far back",re.mode=30;break e}if(S>>>=h,u-=h,h=y-F,c>h){if(h=c-h,h>Z&&re.sane){a.msg="invalid distance too far back",re.mode=30;break e}if(b=0,P=q,J===0){if(b+=L-h,h<i){i-=h;do V[y++]=q[b++];while(--h);b=y-c,P=V}}else if(J<h){if(b+=L+J-h,h-=J,h<i){i-=h;do V[y++]=q[b++];while(--h);if(b=0,J<i){h=J,i-=h;do V[y++]=q[b++];while(--h);b=y-c,P=V}}}else if(b+=J-h,h<i){i-=h;do V[y++]=q[b++];while(--h);b=y-c,P=V}for(;i>2;)V[y++]=P[b++],V[y++]=P[b++],V[y++]=P[b++],i-=3;i&&(V[y++]=P[b++],i>1&&(V[y++]=P[b++]))}else{b=y-c;do V[y++]=V[b++],V[y++]=V[b++],V[y++]=V[b++],i-=3;while(i>2);i&&(V[y++]=V[b++],i>1&&(V[y++]=V[b++]))}break}}break}}while(p<v&&y<Q);i=u>>3,p-=i,u-=i<<3,S&=(1<<u)-1,a.next_in=p,a.next_out=y,a.avail_in=p<v?v-p+5:5-(p-v),a.avail_out=y<Q?Q-y+257:257-(y-Q),re.hold=S,re.bits=u}},function(N){let n=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),p=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),v=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),y=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);N.exports=(F,Q,U,L,Z,J,q,S)=>{let u=S.bits,_,j,W,w,I,h,i=0,c=0,b=0,P=0,D=0,V=0,re=0,H=0,ee=0,ce=0,B=null,te=0,d=new Uint16Array(16),pe=new Uint16Array(16),G,M,l,m=null,X=0;for(i=0;i<=15;i++)d[i]=0;for(c=0;c<L;c++)d[Q[U+c]]++;for(D=u,P=15;P>=1&&d[P]===0;P--);if(D>P&&(D=P),P===0)return Z[J++]=20971520,Z[J++]=20971520,S.bits=1,0;for(b=1;b<P&&d[b]===0;b++);for(D<b&&(D=b),H=1,i=1;i<=15;i++)if(H<<=1,H-=d[i],H<0)return-1;if(H>0&&(F===0||P!==1))return-1;for(pe[1]=0,i=1;i<15;i++)pe[i+1]=pe[i]+d[i];for(c=0;c<L;c++)Q[U+c]!==0&&(q[pe[Q[U+c]]++]=c);if(F===0?(B=m=q,h=19):F===1?(B=n,te-=257,m=p,X-=257,h=256):(B=v,m=y,h=-1),ce=0,c=0,i=b,I=J,V=D,re=0,W=-1,ee=1<<D,w=ee-1,F===1&&ee>852||F===2&&ee>592)return 1;for(;;){G=i-re,q[c]<h?(M=0,l=q[c]):q[c]>h?(M=m[X+q[c]],l=B[te+q[c]]):(M=96,l=0),_=1<<i-re,j=1<<V,b=j;do j-=_,Z[I+(ce>>re)+j]=G<<24|M<<16|l|0;while(j!==0);for(_=1<<i-1;ce&_;)_>>=1;if(_!==0?(ce&=_-1,ce+=_):ce=0,c++,--d[i]==0){if(i===P)break;i=Q[U+q[c]]}if(i>D&&(ce&w)!==W){for(re===0&&(re=D),I+=b,V=i-re,H=1<<V;V+re<P&&(H-=d[V+re],!(H<=0));)V++,H<<=1;if(ee+=1<<V,F===1&&ee>852||F===2&&ee>592)return 1;W=ce&w,Z[W]=D<<24|V<<16|I-J|0}}return ce!==0&&(Z[I+ce]=i-re<<24|4194304|0),S.bits=D,0}},function(N){N.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(N){let a=new TextEncoder,n=new TextDecoder("utf-8");function p(S){return a.encode(S)}function v(S){return n.decode(S)}function y(S){if(typeof S!="string")throw new TypeError("value is not a string");if(!/^([0-9a-f][0-9a-f])*$/.test(S))throw new RangeError("value is not hexadecimal");return S===""?new Uint8Array(0):new Uint8Array(S.match(/../g).map(u=>parseInt(u,16)))}function F(S){let u=[];for(let _ of S){if(_<0||_>255)throw new RangeError(`value does not fit in one byte: ${_}`);u.push(("0"+_.toString(16)).slice(-2))}return u.join("")}class Q{constructor(){this.buf=new Uint8Array(16),this.offset=0}get buffer(){return this.finish(),this.buf.subarray(0,this.offset)}grow(u=0){let _=4*this.buf.byteLength;for(;_<u;)_*=2;let j=new Uint8Array(_);return j.set(this.buf,0),this.buf=j,this}appendByte(u){this.offset>=this.buf.byteLength&&this.grow(),this.buf[this.offset]=u,this.offset+=1}appendUint32(u){if(!Number.isInteger(u))throw new RangeError("value is not an integer");if(u<0||u>4294967295)throw new RangeError("number out of range");let _=Math.max(1,Math.ceil((32-Math.clz32(u))/7));this.offset+_>this.buf.byteLength&&this.grow();for(let j=0;j<_;j++)this.buf[this.offset+j]=127&u|(j===_-1?0:128),u>>>=7;return this.offset+=_,_}appendInt32(u){if(!Number.isInteger(u))throw new RangeError("value is not an integer");if(u<-2147483648||u>2147483647)throw new RangeError("number out of range");let _=Math.ceil((33-Math.clz32(u>=0?u:-u-1))/7);this.offset+_>this.buf.byteLength&&this.grow();for(let j=0;j<_;j++)this.buf[this.offset+j]=127&u|(j===_-1?0:128),u>>=7;return this.offset+=_,_}appendUint53(u){if(!Number.isInteger(u))throw new RangeError("value is not an integer");if(u<0||u>Number.MAX_SAFE_INTEGER)throw new RangeError("number out of range");let _=Math.floor(u/4294967296),j=(4294967295&u)>>>0;return this.appendUint64(_,j)}appendInt53(u){if(!Number.isInteger(u))throw new RangeError("value is not an integer");if(u<Number.MIN_SAFE_INTEGER||u>Number.MAX_SAFE_INTEGER)throw new RangeError("number out of range");let _=Math.floor(u/4294967296),j=(4294967295&u)>>>0;return this.appendInt64(_,j)}appendUint64(u,_){if(!Number.isInteger(u)||!Number.isInteger(_))throw new RangeError("value is not an integer");if(u<0||u>4294967295||_<0||_>4294967295)throw new RangeError("number out of range");if(u===0)return this.appendUint32(_);let j=Math.ceil((64-Math.clz32(u))/7);this.offset+j>this.buf.byteLength&&this.grow();for(let W=0;W<4;W++)this.buf[this.offset+W]=127&_|128,_>>>=7;this.buf[this.offset+4]=15&_|(7&u)<<4|(j===5?0:128),u>>>=3;for(let W=5;W<j;W++)this.buf[this.offset+W]=127&u|(W===j-1?0:128),u>>>=7;return this.offset+=j,j}appendInt64(u,_){if(!Number.isInteger(u)||!Number.isInteger(_))throw new RangeError("value is not an integer");if(u<-2147483648||u>2147483647||_<-2147483648||_>4294967295)throw new RangeError("number out of range");if(_>>>=0,u===0&&_<=2147483647)return this.appendInt32(_);if(u===-1&&_>=2147483648)return this.appendInt32(_-4294967296);let j=Math.ceil((65-Math.clz32(u>=0?u:-u-1))/7);this.offset+j>this.buf.byteLength&&this.grow();for(let W=0;W<4;W++)this.buf[this.offset+W]=127&_|128,_>>>=7;this.buf[this.offset+4]=15&_|(7&u)<<4|(j===5?0:128),u>>=3;for(let W=5;W<j;W++)this.buf[this.offset+W]=127&u|(W===j-1?0:128),u>>=7;return this.offset+=j,j}appendRawBytes(u){return this.offset+u.byteLength>this.buf.byteLength&&this.grow(this.offset+u.byteLength),this.buf.set(u,this.offset),this.offset+=u.byteLength,u.byteLength}appendRawString(u){if(typeof u!="string")throw new TypeError("value is not a string");return this.appendRawBytes(p(u))}appendPrefixedBytes(u){return this.appendUint53(u.byteLength),this.appendRawBytes(u),this}appendPrefixedString(u){if(typeof u!="string")throw new TypeError("value is not a string");return this.appendPrefixedBytes(p(u)),this}appendHexString(u){return this.appendPrefixedBytes(y(u)),this}finish(){}}class U{constructor(u){if(!(u instanceof Uint8Array))throw new TypeError(`Not a byte array: ${u}`);this.buf=u,this.offset=0}get done(){return this.offset===this.buf.byteLength}reset(){this.offset=0}skip(u){if(this.offset+u>this.buf.byteLength)throw new RangeError("cannot skip beyond end of buffer");this.offset+=u}readByte(){return this.offset+=1,this.buf[this.offset-1]}readUint32(){let u=0,_=0;for(;this.offset<this.buf.byteLength;){let j=this.buf[this.offset];if(_===28&&(240&j)!=0)throw new RangeError("number out of range");if(u=(u|(127&j)<<_)>>>0,_+=7,this.offset++,(128&j)==0)return u}throw new RangeError("buffer ended with incomplete number")}readInt32(){let u=0,_=0;for(;this.offset<this.buf.byteLength;){let j=this.buf[this.offset];if(_===28&&(128&j)!=0||_===28&&(64&j)==0&&(56&j)!=0||_===28&&(64&j)!=0&&(56&j)!=56)throw new RangeError("number out of range");if(u|=(127&j)<<_,_+=7,this.offset++,(128&j)==0)return(64&j)==0||_>28?u:u|-1<<_}throw new RangeError("buffer ended with incomplete number")}readUint53(){let{low32:u,high32:_}=this.readUint64();if(_<0||_>2097151)throw new RangeError("number out of range");return 4294967296*_+u}readInt53(){let{low32:u,high32:_}=this.readInt64();if(_<-2097152||_===-2097152&&u===0||_>2097151)throw new RangeError("number out of range");return 4294967296*_+u}readUint64(){let u=0,_=0,j=0;for(;this.offset<this.buf.byteLength&&j<=28;){let W=this.buf[this.offset];if(u=(u|(127&W)<<j)>>>0,j===28&&(_=(112&W)>>>4),j+=7,this.offset++,(128&W)==0)return{high32:_,low32:u}}for(j=3;this.offset<this.buf.byteLength;){let W=this.buf[this.offset];if(j===31&&(254&W)!=0)throw new RangeError("number out of range");if(_=(_|(127&W)<<j)>>>0,j+=7,this.offset++,(128&W)==0)return{high32:_,low32:u}}throw new RangeError("buffer ended with incomplete number")}readInt64(){let u=0,_=0,j=0;for(;this.offset<this.buf.byteLength&&j<=28;){let W=this.buf[this.offset];if(u=(u|(127&W)<<j)>>>0,j===28&&(_=(112&W)>>>4),j+=7,this.offset++,(128&W)==0)return(64&W)!=0&&(j<32&&(u=(u|-1<<j)>>>0),_|=-1<<Math.max(j-32,0)),{high32:_,low32:u}}for(j=3;this.offset<this.buf.byteLength;){let W=this.buf[this.offset];if(j===31&&W!==0&&W!==127)throw new RangeError("number out of range");if(_|=(127&W)<<j,j+=7,this.offset++,(128&W)==0)return(64&W)!=0&&j<32&&(_|=-1<<j),{high32:_,low32:u}}throw new RangeError("buffer ended with incomplete number")}readRawBytes(u){let _=this.offset;if(_+u>this.buf.byteLength)throw new RangeError("subarray exceeds buffer size");return this.offset+=u,this.buf.subarray(_,this.offset)}readRawString(u){return v(this.readRawBytes(u))}readPrefixedBytes(){return this.readRawBytes(this.readUint53())}readPrefixedString(){return v(this.readPrefixedBytes())}readHexString(){return F(this.readPrefixedBytes())}}class L extends Q{constructor(u){super(),this.type=u,this.state="empty",this.lastValue=void 0,this.count=0,this.literal=[]}appendValue(u,_=1){this._appendValue(u,_)}_appendValue(u,_=1){_<=0||(this.state==="empty"?(this.state=u===null?"nulls":_===1?"loneValue":"repetition",this.lastValue=u,this.count=_):this.state==="loneValue"?u===null?(this.flush(),this.state="nulls",this.count=_):u===this.lastValue?(this.state="repetition",this.count=1+_):_>1?(this.flush(),this.state="repetition",this.count=_,this.lastValue=u):(this.state="literal",this.literal=[this.lastValue],this.lastValue=u):this.state==="repetition"?u===null?(this.flush(),this.state="nulls",this.count=_):u===this.lastValue?this.count+=_:_>1?(this.flush(),this.state="repetition",this.count=_,this.lastValue=u):(this.flush(),this.state="loneValue",this.lastValue=u):this.state==="literal"?u===null?(this.literal.push(this.lastValue),this.flush(),this.state="nulls",this.count=_):u===this.lastValue?(this.flush(),this.state="repetition",this.count=1+_):_>1?(this.literal.push(this.lastValue),this.flush(),this.state="repetition",this.count=_,this.lastValue=u):(this.literal.push(this.lastValue),this.lastValue=u):this.state==="nulls"&&(u===null?this.count+=_:_>1?(this.flush(),this.state="repetition",this.count=_,this.lastValue=u):(this.flush(),this.state="loneValue",this.lastValue=u)))}copyFrom(u,_={}){let{count:j,sumValues:W,sumShift:w}=_;if(!(u instanceof Z)||u.type!==this.type)throw new TypeError("incompatible type of decoder");let I=typeof j=="number"?j:Number.MAX_SAFE_INTEGER,h=0,i=0;if(j&&I>0&&u.done)throw new RangeError(`cannot copy ${j} values`);if(I===0||u.done)return W?{nonNullValues:h,sum:i}:{nonNullValues:h};let c=u.readValue();if(c===null){let P=Math.min(u.count+1,I);if(I-=P,u.count-=P-1,this.appendValue(null,P),j&&I>0&&u.done)throw new RangeError(`cannot copy ${j} values`);if(I===0||u.done)return W?{nonNullValues:h,sum:i}:{nonNullValues:h};if(c=u.readValue(),c===null)throw new RangeError("null run must be followed by non-null value")}if(this.appendValue(c),I--,h++,W&&(i+=w?c>>>w:c),j&&I>0&&u.done)throw new RangeError(`cannot copy ${j} values`);if(I===0||u.done)return W?{nonNullValues:h,sum:i}:{nonNullValues:h};let b=u.count>0;for(;I>0&&!u.done;){b||u.readRecord();let P=Math.min(u.count,I);if(u.count-=P,u.state==="literal"){h+=P;for(let D=0;D<P;D++){if(u.done)throw new RangeError("incomplete literal");let V=u.readRawValue();if(V===u.lastValue)throw new RangeError("Repetition of values is not allowed in literal");u.lastValue=V,this._appendValue(V),W&&(i+=w?V>>>w:V)}}else if(u.state==="repetition"){h+=P,W&&(i+=P*(w?u.lastValue>>>w:u.lastValue));let D=u.lastValue;if(this._appendValue(D),P>1){if(this._appendValue(D),this.state!=="repetition")throw new RangeError(`Unexpected state ${this.state}`);this.count+=P-2}}else if(u.state==="nulls"){if(this._appendValue(null),this.state!=="nulls")throw new RangeError(`Unexpected state ${this.state}`);this.count+=P-1}b=!1,I-=P}if(j&&I>0&&u.done)throw new RangeError(`cannot copy ${j} values`);return W?{nonNullValues:h,sum:i}:{nonNullValues:h}}flush(){if(this.state==="loneValue")this.appendInt32(-1),this.appendRawValue(this.lastValue);else if(this.state==="repetition")this.appendInt53(this.count),this.appendRawValue(this.lastValue);else if(this.state==="literal"){this.appendInt53(-this.literal.length);for(let u of this.literal)this.appendRawValue(u)}else this.state==="nulls"&&(this.appendInt32(0),this.appendUint53(this.count));this.state="empty"}appendRawValue(u){if(this.type==="int")this.appendInt53(u);else if(this.type==="uint")this.appendUint53(u);else{if(this.type!=="utf8")throw new RangeError(`Unknown RLEEncoder datatype: ${this.type}`);this.appendPrefixedString(u)}}finish(){this.state==="literal"&&this.literal.push(this.lastValue),(this.state!=="nulls"||this.offset>0)&&this.flush()}}class Z extends U{constructor(u,_){super(_),this.type=u,this.lastValue=void 0,this.count=0,this.state=void 0}get done(){return this.count===0&&this.offset===this.buf.byteLength}reset(){this.offset=0,this.lastValue=void 0,this.count=0,this.state=void 0}readValue(){if(this.done)return null;if(this.count===0&&this.readRecord(),this.count-=1,this.state==="literal"){let u=this.readRawValue();if(u===this.lastValue)throw new RangeError("Repetition of values is not allowed in literal");return this.lastValue=u,u}return this.lastValue}skipValues(u){for(;u>0&&!this.done;){this.count===0&&(this.count=this.readInt53(),this.count>0?(this.lastValue=this.count<=u?this.skipRawValues(1):this.readRawValue(),this.state="repetition"):this.count<0?(this.count=-this.count,this.state="literal"):(this.count=this.readUint53(),this.lastValue=null,this.state="nulls"));let _=Math.min(u,this.count);this.state==="literal"&&this.skipRawValues(_),u-=_,this.count-=_}}readRecord(){if(this.count=this.readInt53(),this.count>1){let u=this.readRawValue();if((this.state==="repetition"||this.state==="literal")&&this.lastValue===u)throw new RangeError("Successive repetitions with the same value are not allowed");this.state="repetition",this.lastValue=u}else{if(this.count===1)throw new RangeError("Repetition count of 1 is not allowed, use a literal instead");if(this.count<0){if(this.count=-this.count,this.state==="literal")throw new RangeError("Successive literals are not allowed");this.state="literal"}else{if(this.state==="nulls")throw new RangeError("Successive null runs are not allowed");if(this.count=this.readUint53(),this.count===0)throw new RangeError("Zero-length null runs are not allowed");this.lastValue=null,this.state="nulls"}}}readRawValue(){if(this.type==="int")return this.readInt53();if(this.type==="uint")return this.readUint53();if(this.type==="utf8")return this.readPrefixedString();throw new RangeError(`Unknown RLEDecoder datatype: ${this.type}`)}skipRawValues(u){if(this.type==="utf8")for(let _=0;_<u;_++)this.skip(this.readUint53());else{for(;u>0&&this.offset<this.buf.byteLength;)(128&this.buf[this.offset])==0&&u--,this.offset++;if(u>0)throw new RangeError("cannot skip beyond end of buffer")}}}class J extends Z{constructor(u){super("int",u),this.absoluteValue=0}reset(){this.offset=0,this.lastValue=void 0,this.count=0,this.state=void 0,this.absoluteValue=0}readValue(){let u=super.readValue();return u===null?null:(this.absoluteValue+=u,this.absoluteValue)}skipValues(u){for(;u>0&&!this.done;){this.count===0&&this.readRecord();let _=Math.min(u,this.count);if(this.state==="literal")for(let j=0;j<_;j++)this.lastValue=this.readRawValue(),this.absoluteValue+=this.lastValue;else this.state==="repetition"&&(this.absoluteValue+=_*this.lastValue);u-=_,this.count-=_}}}class q extends U{constructor(u){super(u),this.lastValue=!0,this.firstRun=!0,this.count=0}get done(){return this.count===0&&this.offset===this.buf.byteLength}reset(){this.offset=0,this.lastValue=!0,this.firstRun=!0,this.count=0}readValue(){if(this.done)return!1;for(;this.count===0;){if(this.count=this.readUint53(),this.lastValue=!this.lastValue,this.count===0&&!this.firstRun)throw new RangeError("Zero-length runs are not allowed");this.firstRun=!1}return this.count-=1,this.lastValue}skipValues(u){for(;u>0&&!this.done;){if(this.count===0&&(this.count=this.readUint53(),this.lastValue=!this.lastValue,this.count===0))throw new RangeError("Zero-length runs are not allowed");this.count<u?(u-=this.count,this.count=0):(this.count-=u,u=0)}}}N.exports={stringToUtf8:p,utf8ToString:v,hexStringToBytes:y,bytesToHexString:F,Encoder:Q,Decoder:U,RLEEncoder:L,RLEDecoder:Z,DeltaEncoder:class extends L{constructor(){super("int"),this.absoluteValue=0}appendValue(S,u=1){u<=0||(typeof S=="number"?(super.appendValue(S-this.absoluteValue,1),this.absoluteValue=S,u>1&&super.appendValue(0,u-1)):super.appendValue(S,u))}copyFrom(S,u={}){if(u.sumValues)throw new RangeError("unsupported options for DeltaEncoder.copyFrom()");if(!(S instanceof J))throw new TypeError("incompatible type of decoder");let _=u.count;if(_>0&&S.done)throw new RangeError(`cannot copy ${_} values`);if(_===0||S.done)return;let j=S.readValue(),W=0;if(this.appendValue(j),j===null){if(W=S.count+1,_!==void 0&&_<W&&(W=_),S.count-=W-1,this.count+=W-1,_>W&&S.done)throw new RangeError(`cannot copy ${_} values`);if(_===W||S.done)return;S.count===0&&this.appendValue(S.readValue())}_!==void 0&&(_-=W+1);let{nonNullValues:w,sum:I}=super.copyFrom(S,{count:_,sumValues:!0});w>0&&(this.absoluteValue=I,S.absoluteValue=I)}},DeltaDecoder:J,BooleanEncoder:class extends Q{constructor(){super(),this.lastValue=!1,this.count=0}appendValue(S,u=1){if(S!==!1&&S!==!0)throw new RangeError(`Unsupported value for BooleanEncoder: ${S}`);u<=0||(this.lastValue===S?this.count+=u:(this.appendUint53(this.count),this.lastValue=S,this.count=u))}copyFrom(S,u={}){if(!(S instanceof q))throw new TypeError("incompatible type of decoder");let{count:_}=u,j=typeof _=="number"?_:Number.MAX_SAFE_INTEGER;if(_&&j>0&&S.done)throw new RangeError(`cannot copy ${_} values`);if(j===0||S.done)return;this.appendValue(S.readValue()),j--;let W=Math.min(S.count,j);for(this.count+=W,S.count-=W,j-=W;j>0&&!S.done;){if(S.count=S.readUint53(),S.count===0)throw new RangeError("Zero-length runs are not allowed");S.lastValue=!S.lastValue,this.appendUint53(this.count);let w=Math.min(S.count,j);this.count=w,this.lastValue=S.lastValue,S.count-=w,j-=w}if(_&&j>0&&S.done)throw new RangeError(`cannot copy ${_} values`)}finish(){this.count>0&&(this.appendUint53(this.count),this.count=0)}},BooleanDecoder:q}},function(N,a,n){var p;(function(v,y){var F={};(function(L){L.__esModule=!0,L.digestLength=32,L.blockSize=64;var Z=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function J(h,i,c,b,P){for(var D,V,re,H,ee,ce,B,te,d,pe,G,M,l;P>=64;){for(D=i[0],V=i[1],re=i[2],H=i[3],ee=i[4],ce=i[5],B=i[6],te=i[7],pe=0;pe<16;pe++)G=b+4*pe,h[pe]=(255&c[G])<<24|(255&c[G+1])<<16|(255&c[G+2])<<8|255&c[G+3];for(pe=16;pe<64;pe++)M=((d=h[pe-2])>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,l=((d=h[pe-15])>>>7|d<<25)^(d>>>18|d<<14)^d>>>3,h[pe]=(M+h[pe-7]|0)+(l+h[pe-16]|0);for(pe=0;pe<64;pe++)M=(((ee>>>6|ee<<26)^(ee>>>11|ee<<21)^(ee>>>25|ee<<7))+(ee&ce^~ee&B)|0)+(te+(Z[pe]+h[pe]|0)|0)|0,l=((D>>>2|D<<30)^(D>>>13|D<<19)^(D>>>22|D<<10))+(D&V^D&re^V&re)|0,te=B,B=ce,ce=ee,ee=H+M|0,H=re,re=V,V=D,D=M+l|0;i[0]+=D,i[1]+=V,i[2]+=re,i[3]+=H,i[4]+=ee,i[5]+=ce,i[6]+=B,i[7]+=te,b+=64,P-=64}return b}var q=function(){function h(){this.digestLength=L.digestLength,this.blockSize=L.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return h.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},h.prototype.clean=function(){for(var i=0;i<this.buffer.length;i++)this.buffer[i]=0;for(i=0;i<this.temp.length;i++)this.temp[i]=0;this.reset()},h.prototype.update=function(i,c){if(c===void 0&&(c=i.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var b=0;if(this.bytesHashed+=c,this.bufferLength>0){for(;this.bufferLength<64&&c>0;)this.buffer[this.bufferLength++]=i[b++],c--;this.bufferLength===64&&(J(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(c>=64&&(b=J(this.temp,this.state,i,b,c),c%=64);c>0;)this.buffer[this.bufferLength++]=i[b++],c--;return this},h.prototype.finish=function(i){if(!this.finished){var c=this.bytesHashed,b=this.bufferLength,P=c/536870912|0,D=c<<3,V=c%64<56?64:128;this.buffer[b]=128;for(var re=b+1;re<V-8;re++)this.buffer[re]=0;this.buffer[V-8]=P>>>24&255,this.buffer[V-7]=P>>>16&255,this.buffer[V-6]=P>>>8&255,this.buffer[V-5]=P>>>0&255,this.buffer[V-4]=D>>>24&255,this.buffer[V-3]=D>>>16&255,this.buffer[V-2]=D>>>8&255,this.buffer[V-1]=D>>>0&255,J(this.temp,this.state,this.buffer,0,V),this.finished=!0}for(re=0;re<8;re++)i[4*re+0]=this.state[re]>>>24&255,i[4*re+1]=this.state[re]>>>16&255,i[4*re+2]=this.state[re]>>>8&255,i[4*re+3]=this.state[re]>>>0&255;return this},h.prototype.digest=function(){var i=new Uint8Array(this.digestLength);return this.finish(i),i},h.prototype._saveState=function(i){for(var c=0;c<this.state.length;c++)i[c]=this.state[c]},h.prototype._restoreState=function(i,c){for(var b=0;b<this.state.length;b++)this.state[b]=i[b];this.bytesHashed=c,this.finished=!1,this.bufferLength=0},h}();L.Hash=q;var S=function(){function h(i){this.inner=new q,this.outer=new q,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var c=new Uint8Array(this.blockSize);if(i.length>this.blockSize)new q().update(i).finish(c).clean();else for(var b=0;b<i.length;b++)c[b]=i[b];for(b=0;b<c.length;b++)c[b]^=54;for(this.inner.update(c),b=0;b<c.length;b++)c[b]^=106;for(this.outer.update(c),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate),b=0;b<c.length;b++)c[b]=0}return h.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},h.prototype.clean=function(){for(var i=0;i<this.istate.length;i++)this.ostate[i]=this.istate[i]=0;this.inner.clean(),this.outer.clean()},h.prototype.update=function(i){return this.inner.update(i),this},h.prototype.finish=function(i){return this.outer.finished?this.outer.finish(i):(this.inner.finish(i),this.outer.update(i,this.digestLength).finish(i)),this},h.prototype.digest=function(){var i=new Uint8Array(this.digestLength);return this.finish(i),i},h}();function u(h){var i=new q().update(h),c=i.digest();return i.clean(),c}function _(h,i){var c=new S(h).update(i),b=c.digest();return c.clean(),b}function j(h,i,c,b){var P=b[0];if(P===0)throw new Error("hkdf: cannot expand more");i.reset(),P>1&&i.update(h),c&&i.update(c),i.update(b),i.finish(h),b[0]++}L.HMAC=S,L.hash=u,L.default=u,L.hmac=_;var W=new Uint8Array(L.digestLength);function w(h,i,c,b){i===void 0&&(i=W),b===void 0&&(b=32);for(var P=new Uint8Array([1]),D=_(i,h),V=new S(D),re=new Uint8Array(V.digestLength),H=re.length,ee=new Uint8Array(b),ce=0;ce<b;ce++)H===re.length&&(j(re,V,c,P),H=0),ee[ce]=re[H++];return V.clean(),re.fill(0),P.fill(0),ee}function I(h,i,c,b){for(var P=new S(h),D=P.digestLength,V=new Uint8Array(4),re=new Uint8Array(D),H=new Uint8Array(D),ee=new Uint8Array(b),ce=0;ce*D<b;ce++){var B=ce+1;V[0]=B>>>24&255,V[1]=B>>>16&255,V[2]=B>>>8&255,V[3]=B>>>0&255,P.reset(),P.update(i),P.update(V),P.finish(H);for(var te=0;te<D;te++)re[te]=H[te];for(te=2;te<=c;te++){P.reset(),P.update(H).finish(H);for(var d=0;d<D;d++)re[d]^=H[d]}for(te=0;te<D&&ce*D+te<b;te++)ee[ce*D+te]=re[te]}for(ce=0;ce<D;ce++)re[ce]=H[ce]=0;for(ce=0;ce<4;ce++)V[ce]=0;return P.clean(),ee}L.hkdf=w,L.pbkdf2=I})(F);var Q=F.default;for(var U in F)Q[U]=F[U];typeof N.exports=="object"?N.exports=Q:(p=function(){return Q}.call(F,n,F,N))===void 0||(N.exports=p)})()},function(N,a,n){let{init:p,clone:v,free:y,applyChanges:F,applyLocalChange:Q,save:U,load:L,loadChanges:Z,getPatch:J,getHeads:q,getAllChanges:S,getChanges:u,getChangesAdded:_,getChangeByHash:j,getMissingDeps:W}=n(35),{receiveSyncMessage:w,generateSyncMessage:I,encodeSyncMessage:h,decodeSyncMessage:i,encodeSyncState:c,decodeSyncState:b,initSyncState:P}=n(40);N.exports={init:p,clone:v,free:y,applyChanges:F,applyLocalChange:Q,save:U,load:L,loadChanges:Z,getPatch:J,getHeads:q,getAllChanges:S,getChanges:u,getChangesAdded:_,getChangeByHash:j,getMissingDeps:W,receiveSyncMessage:w,generateSyncMessage:I,encodeSyncMessage:h,decodeSyncMessage:i,encodeSyncState:c,decodeSyncState:b,initSyncState:P}},function(N,a,n){let{Map:p,List:v}=n(36),y=n(37),{splitContainers:F,encodeChange:Q,decodeChanges:U,encodeDocument:L,constructPatch:Z,BackendDoc:J}=n(15),{backendState:q}=n(39);function S(i,c,b){return i.getIn(["opSet","states",c,b])}function u(){return{state:p({opSet:y.init(),objectIds:p()}),heads:[]}}function _(i,c,b,P){let D={clock:i.getIn(["opSet","states"]).map(V=>V.size).toObject(),deps:i.getIn(["opSet","deps"]).toArray().sort(),diffs:c,maxOp:i.getIn(["opSet","maxOp"],0),pendingChanges:y.getMissingDeps(i.get("opSet")).length};if(P&&b){D.actor=b.actor,D.seq=b.seq;let V=i.getIn(["opSet","states",b.actor,b.seq-1]);D.deps=D.deps.filter(re=>re!==V)}return D}function j(i,c,b,P){let D=P?{objectId:"_root",type:"map",props:{}}:null,V=i.get("opSet");for(let re of c)for(let H of F(re))V=b?y.addLocalChange(V,H,D):y.addChange(V,H,D);return y.finalizePatch(D),[i=i.set("opSet",V),P?_(i,D,b,!0):null]}function W(i){return L(I(i))}function w(i,c){let b=q(i);{let[P]=j(b,c,null,!1);return i.frozen=!0,{state:P,heads:y.getHeads(P.get("opSet"))}}}function I(i){return h(i,[])}function h(i,c){if(!Array.isArray(c))throw new TypeError("Pass an array of hashes to Backend.getChanges()");let b=q(i);return y.getMissingChanges(b.get("opSet"),v(c))}N.exports={init:u,clone:function(i){return{state:q(i),heads:i.heads}},free:function(i){i.state=null,i.frozen=!0},applyChanges:function(i,c){{let[b,P]=j(q(i),c,null,!0),D=y.getHeads(b.get("opSet"));return i.frozen=!0,[{state:b,heads:D},P]}},applyLocalChange:function(i,c){let b=q(i);if(c.seq<=function(D,V){return D.getIn(["opSet","states",V],v()).size}(b,c.actor))throw new RangeError("Change request has already been applied");if(c.seq>1){let D=S(b,c.actor,c.seq-2);if(!D)throw new RangeError(`Cannot find hash of localChange before seq=${c.seq}`);let V={[D]:!0};for(let re of c.deps)V[re]=!0;c.deps=Object.keys(V).sort()}let P=Q(c);{let D={actor:c.actor,seq:c.seq},[V,re]=j(b,[P],D,!0),H=y.getHeads(V.get("opSet"));return i.frozen=!0,[{state:V,heads:H},re,P]}},save:W,load:function(i){{let c=U([i]).map(Q);return w(u(),c)}},loadChanges:w,getPatch:function(i){let c=q(i);return _(c,Z(W(i)),null,!1)},getHeads:function(i){return i.heads},getAllChanges:I,getChanges:h,getChangesAdded:function(i,c){let b=q(i).get("opSet"),P=q(c).get("opSet");return y.getChangesAdded(b,P)},getChangeByHash:function(i,c){let b=q(i);return y.getChangeByHash(b.get("opSet"),c)},getMissingDeps:function(i,c=[]){let b=q(i);return y.getMissingDeps(b.get("opSet"),c)}}},function(N){N.exports=function(){var a=Array.prototype.slice;function n(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function p(e){return Q(e)?e:xe(e)}function v(e){return U(e)?e:ke(e)}function y(e){return L(e)?e:Se(e)}function F(e){return Q(e)&&!Z(e)?e:qe(e)}function Q(e){return!(!e||!e[q])}function U(e){return!(!e||!e[S])}function L(e){return!(!e||!e[u])}function Z(e){return U(e)||L(e)}function J(e){return!(!e||!e[_])}n(v,p),n(y,p),n(F,p),p.isIterable=Q,p.isKeyed=U,p.isIndexed=L,p.isAssociative=Z,p.isOrdered=J,p.Keyed=v,p.Indexed=y,p.Set=F;var q="@@__IMMUTABLE_ITERABLE__@@",S="@@__IMMUTABLE_KEYED__@@",u="@@__IMMUTABLE_INDEXED__@@",_="@@__IMMUTABLE_ORDERED__@@",j="delete",W=5,w=1<<W,I=w-1,h={},i={value:!1},c={value:!1};function b(e){return e.value=!1,e}function P(e){e&&(e.value=!0)}function D(){}function V(e,t){t=t||0;for(var r=Math.max(0,e.length-t),s=new Array(r),f=0;f<r;f++)s[f]=e[f+t];return s}function re(e){return e.size===void 0&&(e.size=e.__iterate(ee)),e.size}function H(e,t){if(typeof t!="number"){var r=t>>>0;if(""+r!==t||r===4294967295)return NaN;t=r}return t<0?re(e)+t:t}function ee(){return!0}function ce(e,t,r){return(e===0||r!==void 0&&e<=-r)&&(t===void 0||r!==void 0&&t>=r)}function B(e,t){return d(e,t,0)}function te(e,t){return d(e,t,t)}function d(e,t,r){return e===void 0?r:e<0?Math.max(0,t+e):t===void 0?e:Math.min(t,e)}var pe=0,G=1,M=2,l=typeof Symbol=="function"&&Symbol.iterator,m="@@iterator",X=l||m;function g(e){this.next=e}function k(e,t,r,s){var f=e===0?t:e===1?r:[t,r];return s?s.value=f:s={value:f,done:!1},s}function Ie(){return{value:void 0,done:!0}}function ye(e){return!!Ae(e)}function ie(e){return e&&typeof e.next=="function"}function we(e){var t=Ae(e);return t&&t.call(e)}function Ae(e){var t=e&&(l&&e[l]||e[m]);if(typeof t=="function")return t}function Oe(e){return e&&typeof e.length=="number"}function xe(e){return e==null?Je():Q(e)?e.toSeq():it(e)}function ke(e){return e==null?Je().toKeyedSeq():Q(e)?U(e)?e.toSeq():e.fromEntrySeq():Me(e)}function Se(e){return e==null?Je():Q(e)?U(e)?e.entrySeq():e.toIndexedSeq():at(e)}function qe(e){return(e==null?Je():Q(e)?U(e)?e.entrySeq():e:at(e)).toSetSeq()}g.prototype.toString=function(){return"[Iterator]"},g.KEYS=pe,g.VALUES=G,g.ENTRIES=M,g.prototype.inspect=g.prototype.toSource=function(){return this.toString()},g.prototype[X]=function(){return this},n(xe,p),xe.of=function(){return xe(arguments)},xe.prototype.toSeq=function(){return this},xe.prototype.toString=function(){return this.__toString("Seq {","}")},xe.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},xe.prototype.__iterate=function(e,t){return st(this,e,t,!0)},xe.prototype.__iterator=function(e,t){return jt(this,e,t,!0)},n(ke,xe),ke.prototype.toKeyedSeq=function(){return this},n(Se,xe),Se.of=function(){return Se(arguments)},Se.prototype.toIndexedSeq=function(){return this},Se.prototype.toString=function(){return this.__toString("Seq [","]")},Se.prototype.__iterate=function(e,t){return st(this,e,t,!1)},Se.prototype.__iterator=function(e,t){return jt(this,e,t,!1)},n(qe,xe),qe.of=function(){return qe(arguments)},qe.prototype.toSetSeq=function(){return this},xe.isSeq=_e,xe.Keyed=ke,xe.Set=qe,xe.Indexed=Se;var We,o,he,ae="@@__IMMUTABLE_SEQ__@@";function le(e){this._array=e,this.size=e.length}function R(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function Ve(e){this._iterable=e,this.size=e.length||e.size}function je(e){this._iterator=e,this._iteratorCache=[]}function _e(e){return!(!e||!e[ae])}function Je(){return We||(We=new le([]))}function Me(e){var t=Array.isArray(e)?new le(e).fromEntrySeq():ie(e)?new je(e).fromEntrySeq():ye(e)?new Ve(e).fromEntrySeq():typeof e=="object"?new R(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function at(e){var t=pt(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function it(e){var t=pt(e)||typeof e=="object"&&new R(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}function pt(e){return Oe(e)?new le(e):ie(e)?new je(e):ye(e)?new Ve(e):void 0}function st(e,t,r,s){var f=e._cache;if(f){for(var E=f.length-1,$=0;$<=E;$++){var Y=f[r?E-$:$];if(t(Y[1],s?Y[0]:$,e)===!1)return $+1}return $}return e.__iterateUncached(t,r)}function jt(e,t,r,s){var f=e._cache;if(f){var E=f.length-1,$=0;return new g(function(){var Y=f[r?E-$:$];return $++>E?Ie():k(t,s?Y[0]:$-1,Y[1])})}return e.__iteratorUncached(t,r)}function Vt(e,t){return t?Ut(t,e,"",{"":e}):Dt(e)}function Ut(e,t,r,s){return Array.isArray(t)?e.call(s,r,Se(t).map(function(f,E){return Ut(e,f,E,t)})):$t(t)?e.call(s,r,ke(t).map(function(f,E){return Ut(e,f,E,t)})):t}function Dt(e){return Array.isArray(e)?Se(e).map(Dt).toList():$t(e)?ke(e).map(Dt).toMap():e}function $t(e){return e&&(e.constructor===Object||e.constructor===void 0)}function Qe(e,t){if(e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1;if(typeof e.valueOf=="function"&&typeof t.valueOf=="function"){if((e=e.valueOf())===(t=t.valueOf())||e!=e&&t!=t)return!0;if(!e||!t)return!1}return!(typeof e.equals!="function"||typeof t.equals!="function"||!e.equals(t))}function Zt(e,t){if(e===t)return!0;if(!Q(t)||e.size!==void 0&&t.size!==void 0&&e.size!==t.size||e.__hash!==void 0&&t.__hash!==void 0&&e.__hash!==t.__hash||U(e)!==U(t)||L(e)!==L(t)||J(e)!==J(t))return!1;if(e.size===0&&t.size===0)return!0;var r=!Z(e);if(J(e)){var s=e.entries();return t.every(function(ge,fe){var me=s.next().value;return me&&Qe(me[1],ge)&&(r||Qe(me[0],fe))})&&s.next().done}var f=!1;if(e.size===void 0)if(t.size===void 0)typeof e.cacheResult=="function"&&e.cacheResult();else{f=!0;var E=e;e=t,t=E}var $=!0,Y=t.__iterate(function(ge,fe){if(r?!e.has(ge):f?!Qe(ge,e.get(fe,h)):!Qe(e.get(fe,h),ge))return $=!1,!1});return $&&e.size===Y}function ct(e,t){if(!(this instanceof ct))return new ct(e,t);if(this._value=e,this.size=t===void 0?1/0:Math.max(0,t),this.size===0){if(o)return o;o=this}}function A(e,t){if(!e)throw new Error(t)}function O(e,t,r){if(!(this instanceof O))return new O(e,t,r);if(A(r!==0,"Cannot step a Range by 0"),e=e||0,t===void 0&&(t=1/0),r=r===void 0?1:Math.abs(r),t<e&&(r=-r),this._start=e,this._end=t,this._step=r,this.size=Math.max(0,Math.ceil((t-e)/r-1)+1),this.size===0){if(he)return he;he=this}}function z(){throw TypeError("Abstract")}function x(){}function C(){}function T(){}xe.prototype[ae]=!0,n(le,Se),le.prototype.get=function(e,t){return this.has(e)?this._array[H(this,e)]:t},le.prototype.__iterate=function(e,t){for(var r=this._array,s=r.length-1,f=0;f<=s;f++)if(e(r[t?s-f:f],f,this)===!1)return f+1;return f},le.prototype.__iterator=function(e,t){var r=this._array,s=r.length-1,f=0;return new g(function(){return f>s?Ie():k(e,f,r[t?s-f++:f++])})},n(R,ke),R.prototype.get=function(e,t){return t===void 0||this.has(e)?this._object[e]:t},R.prototype.has=function(e){return this._object.hasOwnProperty(e)},R.prototype.__iterate=function(e,t){for(var r=this._object,s=this._keys,f=s.length-1,E=0;E<=f;E++){var $=s[t?f-E:E];if(e(r[$],$,this)===!1)return E+1}return E},R.prototype.__iterator=function(e,t){var r=this._object,s=this._keys,f=s.length-1,E=0;return new g(function(){var $=s[t?f-E:E];return E++>f?Ie():k(e,$,r[$])})},R.prototype[_]=!0,n(Ve,Se),Ve.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var r=we(this._iterable),s=0;if(ie(r))for(var f;!(f=r.next()).done&&e(f.value,s++,this)!==!1;);return s},Ve.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var r=we(this._iterable);if(!ie(r))return new g(Ie);var s=0;return new g(function(){var f=r.next();return f.done?f:k(e,s++,f.value)})},n(je,Se),je.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var r,s=this._iterator,f=this._iteratorCache,E=0;E<f.length;)if(e(f[E],E++,this)===!1)return E;for(;!(r=s.next()).done;){var $=r.value;if(f[E]=$,e($,E++,this)===!1)break}return E},je.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var r=this._iterator,s=this._iteratorCache,f=0;return new g(function(){if(f>=s.length){var E=r.next();if(E.done)return E;s[f]=E.value}return k(e,f,s[f++])})},n(ct,Se),ct.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},ct.prototype.get=function(e,t){return this.has(e)?this._value:t},ct.prototype.includes=function(e){return Qe(this._value,e)},ct.prototype.slice=function(e,t){var r=this.size;return ce(e,t,r)?this:new ct(this._value,te(t,r)-B(e,r))},ct.prototype.reverse=function(){return this},ct.prototype.indexOf=function(e){return Qe(this._value,e)?0:-1},ct.prototype.lastIndexOf=function(e){return Qe(this._value,e)?this.size:-1},ct.prototype.__iterate=function(e,t){for(var r=0;r<this.size;r++)if(e(this._value,r,this)===!1)return r+1;return r},ct.prototype.__iterator=function(e,t){var r=this,s=0;return new g(function(){return s<r.size?k(e,s++,r._value):Ie()})},ct.prototype.equals=function(e){return e instanceof ct?Qe(this._value,e._value):Zt(e)},n(O,Se),O.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},O.prototype.get=function(e,t){return this.has(e)?this._start+H(this,e)*this._step:t},O.prototype.includes=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},O.prototype.slice=function(e,t){return ce(e,t,this.size)?this:(e=B(e,this.size),(t=te(t,this.size))<=e?new O(0,0):new O(this.get(e,this._end),this.get(t,this._end),this._step))},O.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step==0){var r=t/this._step;if(r>=0&&r<this.size)return r}return-1},O.prototype.lastIndexOf=function(e){return this.indexOf(e)},O.prototype.__iterate=function(e,t){for(var r=this.size-1,s=this._step,f=t?this._start+r*s:this._start,E=0;E<=r;E++){if(e(f,E,this)===!1)return E+1;f+=t?-s:s}return E},O.prototype.__iterator=function(e,t){var r=this.size-1,s=this._step,f=t?this._start+r*s:this._start,E=0;return new g(function(){var $=f;return f+=t?-s:s,E>r?Ie():k(e,E++,$)})},O.prototype.equals=function(e){return e instanceof O?this._start===e._start&&this._end===e._end&&this._step===e._step:Zt(this,e)},n(z,p),n(x,z),n(C,z),n(T,z),z.Keyed=x,z.Indexed=C,z.Set=T;var K=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(e,t){var r=65535&(e|=0),s=65535&(t|=0);return r*s+((e>>>16)*s+r*(t>>>16)<<16>>>0)|0};function ne(e){return e>>>1&1073741824|3221225471&e}function oe(e){if(e===!1||e==null||typeof e.valueOf=="function"&&((e=e.valueOf())===!1||e==null))return 0;if(e===!0)return 1;var t=typeof e;if(t==="number"){if(e!=e||e===1/0)return 0;var r=0|e;for(r!==e&&(r^=4294967295*e);e>4294967295;)r^=e/=4294967295;return ne(r)}if(t==="string")return e.length>Ee?de(e):se(e);if(typeof e.hashCode=="function")return e.hashCode();if(t==="object")return be(e);if(typeof e.toString=="function")return se(e.toString());throw new Error("Value type "+t+" cannot be hashed.")}function de(e){var t=Ye[e];return t===void 0&&(t=se(e),et===Ke&&(et=0,Ye={}),et++,Ye[e]=t),t}function se(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return ne(t)}function be(e){var t;if(Te&&(t=Re.get(e))!==void 0||(t=e[$e])!==void 0||!ue&&((t=e.propertyIsEnumerable&&e.propertyIsEnumerable[$e])!==void 0||(t=ze(e))!==void 0))return t;if(t=++Pe,1073741824&Pe&&(Pe=0),Te)Re.set(e,t);else{if(ve!==void 0&&ve(e)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(ue)Object.defineProperty(e,$e,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable!==void 0&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[$e]=t;else{if(e.nodeType===void 0)throw new Error("Unable to set a non-enumerable property on object.");e[$e]=t}}return t}var ve=Object.isExtensible,ue=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function ze(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}var Re,Te=typeof WeakMap=="function";Te&&(Re=new WeakMap);var Pe=0,$e="__immutablehash__";typeof Symbol=="function"&&($e=Symbol($e));var Ee=16,Ke=255,et=0,Ye={};function He(e){A(e!==1/0,"Cannot perform this action with an infinite size.")}function Ue(e){return e==null?mt():Ne(e)&&!J(e)?e:mt().withMutations(function(t){var r=v(e);He(r.size),r.forEach(function(s,f){return t.set(f,s)})})}function Ne(e){return!(!e||!e[Ze])}n(Ue,x),Ue.of=function(){var e=a.call(arguments,0);return mt().withMutations(function(t){for(var r=0;r<e.length;r+=2){if(r+1>=e.length)throw new Error("Missing value for key: "+e[r]);t.set(e[r],e[r+1])}})},Ue.prototype.toString=function(){return this.__toString("Map {","}")},Ue.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},Ue.prototype.set=function(e,t){return Hr(this,e,t)},Ue.prototype.setIn=function(e,t){return this.updateIn(e,h,function(){return t})},Ue.prototype.remove=function(e){return Hr(this,e,h)},Ue.prototype.deleteIn=function(e){return this.updateIn(e,function(){return h})},Ue.prototype.update=function(e,t,r){return arguments.length===1?e(this):this.updateIn([e],t,r)},Ue.prototype.updateIn=function(e,t,r){r||(r=t,t=void 0);var s=Jr(this,_n(e),t,r);return s===h?void 0:s},Ue.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):mt()},Ue.prototype.merge=function(){return er(this,void 0,arguments)},Ue.prototype.mergeWith=function(e){return er(this,e,a.call(arguments,1))},Ue.prototype.mergeIn=function(e){var t=a.call(arguments,1);return this.updateIn(e,mt(),function(r){return typeof r.merge=="function"?r.merge.apply(r,t):t[t.length-1]})},Ue.prototype.mergeDeep=function(){return er(this,Kr,arguments)},Ue.prototype.mergeDeepWith=function(e){var t=a.call(arguments,1);return er(this,Zr(e),t)},Ue.prototype.mergeDeepIn=function(e){var t=a.call(arguments,1);return this.updateIn(e,mt(),function(r){return typeof r.mergeDeep=="function"?r.mergeDeep.apply(r,t):t[t.length-1]})},Ue.prototype.sort=function(e){return ut(Ft(this,e))},Ue.prototype.sortBy=function(e,t){return ut(Ft(this,t,e))},Ue.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},Ue.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new D)},Ue.prototype.asImmutable=function(){return this.__ensureOwner()},Ue.prototype.wasAltered=function(){return this.__altered},Ue.prototype.__iterator=function(e,t){return new dr(this,e,t)},Ue.prototype.__iterate=function(e,t){var r=this,s=0;return this._root&&this._root.iterate(function(f){return s++,e(f[1],f[0],r)},t),s},Ue.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?gr(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Ue.isMap=Ne;var rt,Ze="@@__IMMUTABLE_MAP__@@",De=Ue.prototype;function wt(e,t){this.ownerID=e,this.entries=t}function Mt(e,t,r){this.ownerID=e,this.bitmap=t,this.nodes=r}function Wt(e,t,r){this.ownerID=e,this.count=t,this.nodes=r}function Nt(e,t,r){this.ownerID=e,this.keyHash=t,this.entries=r}function Ot(e,t,r){this.ownerID=e,this.keyHash=t,this.entry=r}function dr(e,t,r){this._type=t,this._reverse=r,this._stack=e._root&&qr(e._root)}function pr(e,t){return k(e,t[0],t[1])}function qr(e,t){return{node:e,index:0,__prev:t}}function gr(e,t,r,s){var f=Object.create(De);return f.size=e,f._root=t,f.__ownerID=r,f.__hash=s,f.__altered=!1,f}function mt(){return rt||(rt=gr(0))}function Hr(e,t,r){var s,f;if(e._root){var E=b(i),$=b(c);if(s=yr(e._root,e.__ownerID,0,void 0,t,r,E,$),!$.value)return e;f=e.size+(E.value?r===h?-1:1:0)}else{if(r===h)return e;f=1,s=new wt(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=f,e._root=s,e.__hash=void 0,e.__altered=!0,e):s?gr(f,s):mt()}function yr(e,t,r,s,f,E,$,Y){return e?e.update(t,r,s,f,E,$,Y):E===h?e:(P(Y),P($),new Ot(t,s,[f,E]))}function Fr(e){return e.constructor===Ot||e.constructor===Nt}function _r(e,t,r,s,f){if(e.keyHash===s)return new Nt(t,s,[e.entry,f]);var E,$=(r===0?e.keyHash:e.keyHash>>>r)&I,Y=(r===0?s:s>>>r)&I;return new Mt(t,1<<$|1<<Y,$===Y?[_r(e,t,r+W,s,f)]:(E=new Ot(t,s,f),$<Y?[e,E]:[E,e]))}function Yn(e,t,r,s){e||(e=new D);for(var f=new Ot(e,oe(r),[r,s]),E=0;E<t.length;E++){var $=t[E];f=f.update(e,0,void 0,$[0],$[1])}return f}function Xn(e,t,r,s){for(var f=0,E=0,$=new Array(r),Y=0,ge=1,fe=t.length;Y<fe;Y++,ge<<=1){var me=t[Y];me!==void 0&&Y!==s&&(f|=ge,$[E++]=me)}return new Mt(e,f,$)}function Qn(e,t,r,s,f){for(var E=0,$=new Array(w),Y=0;r!==0;Y++,r>>>=1)$[Y]=1&r?t[E++]:void 0;return $[s]=f,new Wt(e,E+1,$)}function er(e,t,r){for(var s=[],f=0;f<r.length;f++){var E=r[f],$=v(E);Q(E)||($=$.map(function(Y){return Vt(Y)})),s.push($)}return Wr(e,t,s)}function Kr(e,t,r){return e&&e.mergeDeep&&Q(t)?e.mergeDeep(t):Qe(e,t)?e:t}function Zr(e){return function(t,r,s){if(t&&t.mergeDeepWith&&Q(r))return t.mergeDeepWith(e,r);var f=e(t,r,s);return Qe(t,f)?t:f}}function Wr(e,t,r){return(r=r.filter(function(s){return s.size!==0})).length===0?e:e.size!==0||e.__ownerID||r.length!==1?e.withMutations(function(s){for(var f=t?function($,Y){s.update(Y,h,function(ge){return ge===h?$:t(ge,$,Y)})}:function($,Y){s.set(Y,$)},E=0;E<r.length;E++)r[E].forEach(f)}):e.constructor(r[0])}function Jr(e,t,r,s){var f=e===h,E=t.next();if(E.done){var $=f?r:e,Y=s($);return Y===$?e:Y}A(f||e&&e.set,"invalid keyPath");var ge=E.value,fe=f?h:e.get(ge,h),me=Jr(fe,t,r,s);return me===fe?e:me===h?e.remove(ge):(f?mt():e).set(ge,me)}function Gr(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,e+=e>>8,127&(e+=e>>16)}function Yr(e,t,r,s){var f=s?e:V(e);return f[t]=r,f}function eo(e,t,r,s){var f=e.length+1;if(s&&t+1===f)return e[t]=r,e;for(var E=new Array(f),$=0,Y=0;Y<f;Y++)Y===t?(E[Y]=r,$=-1):E[Y]=e[Y+$];return E}function to(e,t,r){var s=e.length-1;if(r&&t===s)return e.pop(),e;for(var f=new Array(s),E=0,$=0;$<s;$++)$===t&&(E=1),f[$]=e[$+E];return f}De[Ze]=!0,De[j]=De.remove,De.removeIn=De.deleteIn,wt.prototype.get=function(e,t,r,s){for(var f=this.entries,E=0,$=f.length;E<$;E++)if(Qe(r,f[E][0]))return f[E][1];return s},wt.prototype.update=function(e,t,r,s,f,E,$){for(var Y=f===h,ge=this.entries,fe=0,me=ge.length;fe<me&&!Qe(s,ge[fe][0]);fe++);var Ce=fe<me;if(Ce?ge[fe][1]===f:Y)return this;if(P($),(Y||!Ce)&&P(E),!Y||ge.length!==1){if(!Ce&&!Y&&ge.length>=ro)return Yn(e,ge,s,f);var Le=e&&e===this.ownerID,Be=Le?ge:V(ge);return Ce?Y?fe===me-1?Be.pop():Be[fe]=Be.pop():Be[fe]=[s,f]:Be.push([s,f]),Le?(this.entries=Be,this):new wt(e,Be)}},Mt.prototype.get=function(e,t,r,s){t===void 0&&(t=oe(r));var f=1<<((e===0?t:t>>>e)&I),E=this.bitmap;return(E&f)==0?s:this.nodes[Gr(E&f-1)].get(e+W,t,r,s)},Mt.prototype.update=function(e,t,r,s,f,E,$){r===void 0&&(r=oe(s));var Y=(t===0?r:r>>>t)&I,ge=1<<Y,fe=this.bitmap,me=(fe&ge)!=0;if(!me&&f===h)return this;var Ce=Gr(fe&ge-1),Le=this.nodes,Be=me?Le[Ce]:void 0,Fe=yr(Be,e,t+W,r,s,f,E,$);if(Fe===Be)return this;if(!me&&Fe&&Le.length>=no)return Qn(e,Le,fe,Y,Fe);if(me&&!Fe&&Le.length===2&&Fr(Le[1^Ce]))return Le[1^Ce];if(me&&Fe&&Le.length===1&&Fr(Fe))return Fe;var nt=e&&e===this.ownerID,bt=me?Fe?fe:fe^ge:fe|ge,kt=me?Fe?Yr(Le,Ce,Fe,nt):to(Le,Ce,nt):eo(Le,Ce,Fe,nt);return nt?(this.bitmap=bt,this.nodes=kt,this):new Mt(e,bt,kt)},Wt.prototype.get=function(e,t,r,s){t===void 0&&(t=oe(r));var f=(e===0?t:t>>>e)&I,E=this.nodes[f];return E?E.get(e+W,t,r,s):s},Wt.prototype.update=function(e,t,r,s,f,E,$){r===void 0&&(r=oe(s));var Y=(t===0?r:r>>>t)&I,ge=f===h,fe=this.nodes,me=fe[Y];if(ge&&!me)return this;var Ce=yr(me,e,t+W,r,s,f,E,$);if(Ce===me)return this;var Le=this.count;if(me){if(!Ce&&--Le<oo)return Xn(e,fe,Le,Y)}else Le++;var Be=e&&e===this.ownerID,Fe=Yr(fe,Y,Ce,Be);return Be?(this.count=Le,this.nodes=Fe,this):new Wt(e,Le,Fe)},Nt.prototype.get=function(e,t,r,s){for(var f=this.entries,E=0,$=f.length;E<$;E++)if(Qe(r,f[E][0]))return f[E][1];return s},Nt.prototype.update=function(e,t,r,s,f,E,$){r===void 0&&(r=oe(s));var Y=f===h;if(r!==this.keyHash)return Y?this:(P($),P(E),_r(this,e,t,r,[s,f]));for(var ge=this.entries,fe=0,me=ge.length;fe<me&&!Qe(s,ge[fe][0]);fe++);var Ce=fe<me;if(Ce?ge[fe][1]===f:Y)return this;if(P($),(Y||!Ce)&&P(E),Y&&me===2)return new Ot(e,this.keyHash,ge[1^fe]);var Le=e&&e===this.ownerID,Be=Le?ge:V(ge);return Ce?Y?fe===me-1?Be.pop():Be[fe]=Be.pop():Be[fe]=[s,f]:Be.push([s,f]),Le?(this.entries=Be,this):new Nt(e,this.keyHash,Be)},Ot.prototype.get=function(e,t,r,s){return Qe(r,this.entry[0])?this.entry[1]:s},Ot.prototype.update=function(e,t,r,s,f,E,$){var Y=f===h,ge=Qe(s,this.entry[0]);return(ge?f===this.entry[1]:Y)?this:(P($),Y?void P(E):ge?e&&e===this.ownerID?(this.entry[1]=f,this):new Ot(e,this.keyHash,[s,f]):(P(E),_r(this,e,t,oe(s),[s,f])))},wt.prototype.iterate=Nt.prototype.iterate=function(e,t){for(var r=this.entries,s=0,f=r.length-1;s<=f;s++)if(e(r[t?f-s:s])===!1)return!1},Mt.prototype.iterate=Wt.prototype.iterate=function(e,t){for(var r=this.nodes,s=0,f=r.length-1;s<=f;s++){var E=r[t?f-s:s];if(E&&E.iterate(e,t)===!1)return!1}},Ot.prototype.iterate=function(e,t){return e(this.entry)},n(dr,g),dr.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var r,s=t.node,f=t.index++;if(s.entry){if(f===0)return pr(e,s.entry)}else if(s.entries){if(f<=(r=s.entries.length-1))return pr(e,s.entries[this._reverse?r-f:f])}else if(f<=(r=s.nodes.length-1)){var E=s.nodes[this._reverse?r-f:f];if(E){if(E.entry)return pr(e,E.entry);t=this._stack=qr(E,t)}continue}t=this._stack=this._stack.__prev}return Ie()};var ro=w/4,no=w/2,oo=w/4;function Xe(e){var t=mr();if(e==null)return t;if(Xr(e))return e;var r=y(e),s=r.size;return s===0?t:(He(s),s>0&&s<w?Gt(0,s,W,null,new Rt(r.toArray())):t.withMutations(function(f){f.setSize(s),r.forEach(function(E,$){return f.set($,E)})}))}function Xr(e){return!(!e||!e[Qr])}n(Xe,C),Xe.of=function(){return this(arguments)},Xe.prototype.toString=function(){return this.__toString("List [","]")},Xe.prototype.get=function(e,t){if((e=H(this,e))>=0&&e<this.size){var r=nn(this,e+=this._origin);return r&&r.array[e&I]}return t},Xe.prototype.set=function(e,t){return io(this,e,t)},Xe.prototype.remove=function(e){return this.has(e)?e===0?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},Xe.prototype.insert=function(e,t){return this.splice(e,0,t)},Xe.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=W,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):mr()},Xe.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(r){Ct(r,0,t+e.length);for(var s=0;s<e.length;s++)r.set(t+s,e[s])})},Xe.prototype.pop=function(){return Ct(this,0,-1)},Xe.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){Ct(t,-e.length);for(var r=0;r<e.length;r++)t.set(r,e[r])})},Xe.prototype.shift=function(){return Ct(this,1)},Xe.prototype.merge=function(){return tr(this,void 0,arguments)},Xe.prototype.mergeWith=function(e){return tr(this,e,a.call(arguments,1))},Xe.prototype.mergeDeep=function(){return tr(this,Kr,arguments)},Xe.prototype.mergeDeepWith=function(e){var t=a.call(arguments,1);return tr(this,Zr(e),t)},Xe.prototype.setSize=function(e){return Ct(this,0,e)},Xe.prototype.slice=function(e,t){var r=this.size;return ce(e,t,r)?this:Ct(this,B(e,r),te(t,r))},Xe.prototype.__iterator=function(e,t){var r=0,s=rn(this,t);return new g(function(){var f=s();return f===Jt?Ie():k(e,r++,f)})},Xe.prototype.__iterate=function(e,t){for(var r,s=0,f=rn(this,t);(r=f())!==Jt&&e(r,s++,this)!==!1;);return s},Xe.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Gt(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},Xe.isList=Xr;var Qr="@@__IMMUTABLE_LIST__@@",ft=Xe.prototype;function Rt(e,t){this.array=e,this.ownerID=t}ft[Qr]=!0,ft[j]=ft.remove,ft.setIn=De.setIn,ft.deleteIn=ft.removeIn=De.removeIn,ft.update=De.update,ft.updateIn=De.updateIn,ft.mergeIn=De.mergeIn,ft.mergeDeepIn=De.mergeDeepIn,ft.withMutations=De.withMutations,ft.asMutable=De.asMutable,ft.asImmutable=De.asImmutable,ft.wasAltered=De.wasAltered,Rt.prototype.removeBefore=function(e,t,r){if(r===t?1<<t:this.array.length===0)return this;var s=r>>>t&I;if(s>=this.array.length)return new Rt([],e);var f,E=s===0;if(t>0){var $=this.array[s];if((f=$&&$.removeBefore(e,t-W,r))===$&&E)return this}if(E&&!f)return this;var Y=Bt(this,e);if(!E)for(var ge=0;ge<s;ge++)Y.array[ge]=void 0;return f&&(Y.array[s]=f),Y},Rt.prototype.removeAfter=function(e,t,r){if(r===(t?1<<t:0)||this.array.length===0)return this;var s,f=r-1>>>t&I;if(f>=this.array.length)return this;if(t>0){var E=this.array[f];if((s=E&&E.removeAfter(e,t-W,r))===E&&f===this.array.length-1)return this}var $=Bt(this,e);return $.array.splice(f+1),s&&($.array[f]=s),$};var en,tn,Jt={};function rn(e,t){var r=e._origin,s=e._capacity,f=Yt(s),E=e._tail;return $(e._root,e._level,0);function $(fe,me,Ce){return me===0?Y(fe,Ce):ge(fe,me,Ce)}function Y(fe,me){var Ce=me===f?E&&E.array:fe&&fe.array,Le=me>r?0:r-me,Be=s-me;return Be>w&&(Be=w),function(){if(Le===Be)return Jt;var Fe=t?--Be:Le++;return Ce&&Ce[Fe]}}function ge(fe,me,Ce){var Le,Be=fe&&fe.array,Fe=Ce>r?0:r-Ce>>me,nt=1+(s-Ce>>me);return nt>w&&(nt=w),function(){for(;;){if(Le){var bt=Le();if(bt!==Jt)return bt;Le=null}if(Fe===nt)return Jt;var kt=t?--nt:Fe++;Le=$(Be&&Be[kt],me-W,Ce+(kt<<me))}}}}function Gt(e,t,r,s,f,E,$){var Y=Object.create(ft);return Y.size=t-e,Y._origin=e,Y._capacity=t,Y._level=r,Y._root=s,Y._tail=f,Y.__ownerID=E,Y.__hash=$,Y.__altered=!1,Y}function mr(){return en||(en=Gt(0,0,W))}function io(e,t,r){if((t=H(e,t))!=t)return e;if(t>=e.size||t<0)return e.withMutations(function($){t<0?Ct($,t).set(0,r):Ct($,0,t+1).set(t,r)});t+=e._origin;var s=e._tail,f=e._root,E=b(c);return t>=Yt(e._capacity)?s=br(s,e.__ownerID,0,t,r,E):f=br(f,e.__ownerID,e._level,t,r,E),E.value?e.__ownerID?(e._root=f,e._tail=s,e.__hash=void 0,e.__altered=!0,e):Gt(e._origin,e._capacity,e._level,f,s):e}function br(e,t,r,s,f,E){var $,Y=s>>>r&I,ge=e&&Y<e.array.length;if(!ge&&f===void 0)return e;if(r>0){var fe=e&&e.array[Y],me=br(fe,t,r-W,s,f,E);return me===fe?e:(($=Bt(e,t)).array[Y]=me,$)}return ge&&e.array[Y]===f?e:(P(E),$=Bt(e,t),f===void 0&&Y===$.array.length-1?$.array.pop():$.array[Y]=f,$)}function Bt(e,t){return t&&e&&t===e.ownerID?e:new Rt(e?e.array.slice():[],t)}function nn(e,t){if(t>=Yt(e._capacity))return e._tail;if(t<1<<e._level+W){for(var r=e._root,s=e._level;r&&s>0;)r=r.array[t>>>s&I],s-=W;return r}}function Ct(e,t,r){t!==void 0&&(t|=0),r!==void 0&&(r|=0);var s=e.__ownerID||new D,f=e._origin,E=e._capacity,$=f+t,Y=r===void 0?E:r<0?E+r:f+r;if($===f&&Y===E)return e;if($>=Y)return e.clear();for(var ge=e._level,fe=e._root,me=0;$+me<0;)fe=new Rt(fe&&fe.array.length?[void 0,fe]:[],s),me+=1<<(ge+=W);me&&($+=me,f+=me,Y+=me,E+=me);for(var Ce=Yt(E),Le=Yt(Y);Le>=1<<ge+W;)fe=new Rt(fe&&fe.array.length?[fe]:[],s),ge+=W;var Be=e._tail,Fe=Le<Ce?nn(e,Y-1):Le>Ce?new Rt([],s):Be;if(Be&&Le>Ce&&$<E&&Be.array.length){for(var nt=fe=Bt(fe,s),bt=ge;bt>W;bt-=W){var kt=Ce>>>bt&I;nt=nt.array[kt]=Bt(nt.array[kt],s)}nt.array[Ce>>>W&I]=Be}if(Y<E&&(Fe=Fe&&Fe.removeAfter(s,0,Y)),$>=Le)$-=Le,Y-=Le,ge=W,fe=null,Fe=Fe&&Fe.removeBefore(s,0,$);else if($>f||Le<Ce){for(me=0;fe;){var ur=$>>>ge&I;if(ur!==Le>>>ge&I)break;ur&&(me+=(1<<ge)*ur),ge-=W,fe=fe.array[ur]}fe&&$>f&&(fe=fe.removeBefore(s,ge,$-me)),fe&&Le<Ce&&(fe=fe.removeAfter(s,ge,Le-me)),me&&($-=me,Y-=me)}return e.__ownerID?(e.size=Y-$,e._origin=$,e._capacity=Y,e._level=ge,e._root=fe,e._tail=Fe,e.__hash=void 0,e.__altered=!0,e):Gt($,Y,ge,fe,Fe)}function tr(e,t,r){for(var s=[],f=0,E=0;E<r.length;E++){var $=r[E],Y=y($);Y.size>f&&(f=Y.size),Q($)||(Y=Y.map(function(ge){return Vt(ge)})),s.push(Y)}return f>e.size&&(e=e.setSize(f)),Wr(e,t,s)}function Yt(e){return e<w?0:e-1>>>W<<W}function ut(e){return e==null?rr():on(e)?e:rr().withMutations(function(t){var r=v(e);He(r.size),r.forEach(function(s,f){return t.set(f,s)})})}function on(e){return Ne(e)&&J(e)}function wr(e,t,r,s){var f=Object.create(ut.prototype);return f.size=e?e.size:0,f._map=e,f._list=t,f.__ownerID=r,f.__hash=s,f}function rr(){return tn||(tn=wr(mt(),mr()))}function sn(e,t,r){var s,f,E=e._map,$=e._list,Y=E.get(t),ge=Y!==void 0;if(r===h){if(!ge)return e;$.size>=w&&$.size>=2*E.size?(s=(f=$.filter(function(fe,me){return fe!==void 0&&Y!==me})).toKeyedSeq().map(function(fe){return fe[0]}).flip().toMap(),e.__ownerID&&(s.__ownerID=f.__ownerID=e.__ownerID)):(s=E.remove(t),f=Y===$.size-1?$.pop():$.set(Y,void 0))}else if(ge){if(r===$.get(Y)[1])return e;s=E,f=$.set(Y,[t,r])}else s=E.set(t,$.size),f=$.set($.size,[t,r]);return e.__ownerID?(e.size=s.size,e._map=s,e._list=f,e.__hash=void 0,e):wr(s,f)}function _t(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function Pt(e){this._iter=e,this.size=e.size}function qt(e){this._iter=e,this.size=e.size}function Ht(e){this._iter=e,this.size=e.size}function an(e){var t=vt(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var r=e.reverse.apply(this);return r.flip=function(){return e.reverse()},r},t.has=function(r){return e.includes(r)},t.includes=function(r){return e.has(r)},t.cacheResult=kr,t.__iterateUncached=function(r,s){var f=this;return e.__iterate(function(E,$){return r($,E,f)!==!1},s)},t.__iteratorUncached=function(r,s){if(r===M){var f=e.__iterator(r,s);return new g(function(){var E=f.next();if(!E.done){var $=E.value[0];E.value[0]=E.value[1],E.value[1]=$}return E})}return e.__iterator(r===G?pe:G,s)},t}function un(e,t,r){var s=vt(e);return s.size=e.size,s.has=function(f){return e.has(f)},s.get=function(f,E){var $=e.get(f,h);return $===h?E:t.call(r,$,f,e)},s.__iterateUncached=function(f,E){var $=this;return e.__iterate(function(Y,ge,fe){return f(t.call(r,Y,ge,fe),ge,$)!==!1},E)},s.__iteratorUncached=function(f,E){var $=e.__iterator(M,E);return new g(function(){var Y=$.next();if(Y.done)return Y;var ge=Y.value,fe=ge[0];return k(f,fe,t.call(r,ge[1],fe,e),Y)})},s}function vr(e,t){var r=vt(e);return r._iter=e,r.size=e.size,r.reverse=function(){return e},e.flip&&(r.flip=function(){var s=an(e);return s.reverse=function(){return e.flip()},s}),r.get=function(s,f){return e.get(t?s:-1-s,f)},r.has=function(s){return e.has(t?s:-1-s)},r.includes=function(s){return e.includes(s)},r.cacheResult=kr,r.__iterate=function(s,f){var E=this;return e.__iterate(function($,Y){return s($,Y,E)},!f)},r.__iterator=function(s,f){return e.__iterator(s,!f)},r}function cn(e,t,r,s){var f=vt(e);return s&&(f.has=function(E){var $=e.get(E,h);return $!==h&&!!t.call(r,$,E,e)},f.get=function(E,$){var Y=e.get(E,h);return Y!==h&&t.call(r,Y,E,e)?Y:$}),f.__iterateUncached=function(E,$){var Y=this,ge=0;return e.__iterate(function(fe,me,Ce){if(t.call(r,fe,me,Ce))return ge++,E(fe,s?me:ge-1,Y)},$),ge},f.__iteratorUncached=function(E,$){var Y=e.__iterator(M,$),ge=0;return new g(function(){for(;;){var fe=Y.next();if(fe.done)return fe;var me=fe.value,Ce=me[0],Le=me[1];if(t.call(r,Le,Ce,e))return k(E,s?Ce:ge++,Le,fe)}})},f}function so(e,t,r){var s=Ue().asMutable();return e.__iterate(function(f,E){s.update(t.call(r,f,E,e),0,function($){return $+1})}),s.asImmutable()}function ao(e,t,r){var s=U(e),f=(J(e)?ut():Ue()).asMutable();e.__iterate(function($,Y){f.update(t.call(r,$,Y,e),function(ge){return(ge=ge||[]).push(s?[Y,$]:$),ge})});var E=gn(e);return f.map(function($){return Ge(e,E($))})}function Ir(e,t,r,s){var f=e.size;if(t!==void 0&&(t|=0),r!==void 0&&(r===1/0?r=f:r|=0),ce(t,r,f))return e;var E=B(t,f),$=te(r,f);if(E!=E||$!=$)return Ir(e.toSeq().cacheResult(),t,r,s);var Y,ge=$-E;ge==ge&&(Y=ge<0?0:ge);var fe=vt(e);return fe.size=Y===0?Y:e.size&&Y||void 0,!s&&_e(e)&&Y>=0&&(fe.get=function(me,Ce){return(me=H(this,me))>=0&&me<Y?e.get(me+E,Ce):Ce}),fe.__iterateUncached=function(me,Ce){var Le=this;if(Y===0)return 0;if(Ce)return this.cacheResult().__iterate(me,Ce);var Be=0,Fe=!0,nt=0;return e.__iterate(function(bt,kt){if(!Fe||!(Fe=Be++<E))return nt++,me(bt,s?kt:nt-1,Le)!==!1&&nt!==Y}),nt},fe.__iteratorUncached=function(me,Ce){if(Y!==0&&Ce)return this.cacheResult().__iterator(me,Ce);var Le=Y!==0&&e.__iterator(me,Ce),Be=0,Fe=0;return new g(function(){for(;Be++<E;)Le.next();if(++Fe>Y)return Ie();var nt=Le.next();return s||me===G?nt:k(me,Fe-1,me===pe?void 0:nt.value[1],nt)})},fe}function uo(e,t,r){var s=vt(e);return s.__iterateUncached=function(f,E){var $=this;if(E)return this.cacheResult().__iterate(f,E);var Y=0;return e.__iterate(function(ge,fe,me){return t.call(r,ge,fe,me)&&++Y&&f(ge,fe,$)}),Y},s.__iteratorUncached=function(f,E){var $=this;if(E)return this.cacheResult().__iterator(f,E);var Y=e.__iterator(M,E),ge=!0;return new g(function(){if(!ge)return Ie();var fe=Y.next();if(fe.done)return fe;var me=fe.value,Ce=me[0],Le=me[1];return t.call(r,Le,Ce,$)?f===M?fe:k(f,Ce,Le,fe):(ge=!1,Ie())})},s}function hn(e,t,r,s){var f=vt(e);return f.__iterateUncached=function(E,$){var Y=this;if($)return this.cacheResult().__iterate(E,$);var ge=!0,fe=0;return e.__iterate(function(me,Ce,Le){if(!ge||!(ge=t.call(r,me,Ce,Le)))return fe++,E(me,s?Ce:fe-1,Y)}),fe},f.__iteratorUncached=function(E,$){var Y=this;if($)return this.cacheResult().__iterator(E,$);var ge=e.__iterator(M,$),fe=!0,me=0;return new g(function(){var Ce,Le,Be;do{if((Ce=ge.next()).done)return s||E===G?Ce:k(E,me++,E===pe?void 0:Ce.value[1],Ce);var Fe=Ce.value;Le=Fe[0],Be=Fe[1],fe&&(fe=t.call(r,Be,Le,Y))}while(fe);return E===M?Ce:k(E,Le,Be,Ce)})},f}function co(e,t){var r=U(e),s=[e].concat(t).map(function($){return Q($)?r&&($=v($)):$=r?Me($):at(Array.isArray($)?$:[$]),$}).filter(function($){return $.size!==0});if(s.length===0)return e;if(s.length===1){var f=s[0];if(f===e||r&&U(f)||L(e)&&L(f))return f}var E=new le(s);return r?E=E.toKeyedSeq():L(e)||(E=E.toSetSeq()),(E=E.flatten(!0)).size=s.reduce(function($,Y){if($!==void 0){var ge=Y.size;if(ge!==void 0)return $+ge}},0),E}function ln(e,t,r){var s=vt(e);return s.__iterateUncached=function(f,E){var $=0,Y=!1;function ge(fe,me){var Ce=this;fe.__iterate(function(Le,Be){return(!t||me<t)&&Q(Le)?ge(Le,me+1):f(Le,r?Be:$++,Ce)===!1&&(Y=!0),!Y},E)}return ge(e,0),$},s.__iteratorUncached=function(f,E){var $=e.__iterator(f,E),Y=[],ge=0;return new g(function(){for(;$;){var fe=$.next();if(fe.done===!1){var me=fe.value;if(f===M&&(me=me[1]),t&&!(Y.length<t)||!Q(me))return r?fe:k(f,ge++,me,fe);Y.push($),$=me.__iterator(f,E)}else $=Y.pop()}return Ie()})},s}function ho(e,t,r){var s=gn(e);return e.toSeq().map(function(f,E){return s(t.call(r,f,E,e))}).flatten(!0)}function lo(e,t){var r=vt(e);return r.size=e.size&&2*e.size-1,r.__iterateUncached=function(s,f){var E=this,$=0;return e.__iterate(function(Y,ge){return(!$||s(t,$++,E)!==!1)&&s(Y,$++,E)!==!1},f),$},r.__iteratorUncached=function(s,f){var E,$=e.__iterator(G,f),Y=0;return new g(function(){return(!E||Y%2)&&(E=$.next()).done?E:Y%2?k(s,Y++,t):k(s,Y++,E.value,E)})},r}function Ft(e,t,r){t||(t=yn);var s=U(e),f=0,E=e.toSeq().map(function($,Y){return[Y,$,f++,r?r($,Y,e):$]}).toArray();return E.sort(function($,Y){return t($[3],Y[3])||$[2]-Y[2]}).forEach(s?function($,Y){E[Y].length=2}:function($,Y){E[Y]=$[1]}),s?ke(E):L(e)?Se(E):qe(E)}function nr(e,t,r){if(t||(t=yn),r){var s=e.toSeq().map(function(f,E){return[f,r(f,E,e)]}).reduce(function(f,E){return fn(t,f[1],E[1])?E:f});return s&&s[0]}return e.reduce(function(f,E){return fn(t,f,E)?E:f})}function fn(e,t,r){var s=e(r,t);return s===0&&r!==t&&(r==null||r!=r)||s>0}function xr(e,t,r){var s=vt(e);return s.size=new le(r).map(function(f){return f.size}).min(),s.__iterate=function(f,E){for(var $,Y=this.__iterator(G,E),ge=0;!($=Y.next()).done&&f($.value,ge++,this)!==!1;);return ge},s.__iteratorUncached=function(f,E){var $=r.map(function(fe){return fe=p(fe),we(E?fe.reverse():fe)}),Y=0,ge=!1;return new g(function(){var fe;return ge||(fe=$.map(function(me){return me.next()}),ge=fe.some(function(me){return me.done})),ge?Ie():k(f,Y++,t.apply(null,fe.map(function(me){return me.value})))})},s}function Ge(e,t){return _e(e)?t:e.constructor(t)}function dn(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function pn(e){return He(e.size),re(e)}function gn(e){return U(e)?v:L(e)?y:F}function vt(e){return Object.create((U(e)?ke:L(e)?Se:qe).prototype)}function kr(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):xe.prototype.cacheResult.call(this)}function yn(e,t){return e>t?1:e<t?-1:0}function _n(e){var t=we(e);if(!t){if(!Oe(e))throw new TypeError("Expected iterable or array-like: "+e);t=we(p(e))}return t}function gt(e,t){var r,s=function(E){if(E instanceof s)return E;if(!(this instanceof s))return new s(E);if(!r){r=!0;var $=Object.keys(e);fo(f,$),f.size=$.length,f._name=t,f._keys=$,f._defaultValues=e}this._map=Ue(E)},f=s.prototype=Object.create(lt);return f.constructor=s,s}n(ut,Ue),ut.of=function(){return this(arguments)},ut.prototype.toString=function(){return this.__toString("OrderedMap {","}")},ut.prototype.get=function(e,t){var r=this._map.get(e);return r!==void 0?this._list.get(r)[1]:t},ut.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):rr()},ut.prototype.set=function(e,t){return sn(this,e,t)},ut.prototype.remove=function(e){return sn(this,e,h)},ut.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},ut.prototype.__iterate=function(e,t){var r=this;return this._list.__iterate(function(s){return s&&e(s[1],s[0],r)},t)},ut.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},ut.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),r=this._list.__ensureOwner(e);return e?wr(t,r,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=r,this)},ut.isOrderedMap=on,ut.prototype[_]=!0,ut.prototype[j]=ut.prototype.remove,n(_t,ke),_t.prototype.get=function(e,t){return this._iter.get(e,t)},_t.prototype.has=function(e){return this._iter.has(e)},_t.prototype.valueSeq=function(){return this._iter.valueSeq()},_t.prototype.reverse=function(){var e=this,t=vr(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},_t.prototype.map=function(e,t){var r=this,s=un(this,e,t);return this._useKeys||(s.valueSeq=function(){return r._iter.toSeq().map(e,t)}),s},_t.prototype.__iterate=function(e,t){var r,s=this;return this._iter.__iterate(this._useKeys?function(f,E){return e(f,E,s)}:(r=t?pn(this):0,function(f){return e(f,t?--r:r++,s)}),t)},_t.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var r=this._iter.__iterator(G,t),s=t?pn(this):0;return new g(function(){var f=r.next();return f.done?f:k(e,t?--s:s++,f.value,f)})},_t.prototype[_]=!0,n(Pt,Se),Pt.prototype.includes=function(e){return this._iter.includes(e)},Pt.prototype.__iterate=function(e,t){var r=this,s=0;return this._iter.__iterate(function(f){return e(f,s++,r)},t)},Pt.prototype.__iterator=function(e,t){var r=this._iter.__iterator(G,t),s=0;return new g(function(){var f=r.next();return f.done?f:k(e,s++,f.value,f)})},n(qt,qe),qt.prototype.has=function(e){return this._iter.includes(e)},qt.prototype.__iterate=function(e,t){var r=this;return this._iter.__iterate(function(s){return e(s,s,r)},t)},qt.prototype.__iterator=function(e,t){var r=this._iter.__iterator(G,t);return new g(function(){var s=r.next();return s.done?s:k(e,s.value,s.value,s)})},n(Ht,ke),Ht.prototype.entrySeq=function(){return this._iter.toSeq()},Ht.prototype.__iterate=function(e,t){var r=this;return this._iter.__iterate(function(s){if(s){dn(s);var f=Q(s);return e(f?s.get(1):s[1],f?s.get(0):s[0],r)}},t)},Ht.prototype.__iterator=function(e,t){var r=this._iter.__iterator(G,t);return new g(function(){for(;;){var s=r.next();if(s.done)return s;var f=s.value;if(f){dn(f);var E=Q(f);return k(e,E?f.get(0):f[0],E?f.get(1):f[1],s)}}})},Pt.prototype.cacheResult=_t.prototype.cacheResult=qt.prototype.cacheResult=Ht.prototype.cacheResult=kr,n(gt,x),gt.prototype.toString=function(){return this.__toString(mn(this)+" {","}")},gt.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},gt.prototype.get=function(e,t){if(!this.has(e))return t;var r=this._defaultValues[e];return this._map?this._map.get(e,r):r},gt.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=this.constructor;return e._empty||(e._empty=or(this,mt()))},gt.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+mn(this));if(this._map&&!this._map.has(e)&&t===this._defaultValues[e])return this;var r=this._map&&this._map.set(e,t);return this.__ownerID||r===this._map?this:or(this,r)},gt.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:or(this,t)},gt.prototype.wasAltered=function(){return this._map.wasAltered()},gt.prototype.__iterator=function(e,t){var r=this;return v(this._defaultValues).map(function(s,f){return r.get(f)}).__iterator(e,t)},gt.prototype.__iterate=function(e,t){var r=this;return v(this._defaultValues).map(function(s,f){return r.get(f)}).__iterate(e,t)},gt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?or(this,t,e):(this.__ownerID=e,this._map=t,this)};var lt=gt.prototype;function or(e,t,r){var s=Object.create(Object.getPrototypeOf(e));return s._map=t,s.__ownerID=r,s}function mn(e){return e._name||e.constructor.name||"Record"}function fo(e,t){try{t.forEach(po.bind(void 0,e))}catch{}}function po(e,t){Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(r){A(this.__ownerID,"Cannot set on an immutable record."),this.set(t,r)}})}function tt(e){return e==null?Sr():Er(e)&&!J(e)?e:Sr().withMutations(function(t){var r=F(e);He(r.size),r.forEach(function(s){return t.add(s)})})}function Er(e){return!(!e||!e[wn])}lt[j]=lt.remove,lt.deleteIn=lt.removeIn=De.removeIn,lt.merge=De.merge,lt.mergeWith=De.mergeWith,lt.mergeIn=De.mergeIn,lt.mergeDeep=De.mergeDeep,lt.mergeDeepWith=De.mergeDeepWith,lt.mergeDeepIn=De.mergeDeepIn,lt.setIn=De.setIn,lt.update=De.update,lt.updateIn=De.updateIn,lt.withMutations=De.withMutations,lt.asMutable=De.asMutable,lt.asImmutable=De.asImmutable,n(tt,T),tt.of=function(){return this(arguments)},tt.fromKeys=function(e){return this(v(e).keySeq())},tt.prototype.toString=function(){return this.__toString("Set {","}")},tt.prototype.has=function(e){return this._map.has(e)},tt.prototype.add=function(e){return Or(this,this._map.set(e,!0))},tt.prototype.remove=function(e){return Or(this,this._map.remove(e))},tt.prototype.clear=function(){return Or(this,this._map.clear())},tt.prototype.union=function(){var e=a.call(arguments,0);return(e=e.filter(function(t){return t.size!==0})).length===0?this:this.size!==0||this.__ownerID||e.length!==1?this.withMutations(function(t){for(var r=0;r<e.length;r++)F(e[r]).forEach(function(s){return t.add(s)})}):this.constructor(e[0])},tt.prototype.intersect=function(){var e=a.call(arguments,0);if(e.length===0)return this;e=e.map(function(r){return F(r)});var t=this;return this.withMutations(function(r){t.forEach(function(s){e.every(function(f){return f.includes(s)})||r.remove(s)})})},tt.prototype.subtract=function(){var e=a.call(arguments,0);if(e.length===0)return this;e=e.map(function(r){return F(r)});var t=this;return this.withMutations(function(r){t.forEach(function(s){e.some(function(f){return f.includes(s)})&&r.remove(s)})})},tt.prototype.merge=function(){return this.union.apply(this,arguments)},tt.prototype.mergeWith=function(e){var t=a.call(arguments,1);return this.union.apply(this,t)},tt.prototype.sort=function(e){return It(Ft(this,e))},tt.prototype.sortBy=function(e,t){return It(Ft(this,t,e))},tt.prototype.wasAltered=function(){return this._map.wasAltered()},tt.prototype.__iterate=function(e,t){var r=this;return this._map.__iterate(function(s,f){return e(f,f,r)},t)},tt.prototype.__iterator=function(e,t){return this._map.map(function(r,s){return s}).__iterator(e,t)},tt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},tt.isSet=Er;var bn,wn="@@__IMMUTABLE_SET__@@",yt=tt.prototype;function Or(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:t.size===0?e.__empty():e.__make(t)}function vn(e,t){var r=Object.create(yt);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function Sr(){return bn||(bn=vn(mt()))}function It(e){return e==null?Ar():In(e)?e:Ar().withMutations(function(t){var r=F(e);He(r.size),r.forEach(function(s){return t.add(s)})})}function In(e){return Er(e)&&J(e)}yt[wn]=!0,yt[j]=yt.remove,yt.mergeDeep=yt.merge,yt.mergeDeepWith=yt.mergeWith,yt.withMutations=De.withMutations,yt.asMutable=De.asMutable,yt.asImmutable=De.asImmutable,yt.__empty=Sr,yt.__make=vn,n(It,tt),It.of=function(){return this(arguments)},It.fromKeys=function(e){return this(v(e).keySeq())},It.prototype.toString=function(){return this.__toString("OrderedSet {","}")},It.isOrderedSet=In;var xn,ir=It.prototype;function kn(e,t){var r=Object.create(ir);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function Ar(){return xn||(xn=kn(rr()))}function ht(e){return e==null?jr():En(e)?e:jr().unshiftAll(e)}function En(e){return!(!e||!e[Sn])}ir[_]=!0,ir.__empty=Ar,ir.__make=kn,n(ht,C),ht.of=function(){return this(arguments)},ht.prototype.toString=function(){return this.__toString("Stack [","]")},ht.prototype.get=function(e,t){var r=this._head;for(e=H(this,e);r&&e--;)r=r.next;return r?r.value:t},ht.prototype.peek=function(){return this._head&&this._head.value},ht.prototype.push=function(){if(arguments.length===0)return this;for(var e=this.size+arguments.length,t=this._head,r=arguments.length-1;r>=0;r--)t={value:arguments[r],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):Xt(e,t)},ht.prototype.pushAll=function(e){if((e=y(e)).size===0)return this;He(e.size);var t=this.size,r=this._head;return e.reverse().forEach(function(s){t++,r={value:s,next:r}}),this.__ownerID?(this.size=t,this._head=r,this.__hash=void 0,this.__altered=!0,this):Xt(t,r)},ht.prototype.pop=function(){return this.slice(1)},ht.prototype.unshift=function(){return this.push.apply(this,arguments)},ht.prototype.unshiftAll=function(e){return this.pushAll(e)},ht.prototype.shift=function(){return this.pop.apply(this,arguments)},ht.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):jr()},ht.prototype.slice=function(e,t){if(ce(e,t,this.size))return this;var r=B(e,this.size);if(te(t,this.size)!==this.size)return C.prototype.slice.call(this,e,t);for(var s=this.size-r,f=this._head;r--;)f=f.next;return this.__ownerID?(this.size=s,this._head=f,this.__hash=void 0,this.__altered=!0,this):Xt(s,f)},ht.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Xt(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},ht.prototype.__iterate=function(e,t){if(t)return this.reverse().__iterate(e);for(var r=0,s=this._head;s&&e(s.value,r++,this)!==!1;)s=s.next;return r},ht.prototype.__iterator=function(e,t){if(t)return this.reverse().__iterator(e);var r=0,s=this._head;return new g(function(){if(s){var f=s.value;return s=s.next,k(e,r++,f)}return Ie()})},ht.isStack=En;var On,Sn="@@__IMMUTABLE_STACK__@@",Kt=ht.prototype;function Xt(e,t,r,s){var f=Object.create(Kt);return f.size=e,f._head=t,f.__ownerID=r,f.__hash=s,f.__altered=!1,f}function jr(){return On||(On=Xt(0))}function xt(e,t){var r=function(s){e.prototype[s]=t[s]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}Kt[Sn]=!0,Kt.withMutations=De.withMutations,Kt.asMutable=De.asMutable,Kt.asImmutable=De.asImmutable,Kt.wasAltered=De.wasAltered,p.Iterator=g,xt(p,{toArray:function(){He(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,r){e[r]=t}),e},toIndexedSeq:function(){return new Pt(this)},toJS:function(){return this.toSeq().map(function(e){return e&&typeof e.toJS=="function"?e.toJS():e}).__toJS()},toJSON:function(){return this.toSeq().map(function(e){return e&&typeof e.toJSON=="function"?e.toJSON():e}).__toJS()},toKeyedSeq:function(){return new _t(this,!0)},toMap:function(){return Ue(this.toKeyedSeq())},toObject:function(){He(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e},toOrderedMap:function(){return ut(this.toKeyedSeq())},toOrderedSet:function(){return It(U(this)?this.valueSeq():this)},toSet:function(){return tt(U(this)?this.valueSeq():this)},toSetSeq:function(){return new qt(this)},toSeq:function(){return L(this)?this.toIndexedSeq():U(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return ht(U(this)?this.valueSeq():this)},toList:function(){return Xe(U(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return this.size===0?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){return Ge(this,co(this,a.call(arguments,0)))},includes:function(e){return this.some(function(t){return Qe(t,e)})},entries:function(){return this.__iterator(M)},every:function(e,t){He(this.size);var r=!0;return this.__iterate(function(s,f,E){if(!e.call(t,s,f,E))return r=!1,!1}),r},filter:function(e,t){return Ge(this,cn(this,e,t,!0))},find:function(e,t,r){var s=this.findEntry(e,t);return s?s[1]:r},forEach:function(e,t){return He(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){He(this.size),e=e!==void 0?""+e:",";var t="",r=!0;return this.__iterate(function(s){r?r=!1:t+=e,t+=s!=null?s.toString():""}),t},keys:function(){return this.__iterator(pe)},map:function(e,t){return Ge(this,un(this,e,t))},reduce:function(e,t,r){var s,f;return He(this.size),arguments.length<2?f=!0:s=t,this.__iterate(function(E,$,Y){f?(f=!1,s=E):s=e.call(r,s,E,$,Y)}),s},reduceRight:function(e,t,r){var s=this.toKeyedSeq().reverse();return s.reduce.apply(s,arguments)},reverse:function(){return Ge(this,vr(this,!0))},slice:function(e,t){return Ge(this,Ir(this,e,t,!0))},some:function(e,t){return!this.every(ar(e),t)},sort:function(e){return Ge(this,Ft(this,e))},values:function(){return this.__iterator(G)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(e,t){return re(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return so(this,e,t)},equals:function(e){return Zt(this,e)},entrySeq:function(){var e=this;if(e._cache)return new le(e._cache);var t=e.toSeq().map(yo).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(ar(e),t)},findEntry:function(e,t,r){var s=r;return this.__iterate(function(f,E,$){if(e.call(t,f,E,$))return s=[E,f],!1}),s},findKey:function(e,t){var r=this.findEntry(e,t);return r&&r[0]},findLast:function(e,t,r){return this.toKeyedSeq().reverse().find(e,t,r)},findLastEntry:function(e,t,r){return this.toKeyedSeq().reverse().findEntry(e,t,r)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(){return this.find(ee)},flatMap:function(e,t){return Ge(this,ho(this,e,t))},flatten:function(e){return Ge(this,ln(this,e,!0))},fromEntrySeq:function(){return new Ht(this)},get:function(e,t){return this.find(function(r,s){return Qe(s,e)},void 0,t)},getIn:function(e,t){for(var r,s=this,f=_n(e);!(r=f.next()).done;){var E=r.value;if((s=s&&s.get?s.get(E,h):h)===h)return t}return s},groupBy:function(e,t){return ao(this,e,t)},has:function(e){return this.get(e,h)!==h},hasIn:function(e){return this.getIn(e,h)!==h},isSubset:function(e){return e=typeof e.includes=="function"?e:p(e),this.every(function(t){return e.includes(t)})},isSuperset:function(e){return(e=typeof e.isSubset=="function"?e:p(e)).isSubset(this)},keyOf:function(e){return this.findKey(function(t){return Qe(t,e)})},keySeq:function(){return this.toSeq().map(go).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return nr(this,e)},maxBy:function(e,t){return nr(this,t,e)},min:function(e){return nr(this,e?An(e):Rn)},minBy:function(e,t){return nr(this,t?An(t):Rn,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return Ge(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return Ge(this,hn(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(ar(e),t)},sortBy:function(e,t){return Ge(this,Ft(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return Ge(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return Ge(this,uo(this,e,t))},takeUntil:function(e,t){return this.takeWhile(ar(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=mo(this))}});var dt=p.prototype;dt[q]=!0,dt[X]=dt.values,dt.__toJS=dt.toArray,dt.__toStringMapper=jn,dt.inspect=dt.toSource=function(){return this.toString()},dt.chain=dt.flatMap,dt.contains=dt.includes,xt(v,{flip:function(){return Ge(this,an(this))},mapEntries:function(e,t){var r=this,s=0;return Ge(this,this.toSeq().map(function(f,E){return e.call(t,[E,f],s++,r)}).fromEntrySeq())},mapKeys:function(e,t){var r=this;return Ge(this,this.toSeq().flip().map(function(s,f){return e.call(t,s,f,r)}).flip())}});var sr=v.prototype;function go(e,t){return t}function yo(e,t){return[t,e]}function ar(e){return function(){return!e.apply(this,arguments)}}function An(e){return function(){return-e.apply(this,arguments)}}function jn(e){return typeof e=="string"?JSON.stringify(e):String(e)}function _o(){return V(arguments)}function Rn(e,t){return e<t?1:e>t?-1:0}function mo(e){if(e.size===1/0)return 0;var t=J(e),r=U(e),s=t?1:0;return bo(e.__iterate(r?t?function(f,E){s=31*s+Cn(oe(f),oe(E))|0}:function(f,E){s=s+Cn(oe(f),oe(E))|0}:t?function(f){s=31*s+oe(f)|0}:function(f){s=s+oe(f)|0}),s)}function bo(e,t){return t=K(t,3432918353),t=K(t<<15|t>>>-15,461845907),t=K(t<<13|t>>>-13,5),t=K((t=(t+3864292196|0)^e)^t>>>16,2246822507),t=ne((t=K(t^t>>>13,3266489909))^t>>>16)}function Cn(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}return sr[S]=!0,sr[X]=dt.entries,sr.__toJS=dt.toObject,sr.__toStringMapper=function(e,t){return JSON.stringify(t)+": "+jn(e)},xt(y,{toKeyedSeq:function(){return new _t(this,!1)},filter:function(e,t){return Ge(this,cn(this,e,t,!1))},findIndex:function(e,t){var r=this.findEntry(e,t);return r?r[0]:-1},indexOf:function(e){var t=this.keyOf(e);return t===void 0?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e);return t===void 0?-1:t},reverse:function(){return Ge(this,vr(this,!1))},slice:function(e,t){return Ge(this,Ir(this,e,t,!1))},splice:function(e,t){var r=arguments.length;if(t=Math.max(0|t,0),r===0||r===2&&!t)return this;e=B(e,e<0?this.count():this.size);var s=this.slice(0,e);return Ge(this,r===1?s:s.concat(V(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var r=this.findLastEntry(e,t);return r?r[0]:-1},first:function(){return this.get(0)},flatten:function(e){return Ge(this,ln(this,e,!1))},get:function(e,t){return(e=H(this,e))<0||this.size===1/0||this.size!==void 0&&e>this.size?t:this.find(function(r,s){return s===e},void 0,t)},has:function(e){return(e=H(this,e))>=0&&(this.size!==void 0?this.size===1/0||e<this.size:this.indexOf(e)!==-1)},interpose:function(e){return Ge(this,lo(this,e))},interleave:function(){var e=[this].concat(V(arguments)),t=xr(this.toSeq(),Se.of,e),r=t.flatten(!0);return t.size&&(r.size=t.size*e.length),Ge(this,r)},keySeq:function(){return O(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(e,t){return Ge(this,hn(this,e,t,!1))},zip:function(){return Ge(this,xr(this,_o,[this].concat(V(arguments))))},zipWith:function(e){var t=V(arguments);return t[0]=this,Ge(this,xr(this,e,t))}}),y.prototype[u]=!0,y.prototype[_]=!0,xt(F,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),F.prototype.has=dt.includes,F.prototype.contains=F.prototype.includes,xt(ke,v.prototype),xt(Se,y.prototype),xt(qe,F.prototype),xt(x,v.prototype),xt(C,y.prototype),xt(T,F.prototype),{Iterable:p,Seq:xe,Collection:z,Map:Ue,OrderedMap:ut,List:Xe,Stack:ht,Set:tt,OrderedSet:It,Record:gt,Range:O,Repeat:ct,is:Qe,fromJS:Vt}}()},function(N,a,n){let{Map:p,List:v,Set:y,fromJS:F}=n(36),{SkipList:Q}=n(38),{decodeChange:U,decodeChangeMeta:L,appendEdit:Z}=n(15),{parseOpId:J}=n(7);function q(G,M){for(let l of M.deps)if(!G.hasIn(["hashes",l]))return!1;return!0}function S(G,M){if(M==="_root")return"map";let l=G.getIn(["byObject",M,"_init","action"]),m={makeMap:"map",makeTable:"table",makeList:"list",makeText:"text"}[l];if(!m)throw new RangeError(`Unknown object type ${l} for ${M}`);return m}function u(G,M,l){let m=j(M),X=M.get("action");if(G.hasIn(["byObject",m,"_keys"]))throw new Error(`Duplicate creation of object ${m}`);let g=p({_init:M,_inbound:y(),_keys:p()});return X!=="makeList"&&X!=="makeText"||(g=g.set("_elemIds",new Q)),G=G.setIn(["byObject",m],g),l&&(l.objectId=m,l.type=S(G,m),l.props={},l.type!=="list"&&l.type!=="text"||(l.edits=[])),G}function _(G){let M=G.get("action");return M.startsWith("make")||M==="link"}function j(G){return G.get("child",G.get("opId"))}function W(G){let M=G.get("key");if(M)return M;let l=G.get("insert")?G.get("opId"):G.get("elemId");if(!l)throw new RangeError(`operation has no key: ${G}`);return l}function w(G,M,l){let m=M.get("obj"),X=M.get("action"),g=W(M);if(!G.get("byObject").has(m))throw new RangeError(`Modification of unknown object ${m}`);let k=S(G,m);if(l){if(l.objectId=l.objectId||m,l.objectId!==m)throw new RangeError(`objectId mismatch in patch: ${l.objectId} != ${m}`);if(l.type=l.type||k,l.type!==k)throw new RangeError(`object type mismatch in patch: ${l.type} != ${k}`);k==="list"||k==="text"||l.props[g]||(l.props[g]={})}if(X.startsWith("make"))if(l){let we={};G=u(G,M,we),k!=="map"&&k!=="table"||(l.props[g][M.get("opId")]=we)}else G=u(G,M);X==="link"&&l&&(l.props[g][M.get("opId")]=pe(G,j(M)));let Ie=V(G,m,g),ye,ie;if(X==="inc")ye=v(),ie=Ie.map(we=>we.get("action")==="set"&&typeof we.get("value")=="number"&&we.get("datatype")==="counter"&&M.get("pred").includes(we.get("opId"))?we.set("value",we.get("value")+M.get("value")):we);else{let we=Ie.groupBy(Ae=>M.get("pred").includes(Ae.get("opId")));ye=we.get(!0,v()),ie=we.get(!1,v())}for(let we of ye.filter(_))G=G.updateIn(["byObject",j(we),"_inbound"],Ae=>Ae.remove(we));return _(M)&&(G=G.updateIn(["byObject",j(M),"_inbound"],y(),we=>we.add(M))),(X==="set"||_(M))&&(ie=ie.push(M)),ie=ie.sort(H).reverse(),G=G.setIn(["byObject",m,"_keys",g],ie),k==="list"||k==="text"?G=function(we,Ae,Oe,xe){let ke=V(we,Ae,Oe),Se=we.getIn(["byObject",Ae,"_elemIds"]),qe=Se.indexOf(Oe);if(qe>=0)Se=ke.isEmpty()?Se.removeIndex(qe):Se.setValue(Oe,ke.first().get("value")),c(we,Ae,Oe,qe,!1,xe);else{if(ke.isEmpty())return we;let We=Oe;for(;qe=-1,We=te(we,Ae,We),We&&(qe=Se.indexOf(We),!(qe>=0)););qe+=1,Se=Se.insertIndex(qe,Oe,ke.first().get("value")),c(we,Ae,Oe,qe,!0,xe)}return we.setIn(["byObject",Ae,"_elemIds"],Se)}(G,m,g,l):i(G,m,g,l),G}function I(G,M,l){let m=M.get("obj"),X=M.get("opId"),g=W(M),k=S(G,m);if(l.objectId=l.objectId||m,l.type=l.type||k,l.objectId!==m)throw new RangeError(`objectId mismatch in path: ${l.objectId} != ${m}`);if(l.type!==k)throw new RangeError(`object type mismatch in path: ${l.type} != ${k}`);if(!l.props[g]||!l.props[g][X])if(k==="list"||k==="text"){let Ie=G.getIn(["byObject",m,"_elemIds"]).indexOf(g);c(G,m,g,Ie,!1,l)}else i(G,m,g,l);if(l.props[g][X]===void 0)throw new RangeError(`field ops for ${g} did not contain opId ${X}`);return l.props[g][X]}function h(G,M){if(M.get("action")==="set"){let l={type:"value",value:M.get("value")};return M.get("datatype")&&(l.datatype=M.get("datatype")),l}if(_(M)){let l=j(M),m=S(G,l);return m==="list"||m==="text"?{objectId:l,type:m,props:{},edits:[]}:{objectId:l,type:m,props:{}}}throw new RangeError(`Unexpected operation in field ops: ${M.get("action")}`)}function i(G,M,l,m){if(!m)return;m.props[l]||(m.props[l]={});let X={};for(let g of V(G,M,l)){let k=g.get("opId");X[k]=!0,_(g)&&m.props[l][k]||(m.props[l][k]=h(G,g))}for(let g of Object.keys(m.props[l]))X[g]||delete m.props[l][g]}function c(G,M,l,m,X,g){if(g)if(i(G,M,l,g),Object.keys(g.props[l]).length!==0){for(;!X&&g.edits.length>0&&g.edits[g.edits.length-1].index===m&&["insert","update"].includes(g.edits[g.edits.length-1].action);)X=g.edits.pop().action==="insert";for(let k of Object.keys(g.props[l]).sort(ee)){let Ie=g.props[l][k];Z(g.edits,X?{action:"insert",index:m,elemId:l,opId:k,value:Ie}:{action:"update",index:m,opId:k,value:Ie}),X=!1}}else Z(g.edits,{action:"remove",index:m,count:1})}function b(G,M,l){let m=M.get("actor"),X=M.get("startOp"),g=y();return M.get("ops").forEach((k,Ie)=>{let ye=k.get("action"),ie=k.get("obj"),we=k.get("insert");if(!["set","del","inc","link","makeMap","makeList","makeText","makeTable"].includes(ye))throw new RangeError(`Unknown operation action: ${ye}`);if(!k.get("pred"))throw new RangeError(`Missing 'pred' field in operation ${k}`);let Ae;if(l){let xe=function(ke,Se){let qe=[];for(;Se!=="_root";){let We=ke.getIn(["byObject",Se,"_inbound"],y()).first();if(!We)return null;qe.unshift(We),Se=We.get("obj")}return qe}(G,ie);if(xe!==null){Ae=l;for(let ke of xe)Ae=I(G,ke,Ae)}}let Oe=k.merge({opId:`${X+Ie}@${m}`});we&&(G=function(xe,ke){let Se=ke.get("obj"),qe=ke.get("opId");if(!xe.get("byObject").has(Se))throw new Error(`Modification of unknown object ${Se}`);if(xe.hasIn(["byObject",Se,"_insertion",qe]))throw new Error(`Duplicate list element ID ${qe}`);if(!ke.get("elemId"))throw new RangeError("insert operation has no key");return xe.updateIn(["byObject",Se,"_following",ke.get("elemId")],v(),We=>We.push(ke)).setIn(["byObject",Se,"_insertion",qe],ke)}(G,Oe)),ye.startsWith("make")&&(g=g.add(j(Oe))),G=w(G,Oe,Ae)}),G}function P(G,M,l){let m=F(U(M)),X=m.get("actor"),g=m.get("seq"),k=m.get("startOp"),Ie=m.get("hash");if(typeof X!="string"||typeof g!="number"||typeof k!="number")throw new TypeError(`Missing change metadata: actor = ${X}, seq = ${g}, startOp = ${k}`);if(G.hasIn(["hashes",Ie]))return G;let ye=G.getIn(["states",X],v()).size+1;if(g!==ye)throw new RangeError(`Expected change ${ye} by ${X}, got change ${g}`);let ie=0;for(let xe of m.get("deps")){let ke=G.getIn(["hashes",xe,"maxOpId"]);if(ke===void 0)throw new RangeError(`Unknown dependency hash ${xe}`);ie=Math.max(ie,ke),G=G.updateIn(["hashes",xe,"depsFuture"],y(),Se=>Se.add(Ie))}if(k!==ie+1)throw new RangeError(`Expected startOp to be ${ie+1}, was ${k}`);let we=m.get("deps"),Ae=g===1;for(;!Ae&&!we.isEmpty();){let xe=G.getIn(["hashes",we.first()]);we=we.shift(),xe.get("actor")===X&&xe.get("seq")===g-1?Ae=!0:we=we.concat(xe.get("depsPast"))}if(!Ae)throw new RangeError("Change lacks dependency on prior sequence number by the same actor");let Oe=p({actor:X,seq:g,startOp:k,change:M,maxOpId:k+m.get("ops").size-1,depsPast:m.get("deps").toSet(),depsFuture:y()});return(G=b(G,m,l)).setIn(["hashes",Ie],Oe).updateIn(["states",X],v(),xe=>xe.push(Ie)).update("deps",xe=>xe.subtract(m.get("deps")).add(Ie)).update("maxOp",xe=>Math.max(xe,Oe.get("maxOpId"))).update("history",xe=>xe.push(Ie))}function D(G,M){return G.getIn(["hashes",M,"change"])}function V(G,M,l){return G.getIn(["byObject",M,"_keys",l],v())}function re(G,M,l){if(l==="_head")return;let m=G.getIn(["byObject",M,"_insertion",l]);if(!m)throw new TypeError(`Missing index entry for list element ${l}`);return m.get("elemId")}function H(G,M){return ee(G.get("opId"),M.get("opId"))}function ee(G,M){let l=J(G),m=J(M);return l.counter<m.counter?-1:l.counter>m.counter?1:l.actorId<m.actorId?-1:l.actorId>m.actorId?1:0}function ce(G,M,l,m){let X=null;return m&&(X=p({opId:m})),G.getIn(["byObject",M,"_following",l],v()).filter(g=>g.get("insert")&&(!X||H(g,X)<0)).sort(H).reverse().map(g=>g.get("opId"))}function B(G,M,l){let m=ce(G,M,l);if(!m.isEmpty())return m.first();let X;for(;;){if(X=re(G,M,l),!X)return;let g=ce(G,M,X,l);if(!g.isEmpty())return g.first();l=X}}function te(G,M,l){let m=re(G,M,l),X,g=ce(G,M,m);if(g.first()===l)return m==="_head"?null:m;for(let k of g){if(k===l)break;X=k}for(;;){if(g=ce(G,M,X),g.isEmpty())return X;X=g.last()}}function d(G,M){if(_(M))return pe(G,j(M));if(M.get("action")==="set"){let l={value:M.get("value")};return M.get("datatype")&&(l.datatype=M.get("datatype")),l}throw new TypeError(`Unexpected operation action: ${M.get("action")}`)}function pe(G,M){let l=S(G,M);if(l==="map"||l==="table")return function(m,X,g){let k={objectId:X,type:g,props:{}};for(let[Ie,ye]of m.getIn(["byObject",X,"_keys"]).entries())if(!ye.isEmpty()){k.props[Ie]={};for(let ie of ye)k.props[Ie][ie.get("opId")]=d(m,ie)}return k}(G,M,l);if(l==="list"||l==="text")return function(m,X,g){let k={objectId:X,type:g,props:{},edits:[]},Ie="_head",ye=0,ie=0;for(;;){if(Ie=B(m,X,Ie),!Ie)return k;ie=Math.max(ie,J(Ie).counter);let we=V(m,X,Ie);if(!we.isEmpty()){k.props[ye]={};for(let Ae of we)k.props[ye][Ae.get("opId")]=d(m,Ae);ye+=1}}}(G,M,l);throw new RangeError(`Unknown object type: ${l}`)}N.exports={init:function(){return p().set("states",p()).set("history",v()).set("byObject",p().set("_root",p().set("_keys",p()))).set("hashes",p()).set("deps",y()).set("maxOp",0).set("queue",v())},addChange:function(G,M,l){return function(m,X){let g=v();for(;;){for(let k of m.get("queue"))q(m,L(k,!1))?m=P(m,k,X):g=g.push(k);if(g.count()===m.get("queue").count())return m;m=m.set("queue",g),g=v()}}(G=G.update("queue",m=>m.push(M)),l)},addLocalChange:function(G,M,l){return P(G,M,l)},getHeads:function(G){return G.get("deps").toArray().sort()},getChangeByHash:D,getMissingChanges:function(G,M){if(M.isEmpty())return G.get("history").toArray().map(g=>D(G,g));let l=v(),m={},X=[];for(let g of M){m[g]=!0;let k=G.getIn(["hashes",g,"depsFuture"]);if(!k)throw new RangeError(`hash not found: ${g}`);l=l.concat(k)}for(;!l.isEmpty();){let g=l.last();if(m[g]=!0,X.push(g),!G.getIn(["hashes",g,"depsPast"]).every(k=>m[k]))break;l=l.pop().concat(G.getIn(["hashes",g,"depsFuture"]))}if(l.isEmpty()&&G.get("deps").every(g=>m[g]))return X.map(g=>D(G,g));for(l=M,m={};!l.isEmpty();){let g=l.last();if(l=l.pop(),!m[g]){let k=G.getIn(["hashes",g,"depsPast"]);if(!k)throw new RangeError(`hash not found: ${g}`);l=l.concat(k),m[g]=!0}}return G.get("history").filter(g=>!m[g]).map(g=>D(G,g)).toArray()},getChangesAdded:function(G,M){let l=M.get("deps").toArray(),m={},X=[];for(;l.length>0;){let g=l.pop();m[g]||D(G,g)||(m[g]=!0,X.push(g),l.push(...M.getIn(["hashes",g,"depsPast"])))}return X.reverse().map(g=>D(M,g))},getMissingDeps:function(G,M=[]){let l={},m={};for(let X of G.get("queue")){let g=L(X,!0);m[g.hash]=!0;for(let k of g.deps)G.hasIn(["hashes",k])||(l[k]=!0)}for(let X of M)G.hasIn(["hashes",X])||(l[X]=!0);return Object.keys(l).filter(X=>!m[X]).sort()},constructObject:pe,getFieldOps:V,getOperationKey:W,finalizePatch:function G(M){if(M){if(M.type==="list"||M.type==="text"){delete M.props;for(let l of M.edits)G(l.value)}else if(M.type==="map"||M.type==="table")for(let l of Object.keys(M.props))for(let m of Object.keys(M.props[l]))G(M.props[l][m])}}}},function(N,a,n){let{Map:p}=n(36);class v{constructor(U,L,Z,J,q,S,u){this.key=U,this.value=L,this.level=Z,this.prevKey=J,this.nextKey=q,this.prevCount=S,this.nextCount=u}setValue(U){return new v(this.key,U,this.level,this.prevKey,this.nextKey,this.prevCount,this.nextCount)}insertAfter(U,L,Z,J){if(L>this.level&&this.key!==null)throw new RangeError("Cannot increase the level of a non-head node");let q=Math.max(this.level,L),S=this.nextKey.slice(),u=this.nextCount.slice();for(let _=Z;_<q;_++)_<L?(S[_]=U,u[_]=J):u[_]+=1;return new v(this.key,this.value,q,this.prevKey,S,this.prevCount,u)}insertBefore(U,L,Z,J){if(L>this.level)throw new RangeError("Cannot increase node level");let q=this.prevKey.slice(),S=this.prevCount.slice();for(let u=Z;u<this.level;u++)u<L?(q[u]=U,S[u]=J):S[u]+=1;return new v(this.key,this.value,this.level,q,this.nextKey,S,this.nextCount)}removeAfter(U,L,Z,J){let q=this.nextKey.slice(),S=this.nextCount.slice();for(let u=U;u<this.level;u++)u<L?(q[u]=Z[u],S[u]=J[u]):S[u]-=1;return new v(this.key,this.value,this.level,this.prevKey,q,this.prevCount,S)}removeBefore(U,L,Z,J){let q=this.prevKey.slice(),S=this.prevCount.slice();for(let u=U;u<this.level;u++)u<L?(q[u]=Z[u],S[u]=J[u]):S[u]-=1;return new v(this.key,this.value,this.level,q,this.nextKey,S,this.nextCount)}}class y{constructor(U){let L=new v(null,null,1,[],[null],[],[null]),Z=U?U():{next(){let J=Math.floor(4294967296*Math.random()),q=1;for(;J<1<<32-2*q&&q<16;)q+=1;return{value:q,done:!1}}};return F(0,p().set(null,L),Z)}get headNode(){return this._nodes.get(null)}predecessors(U,L){let Z=[U],J=[1];for(let q=1;q<L;q++){let S=Z[q-1],u=J[q-1];for(;S;){let _=this._nodes.get(S);if(_.level>q)break;if(_.level<q)throw new RangeError("Node "+S+" below expected level "+(q-1));u+=_.prevCount[q-1],S=_.prevKey[q-1]}Z[q]=S,J[q]=u}return{preKeys:Z,preCounts:J}}successors(U,L){let Z=[U],J=[1];for(let q=1;q<L;q++){let S=Z[q-1],u=J[q-1];for(;S;){let _=this._nodes.get(S);if(_.level>q)break;if(_.level<q)throw new RangeError("Node "+S+" below expected level "+(q-1));u+=_.nextCount[q-1],S=_.nextKey[q-1]}Z[q]=S,J[q]=u}return{sucKeys:Z,sucCounts:J}}insertAfter(U,L,Z){if(typeof L!="string"||L==="")throw new RangeError("Key must be a nonempty string");if(!this._nodes.has(U))throw new RangeError("The referenced predecessor key does not exist");if(this._nodes.has(L))throw new RangeError("Cannot insert a key that already exists");let J=this._randomSource.next().value,q=Math.max(J,this.headNode.level),S=this._nodes.get(U).nextKey[0]||null,{preKeys:u,preCounts:_}=this.predecessors(U,q),{sucKeys:j,sucCounts:W}=this.successors(S,q);return F(this.length+1,this._nodes.withMutations(w=>{let I=0,h=0;for(let i=1;i<=q;i++){let c=Math.min(i,J);i!==q&&u[i]===u[I]||(w.update(u[I],b=>b.insertAfter(L,c,I,_[I])),I=i),!j[h]||i!==q&&j[i]===j[h]||(w.update(j[h],b=>b.insertBefore(L,c,h,W[h])),h=i)}w.set(L,new v(L,Z,J,u.slice(0,J),j.slice(0,J),_.slice(0,J),W.slice(0,J)))}),this._randomSource)}insertIndex(U,L,Z){if(typeof U!="number"||U<0)throw new RangeError("Index must be a non-negative integer");return U===0?this.insertAfter(null,L,Z):this.insertAfter(this.keyOf(U-1),L,Z)}removeKey(U){if(typeof U!="string"||!this._nodes.has(U))throw new RangeError("The given key cannot be removed because it does not exist");let L=this._nodes.get(U),Z=this.headNode.level,{preKeys:J,preCounts:q}=this.predecessors(L.prevKey[0],Z),{sucKeys:S,sucCounts:u}=this.successors(L.nextKey[0],Z),_=new Array(Z);for(let j=0;j<Z;j++)_[j]=q[j]+u[j]-1;return F(this.length-1,this._nodes.withMutations(j=>{j.remove(U);let W=0,w=0;for(let I=1;I<=Z;I++){let h=Math.min(I,L.level);I!==Z&&J[I]===J[W]||(j.update(J[W],i=>i.removeAfter(W,h,S,_)),W=I),!S[w]||I!==Z&&S[I]===S[w]||(j.update(S[w],i=>i.removeBefore(w,h,J,_)),w=I)}}),this._randomSource)}removeIndex(U){return this.removeKey(this.keyOf(U))}indexOf(U){if(typeof U!="string"||U===""||!this._nodes.has(U))return-1;let L=this._nodes.get(U),Z=0;for(;L&&L.key;)Z+=L.prevCount[L.level-1],L=this._nodes.get(L.prevKey[L.level-1]);return Z-1}keyOf(U){if(typeof U!="number"||(U<0&&(U+=this.length),U<0||U>=this.length))return null;let L=this._nodes.get(null),Z=L.level-1,J=0;for(;;){if(J===U+1)return L.key;J+L.nextCount[Z]>U+1?Z-=1:(J+=L.nextCount[Z],L=this._nodes.get(L.nextKey[Z]))}}getValue(U){if(typeof U!="string"||U==="")throw new RangeError("Key must be a nonempty string");let L=this._nodes.get(U);return L&&L.value}setValue(U,L){if(typeof U!="string"||U==="")throw new RangeError("Key must be a nonempty string");let Z=this._nodes.get(U);if(!Z)throw new RangeError("The referenced key does not exist");return Z=Z.setValue(L),F(this.length,this._nodes.set(U,Z),this._randomSource)}iterator(U){let L=this._nodes,Z=L.get(null).nextKey[0];return{next(){if(!Z)return{value:void 0,done:!0};let J=L.get(Z),q;switch(U){case"keys":q={value:Z,done:!1};break;case"values":q={value:J.value,done:!1};break;case"entries":q={value:[Z,J.value],done:!1}}return Z=J.nextKey[0],q},[Symbol.iterator]:()=>this.iterator(U)}}[Symbol.iterator](){return this.iterator("values")}}function F(Q,U,L){let Z=Object.create(y.prototype);return Z.length=Q,Z._nodes=U,Z._randomSource=L,Z}N.exports={SkipList:y}},function(N){N.exports={backendState:function(a){if(a.frozen)throw new Error("Attempting to use an outdated Automerge document that has already been updated. Please use the latest document state, or call Automerge.clone() if you really need to use this old document state.");return a.state}}},function(N,a,n){let{List:p}=n(36),{backendState:v}=n(39),y=n(35),F=n(37),{hexStringToBytes:Q,bytesToHexString:U,Encoder:L,Decoder:Z}=n(32),{decodeChangeMeta:J}=n(15),{copyObject:q}=n(7);class S{constructor(c){if(Array.isArray(c)){this.numEntries=c.length,this.numBitsPerEntry=10,this.numProbes=7,this.bits=new Uint8Array(Math.ceil(this.numEntries*this.numBitsPerEntry/8));for(let b of c)this.addHash(b)}else{if(!(c instanceof Uint8Array))throw new TypeError("invalid argument");if(c.byteLength===0)this.numEntries=0,this.numBitsPerEntry=0,this.numProbes=0,this.bits=c;else{let b=new Z(c);this.numEntries=b.readUint32(),this.numBitsPerEntry=b.readUint32(),this.numProbes=b.readUint32(),this.bits=b.readRawBytes(Math.ceil(this.numEntries*this.numBitsPerEntry/8))}}}get bytes(){if(this.numEntries===0)return new Uint8Array(0);let c=new L;return c.appendUint32(this.numEntries),c.appendUint32(this.numBitsPerEntry),c.appendUint32(this.numProbes),c.appendRawBytes(this.bits),c.buffer}getProbes(c){let b=Q(c),P=8*this.bits.byteLength;if(b.byteLength!==32)throw new RangeError(`Not a 256-bit hash: ${c}`);let D=((b[0]|b[1]<<8|b[2]<<16|b[3]<<24)>>>0)%P,V=((b[4]|b[5]<<8|b[6]<<16|b[7]<<24)>>>0)%P,re=((b[8]|b[9]<<8|b[10]<<16|b[11]<<24)>>>0)%P,H=[D];for(let ee=1;ee<this.numProbes;ee++)D=(D+V)%P,V=(V+re)%P,H.push(D);return H}addHash(c){for(let b of this.getProbes(c))this.bits[b>>>3]|=1<<(7&b)}containsHash(c){if(this.numEntries===0)return!1;for(let b of this.getProbes(c))if((this.bits[b>>>3]&1<<(7&b))==0)return!1;return!0}}function u(i,c){if(!Array.isArray(c))throw new TypeError("hashes must be an array");i.appendUint32(c.length);for(let b=0;b<c.length;b++){if(b>0&&c[b-1]>=c[b])throw new RangeError("hashes must be sorted");let P=Q(c[b]);if(P.byteLength!==32)throw new TypeError("heads hashes must be 256 bits");i.appendRawBytes(P)}}function _(i){let c=i.readUint32(),b=[];for(let P=0;P<c;P++)b.push(U(i.readRawBytes(32)));return b}function j(i){let c=new L;c.appendByte(66),u(c,i.heads),u(c,i.need),c.appendUint32(i.have.length);for(let b of i.have)u(c,b.lastSync),c.appendPrefixedBytes(b.bloom);c.appendUint32(i.changes.length);for(let b of i.changes)c.appendPrefixedBytes(b);return c.buffer}function W(i){let c=new Z(i),b=c.readByte();if(b!==66)throw new RangeError(`Unexpected message type: ${b}`);let P=_(c),D=_(c),V=c.readUint32(),re={heads:P,need:D,have:[],changes:[]};for(let ee=0;ee<V;ee++){let ce=_(c),B=c.readPrefixedBytes(c);re.have.push({lastSync:ce,bloom:B})}let H=c.readUint32();for(let ee=0;ee<H;ee++){let ce=c.readPrefixedBytes();re.changes.push(ce)}return re}function w(i,c){let b=F.getMissingChanges(i.get("opSet"),p(c)).map(P=>J(P,!0).hash);return{lastSync:c,bloom:new S(b).bytes}}function I(){return{sharedHeads:[],lastSentHeads:[],theirHeads:null,theirNeed:null,theirHave:null,sentHashes:{}}}function h(i,c){return i.length===c.length&&i.every((b,P)=>b===c[P])}N.exports={receiveSyncMessage:function(i,c,b){if(!i)throw new Error("generateSyncMessage called with no Automerge document");if(!c)throw new Error("generateSyncMessage requires a syncState, which can be created with initSyncState()");let{sharedHeads:P,lastSentHeads:D,sentHashes:V}=c,re=null,H=W(b),ee=y.getHeads(i);H.changes.length>0&&([i,re]=y.applyChanges(i,H.changes),P=function(te,d,pe){let G=d.filter(l=>!te.includes(l)),M=pe.filter(l=>d.includes(l));return[...new Set([...G,...M])].sort()}(ee,y.getHeads(i),P)),H.changes.length===0&&h(H.heads,ee)&&(D=H.heads);let ce=H.heads.filter(te=>y.getChangeByHash(i,te));ce.length===H.heads.length?(P=H.heads,H.heads.length===0&&(D=[],V=[])):P=[...new Set(ce.concat(P))].sort();let B={sharedHeads:P,lastSentHeads:D,theirHave:H.have,theirHeads:H.heads,theirNeed:H.need,sentHashes:V};return[i,B,re]},generateSyncMessage:function(i,c){if(!i)throw new Error("generateSyncMessage called with no Automerge document");if(!c)throw new Error("generateSyncMessage requires a syncState, which can be created with initSyncState()");let{sharedHeads:b,lastSentHeads:P,theirHeads:D,theirNeed:V,theirHave:re,sentHashes:H}=c,ee=y.getHeads(i),ce=v(i),B=y.getMissingDeps(i,D||[]),te=[];if(D&&!B.every(l=>D.includes(l))||(te=[w(ce,b)]),re&&re.length>0&&!re[0].lastSync.every(l=>y.getChangeByHash(i,l)))return[c,j({heads:ee,need:[],have:[{lastSync:[],bloom:new Uint8Array(0)}],changes:[]})];let d=Array.isArray(re)&&Array.isArray(V)?function(l,m,X){let g=l.get("opSet");if(m.length===0)return X.map(ke=>F.getChangeByHash(g,ke)).filter(ke=>ke!==void 0);let k={},Ie=[];for(let ke of m){for(let Se of ke.lastSync)k[Se]=!0;Ie.push(new S(ke.bloom))}let ye=F.getMissingChanges(g,p(Object.keys(k))).map(ke=>J(ke,!0)),ie={},we={},Ae={};for(let ke of ye){ie[ke.hash]=!0;for(let Se of ke.deps)we[Se]||(we[Se]=[]),we[Se].push(ke.hash);Ie.every(Se=>!Se.containsHash(ke.hash))&&(Ae[ke.hash]=!0)}let Oe=Object.keys(Ae);for(;Oe.length>0;){let ke=Oe.pop();if(we[ke])for(let Se of we[ke])Ae[Se]||(Ae[Se]=!0,Oe.push(Se))}let xe=[];for(let ke of X)if(Ae[ke]=!0,!ie[ke]){let Se=F.getChangeByHash(g,ke);Se&&xe.push(Se)}for(let ke of ye)Ae[ke.hash]&&xe.push(ke.change);return xe}(ce,re,V):[],pe=Array.isArray(P)&&h(ee,P),G=Array.isArray(D)&&h(ee,D);if(pe&&G&&d.length===0)return[c,null];d=d.filter(l=>!H[J(l,!0).hash]);let M={heads:ee,have:te,need:B,changes:d};if(d.length>0){H=q(H);for(let l of d)H[J(l,!0).hash]=!0}return[c=Object.assign({},c,{lastSentHeads:ee,sentHashes:H}),j(M)]},encodeSyncMessage:j,decodeSyncMessage:W,initSyncState:I,encodeSyncState:function(i){let c=new L;return c.appendByte(67),u(c,i.sharedHeads),c.buffer},decodeSyncState:function(i){let c=new Z(i),b=c.readByte();if(b!==67)throw new RangeError(`Unexpected record type: ${b}`);let P=_(c);return Object.assign({sharedHeads:[],lastSentHeads:[],theirHeads:null,theirNeed:null,theirHave:null,sentHashes:{}},{sharedHeads:P})},BloomFilter:S}}],zn={},xo=function N(a){var n=zn[a];if(n!==void 0)return n.exports;var p=zn[a]={exports:{}};return Io[a].call(p.exports,p,p.exports,N),p.exports}(0);globalThis.Automerge=xo;var{Automerge:zt}=globalThis;var Et=class{listeners={};getEventListeners(a){return this.listeners[a]||(this.listeners[a]=[])}fire(a,...n){let p=this.getEventListeners(a);p?.forEach&&p.forEach(v=>v(...n))}listen(a,n,p){return this.getEventListeners(a).push(n),n._name=p||"(unnamed listener)",n}unlisten(a,n){let p=this.getEventListeners(a),v=typeof n=="string"?p.findIndex(y=>y._name===n):p.indexOf(n);v>=0?p.splice(v,1):console.warn("failed to unlisten from",a)}};var{create:ko,keys:Eo}=Object,{stringify:Ln,parse:Tn}=JSON,Rr=class extends Et{privateData;constructor(){super()}setPrivateData(a){this.privateData=a}set data(a){this.setPrivateData(a)}get data(){return this.privateData}toString(){return this.pretty}get isObject(){return this.data&&typeof this.data=="object"}get pojo(){return this.data}get json(){return Ln(this.data)}set json(a){let n=null;try{n=Tn(a)}catch{}this.data=n}get pretty(){let a={},n=this.pojo;return Eo(n).sort().forEach(p=>a[p]=n[p]),Ln(a,null,"  ")}},Cr=class extends Rr{change(a){a(this),this.doChange()}doChange(){this.fire("change",this),this.onChange(this)}onChange(a){}set data(a){this.change(n=>n.setPrivateData(a))}get data(){return this.privateData}set(a,n){this.data||this.setPrivateData(ko(null)),n!==void 0?this.change(p=>p.data[a]=n):this.delete(a)}delete(a){this.change(n=>delete n.data[a])}},zr=class extends Cr{meta;persistor;willPersist;constructor(a){super(),this.meta={...a}}toString(){return`${JSON.stringify(this.meta,null,"  ")}, ${this.pretty}`}get tags(){return this.meta.tags??(this.meta.tags=[])}is(...a){return a.every(n=>this.tags.includes(n))}isCollection(){return this.meta.type?.[0]==="["}async doChange(){return this.persist(),super.doChange()}async persist(){!this.willPersist&&this.persistor&&(this.willPersist=!0,setTimeout(()=>{this.willPersist=!1,this.persistor.persist(this)},500))}async restore(a){!await this.persistor?.restore(this)&&a!==void 0&&(this.data=a)}delete(){this.persistor?.remove(this)}save(){return this.json}load(a,n){let p=n;try{a&&(p=Tn(a))}catch{}p!==void 0&&(this.data=p)}},Lt=class extends zr{};function St(N){if(N){if(Array.isArray(N))return N.map(a=>St(a));if(typeof N=="object"){let a=Object.create(null);return Object.entries(N).forEach(([n,p])=>{a[n]=St(p)}),a}else return N}else return N}var hr=(N,a)=>{let n=typeof N;if(n!==typeof a)return!1;if(n==="object"&&N&&a){let p=Object.getOwnPropertyNames(N),v=Object.getOwnPropertyNames(a);return p.length==v.length&&!p.some(y=>!hr(N[y],a[y]))}return N===a};var Vn=["log","group","groupCollapsed","groupEnd","dir"],Un=["warn","error"];var{fromEntries:Dn}=Object,$n=(N,a,n,p="log")=>{if(!N)return()=>{};if(p==="dir")return console.dir.bind(console);let v=`background: ${n||"gray"}; color: white; padding: 1px 6px 2px 7px; border-radius: 6px 0 0 6px;`;return console[p].bind(console,`%c${a}`,v)},ot=(N,a,n="")=>{let p=Dn(Vn.map(Q=>[Q,$n(N,a,n,Q)])),v=Dn(Un.map(Q=>[Q,$n(!0,a,n,Q)])),y={...p,...v},F=y.log;return Object.assign(F,y),F};ot.flags=globalThis.config?.logFlags||{};var Oo=N=>ot(ot.flags.arc,`Arc (${N})`,"slateblue"),{assign:So,keys:Lr,entries:Mn,create:Ao}=Object,Tr=N=>Object.values(N),Vr=()=>Ao(null),lr=class extends Et{log;id;meta;stores;hosts;surface;composer;hostService;constructor(a,n,p){super(),this.id=a,this.meta=n,this.surface=p,this.hosts=Vr(),this.stores=Vr(),this.log=Oo(a)}async addHost(a,n){return await this.ensureComposer(),this.hosts[a.id]=a,a.arc=this,this.updateHost(a),a}async ensureComposer(){!this.composer&&this.surface&&(this.composer=await this.surface.createComposer("root"),this.composer.onevent=this.onevent.bind(this))}removeHost(a){this.hosts[a]?.detach(),delete this.hosts[a]}addStore(a,n){n&&!this.stores[a]&&(this.stores[a]=n,n.listen("change",()=>this.storeChanged(a,n),this.id))}removeStore(a){let n=this.stores[a];n&&n.unlisten("change",this.id),delete this.stores[a]}storeChanged(a,n){this.log(`storeChanged: "${a}"`);let p=v=>v&&v.some(y=>Tr(y)[0]==a||Lr(y)[0]==a);Tr(this.hosts).forEach(v=>{let y=v.meta?.inputs;(y==="*"||p(y))&&(this.log(`host "${v.id}" has interest in "${a}"`),this.updateHost(v))}),this.fire("store-changed",a)}updateParticleMeta(a,n){let p=this.hosts[a];p.meta=n,this.updateHost(p)}updateHost(a){a.inputs=this.computeInputs(a)}computeInputs(a){let n=Vr(),p=a.meta?.inputs;if(p==="*")Mn(this.stores).forEach(([v,y])=>n[v]=y.pojo);else{let v=a.meta?.staticInputs;So(n,v),p&&(p.forEach(y=>this.computeInput(Mn(y)[0],n)),this.log(`computeInputs(${a.id}) =`,n))}return n}computeInput([a,n],p){let v=n||a,y=this.stores[v];y?p[a]=y.pojo:this.log.warn(`computeInput: "${v}" (bound to "${a}") not found`)}assignOutputs({id:a,meta:n},p){let v=Lr(p);n?.outputs&&v.length&&(v.forEach(y=>this.assignOutput(y,p[y],n.outputs)),this.log(`[end][${a}] assignOutputs:`,p))}assignOutput(a,n,p){if(n!==void 0){let v=this.findOutputByName(p,a)||a,y=this.stores[v];y?(this.log(`assignOutputs: "${a}" is dirty, updating Store "${v}"`,n),y.data=n):p?.[a]&&this.log.warn(`assignOutputs: no "${v}" store for output "${a}"`)}}findOutputByName(a,n){let p=a?.find(v=>Lr(v)[0]===n);if(p)return Tr(p)[0]}async render(a){this.composer&&this.composer.render(a)}onevent(a,n){let p=this.hosts[a];p&&p.handleEvent(n)}async service(a,n){let p=await this.surface?.service(n);return p===void 0&&(p=this.hostService?.(a,n)),p}};var{floor:jo,pow:pi,random:Ro}=Math;var Ur=N=>jo(Ro()*N),Nn=N=>N[Ur(N.length)];var Dr=ot(ot.flags.decorator,"Decorator","plum"),{values:Co,entries:Pn}=Object,Bn={},$r={setOpaqueData(N,a){return Bn[N]=St(a),N},getOpaqueData(N){return Bn[N]},maybeDecorateModel(N,a){return N&&!Array.isArray(N)&&Co(N).forEach(n=>{n&&typeof n=="object"&&(n.models?(Dr("applying decorator(s) to list:",n),this.maybeDecorateItem(n,a)):(N?.filter||N?.decorator||N?.collateBy)&&(Dr("scanning for lists in sub-model:",n),this.maybeDecorateModel(n,a)))}),N},maybeDecorateItem(N,a){let n=typeof N.models=="string"?this.getOpaqueData(N.models):N.models;n=zo(n,N.decorator,a),n=Lo(n,N.filter,a.impl),n=To(n,N),N.models=n}},zo=(N,a,n)=>{a=n.impl[a]??a;let{inputs:p,state:v}=n.internal;if(a){let y=Object.freeze(St(p)),F=Object.freeze(St(v));N=N.map(Q=>{Q.privateData=Q.privateData||{};let U=Object.freeze(St(Q)),L=a(U,y,F);return Q.privateData=L.privateData,{...L,...Q}}),N.sort(Vo("sortKey")),Dr("decoration was performed")}return N},Lo=(N,a,n)=>(a=n[a]??a,a&&N&&(N=N.filter(a)),N),To=(N,a)=>(Pn(a).forEach(([n,p])=>{if(p?.collateBy){let v=Do(N,p.collateBy);N=$o(v,n,p.$template)}}),N),Vo=N=>(a,n)=>Uo(String(a[N]).toLowerCase(),String(n[N]).toLowerCase()),Uo=(N,a)=>N<a?-1:N>a?1:0,Do=(N,a)=>{let n={};return N.forEach(p=>{let v=p[a];v&&(n[v]||(n[v]=[])).push(p)}),n},$o=(N,a,n)=>Pn(N).map(([p,v])=>({key:p,[a]:{models:v,$template:n},single:v.length===1,...v?.[0]}));var{entries:qn,keys:Mo}=Object,No=N=>ot(ot.flags.host,`Host (${N})`,Nn(["#5a189a","#51168b","#48137b","#6b2fa4","#7b46ae","#3f116c"])),Qt=class extends Et{arc;id;lastOutput;log;meta;particle;constructor(a){super(),this.log=No(a),this.id=a}onevent(a){this.arc?.onevent(a)}installParticle(a,n){this.particle&&this.detachParticle(),a&&(this.particle=a,this.meta=n||this.meta)}get container(){return this.meta?.container||"root"}detach(){this.detachParticle(),this.arc=null}detachParticle(){let{particle:a}=this;a&&(this.render({$clear:!0}),this.particle=null,this.meta=null)}async service(a){return a?.decorate?$r.maybeDecorateModel(a.model,this.particle):this.arc?.service(this,a)}output(a,n){a&&(this.lastOutput=a,this.arc?.assignOutputs(this,a)),this.template&&($r.maybeDecorateModel(n,this.particle),this.log(n),this.render(n))}render(a){let{id:n,container:p,template:v}=this;this.arc?.render({id:n,container:p,content:{template:v,model:a}})}set inputs(a){if(this.particle&&a){let n=this.particle.internal.inputs;this.dirtyCheck(a,n,this.lastOutput)?(this.particle.inputs={...this.meta?.staticInputs,...a},this.fire("inputs-changed")):this.log("inputs are uninteresting, skipping update")}}dirtyCheck(a,n,p){let v=([y,F])=>p?.[y]&&!hr(p[y],F)||!hr(n?.[y],F);return!n||qn(a).length!==this.lastInputsLength(n)||qn(a).some(v)}lastInputsLength(a){return Mo(a).filter(n=>!this.meta?.staticInputs?.[n]&&n!=="eventlet").length}get config(){return this.particle?.config}get template(){return this.config?.template}invalidate(){this.particle?.invalidate()}handleEvent(a){return this.particle?.handleEvent(a)}};var Mr=(N,a,n)=>{N=N||2,a=a||2,n=n||"-";let p=Math.pow(10,a-1),v=Math.pow(10,a)-p,y=[];for(let F=0;F<N;F++)y.push(`${Ur(v-p)+p}`);return y.join(n)};var Hn=ot(ot.flags.runtime,"runtime","#873600"),Fn={},Nr={},{keys:Bo}=Object,Tt=class extends Et{log;uid;nid;arcs;stores;peers;shares;endpoint;network;surfaces;persistor;prettyUid;constructor(a){a=a||"user",super(),this.arcs={},this.surfaces={},this.stores={},this.peers=new Set,this.shares=new Set,this.setUid(a),this.log=ot(ot.flags.runtime,`runtime:[${this.prettyUid}]`,"#873600"),Tt.securityLockdown?.(Tt.particleOptions)}setUid(a){this.uid=a,this.nid=`${a}:${Mr(1,2)}`,this.prettyUid=a.substring(0,a.indexOf("@")+1)||a}async bootstrapArc(a,n,p,v){let y=new lr(a,n,p);return y.hostService=this.serviceFactory(v),await this.addArc(y),y}serviceFactory(a){return async(n,p)=>a.handle(this,n,p)}async bootstrapParticle(a,n,p){let v=new Qt(n);await this.marshalParticle(v,p);let y=a.addHost(v);return Hn("bootstrapped particle",n),y}addSurface(a,n){this.surfaces[a]=n}getSurface(a){return this.surfaces[a]}addArc(a){let{id:n}=a;if(n&&!this.arcs[n])return this.arcs[n]=a;throw`arc has no id, or id "${n}" is already in use`}removeArc(a){let{id:n}=a;if(!n||!this.arcs[n])throw n?`id "${n}" is not in use`:"arc has no id";delete this.arcs[n]}async marshalParticle(a,n){let p=await this.createParticle(a,n.kind);a.installParticle(p,n)}async installParticle(a,n,p){if(this.log("installParticle",p,n,a.id),p=p||Mr(),a.hosts[p]){let y=1;for(;a.hosts[`${p}-${y}`];y++);p=`${p}-${y}`}let v=new Qt(p);return await this.marshalParticle(v,n),a.addHost(v),v}addStore(a,n){n.marshal&&n.marshal(this),n.persistor&&(n.persistor.persist=y=>this.persistor?.persist(a,y));let p=`${this.nid}:${a}-changed`,v=this.storeChanged.bind(this,a);n.listen("change",v,p),this.stores[a]=n,this.maybeShareStore(a)}storeChanged(a,n){this.log("storeChanged",a),this.network?.invalidatePeers(a),this.onStoreChange(a,n),this.fire("store-changed",{storeId:a,store:n})}onStoreChange(a,n){}do(a,n){n(this.stores[a])}removeStore(a){this.do(a,n=>{n?.unlisten("change",`${this.nid}:${a}-changed`)}),delete this.stores[a]}maybeShareStore(a){this.do(a,n=>{n?.is("shared")&&this.shareStore(a)})}addPeer(a){this.peers.add(a),[...this.shares].forEach(n=>this.maybeShareStoreWithPeer(n,a))}shareStore(a){this.shares.add(a),[...this.peers].forEach(n=>this.maybeShareStoreWithPeer(a,n))}maybeShareStoreWithPeer(a,n){this.do(a,p=>{let v=this.uid.replace(/\./g,"_");(!p.is("private")||n.startsWith(v))&&this.shareStoreWithPeer(a,n)})}shareStoreWithPeer(a,n){this.network?.shareStore(a,n)}async createParticle(a,n){try{return(await this.marshalParticleFactory(n))(a)}catch(p){Hn.error(`createParticle(${n}):`,p)}}async marshalParticleFactory(a){return Fn[a]??this.lateBindParticle(a)}lateBindParticle(a){return Tt.registerParticleFactory(a,Tt?.particleIndustry(a,Tt.particleOptions))}static registerParticleFactory(a,n){return Fn[a]=n}requireStore(a){let n=this.stores[a.name];return n||(n=this.createStore(a),this.addStore(a.name,n)),n}createStore(a){let n=Bo(Nr).find(v=>a.tags?.includes?.(v)),p=Nr[String(n)]||Lt;return new p(a)}static registerStoreClass(a,n){Nr[a]=n}},At=Tt;cr(At,"securityLockdown"),cr(At,"particleIndustry"),cr(At,"particleOptions");var Po=ot(ot.flags.automerge,"AutomergeStore","crimson"),{init:qo,change:Kn,load:Ho,getLastLocalChange:Fo}=zt,Br=class extends Lt{crdt;constructor(a){super(a),this.crdt=this.initDefaultStateDoc({})}get data(){return this.crdt.data}set data(a){this.change(n=>n.data=a)}initDefaultStateDoc(a){return Ho(Fo(Kn(qo("0000"),{time:0},n=>n.data=a)))}get pojo(){return St(this.data)}change(a){if(!this.crdt)throw"null crdt";this.setCrdt(Kn(this.crdt,a))}setCrdt(a){a!==this.crdt&&(Po(`[${this.meta.name}] crdt changed, invoking doChange`),this.crdt=a,this.doChange())}save(){let a=zt.save(this.crdt);return btoa(a)}load(a){let n=JSON.parse(`[${atob(a)}]`),p=new Uint8Array(n);this.crdt=zt.load(p)}};At.registerStoreClass("crdt",Br);var fr=(N,a,n)=>{if(N&&clearTimeout(N),a&&n)return setTimeout(a,n)};var Zn=(N,a)=>{setTimeout(N,a??0)};var Ko=100,Zo=100,{values:Wo}=Object,Jo=N=>new Uint8Array(JSON.parse(`[${atob(N)}]`)),Go=N=>btoa(N),Wn={},Jn=class{log;log2;nid;runtime;shares;constructor(a,n){this.shares={},this.nid=a,this.runtime=n,this.log=ot(ot.flags.network,`network[${a}]`,"#512DA8"),this.log2=ot(ot.flags.network,`network[${a}]`,"#4527A0"),this.connectEndpoint()}connectEndpoint(){let{endpoint:a}=this.runtime;a?a.onreceive=(n,p)=>this.receive(n,p):Wn[this.nid]=this}shareStore(a,n){let p=this.shares[a]??(this.shares[a]={}),v=p[n]??(p[n]=this.initShare(a,n));this.updatePeer(v)}invalidatePeers(a){let n=`${this.nid}_${a}_updatePeersDebounceKey`;this[n]=fr(this[n],()=>this.updatePeers(a),Ko)}initShare(a,n){return this.runtime.endpoint?.ring(n),{storeId:a,peerId:n,syncState:zt.initSyncState()}}updatePeer(a){let n=this.runtime.stores[a.storeId];if(n){let[p,v]=zt.generateSyncMessage(n.crdt,a.syncState);a.syncState=p,v&&this.send(a,v)}}send(a,n){let p=Go(n),v={storeId:a.storeId,syncString:p};if(this.log(`send sync for [${a.storeId}] to [${a.peerId}]`),this.runtime.endpoint?.send)this.runtime.endpoint.send(a.peerId,v);else{let y=Wn[a.peerId];y&&Zn(()=>y.receive(this.nid,v),Zo)}}receive(a,{storeId:n,syncString:p}){let v=Jo(p);this.log2(`receive sync for [${n}] from [${a}]`);let y=this.runtime.stores[n],F=this.shares[n]?.[a];if(y&&F){let[Q,U]=zt.receiveSyncMessage(y.crdt,F.syncState,v);F.syncState=U,this.updateCrdt(F.storeId,y,Q)}else this.log.warn(`receive: store [${n}] doesn't exist`)}updateCrdt(a,n,p){n.crdt!==p?n.setCrdt(p):this.invalidatePeers(a)}updatePeers(a){this.log("updatePeers",a);let n=this.shares[a];n&&Wo(n).forEach(p=>this.updatePeer(p))}};function Gn(N,a){for(let n in a)if(N[n]!==a[n])return!1;return!0}var Pr=class extends Lt{criteria;stores;debounceKey;constructor(a){super(a),this.stores=[],this.criteria={name:this.nameFromTags(),type:a.type},this.setPrivateData([])}nameFromTags(){return this.tags.map(a=>(a.match(/^name:(.*)$/)||[])[1]).filter(a=>a)[0]}onContextAdd(a){this.addMapped([a])}onContextChanged(a){this.hasStore(a)&&this.invalidateStore()}addMapped(a){let n=v=>Gn(v.meta,this.criteria),p=a?.filter(n);p?.length>0&&(this.pushStores(p),this.invalidateStore())}pushStores(a){let n=a.filter(p=>!this.hasStore(p));n.length>0&&this.stores.push(...n)}invalidateStore(){this.debounceKey=fr(this.debounceKey,()=>this.aggregateStores(),40)}async aggregateStores(){this.debounceKey=null;let a=this.stores.map(n=>n?.data).filter(n=>n&&Array.isArray(n)).flat();this.change(n=>n.data=a)}save(){return""}hasStore(a){return this.stores.some(({meta:n})=>n.name===a.meta.name)}marshal(a){this.addMapped(Object.values(this.stores)),a.listen("store-added",n=>this.onContextAdd(n)),a.listen("store-changed",n=>this.onContextChanged(n)),this.rebuild(a)}rebuild(a){let p=(this.meta?.value).map(v=>a.requireStore(v));this.addMapped(p)}};At.registerStoreClass("aggregate",Pr);export{Pr as AggregateStore,Jn as AutomergeNetwork,Br as AutomergeStore};
/**
 * @license
 * Copyright 2021 Google LLC.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
//# sourceMappingURL=crdt.min.js.map
