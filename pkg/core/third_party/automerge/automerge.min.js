var t=[function(t,e,n){const r=n(1),o=n(5),{OPTIONS:i}=n(6),{encodeChange:s,decodeChange:a}=n(15),{isObject:u}=n(7);let c=n(34);function l(t){if("string"==typeof t)t={actorId:t};else if(void 0===t)t={};else if(!u(t))throw new TypeError(`Unsupported options for init(): ${t}`);return o.init(Object.assign({backend:c},t))}function h(t,e,n){const[r]=o.change(t,e,n);return r}function f(t){return c.getAllChanges(o.getBackendState(t,"getAllChanges"))}function d(t,e,n,r,s){const a=o.applyPatch(t,e,n),u=s.patchCallback||t[i].patchCallback;return u&&u(e,t,a,!1,r),a}function p(t,e,n={}){const r=o.getBackendState(t,"applyChanges"),[i,s]=c.applyChanges(r,e);return[d(t,s,i,e,n),s]}t.exports={init:l,from:function(t,e){return h(l(e),{message:"Initialization"},(e=>Object.assign(e,t)))},change:h,emptyChange:function(t,e){const[n]=o.emptyChange(t,e);return n},clone:function(t,e={}){const n=c.clone(o.getBackendState(t,"clone"));return d(l(e),c.getPatch(n),n,[],e)},free:function(t){c.free(o.getBackendState(t,"free"))},load:function(t,e={}){const n=c.load(t);return d(l(e),c.getPatch(n),n,[t],e)},save:function(t){return c.save(o.getBackendState(t,"save"))},merge:function(t,e){const n=o.getBackendState(t,"merge"),r=o.getBackendState(e,"merge","second");if(o.getActorId(t)===o.getActorId(e))throw new RangeError("Cannot merge an actor with itself");const i=c.getChangesAdded(n,r),[s]=p(t,i);return s},getChanges:function(t,e){const n=o.getBackendState(t,"getChanges"),r=o.getBackendState(e,"getChanges","second");return c.getChanges(r,c.getHeads(n))},getAllChanges:f,applyChanges:p,encodeChange:s,decodeChange:a,equals:function t(e,n){if(!u(e)||!u(n))return e===n;const r=Object.keys(e).sort(),o=Object.keys(n).sort();if(r.length!==o.length)return!1;for(let i=0;i<r.length;i++){if(r[i]!==o[i])return!1;if(!t(e[r[i]],n[o[i]]))return!1}return!0},getHistory:function(t){const e=o.getActorId(t),n=f(t);return n.map(((t,r)=>({get change(){return a(t)},get snapshot(){const t=c.loadChanges(c.init(),n.slice(0,r+1));return o.applyPatch(l(e),c.getPatch(t),t)}})))},uuid:r,Frontend:o,setDefaultBackend:function(t){c=t},generateSyncMessage:function(t,e){const n=o.getBackendState(t,"generateSyncMessage");return c.generateSyncMessage(n,e)},receiveSyncMessage:function(t,e,n){const r=o.getBackendState(t,"receiveSyncMessage"),[s,a,u]=c.receiveSyncMessage(r,e,n);if(!u)return[t,a,u];let l=null;return t[i].patchCallback&&(l=c.decodeSyncMessage(n).changes),[d(t,u,s,l,{}),a,u]},initSyncState:function(){return c.initSyncState()},get Backend(){return c}};for(let e of["getObjectId","getObjectById","getActorId","setActorId","getConflicts","getLastLocalChange","Text","Table","Counter","Observable"])t.exports[e]=o[e]},function(t,e,n){const r=n(2);function o(){return r().replace(/-/g,"")}let i=o;function s(){return i()}s.setFactory=t=>{i=t},s.reset=()=>{i=o},t.exports=s},function(t,e,n){var r=n(3),o=n(4);t.exports=function(t,e,n){var i=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var a=0;a<16;++a)e[i+a]=s[a];return e||o(s)}},function(t){var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var n=new Uint8Array(16);t.exports=function(){return e(n),n}}else{var r=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}},function(t){for(var e=[],n=0;n<256;++n)e[n]=(n+256).toString(16).substr(1);t.exports=function(t,n){var r=n||0,o=e;return[o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]]].join("")}},function(t,e,n){const{OPTIONS:r,CACHE:o,STATE:i,OBJECT_ID:s,CONFLICTS:a,CHANGE:u,ELEM_IDS:c}=n(6),{isObject:l,copyObject:h}=n(7),f=n(1),{interpretPatch:d,cloneRootObject:p}=n(8),{rootObjectProxy:g}=n(12),{Context:_}=n(13),{Text:y}=n(9),{Table:b}=n(10),{Counter:w}=n(11),{Observable:m}=n(14);function v(t){if("string"!=typeof t)throw new TypeError("Unsupported type of actorId: "+typeof t);if(!/^[0-9a-f]+$/.test(t))throw new RangeError("actorId must consist only of lowercase hex digits");if(t.length%2!=0)throw new RangeError("actorId must consist of an even number of digits")}function I(t,e,n){let s=e._root;if(s||(s=p(t[o]._root),e._root=s),Object.defineProperty(s,r,{value:t[r]}),Object.defineProperty(s,o,{value:e}),Object.defineProperty(s,i,{value:n}),t[r].freeze)for(let t of Object.keys(e))e[t]instanceof b?e[t]._freeze():e[t]instanceof y?(Object.freeze(e[t].elems),Object.freeze(e[t])):(Object.freeze(e[t]),Object.freeze(e[t][a]));for(let n of Object.keys(t[o]))e[n]||(e[n]=t[o][n]);return t[r].freeze&&Object.freeze(e),s}function k(t,e,n){const o=A(t);if(!o)throw new Error("Actor ID must be initialized with setActorId() before making a change");const s=h(t[i]);s.seq+=1;const a={actor:o,seq:s.seq,startOp:s.maxOp+1,deps:s.deps,time:n&&"number"==typeof n.time?n.time:Math.round((new Date).getTime()/1e3),message:n&&"string"==typeof n.message?n.message:"",ops:e.ops};if(t[r].backend){const[e,o,i]=t[r].backend.applyLocalChange(s.backendState,a);s.backendState=e,s.lastLocalChange=i;const u=x(t,o,s,!0),c=n&&n.patchCallback||t[r].patchCallback;return c&&c(o,t,u,!0,[i]),[u,a]}{const n={actor:o,seq:a.seq,before:t};return s.requests=s.requests.concat([n]),s.maxOp=s.maxOp+function(t){let e=0;for(const n of t)"set"===n.action&&n.values?e+=n.values.length:e+=1;return e}(a.ops),s.deps=[],[I(t,e?e.updated:{},s),a]}}function x(t,e,n,r){const o=A(t),i={};if(d(e.diffs,t,i),r){if(!e.clock)throw new RangeError("patch is missing clock field");e.clock[o]&&e.clock[o]>n.seq&&(n.seq=e.clock[o]),n.clock=e.clock,n.deps=e.deps,n.maxOp=Math.max(n.maxOp,e.maxOp)}return I(t,i,n)}function E(t){if("string"==typeof t)t={actorId:t};else if(void 0===t)t={};else if(!l(t))throw new TypeError(`Unsupported value for init() options: ${t}`);if(t.deferActorId||(void 0===t.actorId&&(t.actorId=f()),v(t.actorId)),t.observable){const e=t.patchCallback,n=t.observable;t.patchCallback=(t,r,o,i,s)=>{e&&e(t,r,o,i,s),n.patchCallback(t,r,o,i,s)}}const e={},n={_root:e},u={seq:0,maxOp:0,requests:[],clock:{},deps:[]};return t.backend&&(u.backendState=t.backend.init(),u.lastLocalChange=null),Object.defineProperty(e,s,{value:"_root"}),Object.defineProperty(e,r,{value:Object.freeze(t)}),Object.defineProperty(e,a,{value:Object.freeze({})}),Object.defineProperty(e,o,{value:Object.freeze(n)}),Object.defineProperty(e,i,{value:Object.freeze(u)}),Object.freeze(e)}function O(t,e,n){if("_root"!==t[s])throw new TypeError("The first argument to Automerge.change must be the document root");if(t[u])throw new TypeError("Calls to Automerge.change cannot be nested");if("function"==typeof e&&void 0===n&&([e,n]=[n,e]),"string"==typeof e&&(e={message:e}),void 0!==e&&!l(e))throw new TypeError("Unsupported type of options");const r=A(t);if(!r)throw new Error("Actor ID must be initialized with setActorId() before making a change");const o=new _(t,r);return n(g(o)),0===Object.keys(o.updated).length?[t,null]:k(t,o,e)}function A(t){return t[i].actorId||t[r].actorId}t.exports={init:E,from:function(t,e){return O(E(e),"Initialization",(e=>Object.assign(e,t)))},change:O,emptyChange:function(t,e){if("_root"!==t[s])throw new TypeError("The first argument to Automerge.emptyChange must be the document root");if("string"==typeof e&&(e={message:e}),void 0!==e&&!l(e))throw new TypeError("Unsupported type of options");const n=A(t);if(!n)throw new Error("Actor ID must be initialized with setActorId() before making a change");return k(t,new _(t,n),e)},applyPatch:function(t,e,n){if("_root"!==t[s])throw new TypeError("The first argument to Frontend.applyPatch must be the document root");const o=h(t[i]);if(t[r].backend){if(!n)throw new RangeError("applyPatch must be called with the updated backend state");return o.backendState=n,x(t,e,o,!0)}let a;if(o.requests.length>0)if(a=o.requests[0].before,e.actor===A(t)){if(o.requests[0].seq!==e.seq)throw new RangeError(`Mismatched sequence number: patch ${e.seq} does not match next request ${o.requests[0].seq}`);o.requests=o.requests.slice(1)}else o.requests=o.requests.slice();else a=t,o.requests=[];let u=x(a,e,o,!0);return 0===o.requests.length?u:(o.requests[0]=h(o.requests[0]),o.requests[0].before=u,I(t,{},o))},getObjectId:function(t){return t[s]},getObjectById:function(t,e){if(t[u])throw new TypeError("Cannot use getObjectById in a change callback");return t[o][e]},getActorId:A,setActorId:function(t,e){return v(e),I(t,{},Object.assign({},t[i],{actorId:e}))},getConflicts:function(t,e){if(t[a]&&t[a][e]&&Object.keys(t[a][e]).length>1)return t[a][e]},getLastLocalChange:function(t){return t[i]&&t[i].lastLocalChange?t[i].lastLocalChange:null},getBackendState:function(t,e=null,n="first"){if("_root"!==t[s]){const r=Array.isArray(t)?". Note: Automerge.applyChanges now returns an array.":"";throw e?new TypeError(`The ${n} argument to Automerge.${e} must be the document root${r}`):new TypeError(`Argument is not an Automerge document root${r}`)}return t[i].backendState},getElementIds:function(t){return t instanceof y?t.elems.map((t=>t.elemId)):t[c]},Text:y,Table:b,Counter:w,Observable:m}},function(t){const e=Symbol("_options"),n=Symbol("_cache"),r=Symbol("_state"),o=Symbol("_objectId"),i=Symbol("_conflicts"),s=Symbol("_change"),a=Symbol("_elemIds");t.exports={OPTIONS:e,CACHE:n,STATE:r,OBJECT_ID:o,CONFLICTS:i,CHANGE:s,ELEM_IDS:a}},function(t){function e(t){return"object"==typeof t&&null!==t}t.exports={isObject:e,copyObject:function(t){if(!e(t))return{};let n={};for(let e of Object.keys(t))n[e]=t[e];return n},parseOpId:function(t){const e=/^(\d+)@(.*)$/.exec(t||"");if(!e)throw new RangeError(`Not a valid opId: ${t}`);return{counter:parseInt(e[1],10),actorId:e[2]}},equalBytes:function(t,e){if(!(t instanceof Uint8Array&&e instanceof Uint8Array))throw new TypeError("equalBytes can only compare Uint8Arrays");if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.byteLength;n++)if(t[n]!==e[n])return!1;return!0}}},function(t,e,n){const{isObject:r,copyObject:o,parseOpId:i}=n(7),{OBJECT_ID:s,CONFLICTS:a,ELEM_IDS:u}=n(6),{instantiateText:c}=n(9),{instantiateTable:l}=n(10),{Counter:h}=n(11);function f(t,e,n){if(t.objectId)return e&&e[s]!==t.objectId&&(e=void 0),y(t,e,n);if("timestamp"===t.datatype)return new Date(t.value);if("counter"===t.datatype)return new h(t.value);if(void 0!==t.datatype)throw new TypeError(`Unknown datatype: ${t.datatype}`);return t.value}function d(t,e){const n=/^(\d+)@(.*)$/,r=n.test(t)?i(t):{counter:0,actorId:t},o=n.test(e)?i(e):{counter:0,actorId:e};return r.counter<o.counter?-1:r.counter>o.counter?1:r.actorId<o.actorId?-1:r.actorId>o.actorId?1:0}function p(t,e){const n=o(t),r=o(t?t[a]:void 0);return Object.defineProperty(n,s,{value:e}),Object.defineProperty(n,a,{value:r}),n}function g(t,e,n){const r=t.objectId;n[r]||(n[r]=p(e,r));const o=n[r];return function(t,e,n,r){if(t)for(let o of Object.keys(t)){const i={},s=Object.keys(t[o]).sort(d).reverse();for(let e of s){const s=t[o][e];n[o]&&n[o][e]?i[e]=f(s,n[o][e],r):i[e]=f(s,void 0,r)}0===s.length?(delete e[o],delete n[o]):(e[o]=i[s[0]],n[o]=i)}}(t.props,o,o[a],n),o}function _(t,e,n){const r=t.objectId;n[r]||(n[r]=function(t,e){const n=t?t.slice():[],r=t&&t[a]?t[a].slice():[],o=t&&t[u]?t[u].slice():[];return Object.defineProperty(n,s,{value:e}),Object.defineProperty(n,a,{value:r}),Object.defineProperty(n,u,{value:o}),n}(e,r));const o=n[r],c=o[a],l=o[u];for(let e=0;e<t.edits.length;e++){const r=t.edits[e];if("insert"===r.action||"update"===r.action){const i=c[r.index]&&c[r.index][r.opId];let s=f(r.value,i,n),a={[r.opId]:s};for(;e<t.edits.length-1&&t.edits[e+1].index===r.index&&"update"===t.edits[e+1].action;){e++;const r=t.edits[e],o=c[r.index]&&c[r.index][r.opId];s=f(r.value,o,n),a[r.opId]=s}"insert"===r.action?(o.splice(r.index,0,s),c.splice(r.index,0,a),l.splice(r.index,0,r.elemId)):(o[r.index]=s,c[r.index]=a)}else if("multi-insert"===r.action){const t=i(r.elemId),e=[],n=[],s=[];r.values.forEach(((r,o)=>{const i=`${t.counter+o}@${t.actorId}`;n.push(r),s.push({[i]:{value:r,type:"value"}}),e.push(i)})),o.splice(r.index,0,...n),c.splice(r.index,0,...s),l.splice(r.index,0,...e)}else"remove"===r.action&&(o.splice(r.index,r.count),c.splice(r.index,r.count),l.splice(r.index,r.count))}return o}function y(t,e,n){if(r(e)&&(!t.props||0===Object.keys(t.props).length)&&(!t.edits||0===t.edits.length)&&!n[t.objectId])return e;if("map"===t.type)return g(t,e,n);if("table"===t.type)return function(t,e,n){const r=t.objectId;n[r]||(n[r]=e?e._clone():l(r));const o=n[r];for(let e of Object.keys(t.props||{})){const r=Object.keys(t.props[e]);if(0===r.length)o.remove(e);else{if(1!==r.length)throw new RangeError("Conflicts are not supported on properties of a table");{const i=t.props[e][r[0]];o._set(e,f(i,o.byId(e),n),r[0])}}}return o}(t,e,n);if("list"===t.type)return _(t,e,n);if("text"===t.type)return function(t,e,n){const r=t.objectId;let o;o=n[r]?n[r].elems:e?e.elems.slice():[];for(const e of t.edits)if("insert"===e.action){const t=f(e.value,void 0,n),r={elemId:e.elemId,pred:[e.opId],value:t};o.splice(e.index,0,r)}else if("multi-insert"===e.action){const t=i(e.elemId),n=e.values.map(((e,n)=>{const r=`${t.counter+n}@${t.actorId}`;return{elemId:r,pred:[r],value:e}}));o.splice(e.index,0,...n)}else if("update"===e.action){const t=o[e.index].elemId,r=f(e.value,o[e.index].value,n);o[e.index]={elemId:t,pred:[e.opId],value:r}}else"remove"===e.action&&o.splice(e.index,e.count);return n[r]=c(r,o),n[r]}(t,e,n);throw new TypeError(`Unknown object type: ${t.type}`)}t.exports={interpretPatch:y,cloneRootObject:function(t){if("_root"!==t[s])throw new RangeError(`Not the root object: ${t[s]}`);return p(t,"_root")}}},function(t,e,n){const{OBJECT_ID:r}=n(6),{isObject:o}=n(7);class i{constructor(t){if("string"==typeof t){return s(void 0,[...t].map((t=>({value:t}))))}if(Array.isArray(t)){return s(void 0,t.map((t=>({value:t}))))}if(void 0===t)return s(void 0,[]);throw new TypeError(`Unsupported initial value for Text: ${t}`)}get length(){return this.elems.length}get(t){const e=this.elems[t].value;if(this.context&&o(e)){const n=e[r],o=this.path.concat([{key:t,objectId:n}]);return this.context.instantiateObject(o,n)}return e}getElemId(t){return this.elems[t].elemId}[Symbol.iterator](){let t=this.elems,e=-1;return{next:()=>(e+=1,e<t.length?{done:!1,value:t[e].value}:{done:!0})}}toString(){let t="";for(const e of this.elems)"string"==typeof e.value&&(t+=e.value);return t}toSpans(){let t=[],e="";for(const n of this.elems)"string"==typeof n.value?e+=n.value:(e.length>0&&(t.push(e),e=""),t.push(n.value));return e.length>0&&t.push(e),t}toJSON(){return this.toString()}getWriteable(t,e){if(!this[r])throw new RangeError("getWriteable() requires the objectId to be set");const n=s(this[r],this.elems);return n.context=t,n.path=e,n}set(t,e){if(this.context)this.context.setListIndex(this.path,t,e);else{if(this[r])throw new TypeError("Automerge.Text object cannot be modified outside of a change block");this.elems[t].value=e}return this}insertAt(t,...e){if(this.context)this.context.splice(this.path,t,0,e);else{if(this[r])throw new TypeError("Automerge.Text object cannot be modified outside of a change block");this.elems.splice(t,0,...e.map((t=>({value:t}))))}return this}deleteAt(t,e=1){if(this.context)this.context.splice(this.path,t,e,[]);else{if(this[r])throw new TypeError("Automerge.Text object cannot be modified outside of a change block");this.elems.splice(t,e)}return this}}for(let t of["concat","every","filter","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString"])i.prototype[t]=function(...e){return[...this][t](...e)};function s(t,e){const n=Object.create(i.prototype);return n[r]=t,n.elems=e,n}t.exports={Text:i,instantiateText:s}},function(t,e,n){const{OBJECT_ID:r,CONFLICTS:o}=n(6),{isObject:i,copyObject:s}=n(7);function a(t,e,n){for(let r of t)if(e[r]!==n[r]){if("number"==typeof e[r]&&"number"==typeof n[r])return e[r]-n[r];{const t=""+e[r],o=""+n[r];if(t===o)continue;return t<o?-1:1}}return 0}class u{constructor(){this.entries=Object.freeze({}),this.opIds=Object.freeze({}),Object.freeze(this)}byId(t){return this.entries[t]}get ids(){return Object.keys(this.entries).filter((t=>{const e=this.entries[t];return i(e)&&e.id===t}))}get count(){return this.ids.length}get rows(){return this.ids.map((t=>this.byId(t)))}filter(t,e){return this.rows.filter(t,e)}find(t,e){return this.rows.find(t,e)}map(t,e){return this.rows.map(t,e)}sort(t){if("function"==typeof t)return this.rows.sort(t);if("string"==typeof t)return this.rows.sort(((e,n)=>a([t],e,n)));if(Array.isArray(t))return this.rows.sort(((e,n)=>a(t,e,n)));if(void 0===t)return this.rows.sort(((t,e)=>a(["id"],t,e)));throw new TypeError(`Unsupported sorting argument: ${t}`)}[Symbol.iterator](){let t=this.rows,e=-1;return{next:()=>(e+=1,e<t.length?{done:!1,value:t[e]}:{done:!0})}}_clone(){if(!this[r])throw new RangeError("clone() requires the objectId to be set");return l(this[r],s(this.entries),s(this.opIds))}_set(t,e,n){if(Object.isFrozen(this.entries))throw new Error("A table can only be modified in a change function");i(e)&&!Array.isArray(e)&&Object.defineProperty(e,"id",{value:t,enumerable:!0}),this.entries[t]=e,this.opIds[t]=n}remove(t){if(Object.isFrozen(this.entries))throw new Error("A table can only be modified in a change function");delete this.entries[t],delete this.opIds[t]}_freeze(){Object.freeze(this.entries),Object.freeze(this.opIds),Object.freeze(this)}getWriteable(t,e){if(!this[r])throw new RangeError("getWriteable() requires the objectId to be set");const n=Object.create(c.prototype);return n[r]=this[r],n.context=t,n.entries=this.entries,n.opIds=this.opIds,n.path=e,n}toJSON(){const t={};for(let e of this.ids)t[e]=this.byId(e);return t}}class c extends u{byId(t){if(i(this.entries[t])&&this.entries[t].id===t){const e=this.entries[t][r],n=this.path.concat([{key:t,objectId:e}]);return this.context.instantiateObject(n,e,["id"])}}add(t){return this.context.addTableRow(this.path,t)}remove(t){if(!i(this.entries[t])||this.entries[t].id!==t)throw new RangeError(`There is no row with ID ${t} in this table`);this.context.deleteTableRow(this.path,t,this.opIds[t])}}function l(t,e,n){const i=Object.create(u.prototype);if(!t)throw new RangeError("instantiateTable requires an objectId to be given");return i[r]=t,i[o]=Object.freeze({}),i.entries=e||{},i.opIds=n||{},i}t.exports={Table:u,instantiateTable:l}},function(t){class e{constructor(t){this.value=t||0,Object.freeze(this)}valueOf(){return this.value}toString(){return this.valueOf().toString()}toJSON(){return this.value}}class n extends e{increment(t){return t="number"==typeof t?t:1,this.context.increment(this.path,this.key,t),this.value+=t,this.value}decrement(t){return this.increment("number"==typeof t?-t:-1)}}t.exports={Counter:e,getWriteableCounter:function(t,e,r,o,i){const s=Object.create(n.prototype);return s.value=t,s.context=e,s.path=r,s.objectId=o,s.key=i,s}}},function(t,e,n){const{OBJECT_ID:r,CHANGE:o,STATE:i}=n(6),{Text:s}=n(9),{Table:a}=n(10);function u(t){if("string"==typeof t&&/^[0-9]+$/.test(t)&&(t=parseInt(t,10)),"number"!=typeof t)throw new TypeError("A list index must be a number, but you passed "+JSON.stringify(t));if(t<0||isNaN(t)||t===1/0||t===-1/0)throw new RangeError("A list index must be positive, but you passed "+t);return t}const c={get(t,e){const{context:n,objectId:s,path:a}=t;return e===r?s:e===o?n:e===i?{actorId:n.actorId}:n.getObjectField(a,s,e)},set(t,e,n){const{context:r,path:o,readonly:i}=t;if(Array.isArray(i)&&i.indexOf(e)>=0)throw new RangeError(`Object property "${e}" cannot be modified`);return r.setMapKey(o,e,n),!0},deleteProperty(t,e){const{context:n,path:r,readonly:o}=t;if(Array.isArray(o)&&o.indexOf(e)>=0)throw new RangeError(`Object property "${e}" cannot be modified`);return n.deleteMapKey(r,e),!0},has(t,e){const{context:n,objectId:i}=t;return[r,o].includes(e)||e in n.getObject(i)},getOwnPropertyDescriptor(t,e){const{context:n,objectId:r}=t;if(e in n.getObject(r))return{configurable:!0,enumerable:!0,value:n.getObjectField(r,e)}},ownKeys(t){const{context:e,objectId:n}=t;return Object.keys(e.getObject(n))}},l={get(t,e){const[n,i,s]=t;return e===Symbol.iterator?n.getObject(i)[Symbol.iterator]:e===r?i:e===o?n:"length"===e?n.getObject(i).length:"string"==typeof e&&/^[0-9]+$/.test(e)?n.getObjectField(s,i,u(e)):function(t,e,n){const o={deleteAt(e,r){return t.splice(n,u(e),r||1,[]),this},fill(r,o,i){let s=t.getObject(e);for(let e=u(o||0);e<u(i||s.length);e++)t.setListIndex(n,e,r);return this},indexOf(n,o=0){const i=n[r];if(i){const n=t.getObject(e);for(let t=o;t<n.length;t++)if(n[t][r]===i)return t;return-1}return t.getObject(e).indexOf(n,o)},insertAt(e,...r){return t.splice(n,u(e),0,r),this},pop(){let r=t.getObject(e);if(0==r.length)return;const o=t.getObjectField(n,e,r.length-1);return t.splice(n,r.length-1,1,[]),o},push(...r){let o=t.getObject(e);return t.splice(n,o.length,0,r),t.getObject(e).length},shift(){if(0==t.getObject(e).length)return;const r=t.getObjectField(n,e,0);return t.splice(n,0,1,[]),r},splice(r,o,...i){let s=t.getObject(e);r=u(r),(void 0===o||o>s.length-r)&&(o=s.length-r);const a=[];for(let i=0;i<o;i++)a.push(t.getObjectField(n,e,r+i));return t.splice(n,r,o,i),a},unshift:(...r)=>(t.splice(n,0,0,r),t.getObject(e).length)};for(let n of["entries","keys","values"]){let r=t.getObject(e);o[n]=()=>r[n]()}for(let r of["concat","every","filter","find","findIndex","forEach","includes","join","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString","toString"])o[r]=(...o)=>t.getObject(e).map(((r,o)=>t.getObjectField(n,e,o)))[r](...o);return o}(n,i,s)[e]},set(t,e,n){const[r,,o]=t;return r.setListIndex(o,u(e),n),!0},deleteProperty(t,e){const[n,,r]=t;return n.splice(r,u(e),1,[]),!0},has(t,e){const[n,i]=t;return"string"==typeof e&&/^[0-9]+$/.test(e)?u(e)<n.getObject(i).length:["length",r,o].includes(e)},getOwnPropertyDescriptor(t,e){const[n,o]=t,i=n.getObject(o);if("length"===e)return{writable:!0,value:i.length};if(e===r)return{configurable:!1,enumerable:!1,value:o};if("string"==typeof e&&/^[0-9]+$/.test(e)){const t=u(e);if(t<i.length)return{configurable:!0,enumerable:!0,value:n.getObjectField(o,t)}}},ownKeys(t){const[e,n]=t,r=e.getObject(n);let o=["length"];for(let t of Object.keys(r))o.push(t);return o}};function h(t,e,n,r){return new Proxy({context:t,objectId:e,path:n,readonly:r},c)}function f(t,e,n){const r=this.getObject(e);return Array.isArray(r)?function(t,e,n){return new Proxy([t,e,n],l)}(this,e,t):r instanceof s||r instanceof a?r.getWriteable(this,t):h(this,e,t,n)}t.exports={rootObjectProxy:function(t){return t.instantiateObject=f,h(t,"_root",[])}}},function(t,e,n){const{CACHE:r,OBJECT_ID:o,CONFLICTS:i,ELEM_IDS:s,STATE:a}=n(6),{interpretPatch:u}=n(8),{Text:c}=n(9),{Table:l}=n(10),{Counter:h,getWriteableCounter:f}=n(11),{isObject:d,parseOpId:p}=n(7),g=n(1);function _(t,e){return t instanceof l?[t.opIds[e]]:t instanceof c?t.elems[e].pred:t[i]&&t[i][e]?Object.keys(t[i][e]):[]}function y(t,e,n=!1){if(n){if(0===e)return"_head";e-=1}if(t[s])return t[s][e];if(t.getElemId)return t.getElemId(e);throw new RangeError(`Cannot find elemId at list index ${e}`)}t.exports={Context:class{constructor(t,e,n){this.actorId=e,this.maxOp=t[a].maxOp,this.cache=t[r],this.updated={},this.ops=[],this.applyPatch=n||u}addOp(t){this.ops.push(t)}nextOpId(){let t=this.maxOp+1;for(const e of this.ops)"set"===e.action&&e.values?t+=e.values.length:"del"===e.action&&e.multiOp?t+=e.multiOp:t+=1;return`${t}@${this.actorId}`}getValueDescription(t){if(!["object","boolean","number","string"].includes(typeof t))throw new TypeError("Unsupported type of value: "+typeof t);if(d(t)){if(t instanceof Date)return{type:"value",value:t.getTime(),datatype:"timestamp"};if(t instanceof h)return{type:"value",value:t.value,datatype:"counter"};{const e=t[o],n=this.getObjectType(e);if(!e)throw new RangeError(`Object ${JSON.stringify(t)} has no objectId`);return"list"===n||"text"===n?{objectId:e,type:n,edits:[]}:{objectId:e,type:n,props:{}}}}return{type:"value",value:t}}getValuesDescriptions(t,e,n){if(e instanceof l){const t=e.byId(n);return t?{[n]:this.getValueDescription(t)}:{}}if(e instanceof c){const t=e.get(n),r=e.getElemId(n);return t?{[r]:this.getValueDescription(t)}:{}}{const r=e[i][n],o={};if(!r)throw new RangeError(`No children at key ${n} of path ${JSON.stringify(t)}`);for(let t of Object.keys(r))o[t]=this.getValueDescription(r[t]);return o}}getPropertyValue(t,e,n){return t instanceof l?t.byId(e):t instanceof c?t.get(e):t[i][e][n]}getSubpatch(t,e){if(0==e.length)return t;let n=t,r=this.getObject("_root");for(let t of e){let o=this.getValuesDescriptions(e,r,t.key);if(n.props)n.props[t.key]||(n.props[t.key]=o);else if(n.edits)for(const e of Object.keys(o))n.edits.push({action:"update",index:t.key,opId:e,value:o[e]});let i=null;for(let e of Object.keys(o))o[e].objectId===t.objectId&&(i=e);if(!i)throw new RangeError(`Cannot find path object with objectId ${t.objectId}`);n=o[i],r=this.getPropertyValue(r,t.key,i)}return n}getObject(t){const e=this.updated[t]||this.cache[t];if(!e)throw new RangeError(`Target object does not exist: ${t}`);return e}getObjectType(t){if("_root"===t)return"map";const e=this.getObject(t);return e instanceof c?"text":e instanceof l?"table":Array.isArray(e)?"list":"map"}getObjectField(t,e,n){if(!["string","number"].includes(typeof n))return;const r=this.getObject(e);if(r[n]instanceof h)return f(r[n].value,this,t,e,n);if(d(r[n])){const e=r[n][o],i=t.concat([{key:n,objectId:e}]);return this.instantiateObject(i,e)}return r[n]}createNestedObjects(t,e,n,r,i,s){if(n[o])throw new RangeError("Cannot create a reference to an existing document object");const a=this.nextOpId();if(n instanceof c){this.addOp(s?{action:"makeText",obj:t,elemId:s,insert:r,pred:i}:{action:"makeText",obj:t,key:e,insert:r,pred:i});const o={objectId:a,type:"text",edits:[]};return this.insertListItems(o,0,[...n],!0),o}if(n instanceof l){if(n.count>0)throw new RangeError("Assigning a non-empty Table object is not supported");return this.addOp(s?{action:"makeTable",obj:t,elemId:s,insert:r,pred:i}:{action:"makeTable",obj:t,key:e,insert:r,pred:i}),{objectId:a,type:"table",props:{}}}if(Array.isArray(n)){this.addOp(s?{action:"makeList",obj:t,elemId:s,insert:r,pred:i}:{action:"makeList",obj:t,key:e,insert:r,pred:i});const o={objectId:a,type:"list",edits:[]};return this.insertListItems(o,0,n,!0),o}{this.addOp(s?{action:"makeMap",obj:t,elemId:s,insert:r,pred:i}:{action:"makeMap",obj:t,key:e,insert:r,pred:i});let o={};for(let t of Object.keys(n).sort()){const e=this.nextOpId(),r=this.setValue(a,t,n[t],!1,[]);o[t]={[e]:r}}return{objectId:a,type:"map",props:o}}}setValue(t,e,n,r,o,i){if(!t)throw new RangeError("setValue needs an objectId");if(""===e)throw new RangeError("The key of a map entry must not be an empty string");if(!d(n)||n instanceof Date||n instanceof h){const s=this.getValueDescription(n),a={action:"set",obj:t,insert:r,value:s.value,pred:o};return i?a.elemId=i:a.key=e,s.datatype&&(a.datatype=s.datatype),this.addOp(a),s}return this.createNestedObjects(t,e,n,r,o,i)}applyAtPath(t,e){let n={objectId:"_root",type:"map",props:{}};e(this.getSubpatch(n,t)),this.applyPatch(n,this.cache._root,this.updated)}setMapKey(t,e,n){if("string"!=typeof e)throw new RangeError("The key of a map entry must be a string, not "+typeof e);const r=0===t.length?"_root":t[t.length-1].objectId,o=this.getObject(r);if(o[e]instanceof h)throw new RangeError("Cannot overwrite a Counter object; use .increment() or .decrement() to change its value.");(o[e]!==n||Object.keys(o[i][e]||{}).length>1||void 0===n)&&this.applyAtPath(t,(t=>{const i=_(o,e),s=this.nextOpId(),a=this.setValue(r,e,n,!1,i);t.props[e]={[s]:a}}))}deleteMapKey(t,e){const n=0===t.length?"_root":t[t.length-1].objectId,r=this.getObject(n);if(void 0!==r[e]){const o=_(r,e);this.addOp({action:"del",obj:n,key:e,insert:!1,pred:o}),this.applyAtPath(t,(t=>{t.props[e]={}}))}}insertListItems(t,e,n,r){const o=r?[]:this.getObject(t.objectId);if(e<0||e>o.length)throw new RangeError(`List index ${e} is out of bounds for list of length ${o.length}`);let i=y(o,e,!0);if(n.every((t=>"string"==typeof t||"number"==typeof t||"boolean"==typeof t||null===t))&&n.length>1){let r=this.nextOpId();this.addOp({action:"set",obj:t.objectId,elemId:i,insert:!0,values:n,pred:[]}),t.edits.push({action:"multi-insert",elemId:r,index:e,values:n})}else for(let r=0;r<n.length;r++){let o=this.nextOpId();const s=this.setValue(t.objectId,e+r,n[r],!0,[],i);i=o,t.edits.push({action:"insert",index:e+r,elemId:i,opId:i,value:s})}}setListIndex(t,e,n){const r=0===t.length?"_root":t[t.length-1].objectId,o=this.getObject(r);if(e===o.length)return this.splice(t,e,0,[n]);if(e<0||e>o.length)throw new RangeError(`List index ${e} is out of bounds for list of length ${o.length}`);if(o[e]instanceof h)throw new RangeError("Cannot overwrite a Counter object; use .increment() or .decrement() to change its value.");(o[e]!==n||Object.keys(o[i][e]||{}).length>1||void 0===n)&&this.applyAtPath(t,(t=>{const i=_(o,e),s=this.nextOpId(),a=this.setValue(r,e,n,!1,i,y(o,e));t.edits.push({action:"update",index:e,opId:s,value:a})}))}splice(t,e,n,r){const o=0===t.length?"_root":t[t.length-1].objectId;let i=this.getObject(o);if(e<0||n<0||e>i.length-n)throw new RangeError(`${n} deletions starting at index ${e} are out of bounds for list of length ${i.length}`);if(0===n&&0===r.length)return;let s={objectId:"_root",type:"map",props:{}},a=this.getSubpatch(s,t);if(n>0){let r,s,u;for(let a=0;a<n;a++){if(this.getObjectField(t,o,e+a)instanceof h)throw new TypeError("Unsupported operation: deleting a counter from a list");const n=y(i,e+a),c=p(n),l=_(i,e+a),f=1===l.length?p(l[0]):void 0;r&&s&&u&&f&&s.actorId===c.actorId&&s.counter+1===c.counter&&u.actorId===f.actorId&&u.counter+1===f.counter?r.multiOp=(r.multiOp||1)+1:(r&&this.addOp(r),r={action:"del",obj:o,elemId:n,insert:!1,pred:l}),s=c,u=f}this.addOp(r),a.edits.push({action:"remove",index:e,count:n})}r.length>0&&this.insertListItems(a,e,r,!1),this.applyPatch(s,this.cache._root,this.updated)}addTableRow(t,e){if(!d(e)||Array.isArray(e))throw new TypeError("A table row must be an object");if(e[o])throw new TypeError("Cannot reuse an existing object as table row");if(e.id)throw new TypeError('A table row must not have an "id" property; it is generated automatically');const n=g(),r=this.setValue(t[t.length-1].objectId,n,e,!1,[]);return this.applyAtPath(t,(t=>{t.props[n]={[r.objectId]:r}})),n}deleteTableRow(t,e,n){const r=t[t.length-1].objectId;this.getObject(r).byId(e)&&(this.addOp({action:"del",obj:r,key:e,insert:!1,pred:[n]}),this.applyAtPath(t,(t=>{t.props[e]={}})))}increment(t,e,n){const r=0===t.length?"_root":t[t.length-1].objectId,o=this.getObject(r);if(!(o[e]instanceof h))throw new TypeError("Only counter values can be incremented");const i=this.getObjectType(r),s=o[e].value+n,a=this.nextOpId(),u=_(o,e);if("list"===i||"text"===i){const t=y(o,e,!1);this.addOp({action:"inc",obj:r,elemId:t,value:n,insert:!1,pred:u})}else this.addOp({action:"inc",obj:r,key:e,value:n,insert:!1,pred:u});this.applyAtPath(t,(t=>{"list"===i||"text"===i?t.edits.push({action:"update",index:e,opId:a,value:{value:s,datatype:"counter"}}):t.props[e]={[a]:{value:s,datatype:"counter"}}}))}}}},function(t,e,n){const{OBJECT_ID:r,CONFLICTS:o}=n(6);t.exports={Observable:class{constructor(){this.observers={}}patchCallback(t,e,n,r,o){this._objectUpdate(t.diffs,e,n,r,o)}_objectUpdate(t,e,n,r,i){if(t.objectId){if(this.observers[t.objectId])for(let o of this.observers[t.objectId])o(t,e,n,r,i);if("map"===t.type&&t.props)for(const s of Object.keys(t.props))for(const a of Object.keys(t.props[s]))this._objectUpdate(t.props[s][a],e&&e[o]&&e[o][s]&&e[o][s][a],n&&n[o]&&n[o][s]&&n[o][s][a],r,i);else if("table"===t.type&&t.props)for(const o of Object.keys(t.props))for(const s of Object.keys(t.props[o]))this._objectUpdate(t.props[o][s],e&&e.byId(o),n&&n.byId(o),r,i);else if("list"===t.type&&t.edits){let s=0;for(const a of t.edits)"insert"===a.action?(s-=1,this._objectUpdate(a.value,void 0,n&&n[o]&&n[o][a.index]&&n[o][a.index][a.elemId],r,i)):"multi-insert"===a.action?s-=a.values.length:"update"===a.action?this._objectUpdate(a.value,e&&e[o]&&e[o][a.index+s]&&e[o][a.index+s][a.opId],n&&n[o]&&n[o][a.index]&&n[o][a.index][a.opId],r,i):"remove"===a.action&&(s+=a.count)}else if("text"===t.type&&t.edits){let o=0;for(const s of t.edits)"insert"===s.action?(o-=1,this._objectUpdate(s.value,void 0,n&&n.get(s.index),r,i)):"multi-insert"===s.action?o-=s.values.length:"update"===s.action?this._objectUpdate(s.value,e&&e.get(s.index+o),n&&n.get(s.index),r,i):"remove"===s.action&&(o+=s.count)}}}observe(t,e){const n=t[r];if(!n)throw new TypeError("The observed object must be part of an Automerge document");this.observers[n]||(this.observers[n]=[]),this.observers[n].push(e)}}}},function(t,e,n){const r=n(16),{copyObject:o,parseOpId:i,equalBytes:s}=n(7),{utf8ToString:a,hexStringToBytes:u,bytesToHexString:c,Encoder:l,Decoder:h,RLEEncoder:f,RLEDecoder:d,DeltaEncoder:p,DeltaDecoder:g,BooleanEncoder:_,BooleanDecoder:y}=n(32),{Hash:b}=n(33),w=new Uint8Array([133,111,74,131]),m={GROUP_CARD:0,ACTOR_ID:1,INT_RLE:2,INT_DELTA:3,BOOLEAN:4,STRING_RLE:5,VALUE_LEN:6,VALUE_RAW:7},v={NULL:0,FALSE:1,TRUE:2,LEB128_UINT:3,LEB128_INT:4,IEEE754:5,UTF8:6,BYTES:7,COUNTER:8,TIMESTAMP:9,MIN_UNKNOWN:10,MAX_UNKNOWN:15},I=["makeMap","set","makeList","del","makeText","inc","makeTable","link"],k={makeMap:"map",makeList:"list",makeText:"text",makeTable:"table"},x={objActor:0|m.ACTOR_ID,objCtr:0|m.INT_RLE,keyActor:16|m.ACTOR_ID,keyCtr:16|m.INT_DELTA,keyStr:16|m.STRING_RLE,idActor:32|m.ACTOR_ID,idCtr:32|m.INT_DELTA,insert:48|m.BOOLEAN,action:64|m.INT_RLE,valLen:80|m.VALUE_LEN,valRaw:80|m.VALUE_RAW,chldActor:96|m.ACTOR_ID,chldCtr:96|m.INT_DELTA},E=Object.assign({predNum:112|m.GROUP_CARD,predActor:112|m.ACTOR_ID,predCtr:112|m.INT_DELTA},x),O=Object.assign({succNum:128|m.GROUP_CARD,succActor:128|m.ACTOR_ID,succCtr:128|m.INT_DELTA},x),A=Object.entries(O).reduce(((t,[e,n])=>(t[n]=e,t)),[]),S={actor:0|m.ACTOR_ID,seq:0|m.INT_DELTA,maxOp:16|m.INT_DELTA,time:32|m.INT_DELTA,message:48|m.STRING_RLE,depsNum:64|m.GROUP_CARD,depsIndex:64|m.INT_DELTA,extraLen:80|m.VALUE_LEN,extraRaw:80|m.VALUE_RAW};function j(t,e,n){if(1===e.length)t[e[0]]=n;else{let r=Object.assign({},t[e[0]]);j(r,e.slice(1),n),t[e[0]]=r}}function R(t,e){if(!t||!t.actorId)return t;const n=t.counter,r=e.indexOf(t.actorId);if(r<0)throw new RangeError("missing actorId");return{counter:n,actorNum:r,actorId:t.actorId}}function C(t,e){return t.counter<e.counter?-1:t.counter>e.counter?1:t.actorId<e.actorId?-1:t.actorId>e.actorId?1:0}function z(t,e){const n={},r=[];for(let e of t)e=o(e),n[e.actor]=!0,e.ops=$(e.ops,e.startOp,e.actor),e.ops=e.ops.map((t=>{"_root"!==(t=o(t)).obj&&(t.obj=i(t.obj)),t.elemId&&"_head"!==t.elemId&&(t.elemId=i(t.elemId)),t.child&&(t.child=i(t.child)),t.pred&&(t.pred=t.pred.map(i)),t.obj.actorId&&(n[t.obj.actorId]=!0),t.elemId&&t.elemId.actorId&&(n[t.elemId.actorId]=!0),t.child&&t.child.actorId&&(n[t.child.actorId]=!0);for(let e of t.pred)n[e.actorId]=!0;return t})),r.push(e);let s=Object.keys(n).sort();e&&(s=[t[0].actor].concat(s.filter((e=>e!==t[0].actor))));for(let t of r){t.actorNum=s.indexOf(t.actor);for(let e=0;e<t.ops.length;e++){let n=t.ops[e];n.id={counter:t.startOp+e,actorNum:t.actorNum,actorId:t.actor},n.obj=R(n.obj,s),n.elemId=R(n.elemId,s),n.child=R(n.child,s),n.pred=n.pred.map((t=>R(t,s)))}}return{changes:r,actorIds:s}}function V(t,e){if("_root"===t.obj)e.objActor.appendValue(null),e.objCtr.appendValue(null);else{if(!(t.obj.actorNum>=0&&t.obj.counter>0))throw new RangeError(`Unexpected objectId reference: ${JSON.stringify(t.obj)}`);e.objActor.appendValue(t.obj.actorNum),e.objCtr.appendValue(t.obj.counter)}}function L(t,e){if(t.key)e.keyActor.appendValue(null),e.keyCtr.appendValue(null),e.keyStr.appendValue(t.key);else if("_head"===t.elemId&&t.insert)e.keyActor.appendValue(null),e.keyCtr.appendValue(0),e.keyStr.appendValue(null);else{if(!(t.elemId&&t.elemId.actorNum>=0&&t.elemId.counter>0))throw new RangeError(`Unexpected operation key: ${JSON.stringify(t)}`);e.keyActor.appendValue(t.elemId.actorNum),e.keyCtr.appendValue(t.elemId.counter),e.keyStr.appendValue(null)}}function T(t,e){const n=I.indexOf(t.action);if(n>=0)e.action.appendValue(n);else{if("number"!=typeof t.action)throw new RangeError(`Unexpected operation action: ${t.action}`);e.action.appendValue(t.action)}}function U(t,e,n){let r;t<0||e>0?(r=n.valRaw.appendInt53(t),e||(e=v.LEB128_INT)):(r=n.valRaw.appendUint53(t),e=v.LEB128_UINT),n.valLen.appendValue(r<<4|e)}function D(t,e){if("set"!==t.action&&"inc"!==t.action||null===t.value)e.valLen.appendValue(v.NULL);else if(!1===t.value)e.valLen.appendValue(v.FALSE);else if(!0===t.value)e.valLen.appendValue(v.TRUE);else if("string"==typeof t.value){const n=e.valRaw.appendRawString(t.value);e.valLen.appendValue(n<<4|v.UTF8)}else if(ArrayBuffer.isView(t.value)){const n=e.valRaw.appendRawBytes(new Uint8Array(t.value.buffer));e.valLen.appendValue(n<<4|v.BYTES)}else if("counter"===t.datatype&&"number"==typeof t.value)U(t.value,v.COUNTER,e);else if("timestamp"===t.datatype&&"number"==typeof t.value)U(t.value,v.TIMESTAMP,e);else if("number"==typeof t.datatype&&t.datatype>=v.MIN_UNKNOWN&&t.datatype<=v.MAX_UNKNOWN&&t.value instanceof Uint8Array){const n=e.valRaw.appendRawBytes(t.value);e.valLen.appendValue(n<<4|t.datatype)}else{if(t.datatype)throw new RangeError(`Unknown datatype ${t.datatype} for value ${t.value}`);if("number"!=typeof t.value)throw new RangeError(`Unsupported value in operation: ${t.value}`);if(Number.isInteger(t.value)&&t.value<=Number.MAX_SAFE_INTEGER&&t.value>=Number.MIN_SAFE_INTEGER)U(t.value,0,e);else{const n=new ArrayBuffer(4),r=new DataView(n);if(r.setFloat32(0,t.value,!0),r.getFloat32(0,!0)===t.value)e.valRaw.appendRawBytes(new Uint8Array(n)),e.valLen.appendValue(64|v.IEEE754);else{const n=new ArrayBuffer(8);new DataView(n).setFloat64(0,t.value,!0),e.valRaw.appendRawBytes(new Uint8Array(n)),e.valLen.appendValue(128|v.IEEE754)}}}}function M(t,e){if(t===v.NULL)return{value:null};if(t===v.FALSE)return{value:!1};if(t===v.TRUE)return{value:!0};if(t%16===v.UTF8)return{value:a(e)};if(t%16===v.LEB128_UINT)return{value:new h(e).readUint53()};if(t%16===v.LEB128_INT)return{value:new h(e).readInt53()};if(t%16===v.IEEE754){const t=new DataView(e.buffer,e.byteOffset,e.byteLength);if(4===e.byteLength)return{value:t.getFloat32(0,!0)};if(8===e.byteLength)return{value:t.getFloat64(0,!0)};throw new RangeError(`Invalid length for floating point number: ${e.byteLength}`)}return t%16===v.COUNTER?{value:new h(e).readInt53(),datatype:"counter"}:t%16===v.TIMESTAMP?{value:new h(e).readInt53(),datatype:"timestamp"}:{value:e,datatype:t%16}}function N(t,e,n,r){const{columnId:o,columnName:i,decoder:s}=t[e];if(o%8===m.VALUE_LEN&&e+1<t.length&&t[e+1].columnId===o+1){const n=s.readValue(),o=t[e+1].decoder.readRawBytes(n>>4),{value:a,datatype:u}=M(n,o);return r[i]=a,u&&(r[i+"_datatype"]=u),2}if(o%8===m.ACTOR_ID){const t=s.readValue();if(null===t)r[i]=null;else{if(!n[t])throw new RangeError(`No actor index ${t}`);r[i]=n[t]}}else r[i]=s.readValue();return 1}function B(t,e){const n={objActor:new f("uint"),objCtr:new f("uint"),keyActor:new f("uint"),keyCtr:new p,keyStr:new f("utf8"),insert:new _,action:new f("uint"),valLen:new f("uint"),valRaw:new l,chldActor:new f("uint"),chldCtr:new p};e?(n.idActor=new f("uint"),n.idCtr=new p,n.succNum=new f("uint"),n.succActor=new f("uint"),n.succCtr=new p):(n.predNum=new f("uint"),n.predCtr=new p,n.predActor=new f("uint"));for(let r of t)if(V(r,n),L(r,n),n.insert.appendValue(!!r.insert),T(r,n),D(r,n),r.child&&r.child.counter?(n.chldActor.appendValue(r.child.actorNum),n.chldCtr.appendValue(r.child.counter)):(n.chldActor.appendValue(null),n.chldCtr.appendValue(null)),e){n.idActor.appendValue(r.id.actorNum),n.idCtr.appendValue(r.id.counter),n.succNum.appendValue(r.succ.length),r.succ.sort(C);for(let t=0;t<r.succ.length;t++)n.succActor.appendValue(r.succ[t].actorNum),n.succCtr.appendValue(r.succ[t].counter)}else{n.predNum.appendValue(r.pred.length),r.pred.sort(C);for(let t=0;t<r.pred.length;t++)n.predActor.appendValue(r.pred[t].actorNum),n.predCtr.appendValue(r.pred[t].counter)}let r=[];for(let[t,o]of Object.entries(e?O:E))n[t]&&r.push({id:o,name:t,encoder:n[t]});return r.sort(((t,e)=>t.id-e.id))}function $(t,e,n){let r=e,o=[];for(const e of t)if("set"===e.action&&e.values&&e.insert){if(0!==e.pred.length)throw new RangeError("multi-insert pred must be empty");let t=e.elemId;for(const i of e.values)o.push({action:"set",obj:e.obj,elemId:t,value:i,pred:[],insert:!0}),t=`${r}@${n}`,r+=1}else if("del"===e.action&&e.multiOp>1){if(1!==e.pred.length)throw new RangeError("multiOp deletion must have exactly one pred");const t=i(e.elemId),n=i(e.pred[0]);for(let i=0;i<e.multiOp;i++){const s=`${t.counter+i}@${t.actorId}`,a=[`${n.counter+i}@${n.actorId}`];o.push({action:"del",obj:e.obj,elemId:s,pred:a}),r+=1}}else o.push(e),r+=1;return o}function q(t,e){const n=[];for(let r of t){const t=null===r.objCtr?"_root":`${r.objCtr}@${r.objActor}`,o=r.keyStr?void 0:0===r.keyCtr?"_head":`${r.keyCtr}@${r.keyActor}`,i=I[r.action]||r.action,s=o?{obj:t,elemId:o,action:i}:{obj:t,key:r.keyStr,action:i};if(s.insert=!!r.insert,"set"!==I[r.action]&&"inc"!==I[r.action]||(s.value=r.valLen,r.valLen_datatype&&(s.datatype=r.valLen_datatype)),!!r.chldCtr!=!!r.chldActor)throw new RangeError(`Mismatched child columns: ${r.chldCtr} and ${r.chldActor}`);null!==r.chldCtr&&(s.child=`${r.chldCtr}@${r.chldActor}`),e?(s.id=`${r.idCtr}@${r.idActor}`,s.succ=r.succNum.map((t=>`${t.succCtr}@${t.succActor}`)),P(r.succNum.map((t=>({counter:t.succCtr,actorId:t.succActor}))))):(s.pred=r.predNum.map((t=>`${t.predCtr}@${t.predActor}`)),P(r.predNum.map((t=>({counter:t.predCtr,actorId:t.predActor}))))),n.push(s)}return n}function P(t){let e=null;for(let n of t){if(e&&-1!==C(e,n))throw new RangeError("operation IDs are not in ascending order");e=n}}function H(t){return(7&t)===m.INT_DELTA?new p:(7&t)===m.BOOLEAN?new _:(7&t)===m.STRING_RLE?new f("utf8"):(7&t)===m.VALUE_RAW?new l:new f("uint")}function K(t,e){return(7&t)===m.INT_DELTA?new g(e):(7&t)===m.BOOLEAN?new y(e):(7&t)===m.STRING_RLE?new d("utf8",e):(7&t)===m.VALUE_RAW?new h(e):new d("uint",e)}function F(t,e){const n=new Uint8Array(0),r={};for(let t of Object.values(e))r[t]=K(t,n);for(let e of t)r[e.columnId]=K(e.columnId,e.buffer);let o=[];for(let t of Object.keys(r).map((t=>parseInt(t,10))).sort(((t,e)=>t-e))){let[n]=Object.entries(e).find((([,e])=>e===t));n||(n=t.toString()),o.push({columnId:t,columnName:n,decoder:r[t]})}return o}function Z(t,e,n){t=F(t,n);let r=[];for(;t.some((t=>!t.decoder.done));){let n={},o=0;for(;o<t.length;){const r=t[o].columnId;let i=r>>4,s=1;for(;o+s<t.length&&t[o+s].columnId>>4===i;)s++;if(r%8===m.GROUP_CARD){const r=[],i=t[o].decoder.readValue();for(let n=0;n<i;n++){let n={};for(let r=1;r<s;r++)N(t,o+r,e,n);r.push(n)}n[t[o].columnName]=r,o+=s}else o+=N(t,o,e,n)}r.push(n)}return r}function W(t){const e=-9>>>0;let n=-1,r=[],o=t.readUint53();for(let i=0;i<o;i++){const o=t.readUint53(),i=t.readUint53();if((o&e)<=(n&e))throw new RangeError("Columns must be in ascending order");n=o,r.push({columnId:o,bufferLen:i})}return r}function G(t,e){const n=e.filter((t=>t.encoder.buffer.byteLength>0));t.appendUint53(n.length);for(let e of n)t.appendUint53(e.id),t.appendUint53(e.encoder.buffer.byteLength)}function J(t){const e=t.readUint53(),n=[];for(let r=0;r<e;r++)n.push(c(t.readRawBytes(32)));let r={actor:t.readHexString(),seq:t.readUint53(),startOp:t.readUint53(),time:t.readInt53(),message:t.readPrefixedString(),deps:n};const o=[r.actor],i=t.readUint53();for(let e=0;e<i;e++)o.push(t.readHexString());return r.actorIds=o,r}function Y(t,e){const n=w.byteLength+4+1+5,r=new l;r.appendRawBytes(new Uint8Array(n)),e(r);const o=r.buffer,i=new l;i.appendByte(t),i.appendUint53(o.byteLength-n);const s=i.buffer,a=new b;a.update(s),a.update(o.subarray(n));const u=a.digest(),c=u.subarray(0,4);return o.set(w,n-s.byteLength-4-w.byteLength),o.set(c,n-s.byteLength-4),o.set(s,n-s.byteLength),{hash:u,bytes:o.subarray(n-s.byteLength-4-w.byteLength)}}function X(t,e){if(!s(t.readRawBytes(w.byteLength),w))throw new RangeError("Data does not begin with magic bytes 85 6f 4a 83");const n=t.readRawBytes(4),r=t.offset,o=t.readByte(),i=t.readUint53(),a={chunkType:o,chunkLength:i,chunkData:t.readRawBytes(i)};if(e){const e=new b;e.update(t.buf.subarray(r,t.offset));const o=e.digest();if(!s(o.subarray(0,4),n))throw new RangeError("checksum does not match data");a.hash=c(o)}return a}function Q(t){const{changes:e,actorIds:n}=z([t],!0),o=e[0],{hash:i,bytes:s}=Y(1,(t=>{if(!Array.isArray(o.deps))throw new TypeError("deps is not an array");t.appendUint53(o.deps.length);for(let e of o.deps.slice().sort())t.appendRawBytes(u(e));t.appendHexString(o.actor),t.appendUint53(o.seq),t.appendUint53(o.startOp),t.appendInt53(o.time),t.appendPrefixedString(o.message||""),t.appendUint53(n.length-1);for(let e of n.slice(1))t.appendHexString(e);const e=B(o.ops,!1);G(t,e);for(let n of e)t.appendRawBytes(n.encoder.buffer);o.extraBytes&&t.appendRawBytes(o.extraBytes)})),a=c(i);if(t.hash&&t.hash!==a)throw new RangeError(`Change hash does not match encoding: ${t.hash} != ${a}`);return s.byteLength>=256?function(t){const e=X(new h(t),!1);if(1!==e.chunkType)throw new RangeError(`Unexpected chunk type: ${e.chunkType}`);const n=r.deflateRaw(e.chunkData),o=new l;return o.appendRawBytes(t.subarray(0,8)),o.appendByte(2),o.appendUint53(n.byteLength),o.appendRawBytes(n),o.buffer}(s):s}function tt(t){const e=new h(t),n=X(e,!0),r=new h(n.chunkData);if(!e.done)throw new RangeError("Encoded change has trailing data");if(1!==n.chunkType)throw new RangeError(`Unexpected chunk type: ${n.chunkType}`);const o=J(r),i=W(r);for(let t=0;t<i.length;t++){if(0!=(8&i[t].columnId))throw new RangeError("change must not contain deflated columns");i[t].buffer=r.readRawBytes(i[t].bufferLen)}if(!r.done){const t=r.buf.byteLength-r.offset;o.extraBytes=r.readRawBytes(t)}return o.columns=i,o.hash=n.hash,o}function et(t){2===t[8]&&(t=nt(t));const e=tt(t);return e.ops=q(Z(e.columns,e.actorIds,E),!1),delete e.actorIds,delete e.columns,e}function nt(t){const e=X(new h(t),!1);if(2!==e.chunkType)throw new RangeError(`Unexpected chunk type: ${e.chunkType}`);const n=r.inflateRaw(e.chunkData),o=new l;return o.appendRawBytes(t.subarray(0,8)),o.appendByte(1),o.appendUint53(n.byteLength),o.appendRawBytes(n),o.buffer}function rt(t){let e=new h(t),n=[],r=0;for(;!e.done;)X(e,!1),n.push(t.subarray(r,e.offset)),r=e.offset;return n}function ot(t){let e=[];for(let n of t)for(let t of rt(n))0===t[8]?e=e.concat(ut(t)):1!==t[8]&&2!==t[8]||e.push(et(t));return e}function it(t,e){if(t===e)return 0;if("_root"===t)return-1;if("_root"===e)return 1;const n=i(t),r=i(e);return n.counter<r.counter?-1:n.counter>r.counter?1:n.actorId<r.actorId?-1:n.actorId>r.actorId?1:0}function st(t){const{changes:e,actorIds:n}=z(ot(t),!1),{changesColumns:r,heads:o}=function(t){const e={actor:new f("uint"),seq:new p,maxOp:new p,time:new p,message:new f("utf8"),depsNum:new f("uint"),depsIndex:new p,extraLen:new f("uint"),extraRaw:new l};let n={},r={};for(let o=0;o<t.length;o++){const i=t[o];n[i.hash]=o,r[i.hash]=!0,e.actor.appendValue(i.actorNum),e.seq.appendValue(i.seq),e.maxOp.appendValue(i.startOp+i.ops.length-1),e.time.appendValue(i.time),e.message.appendValue(i.message),e.depsNum.appendValue(i.deps.length);for(let t of i.deps){if("number"!=typeof n[t])throw new RangeError(`Unknown dependency hash: ${t}`);e.depsIndex.appendValue(n[t]),r[t]&&delete r[t]}i.extraBytes?(e.extraLen.appendValue(i.extraBytes.byteLength<<4|v.BYTES),e.extraRaw.appendRawBytes(i.extraBytes)):e.extraLen.appendValue(v.BYTES)}let o=[];for(let[t,n]of Object.entries(S))o.push({id:n,name:t,encoder:e[t]});return o.sort(((t,e)=>t.id-e.id)),{changesColumns:o,heads:Object.keys(r).sort()}}(e),i=B(function(t){let e={},n={},r={};for(let o of t)for(let t=0;t<o.ops.length;t++){const i=o.ops[t],s=`${i.id.counter}@${i.id.actorId}`,a="_root"===i.obj?"_root":`${i.obj.counter}@${i.obj.actorId}`;let u;if(i.action.startsWith("make")&&(r[s]=i.action,"makeList"!==i.action&&"makeText"!==i.action||(n[s]={_head:[]})),"_root"===a||"makeMap"===r[a]||"makeTable"===r[a])u=i.key;else{if("makeList"!==r[a]&&"makeText"!==r[a])throw new RangeError(`Unknown object type for object ${a}`);if(i.insert){u=s;const t="_head"===i.elemId?"_head":`${i.elemId.counter}@${i.elemId.actorId}`;n[a][t].push(s),n[a][s]=[]}else u=`${i.elemId.counter}@${i.elemId.actorId}`}e[a]||(e[a]={}),e[a][u]||(e[a][u]={}),e[a][u][s]=i,i.succ=[];for(let t of i.pred){const n=`${t.counter}@${t.actorId}`;if(!e[a][u][n])throw new RangeError(`No predecessor operation ${n}`);e[a][u][n].succ.push(i.id)}}let o=[];for(let t of Object.keys(e).sort(it)){let i=[];if("makeList"===r[t]||"makeText"===r[t]){let e=["_head"];for(;e.length>0;){const r=e.pop();"_head"!==r&&i.push(r);for(let o of n[t][r].sort(it))e.push(o)}}else i=Object.keys(e[t]).sort();for(let n of i)for(let r of Object.keys(e[t][n]).sort(it)){const i=e[t][n][r];"del"!==i.action&&o.push(i)}}return o}(e),!0);for(let t of r)ct(t);for(let t of i)ct(t);return Y(0,(t=>{t.appendUint53(n.length);for(let e of n)t.appendHexString(e);t.appendUint53(o.length);for(let e of o.sort())t.appendRawBytes(u(e));G(t,r),G(t,i);for(let e of r)t.appendRawBytes(e.encoder.buffer);for(let e of i)t.appendRawBytes(e.encoder.buffer)})).bytes}function at(t){const e=new h(t),n=X(e,!0),r=new h(n.chunkData);if(!e.done)throw new RangeError("Encoded document has trailing data");if(0!==n.chunkType)throw new RangeError(`Unexpected chunk type: ${n.chunkType}`);const o=[],i=r.readUint53();for(let t=0;t<i;t++)o.push(r.readHexString());const s=[],a=r.readUint53();for(let t=0;t<a;t++)s.push(c(r.readRawBytes(32)));const u=W(r),l=W(r);for(let t=0;t<u.length;t++)u[t].buffer=r.readRawBytes(u[t].bufferLen),lt(u[t]);for(let t=0;t<l.length;t++)l[t].buffer=r.readRawBytes(l[t].bufferLen),lt(l[t]);return{changesColumns:u,opsColumns:l,actorIds:o,heads:s,extraBytes:r.readRawBytes(r.buf.byteLength-r.offset)}}function ut(t){const{changesColumns:e,opsColumns:n,actorIds:r,heads:o}=at(t),s=Z(e,r,S);return function(t,e){let n={};for(let e of t){if(e.ops=[],n[e.actor]||(n[e.actor]=[]),e.seq!==n[e.actor].length+1)throw new RangeError(`Expected seq = ${n[e.actor].length+1}, got ${e.seq}`);if(e.seq>1&&n[e.actor][e.seq-2].maxOp>e.maxOp)throw new RangeError("maxOp must increase monotonically per actor");n[e.actor].push(e)}let r={};for(let t of e){if("del"===t.action)throw new RangeError("document should not contain del operations");t.pred=r[t.id]?r[t.id].pred:[],r[t.id]=t;for(let e of t.succ){if(!r[e])if(t.elemId){const n=t.insert?t.id:t.elemId;r[e]={id:e,action:"del",obj:t.obj,elemId:n,pred:[]}}else r[e]={id:e,action:"del",obj:t.obj,key:t.key,pred:[]};r[e].pred.push(t.id)}delete t.succ}for(let t of Object.values(r))"del"===t.action&&e.push(t);for(let t of e){const{counter:e,actorId:r}=i(t.id),o=n[r];let s=0,a=o.length;for(;s<a;){const t=Math.floor((s+a)/2);o[t].maxOp<e?s=t+1:a=t}if(s>=o.length)throw new RangeError(`Operation ID ${t.id} outside of allowed range`);o[s].ops.push(t)}for(let e of t){e.ops.sort(((t,e)=>it(t.id,e.id))),e.startOp=e.maxOp-e.ops.length+1,delete e.maxOp;for(let t=0;t<e.ops.length;t++){const n=e.ops[t],r=`${e.startOp+t}@${e.actor}`;if(n.id!==r)throw new RangeError(`Expected opId ${r}, got ${n.id}`);delete n.id}}}(s,q(Z(n,r,O),!0)),function(t,e){let n={};for(let e=0;e<t.length;e++){let r=t[e];r.deps=[];for(let o of r.depsNum.map((t=>t.depsIndex))){if(!t[o]||!t[o].hash)throw new RangeError(`No hash for index ${o} while processing index ${e}`);const i=t[o].hash;r.deps.push(i),n[i]&&delete n[i]}if(r.deps.sort(),delete r.depsNum,r.extraLen_datatype!==v.BYTES)throw new RangeError(`Bad datatype for extra bytes: ${v.BYTES}`);r.extraBytes=r.extraLen,delete r.extraLen_datatype,t[e]=et(Q(r)),n[t[e].hash]=!0}const r=Object.keys(n).sort();let o=r.length===e.length,i=0;for(;o&&i<r.length;)o=r[i]===e[i],i++;if(!o)throw new RangeError(`Mismatched heads hashes: expected ${e.join(", ")}, got ${r.join(", ")}`)}(s,o),s}function ct(t){t.encoder.buffer.byteLength>=256&&(t.encoder={buffer:r.deflateRaw(t.encoder.buffer)},t.id|=8)}function lt(t){0!=(8&t.columnId)&&(t.buffer=r.inflateRaw(t.buffer),t.columnId^=8)}function ht(t,e){let n={},r=null;for(let o of e.ops)if("set"===o.actionName&&"counter"===o.value.datatype){r||(r={opId:o.opId,value:0,succ:{}}),r.value+=o.value.value;for(let t of o.succ)r.succ[t]=!0}else if("inc"===o.actionName){if(!r)throw new RangeError(`inc operation ${o.opId} without a counter`);r.value+=o.value.value,delete r.succ[o.opId];for(let t of o.succ)r.succ[t]=!0}else if(0===o.succ.length)if(o.actionName.startsWith("make"))n[o.opId]=t[o.opId];else if("set"===o.actionName)n[o.opId]={value:o.value.value,type:"value"},o.value.datatype&&(n[o.opId].datatype=o.value.datatype);else{if("link"!==o.actionName)throw new RangeError(`Unexpected action type: ${o.actionName}`);if(!o.childId)throw new RangeError(`link operation ${o.opId} without a childId`);n[o.opId]=t[o.childId]}if(r&&0===Object.keys(r.succ).length&&(n[r.opId]={type:"value",value:r.value,datatype:"counter"}),Object.keys(n).length>0){let r=t[e.objId];return"map"===r.type||"table"===r.type?r.props[e.key]=n:"list"!==r.type&&"text"!==r.type||function(t,e,n,r){let o=!0;const s=Object.keys(e).sort(((t,e)=>C(i(t),i(e))));for(const i of s)o?t.edits.push({action:"insert",value:e[i],elemId:n,opId:i,index:r}):t.edits.push({action:"update",value:e[i],opId:i,index:r}),o=!1}(r,n,e.key,e.index),!0}return!1}function ft(t){if("list"===t.type||"text"===t.type){t.edits.forEach((t=>ft(t.value)));let e=t.edits;t.edits=[];for(const n of e)dt(t.edits,n)}else if("map"===t.type||"table"===t.type)for(const e of Object.keys(t.props))for(const n of Object.keys(t.props[e]))ft(t.props[e][n])}function dt(t,e){if(0===t.length)return void t.push(e);let n=t[t.length-1];"insert"===n.action&&"insert"===e.action&&n.index===e.index-1&&"value"===n.value.type&&"value"===e.value.type&&n.elemId===n.opId&&e.elemId===e.opId&&pt(n.elemId,e.elemId,1)?(n.action="multi-insert",n.values=[n.value.value,e.value.value],delete n.value,delete n.opId):"multi-insert"===n.action&&"insert"===e.action&&n.index+n.values.length===e.index&&"value"===e.value.type&&e.elemId===e.opId&&pt(n.elemId,e.elemId,n.values.length)?n.values.push(e.value.value):"remove"===n.action&&"remove"===e.action&&n.index===e.index?n.count+=e.count:t.push(e)}function pt(t,e,n=1){const r=i(t),o=i(e);return r.actorId===o.actorId&&r.counter+n===o.counter}function gt(t,e,n){const{objActor:r,objCtr:o,keyActor:i,keyCtr:s,keyStr:a,idActor:u,idCtr:c,insert:l}=t,[h,f,,,d,p,g,_,y,,,,,b]=e.map((t=>t.decoder));let w=0,m=0,v=!1,I=null,k=null,x=null,E=null,O=null,A=null,S=0;if(null!==o)for(;(!f.done||!h.done||!y.done)&&(k=f.readValue(),I=n[h.readValue()],y.skipValues(1),null===k||!I||k<o||k===o&&I<r);)w+=1;if(k!==o||I!==r)return{skipCount:w,visibleCount:m};if(null!==a){for(d.skipValues(w);!d.done;){const t=h.readValue();if(I=null===t?null:n[t],k=f.readValue(),O=d.readValue(),!(null!==O&&O<a&&k===o&&I===r))break;w+=1}return{skipCount:w,visibleCount:m}}if(g.skipValues(w),p.skipValues(w),_.skipValues(w),b.skipValues(w),E=g.readValue(),x=n[p.readValue()],A=_.readValue(),S=b.readValue(),l){if(null!==s&&s>0&&null!==i){for(w+=1;!(g.done||p.done||E===s&&x===i)&&(A&&(v=!1),0!==S||v||(m+=1,v=!0),E=g.readValue(),x=n[p.readValue()],k=f.readValue(),I=n[h.readValue()],A=_.readValue(),S=b.readValue(),k===o&&I===r);)w+=1;if(k!==o||I!==r||E!==s||x!==i||!A)throw new RangeError(`Reference element not found: ${s}@${i}`);if(A&&(v=!1),0!==S||v||(m+=1,v=!0),g.done||p.done)return{skipCount:w,visibleCount:m};E=g.readValue(),x=n[p.readValue()],k=f.readValue(),I=n[h.readValue()],A=_.readValue(),S=b.readValue()}for(;(!A||E>c||E===c&&x>u)&&k===o&&I===r&&(w+=1,A&&(v=!1),0!==S||v||(m+=1,v=!0),!g.done&&!p.done);)E=g.readValue(),x=n[p.readValue()],k=f.readValue(),I=n[h.readValue()],A=_.readValue(),S=b.readValue()}else if(null!==s&&s>0&&null!==i){for(;!(A&&E===s&&x===i||k!==o||I!==r||(w+=1,A&&(v=!1),0!==S||v||(m+=1,v=!0),g.done||p.done));)E=g.readValue(),x=n[p.readValue()],k=f.readValue(),I=n[h.readValue()],A=_.readValue(),S=b.readValue();if(k!==o||I!==r||E!==s||x!==i||!A)throw new RangeError(`Element not found for update: ${s}@${i}`)}return{skipCount:w,visibleCount:m}}function _t(t,e,n){if(0===n)return;let r=0,o=-1,i=0,s=-1,a=0;for(let u of t){for(;r<e.length&&e[r].columnId<u.columnId;)r++;let t=null;r<e.length&&e[r].columnId===u.columnId&&e[r].decoder.buf.byteLength>0&&(t=e[r].decoder);const c=u.columnId>>4===o?i:n;if(u.columnId%8===m.GROUP_CARD)o=u.columnId>>4,t?i=u.encoder.copyFrom(t,{count:n,sumValues:!0}).sum:(u.encoder.appendValue(0,n),i=0);else if(u.columnId%8===m.VALUE_LEN)if(t){if(r+1===e.length||e[r+1].columnId!==u.columnId+1)throw new RangeError("VALUE_LEN column without accompanying VALUE_RAW column");s=u.columnId+1,a=u.encoder.copyFrom(t,{count:c,sumValues:!0,sumShift:4}).sum}else u.encoder.appendValue(null,c),s=u.columnId+1,a=0;else if(u.columnId%8===m.VALUE_RAW){if(u.columnId!==s)throw new RangeError("VALUE_RAW column without accompanying VALUE_LEN column");a>0&&u.encoder.appendRawBytes(t.readRawBytes(a))}else if(t)u.encoder.copyFrom(t,{count:c});else{const t=u.columnId%8!==m.BOOLEAN&&null;u.encoder.appendValue(t,c)}}}function yt(t,e){let n,r=[],o=-1,i=0,s=-1,a=0;for(let u of t){if(u.columnId%8===m.VALUE_RAW){if(u.columnId!==s)throw new RangeError("unexpected VALUE_RAW column");n=u.decoder.readRawBytes(a)}else if(u.columnId%8===m.GROUP_CARD)o=u.columnId>>4,i=u.decoder.readValue()||0,n=i;else if(u.columnId>>4===o){n=[],u.columnId%8===m.VALUE_LEN&&(s=u.columnId+1,a=0);for(let t=0;t<i;t++){let t=u.decoder.readValue();u.columnId%8===m.ACTOR_ID&&e&&"number"==typeof t&&(t=e[t]),u.columnId%8===m.VALUE_LEN&&(a+=n>>>4),n.push(t)}}else n=u.decoder.readValue(),u.columnId%8===m.ACTOR_ID&&e&&"number"==typeof n&&(n=e[n]),u.columnId%8===m.VALUE_LEN&&(s=u.columnId+1,a=n>>>4);r.push(n)}return r}function bt(t,e,n){let r=0,o=-1,i=0;for(let s of t){for(;r<e.length&&e[r].columnId<s.columnId;)r++;if(r<e.length&&e[r].columnId===s.columnId){const t=n[r];if(s.columnId%8===m.GROUP_CARD)o=s.columnId>>4,i=t,s.encoder.appendValue(t);else if(s.columnId>>4===o){if(!Array.isArray(t)||t.length!==i)throw new RangeError("bad group value");for(let e of t)s.encoder.appendValue(e)}else s.columnId%8===m.VALUE_RAW?s.encoder.appendRawBytes(t):s.encoder.appendValue(t)}else if(s.columnId%8===m.GROUP_CARD)o=s.columnId>>4,i=0,s.encoder.appendValue(0);else if(s.columnId%8!==m.VALUE_RAW){const t=s.columnId>>4===o?i:1;let e=null;s.columnId%8===m.BOOLEAN&&(e=!1),s.columnId%8===m.VALUE_LEN&&(e=0),s.encoder.appendValue(e,t)}}}function wt(t,e,n){const r=t.actorIds[0],[o,i,s,a,u,,,c,l]=e.map((t=>t.decoder));let h={},f=null,d=null,p=t.startOp,g=[],_={};for(;!l.done;){const e=o.readValue(),y=s.readValue(),b={objActor:null===e?null:t.actorIds[e],objCtr:i.readValue(),keyActor:null===y?null:t.actorIds[y],keyCtr:a.readValue(),keyStr:u.readValue(),idActor:r,idCtr:p,insert:c.readValue(),action:l.readValue(),idActorIndex:-1,consecutiveOps:1};if(null===b.objCtr&&null!==b.objActor||null!==b.objCtr&&"string"!=typeof b.objActor)throw new RangeError(`Mismatched object reference: (${b.objCtr}, ${b.objActor})`);if(null===b.keyCtr&&null!==b.keyActor||0===b.keyCtr&&null!==b.keyActor||b.keyCtr>0&&"string"!=typeof b.keyActor)throw new RangeError(`Mismatched operation key: (${b.keyCtr}, ${b.keyActor})`);if(b.opId=`${b.idCtr}@${b.idActor}`,b.objId=null===b.objCtr?"_root":`${b.objCtr}@${b.objActor}`,_[b.objId]=!0,b.action%2==0){let t;t=null!==b.keyStr?b.keyStr:b.insert?b.opId:`${b.keyCtr}@${b.keyActor}`;const e=b.action<I.length?k[I[b.action]]:null;n[b.opId]={parentObj:b.objId,parentKey:t,opId:b.opId,type:e,children:{}},_[b.opId]=!0,j(n,[b.objId,"children",t,b.opId],{objectId:b.opId,type:e,props:{}})}f?b.objActor===d.objActor&&b.objCtr===d.objCtr&&(null!==b.keyStr&&null!==d.keyStr&&d.keyStr<=b.keyStr||null===b.keyStr&&null===d.keyStr&&!d.insert&&!b.insert||null===b.keyStr&&null===d.keyStr&&d.insert&&b.insert&&b.keyActor===d.idActor&&b.keyCtr===d.idCtr)?(f.consecutiveOps+=1,d=b):(h[b.objId]=!0,g.push(f),f=b,d=b):(f=b,d=b),p+=1}return f&&g.push(f),{opSequences:g,objectIds:Object.keys(_)}}class mt{constructor(t){if(this.maxOp=0,this.changes=[],this.changeByHash={},this.hashesByActor={},this.actorIds=[],this.heads=[],this.clock={},t){const e=at(t);for(let e of ot([t])){const t=Q(e);this.changes.push(t),this.changeByHash[e.hash]=t,this.clock[e.actor]=Math.max(e.seq,this.clock[e.actor]||0)}this.actorIds=e.actorIds,this.heads=e.heads,this.docColumns=F(e.opsColumns,O),this.numOps=0,this.objectMeta={}}else this.docColumns=F([],O),this.numOps=0,this.objectMeta={_root:{parentObj:null,parentKey:null,opId:null,type:"map",children:{}}}}clone(){let t=new mt;return t.maxOp=this.maxOp,t.changes=this.changes,t.changeByHash=this.changeByHash,t.actorIds=this.actorIds,t.heads=this.heads,t.clock=this.clock,t.docColumns=this.docColumns,t.numOps=this.numOps,t.objectMeta=this.objectMeta,t}updatePatchProperty(t,e,n,r,o,i,s){const a=e.objId,u=n[4]?n[4]:n[7]?`${n[6]}@${r.actorIds[n[5]]}`:`${n[3]}@${r.actorIds[n[2]]}`,c=void 0!==s&&n[13]>0;t[a]||(t[a]={objectId:a,type:r.objectMeta[a].type,props:{}});let l=t[a];if(null===n[4]?(l.edits||(l.edits=[]),c||(o[u]?"remove"===o[u].action&&(l.edits.pop(),o[u].action="update"):(l.edits.push({action:"insert",index:i,elemId:u}),o[u]={action:"insert",visibleOps:[],hasChild:!1})),0===s&&(o[u]?"insert"===o[u].action&&(l.edits.pop(),o[u].action="update"):(l.edits.push({action:"remove",index:i}),o[u]={action:"remove",visibleOps:[],hasChild:!1})),!l.props[i]&&o[u]&&["insert","update"].includes(o[u].action)&&(l.props[i]={})):l.props[n[4]]||(l.props[n[4]]={}),!c&&(o[u]||(o[u]={visibleOps:[],hasChild:!1}),o[u].visibleOps.push(n),o[u].hasChild=o[u].hasChild||n[8]%2==0,o[u].hasChild)){let t={};for(let e of o[u].visibleOps){const n=`${e[6]}@${r.actorIds[e[5]]}`;if("set"===I[e[8]])t[n]=M(e[9],e[10]);else if(e[8]%2==0){const r=e[8]<I.length?k[I[e[8]]]:null;t[n]={objectId:n,type:r,props:{}}}}j(r.objectMeta,[a,"children",u],t)}const h=`${n[6]}@${r.actorIds[n[5]]}`,f=null!==n[4]?n[4]:i;if(c&&"set"===I[n[8]]&&(15&n[9])===v.COUNTER){o[u]||(o[u]={visibleOps:[],hasChild:!1}),o[u].counterStates||(o[u].counterStates={});let t=o[u].counterStates,e={opId:h,value:M(n[9],n[10]).value,succs:{}};for(let o=0;o<n[13];o++){const i=`${n[15][o]}@${r.actorIds[n[14][o]]}`;t[i]=e,e.succs[i]=!0}}else if("inc"===I[n[8]]){if(!o[u]||!o[u].counterStates||!o[u].counterStates[h])throw new RangeError(`increment operation ${h} for unknown counter`);let t=o[u].counterStates[h];t.value+=M(n[9],n[10]).value,delete t.succs[h],0===Object.keys(t.succs).length&&l.props[f]&&(l.props[f][t.opId]={datatype:"counter",value:t.value})}else if(l.props[f]&&!c)if("set"===I[n[8]])l.props[f][h]=M(n[9],n[10]);else if(n[8]%2==0){if(!t[h]){const e=n[8]<I.length?k[I[n[8]]]:null;t[h]={objectId:h,type:e,props:{}}}l.props[f][h]=t[h]}}mergeDocChangeOps(t,e,n,r,o,i){if(o.opsCols[0].columnId!==O.objActor||r[0].columnId!==E.objActor||o.opsCols[1].columnId!==O.objCtr||r[1].columnId!==E.objCtr||o.opsCols[2].columnId!==O.keyActor||r[2].columnId!==E.keyActor||o.opsCols[3].columnId!==O.keyCtr||r[3].columnId!==E.keyCtr||o.opsCols[4].columnId!==O.keyStr||r[4].columnId!==E.keyStr||o.opsCols[5].columnId!==O.idActor||r[5].columnId!==E.idActor||o.opsCols[6].columnId!==O.idCtr||r[6].columnId!==E.idCtr||o.opsCols[7].columnId!==O.insert||r[7].columnId!==E.insert||o.opsCols[8].columnId!==O.action||r[8].columnId!==E.action||o.opsCols[9].columnId!==O.valLen||r[9].columnId!==E.valLen||o.opsCols[10].columnId!==O.valRaw||r[10].columnId!==E.valRaw||o.opsCols[13].columnId!==O.succNum||r[13].columnId!==E.predNum||o.opsCols[14].columnId!==O.succActor||r[14].columnId!==E.predActor||o.opsCols[15].columnId!==O.succCtr||r[15].columnId!==E.predCtr)throw new RangeError("unexpected columnId");let s=n.consecutiveOps,a=0,u=n.idCtr,c=!1,l=!1,h={},f=o.opsCols[8].decoder.done?null:yt(o.opsCols),d=null===f?0:1,p=null===f?0:f[13],g=null,_=null,y=[],b=[];for(;;){if(0===y.length)for(c=!1;0===y.length||n.insert||null!==_[4]&&_[4]===y[0][4]||null===_[4]&&_[2]===y[0][2]&&_[3]===y[0][3];){if(null!==_&&(y.push(_),b.push(new Array(_[13]))),0===s){_=null;break}_=yt(r,o.actorTable),_[5]=n.idActorIndex,_[6]=u,s--,u++}y.length>0&&(g=y[0]);const w=f&&f[0]===g[0]&&f[1]===g[1],m=f&&null!==f[4]&&f[4]===g[4],v=f&&null===f[4]&&null===g[4]&&(!f[7]&&f[2]===g[2]&&f[3]===g[3]||f[7]&&f[5]===g[2]&&f[6]===g[3]);if(0===y.length&&(!w||!m&&!v))break;let k=!1,x=0;if(n.insert||!w||null===f[4]&&null!==g[4]||null!==f[4]&&null!==g[4]&&g[4]<f[4]){if(x=y.length,!w&&!c&&null===g[4]&&!g[7])throw new RangeError(`could not find list element with ID: ${g[3]}@${o.actorIds[g[2]]}`)}else if(m||v||c){for(let t=0;t<y.length;t++){const e=y[t];for(let r=0;r<e[13];r++)if(e[14][r]===f[5]&&e[15][r]===f[6]){let i=0;for(;i<f[13]&&(f[15][i]<e[6]||f[15][i]===e[6]&&o.actorIds[f[14][i]]<n.idActor);)i++;f[15].splice(i,0,e[6]),f[14].splice(i,0,n.idActorIndex),f[13]++,b[t][r]=!0;break}}if(v&&(c=!0),c&&!v)x=y.length;else if(0===y.length||f[6]<g[6]||f[6]===g[6]&&o.actorIds[f[5]]<n.idActor){k=!0,this.updatePatchProperty(t,n,f,o,h,i,p);for(let t=y.length-1;t>=0;t--){let e=!0;for(let n=0;n<y[t][13];n++)b[t][n]||(e=!1);"del"===I[y[t][8]]&&e&&(y.splice(t,1),b.splice(t,1))}}else{if(f[6]===g[6]&&o.actorIds[f[5]]===n.idActor)throw new RangeError(`duplicate operation ID: ${g[6]}@${n.idActor}`);x=1}}else k=!0;if(k&&(bt(e,o.opsCols,f),f[7]&&l&&(l=!1,i++),0===f[13]&&(l=!0),a++,f=o.opsCols[8].decoder.done?null:yt(o.opsCols),null!==f&&(d++,p=f[13])),x>0){for(let s=0;s<x;s++){let a=y[s];for(let t=0;t<a[13];t++)if(!b[s][t])throw new RangeError(`no matching operation for pred: ${a[15][t]}@${o.actorIds[a[14][t]]}`);this.updatePatchProperty(t,n,a,o,h,i),bt(e,r,a),a[7]?(l=!1,i++):l=!0}x===y.length?(y.length=0,b.length=0):(y.splice(0,x),b.splice(0,x)),a+=x}}return f&&(bt(e,o.opsCols,f),a++),{opsAppended:a,docOpsConsumed:d}}applyOps(t,e,n,r){for(let t of r.opsCols)t.decoder.reset();const{skipCount:o,visibleCount:i}=gt(e,r.opsCols,r.actorIds);if(r.lastIndex[e.objId]&&i<r.lastIndex[e.objId])throw new RangeError("list element accesses must occur in ascending order");r.lastIndex[e.objId]=i;for(let t of r.opsCols)t.decoder.reset();let s=r.allCols.map((t=>({columnId:t,encoder:H(t)})));_t(s,r.opsCols,o);const{opsAppended:a,docOpsConsumed:u}=this.mergeDocChangeOps(t,s,e,n,r,i);_t(s,r.opsCols,r.numOps-o-u);for(let t of r.opsCols)if(!t.decoder.done)throw new RangeError(`excess ops in ${t.columnName} column`);r.opsCols=s.map((t=>{const e=K(t.columnId,t.encoder.buffer);return{columnId:t.columnId,columnName:A[t.columnId],decoder:e}})),r.numOps=r.numOps+a-u}getAllColumns(t){const e=["objActor","objCtr","keyActor","keyCtr","keyStr","idActor","idCtr","insert","action","valLen","valRaw","chldActor","chldCtr","predNum","predActor","predCtr"];let n={};for(let n=0;n<e.length;n++)if(t[n].columnName!==e[n])throw new RangeError(`Expected column ${e[n]} at index ${n}, got ${t[n].columnName}`);for(let e of t)n[e.columnId]=!0;for(let t of Object.values(O))n[t]=!0;return delete n[E.predNum],delete n[E.predActor],delete n[E.predCtr],Object.keys(n).map((t=>parseInt(t,10))).sort(((t,e)=>t-e))}getActorTable(t,e){if(t.indexOf(e.actorIds[0])<0){if(1!==e.seq)throw new RangeError(`Seq ${e.seq} is the first change for actor ${e.actorIds[0]}`);t=t.concat([e.actorIds[0]])}const n=[];for(let r of e.actorIds){const e=t.indexOf(r);if(e<0)throw new RangeError(`actorId ${r} is not known to document`);n.push(e)}return{actorIds:t,actorTable:n}}setupPatches(t,e,n){for(let r of e){let e=n.objectMeta[r],o=null,s=!1;for(;;){if(t[r]||(t[r]={objectId:r,type:e.type,props:{}}),o){let a=o.parentKey;if("list"===e.type||"text"===e.type){const t=i(r),e=i(a),o={objActor:t.actorId,objCtr:t.counter,keyActor:e.actorId,keyCtr:e.counter,keyStr:null,insert:!1},{visibleCount:s}=gt(o,n.opsCols,n.actorIds);a=s}t[r].props[a]||(t[r].props[a]={});let u=t[r].props[a];for(let[n,r]of Object.entries(e.children[o.parentKey]))u[n]?s=!0:r.objectId?(t[r.objectId]||(t[r.objectId]=Object.assign({},r,{props:{}})),u[n]=t[r.objectId]):u[n]=r;if(!u[o.opId])throw new RangeError(`object metadata did not contain child entry for ${o.opId}`)}if(s||!e.parentObj)break;o=e,r=e.parentObj,e=n.objectMeta[r]}}return t}applyChanges(t,e=!1){let n={_root:{objectId:"_root",type:"map",props:{}}},r={actorIds:this.actorIds,opsCols:this.docColumns,numOps:this.numOps,objectMeta:Object.assign({},this.objectMeta),lastIndex:{}},o={},i=Object.assign({},this.changeByHash),s=this.maxOp,a={},u=Object.assign({},this.clock);for(let t of this.heads)a[t]=!0;let c=[];for(let e of t){const t=tt(e);c.push(t);for(let e of t.deps){if(!i[e])throw new RangeError(`missing dependency ${e}`);delete a[e]}i[t.hash]=e,a[t.hash]=!0;const l=(u[t.actor]||0)+1;if(t.seq!==l)throw new RangeError(`Expected seq ${l}, got seq ${t.seq} from actor ${t.actor}`);u[t.actor]=t.seq;const h=F(t.columns,E);r.allCols=this.getAllColumns(h),Object.assign(r,this.getActorTable(r.actorIds,t));const f=r.actorIds.indexOf(t.actorIds[0]),{opSequences:d,objectIds:p}=wt(t,h,r.objectMeta);for(let t of p)o[t]=!0;const g=d[d.length-1];g&&(s=Math.max(s,g.idCtr+g.consecutiveOps-1));for(let t of h)t.decoder.reset();for(let t of d)t.idActorIndex=f,this.applyOps(n,t,h,r)}this.setupPatches(n,Object.keys(o),r),this.maxOp=s,this.changes=this.changes.concat(t),this.changeByHash=i,this.actorIds=r.actorIds,this.heads=Object.keys(a).sort(),this.clock=u,this.docColumns=r.opsCols,this.numOps=r.numOps,this.objectMeta=r.objectMeta;for(let t of c)1===t.seq&&(this.hashesByActor[t.actor]=[]),this.hashesByActor[t.actor].push(t.hash);let l={maxOp:s,clock:u,deps:this.heads,diffs:n._root};return e&&1===c.length&&(l.actor=c[0].actor,l.seq=c[0].seq),l}getChanges(t){const e={},n=this.changes.map(tt);for(let n of t)e[n]=!0;for(let t=n.length-1;t>=0;t--)if(e[n[t].hash])for(let r of n[t].deps)e[r]=!0;let r=[];for(let t=0;t<n.length;t++)e[n[t].hash]||r.push(this.changes[t]);return r}getMissingDeps(){return[]}save(){return st(this.changes)}}t.exports={COLUMN_TYPE:m,VALUE_TYPE:v,ACTIONS:I,DOC_OPS_COLUMNS:O,CHANGE_COLUMNS:E,DOCUMENT_COLUMNS:S,splitContainers:rt,encodeChange:Q,decodeChange:et,decodeChangeMeta:function(t,e){2===t[8]&&(t=nt(t));const n=X(new h(t),e);if(1!==n.chunkType)throw new RangeError("Buffer chunk type is not a change");const r=J(new h(n.chunkData));return r.change=t,e&&(r.hash=n.hash),r},decodeChanges:ot,encodeDocument:st,decodeDocument:ut,getChangeChecksum:function(t){if(t[0]!==w[0]||t[1]!==w[1]||t[2]!==w[2]||t[3]!==w[3])throw new RangeError("Data does not begin with magic bytes 85 6f 4a 83");return(t[4]<<24|t[5]<<16|t[6]<<8|t[7])>>>0},appendEdit:dt,constructPatch:function(t){const{opsColumns:e,actorIds:n}=at(t),r=F(e,O).reduce(((t,e)=>Object.assign(t,{[e.columnName]:e.decoder})),{});let o={_root:{objectId:"_root",type:"map",props:{}}},i=null;for(;!r.idActor.done;){const t=`${r.idCtr.readValue()}@${n[r.idActor.readValue()]}`,e=r.action.readValue(),s=I[e];if(e%2==0){const e=k[s]||"unknown";o[t]="list"===e||"text"===e?{objectId:t,type:e,edits:[]}:{objectId:t,type:e,props:{}}}const a=r.objActor.readValue(),u=r.objCtr.readValue(),c=null===a?"_root":`${u}@${n[a]}`;let l=o[c];if(!l)throw new RangeError(`Operation for nonexistent object: ${c}`);const h=r.keyActor.readValue(),f=r.keyCtr.readValue(),d=r.keyStr.readValue(),p=!!r.insert.readValue(),g=r.chldActor.readValue(),_=r.chldCtr.readValue(),y=null===g?null:`${_}@${n[g]}`,b=r.valLen.readValue(),w=M(b,r.valRaw.readRawBytes(b>>4)),m=r.succNum.readValue();let v,x=[];for(let t=0;t<m;t++)x.push(`${r.succCtr.readValue()}@${n[r.succActor.readValue()]}`);if(s&&"unknown"!==l.type){if("list"===l.type||"text"===l.type){if(null===f||0===f&&!p)throw new RangeError(`Operation ${t} on ${l.type} object has no key`);v=p?t:`${f}@${n[h]}`}else{if(null===d)throw new RangeError(`Operation ${t} on ${l.type} object has no key`);v=d}if(!i||i.objId!==c||i.key!==v){let t=0;i&&(t=i.index,ht(o,i)&&(t+=1),i.objId!==c&&(t=0)),i={objId:c,key:v,index:t,ops:[]}}i.ops.push({opId:t,actionName:s,value:w,childId:y,succ:x})}}return i&&ht(o,i),ft(o._root),o._root},BackendDoc:mt}},function(t,e,n){const{Deflate:r,deflate:o,deflateRaw:i,gzip:s}=n(17),{Inflate:a,inflate:u,inflateRaw:c,ungzip:l}=n(27),h=n(23);t.exports.Deflate=r,t.exports.deflate=o,t.exports.deflateRaw=i,t.exports.gzip=s,t.exports.Inflate=a,t.exports.inflate=u,t.exports.inflateRaw=c,t.exports.ungzip=l,t.exports.constants=h},function(t,e,n){const r=n(18),o=n(24),i=n(25),s=n(22),a=n(26),u=Object.prototype.toString,{Z_NO_FLUSH:c,Z_SYNC_FLUSH:l,Z_FULL_FLUSH:h,Z_FINISH:f,Z_OK:d,Z_STREAM_END:p,Z_DEFAULT_COMPRESSION:g,Z_DEFAULT_STRATEGY:_,Z_DEFLATED:y}=n(23);function b(t){this.options=o.assign({level:g,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:_},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==d)throw new Error(s[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?i.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=r.deflateSetDictionary(this.strm,t),n!==d)throw new Error(s[n]);this._dict_set=!0}}function w(t,e){const n=new b(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}b.prototype.push=function(t,e){const n=this.strm,o=this.options.chunkSize;let s,a;if(this.ended)return!1;for(a=e===~~e?e:!0===e?f:c,"string"==typeof t?n.input=i.string2buf(t):"[object ArrayBuffer]"===u.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),(a===l||a===h)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=r.deflate(n,a),s===p)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=r.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===d;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},b.prototype.onData=function(t){this.chunks.push(t)},b.prototype.onEnd=function(t){t===d&&(this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},t.exports.Deflate=b,t.exports.deflate=w,t.exports.deflateRaw=function(t,e){return(e=e||{}).raw=!0,w(t,e)},t.exports.gzip=function(t,e){return(e=e||{}).gzip=!0,w(t,e)},t.exports.constants=n(23)},function(t,e,n){const{_tr_init:r,_tr_stored_block:o,_tr_flush_block:i,_tr_tally:s,_tr_align:a}=n(19),u=n(20),c=n(21),l=n(22),{Z_NO_FLUSH:h,Z_PARTIAL_FLUSH:f,Z_FULL_FLUSH:d,Z_FINISH:p,Z_BLOCK:g,Z_OK:_,Z_STREAM_END:y,Z_STREAM_ERROR:b,Z_DATA_ERROR:w,Z_BUF_ERROR:m,Z_DEFAULT_COMPRESSION:v,Z_FILTERED:I,Z_HUFFMAN_ONLY:k,Z_RLE:x,Z_FIXED:E,Z_DEFAULT_STRATEGY:O,Z_UNKNOWN:A,Z_DEFLATED:S}=n(23),j=258,R=262,C=103,z=113,V=666,L=(t,e)=>(t.msg=l[e],e),T=t=>(t<<1)-(t>4?9:0),U=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let D=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const M=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))},N=(t,e)=>{i(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,M(t.strm)},B=(t,e)=>{t.pending_buf[t.pending++]=e},$=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},q=(t,e,n,r)=>{let o=t.avail_in;return o>r&&(o=r),0===o?0:(t.avail_in-=o,e.set(t.input.subarray(t.next_in,t.next_in+o),n),1===t.state.wrap?t.adler=u(t.adler,e,o,n):2===t.state.wrap&&(t.adler=c(t.adler,e,o,n)),t.next_in+=o,t.total_in+=o,o)},P=(t,e)=>{let n,r,o=t.max_chain_length,i=t.strstart,s=t.prev_length,a=t.nice_match;const u=t.strstart>t.w_size-R?t.strstart-(t.w_size-R):0,c=t.window,l=t.w_mask,h=t.prev,f=t.strstart+j;let d=c[i+s-1],p=c[i+s];t.prev_length>=t.good_match&&(o>>=2),a>t.lookahead&&(a=t.lookahead);do{if(n=e,c[n+s]===p&&c[n+s-1]===d&&c[n]===c[i]&&c[++n]===c[i+1]){i+=2,n++;do{}while(c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&i<f);if(r=j-(f-i),i=f-j,r>s){if(t.match_start=e,s=r,r>=a)break;d=c[i+s-1],p=c[i+s]}}}while((e=h[e&l])>u&&0!=--o);return s<=t.lookahead?s:t.lookahead},H=t=>{const e=t.w_size;let n,r,o,i,s;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-R)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,r=t.hash_size,n=r;do{o=t.head[--n],t.head[n]=o>=e?o-e:0}while(--r);r=e,n=r;do{o=t.prev[--n],t.prev[n]=o>=e?o-e:0}while(--r);i+=e}if(0===t.strm.avail_in)break;if(r=q(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=r,t.lookahead+t.insert>=3)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=D(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=D(t,t.ins_h,t.window[s+3-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<R&&0!==t.strm.avail_in)},K=(t,e)=>{let n,r;for(;;){if(t.lookahead<R){if(H(t),t.lookahead<R&&e===h)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-R&&(t.match_length=P(t,n)),t.match_length>=3)if(r=s(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=D(t,t.ins_h,t.window[t.strstart+1]);else r=s(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(N(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===p?(N(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?1:2},F=(t,e)=>{let n,r,o;for(;;){if(t.lookahead<R){if(H(t),t.lookahead<R&&e===h)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-R&&(t.match_length=P(t,n),t.match_length<=5&&(t.strategy===I||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-3,r=s(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=o&&(t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(N(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(r=s(t,0,t.window[t.strstart-1]),r&&N(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=s(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===p?(N(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?1:2};function Z(t,e,n,r,o){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=o}const W=[new Z(0,0,0,0,((t,e)=>{let n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(H(t),0===t.lookahead&&e===h)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,N(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-R&&(N(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===p?(N(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(N(t,!1),t.strm.avail_out),1)})),new Z(4,4,8,4,K),new Z(4,5,16,8,K),new Z(4,6,32,32,K),new Z(4,4,16,16,F),new Z(8,16,32,32,F),new Z(8,16,128,128,F),new Z(8,32,128,256,F),new Z(32,128,258,1024,F),new Z(32,258,258,4096,F)];function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const J=t=>{if(!t||!t.state)return L(t,b);t.total_in=t.total_out=0,t.data_type=A;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:z,t.adler=2===e.wrap?0:1,e.last_flush=h,r(e),_},Y=t=>{const e=J(t);var n;return e===_&&((n=t.state).window_size=2*n.w_size,U(n.head),n.max_lazy_match=W[n.level].max_lazy,n.good_match=W[n.level].good_length,n.nice_match=W[n.level].nice_length,n.max_chain_length=W[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),e},X=(t,e,n,r,o,i)=>{if(!t)return b;let s=1;if(e===v&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>9||n!==S||r<8||r>15||e<0||e>9||i<0||i>E)return L(t,b);8===r&&(r=9);const a=new G;return t.state=a,a.strm=t,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=o+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<o+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=e,a.strategy=i,a.method=n,Y(t)};t.exports.deflateInit=(t,e)=>X(t,e,S,15,8,O),t.exports.deflateInit2=X,t.exports.deflateReset=Y,t.exports.deflateResetKeep=J,t.exports.deflateSetHeader=(t,e)=>t&&t.state?2!==t.state.wrap?b:(t.state.gzhead=e,_):b,t.exports.deflate=(t,e)=>{let n,r;if(!t||!t.state||e>g||e<0)return t?L(t,b):b;const i=t.state;if(!t.output||!t.input&&0!==t.avail_in||i.status===V&&e!==p)return L(t,0===t.avail_out?m:b);i.strm=t;const u=i.last_flush;if(i.last_flush=e,42===i.status)if(2===i.wrap)t.adler=0,B(i,31),B(i,139),B(i,8),i.gzhead?(B(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),B(i,255&i.gzhead.time),B(i,i.gzhead.time>>8&255),B(i,i.gzhead.time>>16&255),B(i,i.gzhead.time>>24&255),B(i,9===i.level?2:i.strategy>=k||i.level<2?4:0),B(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(B(i,255&i.gzhead.extra.length),B(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=c(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(B(i,0),B(i,0),B(i,0),B(i,0),B(i,0),B(i,9===i.level?2:i.strategy>=k||i.level<2?4:0),B(i,3),i.status=z);else{let e=S+(i.w_bits-8<<4)<<8,n=-1;n=i.strategy>=k||i.level<2?0:i.level<6?1:6===i.level?2:3,e|=n<<6,0!==i.strstart&&(e|=32),e+=31-e%31,i.status=z,$(i,e),0!==i.strstart&&($(i,t.adler>>>16),$(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),M(t),n=i.pending,i.pending!==i.pending_buf_size));)B(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),M(t),n=i.pending,i.pending===i.pending_buf_size)){r=1;break}r=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,B(i,r)}while(0!==r);i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),0===r&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),M(t),n=i.pending,i.pending===i.pending_buf_size)){r=1;break}r=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,B(i,r)}while(0!==r);i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),0===r&&(i.status=C)}else i.status=C;if(i.status===C&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&M(t),i.pending+2<=i.pending_buf_size&&(B(i,255&t.adler),B(i,t.adler>>8&255),t.adler=0,i.status=z)):i.status=z),0!==i.pending){if(M(t),0===t.avail_out)return i.last_flush=-1,_}else if(0===t.avail_in&&T(e)<=T(u)&&e!==p)return L(t,m);if(i.status===V&&0!==t.avail_in)return L(t,m);if(0!==t.avail_in||0!==i.lookahead||e!==h&&i.status!==V){let n=i.strategy===k?((t,e)=>{let n;for(;;){if(0===t.lookahead&&(H(t),0===t.lookahead)){if(e===h)return 1;break}if(t.match_length=0,n=s(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(N(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===p?(N(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?1:2})(i,e):i.strategy===x?((t,e)=>{let n,r,o,i;const a=t.window;for(;;){if(t.lookahead<=j){if(H(t),t.lookahead<=j&&e===h)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(o=t.strstart-1,r=a[o],r===a[++o]&&r===a[++o]&&r===a[++o])){i=t.strstart+j;do{}while(r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&o<i);t.match_length=j-(i-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=s(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=s(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(N(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===p?(N(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?1:2})(i,e):W[i.level].func(i,e);if(3!==n&&4!==n||(i.status=V),1===n||3===n)return 0===t.avail_out&&(i.last_flush=-1),_;if(2===n&&(e===f?a(i):e!==g&&(o(i,0,0,!1),e===d&&(U(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),M(t),0===t.avail_out))return i.last_flush=-1,_}return e!==p?_:i.wrap<=0?y:(2===i.wrap?(B(i,255&t.adler),B(i,t.adler>>8&255),B(i,t.adler>>16&255),B(i,t.adler>>24&255),B(i,255&t.total_in),B(i,t.total_in>>8&255),B(i,t.total_in>>16&255),B(i,t.total_in>>24&255)):($(i,t.adler>>>16),$(i,65535&t.adler)),M(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?_:y)},t.exports.deflateEnd=t=>{if(!t||!t.state)return b;const e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==C&&e!==z&&e!==V?L(t,b):(t.state=null,e===z?L(t,w):_)},t.exports.deflateSetDictionary=(t,e)=>{let n=e.length;if(!t||!t.state)return b;const r=t.state,o=r.wrap;if(2===o||1===o&&42!==r.status||r.lookahead)return b;if(1===o&&(t.adler=u(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){0===o&&(U(r.head),r.strstart=0,r.block_start=0,r.insert=0);let t=new Uint8Array(r.w_size);t.set(e.subarray(n-r.w_size,n),0),e=t,n=r.w_size}const i=t.avail_in,s=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,H(r);r.lookahead>=3;){let t=r.strstart,e=r.lookahead-2;do{r.ins_h=D(r,r.ins_h,r.window[t+3-1]),r.prev[t&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=t,t++}while(--e);r.strstart=t,r.lookahead=2,H(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=s,t.input=a,t.avail_in=i,r.wrap=o,_},t.exports.deflateInfo="pako deflate (from Nodeca project)"},function(t){function e(t){let e=t.length;for(;--e>=0;)t[e]=0}const n=256,r=286,o=30,i=15,s=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),u=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),c=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=new Array(576);e(l);const h=new Array(60);e(h);const f=new Array(512);e(f);const d=new Array(256);e(d);const p=new Array(29);e(p);const g=new Array(o);function _(t,e,n,r,o){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=o,this.has_stree=t&&t.length}let y,b,w;function m(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}e(g);const v=t=>t<256?f[t]:f[256+(t>>>7)],I=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},k=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,I(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},x=(t,e,n)=>{k(t,n[2*e],n[2*e+1])},E=(t,e)=>{let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1},O=(t,e,n)=>{const r=new Array(16);let o,s,a=0;for(o=1;o<=i;o++)r[o]=a=a+n[o-1]<<1;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=E(r[e]++,e))}},A=t=>{let e;for(e=0;e<r;e++)t.dyn_ltree[2*e]=0;for(e=0;e<o;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},S=t=>{t.bi_valid>8?I(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},j=(t,e,n,r)=>{const o=2*e,i=2*n;return t[o]<t[i]||t[o]===t[i]&&r[e]<=r[n]},R=(t,e,n)=>{const r=t.heap[n];let o=n<<1;for(;o<=t.heap_len&&(o<t.heap_len&&j(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!j(e,r,t.heap[o],t.depth));)t.heap[n]=t.heap[o],n=o,o<<=1;t.heap[n]=r},C=(t,e,r)=>{let o,i,u,c,l=0;if(0!==t.last_lit)do{o=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],i=t.pending_buf[t.l_buf+l],l++,0===o?x(t,i,e):(u=d[i],x(t,u+n+1,e),c=s[u],0!==c&&(i-=p[u],k(t,i,c)),o--,u=v(o),x(t,u,r),c=a[u],0!==c&&(o-=g[u],k(t,o,c)))}while(l<t.last_lit);x(t,256,e)},z=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,o=e.stat_desc.has_stree,s=e.stat_desc.elems;let a,u,c,l=-1;for(t.heap_len=0,t.heap_max=573,a=0;a<s;a++)0!==n[2*a]?(t.heap[++t.heap_len]=l=a,t.depth[a]=0):n[2*a+1]=0;for(;t.heap_len<2;)c=t.heap[++t.heap_len]=l<2?++l:0,n[2*c]=1,t.depth[c]=0,t.opt_len--,o&&(t.static_len-=r[2*c+1]);for(e.max_code=l,a=t.heap_len>>1;a>=1;a--)R(t,n,a);c=s;do{a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],R(t,n,1),u=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=u,n[2*c]=n[2*a]+n[2*u],t.depth[c]=(t.depth[a]>=t.depth[u]?t.depth[a]:t.depth[u])+1,n[2*a+1]=n[2*u+1]=c,t.heap[1]=c++,R(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const n=e.dyn_tree,r=e.max_code,o=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,u=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,h,f,d,p,g,_=0;for(d=0;d<=i;d++)t.bl_count[d]=0;for(n[2*t.heap[t.heap_max]+1]=0,l=t.heap_max+1;l<573;l++)h=t.heap[l],d=n[2*n[2*h+1]+1]+1,d>c&&(d=c,_++),n[2*h+1]=d,h>r||(t.bl_count[d]++,p=0,h>=u&&(p=a[h-u]),g=n[2*h],t.opt_len+=g*(d+p),s&&(t.static_len+=g*(o[2*h+1]+p)));if(0!==_){do{for(d=c-1;0===t.bl_count[d];)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,_-=2}while(_>0);for(d=c;0!==d;d--)for(h=t.bl_count[d];0!==h;)f=t.heap[--l],f>r||(n[2*f+1]!==d&&(t.opt_len+=(d-n[2*f+1])*n[2*f],n[2*f+1]=d),h--)}})(t,e),O(n,l,t.bl_count)},V=(t,e,n)=>{let r,o,i=-1,s=e[1],a=0,u=7,c=4;for(0===s&&(u=138,c=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)o=s,s=e[2*(r+1)+1],++a<u&&o===s||(a<c?t.bl_tree[2*o]+=a:0!==o?(o!==i&&t.bl_tree[2*o]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,i=o,0===s?(u=138,c=3):o===s?(u=6,c=3):(u=7,c=4))},L=(t,e,n)=>{let r,o,i=-1,s=e[1],a=0,u=7,c=4;for(0===s&&(u=138,c=3),r=0;r<=n;r++)if(o=s,s=e[2*(r+1)+1],!(++a<u&&o===s)){if(a<c)do{x(t,o,t.bl_tree)}while(0!=--a);else 0!==o?(o!==i&&(x(t,o,t.bl_tree),a--),x(t,16,t.bl_tree),k(t,a-3,2)):a<=10?(x(t,17,t.bl_tree),k(t,a-3,3)):(x(t,18,t.bl_tree),k(t,a-11,7));a=0,i=o,0===s?(u=138,c=3):o===s?(u=6,c=3):(u=7,c=4)}};let T=!1;const U=(t,e,n,r)=>{k(t,0+(r?1:0),3),((t,e,n,r)=>{S(t),r&&(I(t,n),I(t,~n)),t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n})(t,e,n,!0)};t.exports._tr_init=t=>{T||((()=>{let t,e,n,c,m;const v=new Array(16);for(n=0,c=0;c<28;c++)for(p[c]=n,t=0;t<1<<s[c];t++)d[n++]=c;for(d[n-1]=c,m=0,c=0;c<16;c++)for(g[c]=m,t=0;t<1<<a[c];t++)f[m++]=c;for(m>>=7;c<o;c++)for(g[c]=m<<7,t=0;t<1<<a[c]-7;t++)f[256+m++]=c;for(e=0;e<=i;e++)v[e]=0;for(t=0;t<=143;)l[2*t+1]=8,t++,v[8]++;for(;t<=255;)l[2*t+1]=9,t++,v[9]++;for(;t<=279;)l[2*t+1]=7,t++,v[7]++;for(;t<=287;)l[2*t+1]=8,t++,v[8]++;for(O(l,287,v),t=0;t<o;t++)h[2*t+1]=5,h[2*t]=E(t,5);y=new _(l,s,257,r,i),b=new _(h,a,0,o,i),w=new _(new Array(0),u,0,19,7)})(),T=!0),t.l_desc=new m(t.dyn_ltree,y),t.d_desc=new m(t.dyn_dtree,b),t.bl_desc=new m(t.bl_tree,w),t.bi_buf=0,t.bi_valid=0,A(t)},t.exports._tr_stored_block=U,t.exports._tr_flush_block=(t,e,r,o)=>{let i,s,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<n;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),z(t,t.l_desc),z(t,t.d_desc),a=(t=>{let e;for(V(t,t.dyn_ltree,t.l_desc.max_code),V(t,t.dyn_dtree,t.d_desc.max_code),z(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*c[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==e?U(t,e,r,o):4===t.strategy||s===i?(k(t,2+(o?1:0),3),C(t,l,h)):(k(t,4+(o?1:0),3),((t,e,n,r)=>{let o;for(k(t,e-257,5),k(t,n-1,5),k(t,r-4,4),o=0;o<r;o++)k(t,t.bl_tree[2*c[o]+1],3);L(t,t.dyn_ltree,e-1),L(t,t.dyn_dtree,n-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),C(t,t.dyn_ltree,t.dyn_dtree)),A(t),o&&S(t)},t.exports._tr_tally=(t,e,r)=>(t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(d[r]+n+1)]++,t.dyn_dtree[2*v(e)]++),t.last_lit===t.lit_bufsize-1),t.exports._tr_align=t=>{k(t,2,3),x(t,256,l),(t=>{16===t.bi_valid?(I(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},function(t){t.exports=(t,e,n,r)=>{let o=65535&t|0,i=t>>>16&65535|0,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{o=o+e[r++]|0,i=i+o|0}while(--s);o%=65521,i%=65521}return o|i<<16|0}},function(t){const e=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());t.exports=(t,n,r,o)=>{const i=e,s=o+r;t^=-1;for(let e=o;e<s;e++)t=t>>>8^i[255&(t^n[e])];return-1^t}},function(t){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t){const e=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);t.exports.assign=function(t){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const r=n.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const n in r)e(r,n)&&(t[n]=r[n])}}return t},t.exports.flattenChunks=t=>{let e=0;for(let n=0,r=t.length;n<r;n++)e+=t[n].length;const n=new Uint8Array(e);for(let e=0,r=0,o=t.length;e<o;e++){let o=t[e];n.set(o,r),r+=o.length}return n}},function(t){let e=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){e=!1}const n=new Uint8Array(256);for(let t=0;t<256;t++)n[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;n[254]=n[254]=1,t.exports.string2buf=t=>{let e,n,r,o,i,s=t.length,a=0;for(o=0;o<s;o++)n=t.charCodeAt(o),55296==(64512&n)&&o+1<s&&(r=t.charCodeAt(o+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),o++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),i=0,o=0;i<a;o++)n=t.charCodeAt(o),55296==(64512&n)&&o+1<s&&(r=t.charCodeAt(o+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),o++)),n<128?e[i++]=n:n<2048?(e[i++]=192|n>>>6,e[i++]=128|63&n):n<65536?(e[i++]=224|n>>>12,e[i++]=128|n>>>6&63,e[i++]=128|63&n):(e[i++]=240|n>>>18,e[i++]=128|n>>>12&63,e[i++]=128|n>>>6&63,e[i++]=128|63&n);return e};t.exports.buf2string=(t,r)=>{let o,i;const s=r||t.length,a=new Array(2*s);for(i=0,o=0;o<s;){let e=t[o++];if(e<128){a[i++]=e;continue}let r=n[e];if(r>4)a[i++]=65533,o+=r-1;else{for(e&=2===r?31:3===r?15:7;r>1&&o<s;)e=e<<6|63&t[o++],r--;r>1?a[i++]=65533:e<65536?a[i++]=e:(e-=65536,a[i++]=55296|e>>10&1023,a[i++]=56320|1023&e)}}return((t,n)=>{if(n<65534&&t.subarray&&e)return String.fromCharCode.apply(null,t.length===n?t:t.subarray(0,n));let r="";for(let e=0;e<n;e++)r+=String.fromCharCode(t[e]);return r})(a,i)},t.exports.utf8border=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let r=e-1;for(;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+n[t[r]]>e?r:e}},function(t){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,n){const r=n(28),o=n(24),i=n(25),s=n(22),a=n(26),u=n(31),c=Object.prototype.toString,{Z_NO_FLUSH:l,Z_FINISH:h,Z_OK:f,Z_STREAM_END:d,Z_NEED_DICT:p,Z_STREAM_ERROR:g,Z_DATA_ERROR:_,Z_MEM_ERROR:y}=n(23);function b(t){this.options=o.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let n=r.inflateInit2(this.strm,e.windowBits);if(n!==f)throw new Error(s[n]);if(this.header=new u,r.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=i.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=r.inflateSetDictionary(this.strm,e.dictionary),n!==f)))throw new Error(s[n])}function w(t,e){const n=new b(e);if(n.push(t),n.err)throw n.msg||s[n.err];return n.result}b.prototype.push=function(t,e){const n=this.strm,o=this.options.chunkSize,s=this.options.dictionary;let a,u,b;if(this.ended)return!1;for(u=e===~~e?e:!0===e?h:l,"[object ArrayBuffer]"===c.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),a=r.inflate(n,u),a===p&&s&&(a=r.inflateSetDictionary(n,s),a===f?a=r.inflate(n,u):a===_&&(a=p));n.avail_in>0&&a===d&&n.state.wrap>0&&0!==t[n.next_in];)r.inflateReset(n),a=r.inflate(n,u);switch(a){case g:case _:case p:case y:return this.onEnd(a),this.ended=!0,!1}if(b=n.avail_out,n.next_out&&(0===n.avail_out||a===d))if("string"===this.options.to){let t=i.utf8border(n.output,n.next_out),e=n.next_out-t,r=i.buf2string(n.output,t);n.next_out=e,n.avail_out=o-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(r)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==f||0!==b){if(a===d)return a=r.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},b.prototype.onData=function(t){this.chunks.push(t)},b.prototype.onEnd=function(t){t===f&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},t.exports.Inflate=b,t.exports.inflate=w,t.exports.inflateRaw=function(t,e){return(e=e||{}).raw=!0,w(t,e)},t.exports.ungzip=w,t.exports.constants=n(23)},function(t,e,n){const r=n(20),o=n(21),i=n(29),s=n(30),{Z_FINISH:a,Z_BLOCK:u,Z_TREES:c,Z_OK:l,Z_STREAM_END:h,Z_NEED_DICT:f,Z_STREAM_ERROR:d,Z_DATA_ERROR:p,Z_MEM_ERROR:g,Z_BUF_ERROR:_,Z_DEFLATED:y}=n(23),b=12,w=30,m=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const I=t=>{if(!t||!t.state)return d;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,l},k=t=>{if(!t||!t.state)return d;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,I(t)},x=(t,e)=>{let n;if(!t||!t.state)return d;const r=t.state;return e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?d:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,k(t))},E=(t,e)=>{if(!t)return d;const n=new v;t.state=n,n.window=null;const r=x(t,e);return r!==l&&(t.state=null),r};let O,A,S=!0;const j=t=>{if(S){O=new Int32Array(512),A=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(1,t.lens,0,288,O,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(2,t.lens,0,32,A,0,t.work,{bits:5}),S=!1}t.lencode=O,t.lenbits=9,t.distcode=A,t.distbits=5},R=(t,e,n,r)=>{let o;const i=t.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(e.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(o=i.wsize-i.wnext,o>r&&(o=r),i.window.set(e.subarray(n-r,n-r+o),i.wnext),(r-=o)?(i.window.set(e.subarray(n-r,n),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=o,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=o))),0};t.exports.inflateReset=k,t.exports.inflateReset2=x,t.exports.inflateResetKeep=I,t.exports.inflateInit=t=>E(t,15),t.exports.inflateInit2=E,t.exports.inflate=(t,e)=>{let n,v,I,k,x,E,O,A,S,C,z,V,L,T,U,D,M,N,B,$,q,P,H=0;const K=new Uint8Array(4);let F,Z;const W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return d;n=t.state,n.mode===b&&(n.mode=13),x=t.next_out,I=t.output,O=t.avail_out,k=t.next_in,v=t.input,E=t.avail_in,A=n.hold,S=n.bits,C=E,z=O,P=l;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;S<16;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if(2&n.wrap&&35615===A){n.check=0,K[0]=255&A,K[1]=A>>>8&255,n.check=o(n.check,K,2,0),A=0,S=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&A)<<8)+(A>>8))%31){t.msg="incorrect header check",n.mode=w;break}if((15&A)!==y){t.msg="unknown compression method",n.mode=w;break}if(A>>>=4,S-=4,q=8+(15&A),0===n.wbits)n.wbits=q;else if(q>n.wbits){t.msg="invalid window size",n.mode=w;break}n.dmax=1<<n.wbits,t.adler=n.check=1,n.mode=512&A?10:b,A=0,S=0;break;case 2:for(;S<16;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if(n.flags=A,(255&n.flags)!==y){t.msg="unknown compression method",n.mode=w;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=w;break}n.head&&(n.head.text=A>>8&1),512&n.flags&&(K[0]=255&A,K[1]=A>>>8&255,n.check=o(n.check,K,2,0)),A=0,S=0,n.mode=3;case 3:for(;S<32;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}n.head&&(n.head.time=A),512&n.flags&&(K[0]=255&A,K[1]=A>>>8&255,K[2]=A>>>16&255,K[3]=A>>>24&255,n.check=o(n.check,K,4,0)),A=0,S=0,n.mode=4;case 4:for(;S<16;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}n.head&&(n.head.xflags=255&A,n.head.os=A>>8),512&n.flags&&(K[0]=255&A,K[1]=A>>>8&255,n.check=o(n.check,K,2,0)),A=0,S=0,n.mode=5;case 5:if(1024&n.flags){for(;S<16;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}n.length=A,n.head&&(n.head.extra_len=A),512&n.flags&&(K[0]=255&A,K[1]=A>>>8&255,n.check=o(n.check,K,2,0)),A=0,S=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(V=n.length,V>E&&(V=E),V&&(n.head&&(q=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(v.subarray(k,k+V),q)),512&n.flags&&(n.check=o(n.check,v,V,k)),E-=V,k+=V,n.length-=V),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===E)break t;V=0;do{q=v[k+V++],n.head&&q&&n.length<65536&&(n.head.name+=String.fromCharCode(q))}while(q&&V<E);if(512&n.flags&&(n.check=o(n.check,v,V,k)),E-=V,k+=V,q)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===E)break t;V=0;do{q=v[k+V++],n.head&&q&&n.length<65536&&(n.head.comment+=String.fromCharCode(q))}while(q&&V<E);if(512&n.flags&&(n.check=o(n.check,v,V,k)),E-=V,k+=V,q)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;S<16;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if(A!==(65535&n.check)){t.msg="header crc mismatch",n.mode=w;break}A=0,S=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=b;break;case 10:for(;S<32;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}t.adler=n.check=m(A),A=0,S=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=x,t.avail_out=O,t.next_in=k,t.avail_in=E,n.hold=A,n.bits=S,f;t.adler=n.check=1,n.mode=b;case b:if(e===u||e===c)break t;case 13:if(n.last){A>>>=7&S,S-=7&S,n.mode=27;break}for(;S<3;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}switch(n.last=1&A,A>>>=1,S-=1,3&A){case 0:n.mode=14;break;case 1:if(j(n),n.mode=20,e===c){A>>>=2,S-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=w}A>>>=2,S-=2;break;case 14:for(A>>>=7&S,S-=7&S;S<32;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if((65535&A)!=(A>>>16^65535)){t.msg="invalid stored block lengths",n.mode=w;break}if(n.length=65535&A,A=0,S=0,n.mode=15,e===c)break t;case 15:n.mode=16;case 16:if(V=n.length,V){if(V>E&&(V=E),V>O&&(V=O),0===V)break t;I.set(v.subarray(k,k+V),x),E-=V,k+=V,O-=V,x+=V,n.length-=V;break}n.mode=b;break;case 17:for(;S<14;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if(n.nlen=257+(31&A),A>>>=5,S-=5,n.ndist=1+(31&A),A>>>=5,S-=5,n.ncode=4+(15&A),A>>>=4,S-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=w;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;S<3;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}n.lens[W[n.have++]]=7&A,A>>>=3,S-=3}for(;n.have<19;)n.lens[W[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,F={bits:n.lenbits},P=s(0,n.lens,0,19,n.lencode,0,n.work,F),n.lenbits=F.bits,P){t.msg="invalid code lengths set",n.mode=w;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;H=n.lencode[A&(1<<n.lenbits)-1],U=H>>>24,D=H>>>16&255,M=65535&H,!(U<=S);){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if(M<16)A>>>=U,S-=U,n.lens[n.have++]=M;else{if(16===M){for(Z=U+2;S<Z;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if(A>>>=U,S-=U,0===n.have){t.msg="invalid bit length repeat",n.mode=w;break}q=n.lens[n.have-1],V=3+(3&A),A>>>=2,S-=2}else if(17===M){for(Z=U+3;S<Z;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}A>>>=U,S-=U,q=0,V=3+(7&A),A>>>=3,S-=3}else{for(Z=U+7;S<Z;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}A>>>=U,S-=U,q=0,V=11+(127&A),A>>>=7,S-=7}if(n.have+V>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=w;break}for(;V--;)n.lens[n.have++]=q}}if(n.mode===w)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=w;break}if(n.lenbits=9,F={bits:n.lenbits},P=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,F),n.lenbits=F.bits,P){t.msg="invalid literal/lengths set",n.mode=w;break}if(n.distbits=6,n.distcode=n.distdyn,F={bits:n.distbits},P=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,F),n.distbits=F.bits,P){t.msg="invalid distances set",n.mode=w;break}if(n.mode=20,e===c)break t;case 20:n.mode=21;case 21:if(E>=6&&O>=258){t.next_out=x,t.avail_out=O,t.next_in=k,t.avail_in=E,n.hold=A,n.bits=S,i(t,z),x=t.next_out,I=t.output,O=t.avail_out,k=t.next_in,v=t.input,E=t.avail_in,A=n.hold,S=n.bits,n.mode===b&&(n.back=-1);break}for(n.back=0;H=n.lencode[A&(1<<n.lenbits)-1],U=H>>>24,D=H>>>16&255,M=65535&H,!(U<=S);){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if(D&&0==(240&D)){for(N=U,B=D,$=M;H=n.lencode[$+((A&(1<<N+B)-1)>>N)],U=H>>>24,D=H>>>16&255,M=65535&H,!(N+U<=S);){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}A>>>=N,S-=N,n.back+=N}if(A>>>=U,S-=U,n.back+=U,n.length=M,0===D){n.mode=26;break}if(32&D){n.back=-1,n.mode=b;break}if(64&D){t.msg="invalid literal/length code",n.mode=w;break}n.extra=15&D,n.mode=22;case 22:if(n.extra){for(Z=n.extra;S<Z;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}n.length+=A&(1<<n.extra)-1,A>>>=n.extra,S-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;H=n.distcode[A&(1<<n.distbits)-1],U=H>>>24,D=H>>>16&255,M=65535&H,!(U<=S);){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if(0==(240&D)){for(N=U,B=D,$=M;H=n.distcode[$+((A&(1<<N+B)-1)>>N)],U=H>>>24,D=H>>>16&255,M=65535&H,!(N+U<=S);){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}A>>>=N,S-=N,n.back+=N}if(A>>>=U,S-=U,n.back+=U,64&D){t.msg="invalid distance code",n.mode=w;break}n.offset=M,n.extra=15&D,n.mode=24;case 24:if(n.extra){for(Z=n.extra;S<Z;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}n.offset+=A&(1<<n.extra)-1,A>>>=n.extra,S-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=w;break}n.mode=25;case 25:if(0===O)break t;if(V=z-O,n.offset>V){if(V=n.offset-V,V>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=w;break}V>n.wnext?(V-=n.wnext,L=n.wsize-V):L=n.wnext-V,V>n.length&&(V=n.length),T=n.window}else T=I,L=x-n.offset,V=n.length;V>O&&(V=O),O-=V,n.length-=V;do{I[x++]=T[L++]}while(--V);0===n.length&&(n.mode=21);break;case 26:if(0===O)break t;I[x++]=n.length,O--,n.mode=21;break;case 27:if(n.wrap){for(;S<32;){if(0===E)break t;E--,A|=v[k++]<<S,S+=8}if(z-=O,t.total_out+=z,n.total+=z,z&&(t.adler=n.check=n.flags?o(n.check,I,z,x-z):r(n.check,I,z,x-z)),z=O,(n.flags?A:m(A))!==n.check){t.msg="incorrect data check",n.mode=w;break}A=0,S=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;S<32;){if(0===E)break t;E--,A+=v[k++]<<S,S+=8}if(A!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=w;break}A=0,S=0}n.mode=29;case 29:P=h;break t;case w:P=p;break t;case 31:return g;case 32:default:return d}return t.next_out=x,t.avail_out=O,t.next_in=k,t.avail_in=E,n.hold=A,n.bits=S,(n.wsize||z!==t.avail_out&&n.mode<w&&(n.mode<27||e!==a))&&R(t,t.output,t.next_out,z-t.avail_out)?(n.mode=31,g):(C-=t.avail_in,z-=t.avail_out,t.total_in+=C,t.total_out+=z,n.total+=z,n.wrap&&z&&(t.adler=n.check=n.flags?o(n.check,I,z,t.next_out-z):r(n.check,I,z,t.next_out-z)),t.data_type=n.bits+(n.last?64:0)+(n.mode===b?128:0)+(20===n.mode||15===n.mode?256:0),(0===C&&0===z||e===a)&&P===l&&(P=_),P)},t.exports.inflateEnd=t=>{if(!t||!t.state)return d;let e=t.state;return e.window&&(e.window=null),t.state=null,l},t.exports.inflateGetHeader=(t,e)=>{if(!t||!t.state)return d;const n=t.state;return 0==(2&n.wrap)?d:(n.head=e,e.done=!1,l)},t.exports.inflateSetDictionary=(t,e)=>{const n=e.length;let o,i,s;return t&&t.state?(o=t.state,0!==o.wrap&&11!==o.mode?d:11===o.mode&&(i=1,i=r(i,e,n,0),i!==o.check)?p:(s=R(t,e,n,n),s?(o.mode=31,g):(o.havedict=1,l))):d},t.exports.inflateInfo="pako inflate (from Nodeca project)"},function(t){t.exports=function(t,e){let n,r,o,i,s,a,u,c,l,h,f,d,p,g,_,y,b,w,m,v,I,k,x,E;const O=t.state;n=t.next_in,x=t.input,r=n+(t.avail_in-5),o=t.next_out,E=t.output,i=o-(e-t.avail_out),s=o+(t.avail_out-257),a=O.dmax,u=O.wsize,c=O.whave,l=O.wnext,h=O.window,f=O.hold,d=O.bits,p=O.lencode,g=O.distcode,_=(1<<O.lenbits)-1,y=(1<<O.distbits)-1;t:do{d<15&&(f+=x[n++]<<d,d+=8,f+=x[n++]<<d,d+=8),b=p[f&_];e:for(;;){if(w=b>>>24,f>>>=w,d-=w,w=b>>>16&255,0===w)E[o++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=p[(65535&b)+(f&(1<<w)-1)];continue e}if(32&w){O.mode=12;break t}t.msg="invalid literal/length code",O.mode=30;break t}m=65535&b,w&=15,w&&(d<w&&(f+=x[n++]<<d,d+=8),m+=f&(1<<w)-1,f>>>=w,d-=w),d<15&&(f+=x[n++]<<d,d+=8,f+=x[n++]<<d,d+=8),b=g[f&y];n:for(;;){if(w=b>>>24,f>>>=w,d-=w,w=b>>>16&255,!(16&w)){if(0==(64&w)){b=g[(65535&b)+(f&(1<<w)-1)];continue n}t.msg="invalid distance code",O.mode=30;break t}if(v=65535&b,w&=15,d<w&&(f+=x[n++]<<d,d+=8,d<w&&(f+=x[n++]<<d,d+=8)),v+=f&(1<<w)-1,v>a){t.msg="invalid distance too far back",O.mode=30;break t}if(f>>>=w,d-=w,w=o-i,v>w){if(w=v-w,w>c&&O.sane){t.msg="invalid distance too far back",O.mode=30;break t}if(I=0,k=h,0===l){if(I+=u-w,w<m){m-=w;do{E[o++]=h[I++]}while(--w);I=o-v,k=E}}else if(l<w){if(I+=u+l-w,w-=l,w<m){m-=w;do{E[o++]=h[I++]}while(--w);if(I=0,l<m){w=l,m-=w;do{E[o++]=h[I++]}while(--w);I=o-v,k=E}}}else if(I+=l-w,w<m){m-=w;do{E[o++]=h[I++]}while(--w);I=o-v,k=E}for(;m>2;)E[o++]=k[I++],E[o++]=k[I++],E[o++]=k[I++],m-=3;m&&(E[o++]=k[I++],m>1&&(E[o++]=k[I++]))}else{I=o-v;do{E[o++]=E[I++],E[o++]=E[I++],E[o++]=E[I++],m-=3}while(m>2);m&&(E[o++]=E[I++],m>1&&(E[o++]=E[I++]))}break}}break}}while(n<r&&o<s);m=d>>3,n-=m,d-=m<<3,f&=(1<<d)-1,t.next_in=n,t.next_out=o,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=o<s?s-o+257:257-(o-s),O.hold=f,O.bits=d}},function(t){const e=15,n=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),r=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),o=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),i=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);t.exports=(t,s,a,u,c,l,h,f)=>{const d=f.bits;let p,g,_,y,b,w,m=0,v=0,I=0,k=0,x=0,E=0,O=0,A=0,S=0,j=0,R=null,C=0;const z=new Uint16Array(16),V=new Uint16Array(16);let L,T,U,D=null,M=0;for(m=0;m<=e;m++)z[m]=0;for(v=0;v<u;v++)z[s[a+v]]++;for(x=d,k=e;k>=1&&0===z[k];k--);if(x>k&&(x=k),0===k)return c[l++]=20971520,c[l++]=20971520,f.bits=1,0;for(I=1;I<k&&0===z[I];I++);for(x<I&&(x=I),A=1,m=1;m<=e;m++)if(A<<=1,A-=z[m],A<0)return-1;if(A>0&&(0===t||1!==k))return-1;for(V[1]=0,m=1;m<e;m++)V[m+1]=V[m]+z[m];for(v=0;v<u;v++)0!==s[a+v]&&(h[V[s[a+v]]++]=v);if(0===t?(R=D=h,w=19):1===t?(R=n,C-=257,D=r,M-=257,w=256):(R=o,D=i,w=-1),j=0,v=0,m=I,b=l,E=x,O=0,_=-1,S=1<<x,y=S-1,1===t&&S>852||2===t&&S>592)return 1;for(;;){L=m-O,h[v]<w?(T=0,U=h[v]):h[v]>w?(T=D[M+h[v]],U=R[C+h[v]]):(T=96,U=0),p=1<<m-O,g=1<<E,I=g;do{g-=p,c[b+(j>>O)+g]=L<<24|T<<16|U|0}while(0!==g);for(p=1<<m-1;j&p;)p>>=1;if(0!==p?(j&=p-1,j+=p):j=0,v++,0==--z[m]){if(m===k)break;m=s[a+h[v]]}if(m>x&&(j&y)!==_){for(0===O&&(O=x),b+=I,E=m-O,A=1<<E;E+O<k&&(A-=z[E+O],!(A<=0));)E++,A<<=1;if(S+=1<<E,1===t&&S>852||2===t&&S>592)return 1;_=j&y,c[_]=x<<24|E<<16|b-l|0}}return 0!==j&&(c[b+j]=m-O<<24|64<<16|0),f.bits=x,0}},function(t){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t){const e=new TextEncoder,n=new TextDecoder("utf-8");function r(t){return e.encode(t)}function o(t){return n.decode(t)}function i(t){if("string"!=typeof t)throw new TypeError("value is not a string");if(!/^([0-9a-f][0-9a-f])*$/.test(t))throw new RangeError("value is not hexadecimal");return""===t?new Uint8Array(0):new Uint8Array(t.match(/../g).map((t=>parseInt(t,16))))}function s(t){const e=[];for(let n of t){if(n<0||n>255)throw new RangeError(`value does not fit in one byte: ${n}`);e.push(("0"+n.toString(16)).slice(-2))}return e.join("")}class a{constructor(){this.buf=new Uint8Array(16),this.offset=0}get buffer(){return this.finish(),this.buf.subarray(0,this.offset)}grow(t=0){let e=4*this.buf.byteLength;for(;e<t;)e*=2;const n=new Uint8Array(e);return n.set(this.buf,0),this.buf=n,this}appendByte(t){this.offset>=this.buf.byteLength&&this.grow(),this.buf[this.offset]=t,this.offset+=1}appendUint32(t){if(!Number.isInteger(t))throw new RangeError("value is not an integer");if(t<0||t>4294967295)throw new RangeError("number out of range");const e=Math.max(1,Math.ceil((32-Math.clz32(t))/7));this.offset+e>this.buf.byteLength&&this.grow();for(let n=0;n<e;n++)this.buf[this.offset+n]=127&t|(n===e-1?0:128),t>>>=7;return this.offset+=e,e}appendInt32(t){if(!Number.isInteger(t))throw new RangeError("value is not an integer");if(t<-2147483648||t>2147483647)throw new RangeError("number out of range");const e=Math.ceil((33-Math.clz32(t>=0?t:-t-1))/7);this.offset+e>this.buf.byteLength&&this.grow();for(let n=0;n<e;n++)this.buf[this.offset+n]=127&t|(n===e-1?0:128),t>>=7;return this.offset+=e,e}appendUint53(t){if(!Number.isInteger(t))throw new RangeError("value is not an integer");if(t<0||t>Number.MAX_SAFE_INTEGER)throw new RangeError("number out of range");const e=Math.floor(t/4294967296),n=(4294967295&t)>>>0;return this.appendUint64(e,n)}appendInt53(t){if(!Number.isInteger(t))throw new RangeError("value is not an integer");if(t<Number.MIN_SAFE_INTEGER||t>Number.MAX_SAFE_INTEGER)throw new RangeError("number out of range");const e=Math.floor(t/4294967296),n=(4294967295&t)>>>0;return this.appendInt64(e,n)}appendUint64(t,e){if(!Number.isInteger(t)||!Number.isInteger(e))throw new RangeError("value is not an integer");if(t<0||t>4294967295||e<0||e>4294967295)throw new RangeError("number out of range");if(0===t)return this.appendUint32(e);const n=Math.ceil((64-Math.clz32(t))/7);this.offset+n>this.buf.byteLength&&this.grow();for(let t=0;t<4;t++)this.buf[this.offset+t]=127&e|128,e>>>=7;this.buf[this.offset+4]=15&e|(7&t)<<4|(5===n?0:128),t>>>=3;for(let e=5;e<n;e++)this.buf[this.offset+e]=127&t|(e===n-1?0:128),t>>>=7;return this.offset+=n,n}appendInt64(t,e){if(!Number.isInteger(t)||!Number.isInteger(e))throw new RangeError("value is not an integer");if(t<-2147483648||t>2147483647||e<-2147483648||e>4294967295)throw new RangeError("number out of range");if(e>>>=0,0===t&&e<=2147483647)return this.appendInt32(e);if(-1===t&&e>=2147483648)return this.appendInt32(e-4294967296);const n=Math.ceil((65-Math.clz32(t>=0?t:-t-1))/7);this.offset+n>this.buf.byteLength&&this.grow();for(let t=0;t<4;t++)this.buf[this.offset+t]=127&e|128,e>>>=7;this.buf[this.offset+4]=15&e|(7&t)<<4|(5===n?0:128),t>>=3;for(let e=5;e<n;e++)this.buf[this.offset+e]=127&t|(e===n-1?0:128),t>>=7;return this.offset+=n,n}appendRawBytes(t){return this.offset+t.byteLength>this.buf.byteLength&&this.grow(this.offset+t.byteLength),this.buf.set(t,this.offset),this.offset+=t.byteLength,t.byteLength}appendRawString(t){if("string"!=typeof t)throw new TypeError("value is not a string");return this.appendRawBytes(r(t))}appendPrefixedBytes(t){return this.appendUint53(t.byteLength),this.appendRawBytes(t),this}appendPrefixedString(t){if("string"!=typeof t)throw new TypeError("value is not a string");return this.appendPrefixedBytes(r(t)),this}appendHexString(t){return this.appendPrefixedBytes(i(t)),this}finish(){}}class u{constructor(t){if(!(t instanceof Uint8Array))throw new TypeError(`Not a byte array: ${t}`);this.buf=t,this.offset=0}get done(){return this.offset===this.buf.byteLength}reset(){this.offset=0}skip(t){if(this.offset+t>this.buf.byteLength)throw new RangeError("cannot skip beyond end of buffer");this.offset+=t}readByte(){return this.offset+=1,this.buf[this.offset-1]}readUint32(){let t=0,e=0;for(;this.offset<this.buf.byteLength;){const n=this.buf[this.offset];if(28===e&&0!=(240&n))throw new RangeError("number out of range");if(t=(t|(127&n)<<e)>>>0,e+=7,this.offset++,0==(128&n))return t}throw new RangeError("buffer ended with incomplete number")}readInt32(){let t=0,e=0;for(;this.offset<this.buf.byteLength;){const n=this.buf[this.offset];if(28===e&&0!=(128&n)||28===e&&0==(64&n)&&0!=(56&n)||28===e&&0!=(64&n)&&56!=(56&n))throw new RangeError("number out of range");if(t|=(127&n)<<e,e+=7,this.offset++,0==(128&n))return 0==(64&n)||e>28?t:t|-1<<e}throw new RangeError("buffer ended with incomplete number")}readUint53(){const{low32:t,high32:e}=this.readUint64();if(e<0||e>2097151)throw new RangeError("number out of range");return 4294967296*e+t}readInt53(){const{low32:t,high32:e}=this.readInt64();if(e<-2097152||-2097152===e&&0===t||e>2097151)throw new RangeError("number out of range");return 4294967296*e+t}readUint64(){let t=0,e=0,n=0;for(;this.offset<this.buf.byteLength&&n<=28;){const r=this.buf[this.offset];if(t=(t|(127&r)<<n)>>>0,28===n&&(e=(112&r)>>>4),n+=7,this.offset++,0==(128&r))return{high32:e,low32:t}}for(n=3;this.offset<this.buf.byteLength;){const r=this.buf[this.offset];if(31===n&&0!=(254&r))throw new RangeError("number out of range");if(e=(e|(127&r)<<n)>>>0,n+=7,this.offset++,0==(128&r))return{high32:e,low32:t}}throw new RangeError("buffer ended with incomplete number")}readInt64(){let t=0,e=0,n=0;for(;this.offset<this.buf.byteLength&&n<=28;){const r=this.buf[this.offset];if(t=(t|(127&r)<<n)>>>0,28===n&&(e=(112&r)>>>4),n+=7,this.offset++,0==(128&r))return 0!=(64&r)&&(n<32&&(t=(t|-1<<n)>>>0),e|=-1<<Math.max(n-32,0)),{high32:e,low32:t}}for(n=3;this.offset<this.buf.byteLength;){const r=this.buf[this.offset];if(31===n&&0!==r&&127!==r)throw new RangeError("number out of range");if(e|=(127&r)<<n,n+=7,this.offset++,0==(128&r))return 0!=(64&r)&&n<32&&(e|=-1<<n),{high32:e,low32:t}}throw new RangeError("buffer ended with incomplete number")}readRawBytes(t){const e=this.offset;if(e+t>this.buf.byteLength)throw new RangeError("subarray exceeds buffer size");return this.offset+=t,this.buf.subarray(e,this.offset)}readRawString(t){return o(this.readRawBytes(t))}readPrefixedBytes(){return this.readRawBytes(this.readUint53())}readPrefixedString(){return o(this.readPrefixedBytes())}readHexString(){return s(this.readPrefixedBytes())}}class c extends a{constructor(t){super(),this.type=t,this.state="empty",this.lastValue=void 0,this.count=0,this.literal=[]}appendValue(t,e=1){this._appendValue(t,e)}_appendValue(t,e=1){e<=0||("empty"===this.state?(this.state=null===t?"nulls":1===e?"loneValue":"repetition",this.lastValue=t,this.count=e):"loneValue"===this.state?null===t?(this.flush(),this.state="nulls",this.count=e):t===this.lastValue?(this.state="repetition",this.count=1+e):e>1?(this.flush(),this.state="repetition",this.count=e,this.lastValue=t):(this.state="literal",this.literal=[this.lastValue],this.lastValue=t):"repetition"===this.state?null===t?(this.flush(),this.state="nulls",this.count=e):t===this.lastValue?this.count+=e:e>1?(this.flush(),this.state="repetition",this.count=e,this.lastValue=t):(this.flush(),this.state="loneValue",this.lastValue=t):"literal"===this.state?null===t?(this.literal.push(this.lastValue),this.flush(),this.state="nulls",this.count=e):t===this.lastValue?(this.flush(),this.state="repetition",this.count=1+e):e>1?(this.literal.push(this.lastValue),this.flush(),this.state="repetition",this.count=e,this.lastValue=t):(this.literal.push(this.lastValue),this.lastValue=t):"nulls"===this.state&&(null===t?this.count+=e:e>1?(this.flush(),this.state="repetition",this.count=e,this.lastValue=t):(this.flush(),this.state="loneValue",this.lastValue=t)))}copyFrom(t,e={}){const{count:n,sumValues:r,sumShift:o}=e;if(!(t instanceof l)||t.type!==this.type)throw new TypeError("incompatible type of decoder");let i="number"==typeof n?n:Number.MAX_SAFE_INTEGER,s=0,a=0;if(n&&i>0&&t.done)throw new RangeError(`cannot copy ${n} values`);if(0===i||t.done)return r?{nonNullValues:s,sum:a}:{nonNullValues:s};let u=t.readValue();if(null===u){const e=Math.min(t.count+1,i);if(i-=e,t.count-=e-1,this.appendValue(null,e),n&&i>0&&t.done)throw new RangeError(`cannot copy ${n} values`);if(0===i||t.done)return r?{nonNullValues:s,sum:a}:{nonNullValues:s};if(u=t.readValue(),null===u)throw new RangeError("null run must be followed by non-null value")}if(this.appendValue(u),i--,s++,r&&(a+=o?u>>>o:u),n&&i>0&&t.done)throw new RangeError(`cannot copy ${n} values`);if(0===i||t.done)return r?{nonNullValues:s,sum:a}:{nonNullValues:s};let c=t.count>0;for(;i>0&&!t.done;){c||t.readRecord();const e=Math.min(t.count,i);if(t.count-=e,"literal"===t.state){s+=e;for(let n=0;n<e;n++){if(t.done)throw new RangeError("incomplete literal");const e=t.readRawValue();if(e===t.lastValue)throw new RangeError("Repetition of values is not allowed in literal");t.lastValue=e,this._appendValue(e),r&&(a+=o?e>>>o:e)}}else if("repetition"===t.state){s+=e,r&&(a+=e*(o?t.lastValue>>>o:t.lastValue));const n=t.lastValue;if(this._appendValue(n),e>1){if(this._appendValue(n),"repetition"!==this.state)throw new RangeError(`Unexpected state ${this.state}`);this.count+=e-2}}else if("nulls"===t.state){if(this._appendValue(null),"nulls"!==this.state)throw new RangeError(`Unexpected state ${this.state}`);this.count+=e-1}c=!1,i-=e}if(n&&i>0&&t.done)throw new RangeError(`cannot copy ${n} values`);return r?{nonNullValues:s,sum:a}:{nonNullValues:s}}flush(){if("loneValue"===this.state)this.appendInt32(-1),this.appendRawValue(this.lastValue);else if("repetition"===this.state)this.appendInt53(this.count),this.appendRawValue(this.lastValue);else if("literal"===this.state){this.appendInt53(-this.literal.length);for(let t of this.literal)this.appendRawValue(t)}else"nulls"===this.state&&(this.appendInt32(0),this.appendUint53(this.count));this.state="empty"}appendRawValue(t){if("int"===this.type)this.appendInt53(t);else if("uint"===this.type)this.appendUint53(t);else{if("utf8"!==this.type)throw new RangeError(`Unknown RLEEncoder datatype: ${this.type}`);this.appendPrefixedString(t)}}finish(){"literal"===this.state&&this.literal.push(this.lastValue),("nulls"!==this.state||this.offset>0)&&this.flush()}}class l extends u{constructor(t,e){super(e),this.type=t,this.lastValue=void 0,this.count=0,this.state=void 0}get done(){return 0===this.count&&this.offset===this.buf.byteLength}reset(){this.offset=0,this.lastValue=void 0,this.count=0,this.state=void 0}readValue(){if(this.done)return null;if(0===this.count&&this.readRecord(),this.count-=1,"literal"===this.state){const t=this.readRawValue();if(t===this.lastValue)throw new RangeError("Repetition of values is not allowed in literal");return this.lastValue=t,t}return this.lastValue}skipValues(t){for(;t>0&&!this.done;){0===this.count&&(this.count=this.readInt53(),this.count>0?(this.lastValue=this.count<=t?this.skipRawValues(1):this.readRawValue(),this.state="repetition"):this.count<0?(this.count=-this.count,this.state="literal"):(this.count=this.readUint53(),this.lastValue=null,this.state="nulls"));const e=Math.min(t,this.count);"literal"===this.state&&this.skipRawValues(e),t-=e,this.count-=e}}readRecord(){if(this.count=this.readInt53(),this.count>1){const t=this.readRawValue();if(("repetition"===this.state||"literal"===this.state)&&this.lastValue===t)throw new RangeError("Successive repetitions with the same value are not allowed");this.state="repetition",this.lastValue=t}else{if(1===this.count)throw new RangeError("Repetition count of 1 is not allowed, use a literal instead");if(this.count<0){if(this.count=-this.count,"literal"===this.state)throw new RangeError("Successive literals are not allowed");this.state="literal"}else{if("nulls"===this.state)throw new RangeError("Successive null runs are not allowed");if(this.count=this.readUint53(),0===this.count)throw new RangeError("Zero-length null runs are not allowed");this.lastValue=null,this.state="nulls"}}}readRawValue(){if("int"===this.type)return this.readInt53();if("uint"===this.type)return this.readUint53();if("utf8"===this.type)return this.readPrefixedString();throw new RangeError(`Unknown RLEDecoder datatype: ${this.type}`)}skipRawValues(t){if("utf8"===this.type)for(let e=0;e<t;e++)this.skip(this.readUint53());else{for(;t>0&&this.offset<this.buf.byteLength;)0==(128&this.buf[this.offset])&&t--,this.offset++;if(t>0)throw new RangeError("cannot skip beyond end of buffer")}}}class h extends l{constructor(t){super("int",t),this.absoluteValue=0}reset(){this.offset=0,this.lastValue=void 0,this.count=0,this.state=void 0,this.absoluteValue=0}readValue(){const t=super.readValue();return null===t?null:(this.absoluteValue+=t,this.absoluteValue)}skipValues(t){for(;t>0&&!this.done;){0===this.count&&this.readRecord();const e=Math.min(t,this.count);if("literal"===this.state)for(let t=0;t<e;t++)this.lastValue=this.readRawValue(),this.absoluteValue+=this.lastValue;else"repetition"===this.state&&(this.absoluteValue+=e*this.lastValue);t-=e,this.count-=e}}}class f extends u{constructor(t){super(t),this.lastValue=!0,this.firstRun=!0,this.count=0}get done(){return 0===this.count&&this.offset===this.buf.byteLength}reset(){this.offset=0,this.lastValue=!0,this.firstRun=!0,this.count=0}readValue(){if(this.done)return!1;for(;0===this.count;){if(this.count=this.readUint53(),this.lastValue=!this.lastValue,0===this.count&&!this.firstRun)throw new RangeError("Zero-length runs are not allowed");this.firstRun=!1}return this.count-=1,this.lastValue}skipValues(t){for(;t>0&&!this.done;){if(0===this.count&&(this.count=this.readUint53(),this.lastValue=!this.lastValue,0===this.count))throw new RangeError("Zero-length runs are not allowed");this.count<t?(t-=this.count,this.count=0):(this.count-=t,t=0)}}}t.exports={stringToUtf8:r,utf8ToString:o,hexStringToBytes:i,bytesToHexString:s,Encoder:a,Decoder:u,RLEEncoder:c,RLEDecoder:l,DeltaEncoder:class extends c{constructor(){super("int"),this.absoluteValue=0}appendValue(t,e=1){e<=0||("number"==typeof t?(super.appendValue(t-this.absoluteValue,1),this.absoluteValue=t,e>1&&super.appendValue(0,e-1)):super.appendValue(t,e))}copyFrom(t,e={}){if(e.sumValues)throw new RangeError("unsupported options for DeltaEncoder.copyFrom()");if(!(t instanceof h))throw new TypeError("incompatible type of decoder");let n=e.count;if(n>0&&t.done)throw new RangeError(`cannot copy ${n} values`);if(0===n||t.done)return;let r=t.readValue(),o=0;if(this.appendValue(r),null===r){if(o=t.count+1,void 0!==n&&n<o&&(o=n),t.count-=o-1,this.count+=o-1,n>o&&t.done)throw new RangeError(`cannot copy ${n} values`);if(n===o||t.done)return;0===t.count&&this.appendValue(t.readValue())}void 0!==n&&(n-=o+1);const{nonNullValues:i,sum:s}=super.copyFrom(t,{count:n,sumValues:!0});i>0&&(this.absoluteValue=s,t.absoluteValue=s)}},DeltaDecoder:h,BooleanEncoder:class extends a{constructor(){super(),this.lastValue=!1,this.count=0}appendValue(t,e=1){if(!1!==t&&!0!==t)throw new RangeError(`Unsupported value for BooleanEncoder: ${t}`);e<=0||(this.lastValue===t?this.count+=e:(this.appendUint53(this.count),this.lastValue=t,this.count=e))}copyFrom(t,e={}){if(!(t instanceof f))throw new TypeError("incompatible type of decoder");const{count:n}=e;let r="number"==typeof n?n:Number.MAX_SAFE_INTEGER;if(n&&r>0&&t.done)throw new RangeError(`cannot copy ${n} values`);if(0===r||t.done)return;this.appendValue(t.readValue()),r--;const o=Math.min(t.count,r);for(this.count+=o,t.count-=o,r-=o;r>0&&!t.done;){if(t.count=t.readUint53(),0===t.count)throw new RangeError("Zero-length runs are not allowed");t.lastValue=!t.lastValue,this.appendUint53(this.count);const e=Math.min(t.count,r);this.count=e,this.lastValue=t.lastValue,t.count-=e,r-=e}if(n&&r>0&&t.done)throw new RangeError(`cannot copy ${n} values`)}finish(){this.count>0&&(this.appendUint53(this.count),this.count=0)}},BooleanDecoder:f}},function(t,e,n){var r;!function(e,o){var i={};!function(t){t.__esModule=!0,t.digestLength=32,t.blockSize=64;var e=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function n(t,n,r,o,i){for(var s,a,u,c,l,h,f,d,p,g,_,y,b;i>=64;){for(s=n[0],a=n[1],u=n[2],c=n[3],l=n[4],h=n[5],f=n[6],d=n[7],g=0;g<16;g++)_=o+4*g,t[g]=(255&r[_])<<24|(255&r[_+1])<<16|(255&r[_+2])<<8|255&r[_+3];for(g=16;g<64;g++)y=((p=t[g-2])>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,b=((p=t[g-15])>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,t[g]=(y+t[g-7]|0)+(b+t[g-16]|0);for(g=0;g<64;g++)y=(((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&h^~l&f)|0)+(d+(e[g]+t[g]|0)|0)|0,b=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&a^s&u^a&u)|0,d=f,f=h,h=l,l=c+y|0,c=u,u=a,a=s,s=y+b|0;n[0]+=s,n[1]+=a,n[2]+=u,n[3]+=c,n[4]+=l,n[5]+=h,n[6]+=f,n[7]+=d,o+=64,i-=64}return o}var r=function(){function e(){this.digestLength=t.digestLength,this.blockSize=t.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return e.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},e.prototype.clean=function(){for(var t=0;t<this.buffer.length;t++)this.buffer[t]=0;for(t=0;t<this.temp.length;t++)this.temp[t]=0;this.reset()},e.prototype.update=function(t,e){if(void 0===e&&(e=t.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var r=0;if(this.bytesHashed+=e,this.bufferLength>0){for(;this.bufferLength<64&&e>0;)this.buffer[this.bufferLength++]=t[r++],e--;64===this.bufferLength&&(n(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(e>=64&&(r=n(this.temp,this.state,t,r,e),e%=64);e>0;)this.buffer[this.bufferLength++]=t[r++],e--;return this},e.prototype.finish=function(t){if(!this.finished){var e=this.bytesHashed,r=this.bufferLength,o=e/536870912|0,i=e<<3,s=e%64<56?64:128;this.buffer[r]=128;for(var a=r+1;a<s-8;a++)this.buffer[a]=0;this.buffer[s-8]=o>>>24&255,this.buffer[s-7]=o>>>16&255,this.buffer[s-6]=o>>>8&255,this.buffer[s-5]=o>>>0&255,this.buffer[s-4]=i>>>24&255,this.buffer[s-3]=i>>>16&255,this.buffer[s-2]=i>>>8&255,this.buffer[s-1]=i>>>0&255,n(this.temp,this.state,this.buffer,0,s),this.finished=!0}for(a=0;a<8;a++)t[4*a+0]=this.state[a]>>>24&255,t[4*a+1]=this.state[a]>>>16&255,t[4*a+2]=this.state[a]>>>8&255,t[4*a+3]=this.state[a]>>>0&255;return this},e.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},e.prototype._saveState=function(t){for(var e=0;e<this.state.length;e++)t[e]=this.state[e]},e.prototype._restoreState=function(t,e){for(var n=0;n<this.state.length;n++)this.state[n]=t[n];this.bytesHashed=e,this.finished=!1,this.bufferLength=0},e}();t.Hash=r;var o=function(){function t(t){this.inner=new r,this.outer=new r,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var e=new Uint8Array(this.blockSize);if(t.length>this.blockSize)(new r).update(t).finish(e).clean();else for(var n=0;n<t.length;n++)e[n]=t[n];for(n=0;n<e.length;n++)e[n]^=54;this.inner.update(e);for(n=0;n<e.length;n++)e[n]^=106;this.outer.update(e),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(n=0;n<e.length;n++)e[n]=0}return t.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},t.prototype.clean=function(){for(var t=0;t<this.istate.length;t++)this.ostate[t]=this.istate[t]=0;this.inner.clean(),this.outer.clean()},t.prototype.update=function(t){return this.inner.update(t),this},t.prototype.finish=function(t){return this.outer.finished?this.outer.finish(t):(this.inner.finish(t),this.outer.update(t,this.digestLength).finish(t)),this},t.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},t}();function i(t){var e=(new r).update(t),n=e.digest();return e.clean(),n}function s(t,e){var n=new o(t).update(e),r=n.digest();return n.clean(),r}function a(t,e,n,r){var o=r[0];if(0===o)throw new Error("hkdf: cannot expand more");e.reset(),o>1&&e.update(t),n&&e.update(n),e.update(r),e.finish(t),r[0]++}t.HMAC=o,t.hash=i,t.default=i,t.hmac=s;var u=new Uint8Array(t.digestLength);function c(t,e,n,r){void 0===e&&(e=u),void 0===r&&(r=32);for(var i=new Uint8Array([1]),c=s(e,t),l=new o(c),h=new Uint8Array(l.digestLength),f=h.length,d=new Uint8Array(r),p=0;p<r;p++)f===h.length&&(a(h,l,n,i),f=0),d[p]=h[f++];return l.clean(),h.fill(0),i.fill(0),d}function l(t,e,n,r){for(var i=new o(t),s=i.digestLength,a=new Uint8Array(4),u=new Uint8Array(s),c=new Uint8Array(s),l=new Uint8Array(r),h=0;h*s<r;h++){var f=h+1;a[0]=f>>>24&255,a[1]=f>>>16&255,a[2]=f>>>8&255,a[3]=f>>>0&255,i.reset(),i.update(e),i.update(a),i.finish(c);for(var d=0;d<s;d++)u[d]=c[d];for(d=2;d<=n;d++){i.reset(),i.update(c).finish(c);for(var p=0;p<s;p++)u[p]^=c[p]}for(d=0;d<s&&h*s+d<r;d++)l[h*s+d]=u[d]}for(h=0;h<s;h++)u[h]=c[h]=0;for(h=0;h<4;h++)a[h]=0;return i.clean(),l}t.hkdf=c,t.pbkdf2=l}(i);var s=i.default;for(var a in i)s[a]=i[a];"object"==typeof t.exports?t.exports=s:void 0===(r=function(){return s}.call(i,n,i,t))||(t.exports=r)}()},function(t,e,n){const{init:r,clone:o,free:i,applyChanges:s,applyLocalChange:a,save:u,load:c,loadChanges:l,getPatch:h,getHeads:f,getAllChanges:d,getChanges:p,getChangesAdded:g,getChangeByHash:_,getMissingDeps:y}=n(35),{receiveSyncMessage:b,generateSyncMessage:w,encodeSyncMessage:m,decodeSyncMessage:v,encodeSyncState:I,decodeSyncState:k,initSyncState:x}=n(40);t.exports={init:r,clone:o,free:i,applyChanges:s,applyLocalChange:a,save:u,load:c,loadChanges:l,getPatch:h,getHeads:f,getAllChanges:d,getChanges:p,getChangesAdded:g,getChangeByHash:_,getMissingDeps:y,receiveSyncMessage:b,generateSyncMessage:w,encodeSyncMessage:m,decodeSyncMessage:v,encodeSyncState:I,decodeSyncState:k,initSyncState:x}},function(t,e,n){const{Map:r,List:o}=n(36),i=n(37),{splitContainers:s,encodeChange:a,decodeChanges:u,encodeDocument:c,constructPatch:l,BackendDoc:h}=n(15),{backendState:f}=n(39);function d(t,e,n){return t.getIn(["opSet","states",e,n])}function p(){return{state:r({opSet:i.init(),objectIds:r()}),heads:[]}}function g(t,e,n,r){const o={clock:t.getIn(["opSet","states"]).map((t=>t.size)).toObject(),deps:t.getIn(["opSet","deps"]).toArray().sort(),diffs:e,maxOp:t.getIn(["opSet","maxOp"],0),pendingChanges:i.getMissingDeps(t.get("opSet")).length};if(r&&n){o.actor=n.actor,o.seq=n.seq;const e=t.getIn(["opSet","states",n.actor,n.seq-1]);o.deps=o.deps.filter((t=>t!==e))}return o}function _(t,e,n,r){let o=r?{objectId:"_root",type:"map",props:{}}:null,a=t.get("opSet");for(let t of e)for(let e of s(t))a=n?i.addLocalChange(a,e,o):i.addChange(a,e,o);return i.finalizePatch(o),[t=t.set("opSet",a),r?g(t,o,n,!0):null]}function y(t){return c(w(t))}function b(t,e){const n=f(t);{const[r]=_(n,e,null,!1);return t.frozen=!0,{state:r,heads:i.getHeads(r.get("opSet"))}}}function w(t){return m(t,[])}function m(t,e){if(!Array.isArray(e))throw new TypeError("Pass an array of hashes to Backend.getChanges()");const n=f(t);return i.getMissingChanges(n.get("opSet"),o(e))}t.exports={init:p,clone:function(t){return{state:f(t),heads:t.heads}},free:function(t){t.state=null,t.frozen=!0},applyChanges:function(t,e){{let[n,r]=_(f(t),e,null,!0);const o=i.getHeads(n.get("opSet"));return t.frozen=!0,[{state:n,heads:o},r]}},applyLocalChange:function(t,e){const n=f(t);if(e.seq<=function(t,e){return t.getIn(["opSet","states",e],o()).size}(n,e.actor))throw new RangeError("Change request has already been applied");if(e.seq>1){const t=d(n,e.actor,e.seq-2);if(!t)throw new RangeError(`Cannot find hash of localChange before seq=${e.seq}`);let r={[t]:!0};for(let t of e.deps)r[t]=!0;e.deps=Object.keys(r).sort()}const r=a(e);{const o={actor:e.actor,seq:e.seq},[s,a]=_(n,[r],o,!0),u=i.getHeads(s.get("opSet"));return t.frozen=!0,[{state:s,heads:u},a,r]}},save:y,load:function(t){{const e=u([t]).map(a);return b(p(),e)}},loadChanges:b,getPatch:function(t){const e=f(t);return g(e,l(y(t)),null,!1)},getHeads:function(t){return t.heads},getAllChanges:w,getChanges:m,getChangesAdded:function(t,e){const n=f(t).get("opSet"),r=f(e).get("opSet");return i.getChangesAdded(n,r)},getChangeByHash:function(t,e){const n=f(t);return i.getChangeByHash(n.get("opSet"),e)},getMissingDeps:function(t,e=[]){const n=f(t);return i.getMissingDeps(n.get("opSet"),e)}}},function(t){t.exports=function(){var t=Array.prototype.slice;function e(t,e){e&&(t.prototype=Object.create(e.prototype)),t.prototype.constructor=t}function n(t){return s(t)?t:Z(t)}function r(t){return a(t)?t:W(t)}function o(t){return u(t)?t:G(t)}function i(t){return s(t)&&!c(t)?t:J(t)}function s(t){return!(!t||!t[h])}function a(t){return!(!t||!t[f])}function u(t){return!(!t||!t[d])}function c(t){return a(t)||u(t)}function l(t){return!(!t||!t[p])}e(r,n),e(o,n),e(i,n),n.isIterable=s,n.isKeyed=a,n.isIndexed=u,n.isAssociative=c,n.isOrdered=l,n.Keyed=r,n.Indexed=o,n.Set=i;var h="@@__IMMUTABLE_ITERABLE__@@",f="@@__IMMUTABLE_KEYED__@@",d="@@__IMMUTABLE_INDEXED__@@",p="@@__IMMUTABLE_ORDERED__@@",g="delete",_=5,y=1<<_,b=y-1,w={},m={value:!1},v={value:!1};function I(t){return t.value=!1,t}function k(t){t&&(t.value=!0)}function x(){}function E(t,e){e=e||0;for(var n=Math.max(0,t.length-e),r=new Array(n),o=0;o<n;o++)r[o]=t[o+e];return r}function O(t){return void 0===t.size&&(t.size=t.__iterate(S)),t.size}function A(t,e){if("number"!=typeof e){var n=e>>>0;if(""+n!==e||4294967295===n)return NaN;e=n}return e<0?O(t)+e:e}function S(){return!0}function j(t,e,n){return(0===t||void 0!==n&&t<=-n)&&(void 0===e||void 0!==n&&e>=n)}function R(t,e){return z(t,e,0)}function C(t,e){return z(t,e,e)}function z(t,e,n){return void 0===t?n:t<0?Math.max(0,e+t):void 0===e?t:Math.min(e,t)}var V=0,L=1,T=2,U="function"==typeof Symbol&&Symbol.iterator,D="@@iterator",M=U||D;function N(t){this.next=t}function B(t,e,n,r){var o=0===t?e:1===t?n:[e,n];return r?r.value=o:r={value:o,done:!1},r}function $(){return{value:void 0,done:!0}}function q(t){return!!K(t)}function P(t){return t&&"function"==typeof t.next}function H(t){var e=K(t);return e&&e.call(t)}function K(t){var e=t&&(U&&t[U]||t[D]);if("function"==typeof e)return e}function F(t){return t&&"number"==typeof t.length}function Z(t){return null==t?st():s(t)?t.toSeq():ct(t)}function W(t){return null==t?st().toKeyedSeq():s(t)?a(t)?t.toSeq():t.fromEntrySeq():at(t)}function G(t){return null==t?st():s(t)?a(t)?t.entrySeq():t.toIndexedSeq():ut(t)}function J(t){return(null==t?st():s(t)?a(t)?t.entrySeq():t:ut(t)).toSetSeq()}N.prototype.toString=function(){return"[Iterator]"},N.KEYS=V,N.VALUES=L,N.ENTRIES=T,N.prototype.inspect=N.prototype.toSource=function(){return this.toString()},N.prototype[M]=function(){return this},e(Z,n),Z.of=function(){return Z(arguments)},Z.prototype.toSeq=function(){return this},Z.prototype.toString=function(){return this.__toString("Seq {","}")},Z.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},Z.prototype.__iterate=function(t,e){return ht(this,t,e,!0)},Z.prototype.__iterator=function(t,e){return ft(this,t,e,!0)},e(W,Z),W.prototype.toKeyedSeq=function(){return this},e(G,Z),G.of=function(){return G(arguments)},G.prototype.toIndexedSeq=function(){return this},G.prototype.toString=function(){return this.__toString("Seq [","]")},G.prototype.__iterate=function(t,e){return ht(this,t,e,!1)},G.prototype.__iterator=function(t,e){return ft(this,t,e,!1)},e(J,Z),J.of=function(){return J(arguments)},J.prototype.toSetSeq=function(){return this},Z.isSeq=it,Z.Keyed=W,Z.Set=J,Z.Indexed=G;var Y,X,Q,tt="@@__IMMUTABLE_SEQ__@@";function et(t){this._array=t,this.size=t.length}function nt(t){var e=Object.keys(t);this._object=t,this._keys=e,this.size=e.length}function rt(t){this._iterable=t,this.size=t.length||t.size}function ot(t){this._iterator=t,this._iteratorCache=[]}function it(t){return!(!t||!t[tt])}function st(){return Y||(Y=new et([]))}function at(t){var e=Array.isArray(t)?new et(t).fromEntrySeq():P(t)?new ot(t).fromEntrySeq():q(t)?new rt(t).fromEntrySeq():"object"==typeof t?new nt(t):void 0;if(!e)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+t);return e}function ut(t){var e=lt(t);if(!e)throw new TypeError("Expected Array or iterable object of values: "+t);return e}function ct(t){var e=lt(t)||"object"==typeof t&&new nt(t);if(!e)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+t);return e}function lt(t){return F(t)?new et(t):P(t)?new ot(t):q(t)?new rt(t):void 0}function ht(t,e,n,r){var o=t._cache;if(o){for(var i=o.length-1,s=0;s<=i;s++){var a=o[n?i-s:s];if(!1===e(a[1],r?a[0]:s,t))return s+1}return s}return t.__iterateUncached(e,n)}function ft(t,e,n,r){var o=t._cache;if(o){var i=o.length-1,s=0;return new N((function(){var t=o[n?i-s:s];return s++>i?$():B(e,r?t[0]:s-1,t[1])}))}return t.__iteratorUncached(e,n)}function dt(t,e){return e?pt(e,t,"",{"":t}):gt(t)}function pt(t,e,n,r){return Array.isArray(e)?t.call(r,n,G(e).map((function(n,r){return pt(t,n,r,e)}))):_t(e)?t.call(r,n,W(e).map((function(n,r){return pt(t,n,r,e)}))):e}function gt(t){return Array.isArray(t)?G(t).map(gt).toList():_t(t)?W(t).map(gt).toMap():t}function _t(t){return t&&(t.constructor===Object||void 0===t.constructor)}function yt(t,e){if(t===e||t!=t&&e!=e)return!0;if(!t||!e)return!1;if("function"==typeof t.valueOf&&"function"==typeof e.valueOf){if((t=t.valueOf())===(e=e.valueOf())||t!=t&&e!=e)return!0;if(!t||!e)return!1}return!("function"!=typeof t.equals||"function"!=typeof e.equals||!t.equals(e))}function bt(t,e){if(t===e)return!0;if(!s(e)||void 0!==t.size&&void 0!==e.size&&t.size!==e.size||void 0!==t.__hash&&void 0!==e.__hash&&t.__hash!==e.__hash||a(t)!==a(e)||u(t)!==u(e)||l(t)!==l(e))return!1;if(0===t.size&&0===e.size)return!0;var n=!c(t);if(l(t)){var r=t.entries();return e.every((function(t,e){var o=r.next().value;return o&&yt(o[1],t)&&(n||yt(o[0],e))}))&&r.next().done}var o=!1;if(void 0===t.size)if(void 0===e.size)"function"==typeof t.cacheResult&&t.cacheResult();else{o=!0;var i=t;t=e,e=i}var h=!0,f=e.__iterate((function(e,r){if(n?!t.has(e):o?!yt(e,t.get(r,w)):!yt(t.get(r,w),e))return h=!1,!1}));return h&&t.size===f}function wt(t,e){if(!(this instanceof wt))return new wt(t,e);if(this._value=t,this.size=void 0===e?1/0:Math.max(0,e),0===this.size){if(X)return X;X=this}}function mt(t,e){if(!t)throw new Error(e)}function vt(t,e,n){if(!(this instanceof vt))return new vt(t,e,n);if(mt(0!==n,"Cannot step a Range by 0"),t=t||0,void 0===e&&(e=1/0),n=void 0===n?1:Math.abs(n),e<t&&(n=-n),this._start=t,this._end=e,this._step=n,this.size=Math.max(0,Math.ceil((e-t)/n-1)+1),0===this.size){if(Q)return Q;Q=this}}function It(){throw TypeError("Abstract")}function kt(){}function xt(){}function Et(){}Z.prototype[tt]=!0,e(et,G),et.prototype.get=function(t,e){return this.has(t)?this._array[A(this,t)]:e},et.prototype.__iterate=function(t,e){for(var n=this._array,r=n.length-1,o=0;o<=r;o++)if(!1===t(n[e?r-o:o],o,this))return o+1;return o},et.prototype.__iterator=function(t,e){var n=this._array,r=n.length-1,o=0;return new N((function(){return o>r?$():B(t,o,n[e?r-o++:o++])}))},e(nt,W),nt.prototype.get=function(t,e){return void 0===e||this.has(t)?this._object[t]:e},nt.prototype.has=function(t){return this._object.hasOwnProperty(t)},nt.prototype.__iterate=function(t,e){for(var n=this._object,r=this._keys,o=r.length-1,i=0;i<=o;i++){var s=r[e?o-i:i];if(!1===t(n[s],s,this))return i+1}return i},nt.prototype.__iterator=function(t,e){var n=this._object,r=this._keys,o=r.length-1,i=0;return new N((function(){var s=r[e?o-i:i];return i++>o?$():B(t,s,n[s])}))},nt.prototype[p]=!0,e(rt,G),rt.prototype.__iterateUncached=function(t,e){if(e)return this.cacheResult().__iterate(t,e);var n=H(this._iterable),r=0;if(P(n))for(var o;!(o=n.next()).done&&!1!==t(o.value,r++,this););return r},rt.prototype.__iteratorUncached=function(t,e){if(e)return this.cacheResult().__iterator(t,e);var n=H(this._iterable);if(!P(n))return new N($);var r=0;return new N((function(){var e=n.next();return e.done?e:B(t,r++,e.value)}))},e(ot,G),ot.prototype.__iterateUncached=function(t,e){if(e)return this.cacheResult().__iterate(t,e);for(var n,r=this._iterator,o=this._iteratorCache,i=0;i<o.length;)if(!1===t(o[i],i++,this))return i;for(;!(n=r.next()).done;){var s=n.value;if(o[i]=s,!1===t(s,i++,this))break}return i},ot.prototype.__iteratorUncached=function(t,e){if(e)return this.cacheResult().__iterator(t,e);var n=this._iterator,r=this._iteratorCache,o=0;return new N((function(){if(o>=r.length){var e=n.next();if(e.done)return e;r[o]=e.value}return B(t,o,r[o++])}))},e(wt,G),wt.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},wt.prototype.get=function(t,e){return this.has(t)?this._value:e},wt.prototype.includes=function(t){return yt(this._value,t)},wt.prototype.slice=function(t,e){var n=this.size;return j(t,e,n)?this:new wt(this._value,C(e,n)-R(t,n))},wt.prototype.reverse=function(){return this},wt.prototype.indexOf=function(t){return yt(this._value,t)?0:-1},wt.prototype.lastIndexOf=function(t){return yt(this._value,t)?this.size:-1},wt.prototype.__iterate=function(t,e){for(var n=0;n<this.size;n++)if(!1===t(this._value,n,this))return n+1;return n},wt.prototype.__iterator=function(t,e){var n=this,r=0;return new N((function(){return r<n.size?B(t,r++,n._value):$()}))},wt.prototype.equals=function(t){return t instanceof wt?yt(this._value,t._value):bt(t)},e(vt,G),vt.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},vt.prototype.get=function(t,e){return this.has(t)?this._start+A(this,t)*this._step:e},vt.prototype.includes=function(t){var e=(t-this._start)/this._step;return e>=0&&e<this.size&&e===Math.floor(e)},vt.prototype.slice=function(t,e){return j(t,e,this.size)?this:(t=R(t,this.size),(e=C(e,this.size))<=t?new vt(0,0):new vt(this.get(t,this._end),this.get(e,this._end),this._step))},vt.prototype.indexOf=function(t){var e=t-this._start;if(e%this._step==0){var n=e/this._step;if(n>=0&&n<this.size)return n}return-1},vt.prototype.lastIndexOf=function(t){return this.indexOf(t)},vt.prototype.__iterate=function(t,e){for(var n=this.size-1,r=this._step,o=e?this._start+n*r:this._start,i=0;i<=n;i++){if(!1===t(o,i,this))return i+1;o+=e?-r:r}return i},vt.prototype.__iterator=function(t,e){var n=this.size-1,r=this._step,o=e?this._start+n*r:this._start,i=0;return new N((function(){var s=o;return o+=e?-r:r,i>n?$():B(t,i++,s)}))},vt.prototype.equals=function(t){return t instanceof vt?this._start===t._start&&this._end===t._end&&this._step===t._step:bt(this,t)},e(It,n),e(kt,It),e(xt,It),e(Et,It),It.Keyed=kt,It.Indexed=xt,It.Set=Et;var Ot="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(t,e){var n=65535&(t|=0),r=65535&(e|=0);return n*r+((t>>>16)*r+n*(e>>>16)<<16>>>0)|0};function At(t){return t>>>1&1073741824|3221225471&t}function St(t){if(!1===t||null==t)return 0;if("function"==typeof t.valueOf&&(!1===(t=t.valueOf())||null==t))return 0;if(!0===t)return 1;var e=typeof t;if("number"===e){if(t!=t||t===1/0)return 0;var n=0|t;for(n!==t&&(n^=4294967295*t);t>4294967295;)n^=t/=4294967295;return At(n)}if("string"===e)return t.length>Nt?jt(t):Rt(t);if("function"==typeof t.hashCode)return t.hashCode();if("object"===e)return Ct(t);if("function"==typeof t.toString)return Rt(t.toString());throw new Error("Value type "+e+" cannot be hashed.")}function jt(t){var e=qt[t];return void 0===e&&(e=Rt(t),$t===Bt&&($t=0,qt={}),$t++,qt[t]=e),e}function Rt(t){for(var e=0,n=0;n<t.length;n++)e=31*e+t.charCodeAt(n)|0;return At(e)}function Ct(t){var e;if(Ut&&void 0!==(e=Tt.get(t)))return e;if(void 0!==(e=t[Mt]))return e;if(!Vt){if(void 0!==(e=t.propertyIsEnumerable&&t.propertyIsEnumerable[Mt]))return e;if(void 0!==(e=Lt(t)))return e}if(e=++Dt,1073741824&Dt&&(Dt=0),Ut)Tt.set(t,e);else{if(void 0!==zt&&!1===zt(t))throw new Error("Non-extensible objects are not allowed as keys.");if(Vt)Object.defineProperty(t,Mt,{enumerable:!1,configurable:!1,writable:!1,value:e});else if(void 0!==t.propertyIsEnumerable&&t.propertyIsEnumerable===t.constructor.prototype.propertyIsEnumerable)t.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},t.propertyIsEnumerable[Mt]=e;else{if(void 0===t.nodeType)throw new Error("Unable to set a non-enumerable property on object.");t[Mt]=e}}return e}var zt=Object.isExtensible,Vt=function(){try{return Object.defineProperty({},"@",{}),!0}catch(t){return!1}}();function Lt(t){if(t&&t.nodeType>0)switch(t.nodeType){case 1:return t.uniqueID;case 9:return t.documentElement&&t.documentElement.uniqueID}}var Tt,Ut="function"==typeof WeakMap;Ut&&(Tt=new WeakMap);var Dt=0,Mt="__immutablehash__";"function"==typeof Symbol&&(Mt=Symbol(Mt));var Nt=16,Bt=255,$t=0,qt={};function Pt(t){mt(t!==1/0,"Cannot perform this action with an infinite size.")}function Ht(t){return null==t?oe():Kt(t)&&!l(t)?t:oe().withMutations((function(e){var n=r(t);Pt(n.size),n.forEach((function(t,n){return e.set(n,t)}))}))}function Kt(t){return!(!t||!t[Zt])}e(Ht,kt),Ht.of=function(){var e=t.call(arguments,0);return oe().withMutations((function(t){for(var n=0;n<e.length;n+=2){if(n+1>=e.length)throw new Error("Missing value for key: "+e[n]);t.set(e[n],e[n+1])}}))},Ht.prototype.toString=function(){return this.__toString("Map {","}")},Ht.prototype.get=function(t,e){return this._root?this._root.get(0,void 0,t,e):e},Ht.prototype.set=function(t,e){return ie(this,t,e)},Ht.prototype.setIn=function(t,e){return this.updateIn(t,w,(function(){return e}))},Ht.prototype.remove=function(t){return ie(this,t,w)},Ht.prototype.deleteIn=function(t){return this.updateIn(t,(function(){return w}))},Ht.prototype.update=function(t,e,n){return 1===arguments.length?t(this):this.updateIn([t],e,n)},Ht.prototype.updateIn=function(t,e,n){n||(n=e,e=void 0);var r=_e(this,In(t),e,n);return r===w?void 0:r},Ht.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):oe()},Ht.prototype.merge=function(){return fe(this,void 0,arguments)},Ht.prototype.mergeWith=function(e){return fe(this,e,t.call(arguments,1))},Ht.prototype.mergeIn=function(e){var n=t.call(arguments,1);return this.updateIn(e,oe(),(function(t){return"function"==typeof t.merge?t.merge.apply(t,n):n[n.length-1]}))},Ht.prototype.mergeDeep=function(){return fe(this,de,arguments)},Ht.prototype.mergeDeepWith=function(e){var n=t.call(arguments,1);return fe(this,pe(e),n)},Ht.prototype.mergeDeepIn=function(e){var n=t.call(arguments,1);return this.updateIn(e,oe(),(function(t){return"function"==typeof t.mergeDeep?t.mergeDeep.apply(t,n):n[n.length-1]}))},Ht.prototype.sort=function(t){return qe(hn(this,t))},Ht.prototype.sortBy=function(t,e){return qe(hn(this,e,t))},Ht.prototype.withMutations=function(t){var e=this.asMutable();return t(e),e.wasAltered()?e.__ensureOwner(this.__ownerID):this},Ht.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new x)},Ht.prototype.asImmutable=function(){return this.__ensureOwner()},Ht.prototype.wasAltered=function(){return this.__altered},Ht.prototype.__iterator=function(t,e){return new te(this,t,e)},Ht.prototype.__iterate=function(t,e){var n=this,r=0;return this._root&&this._root.iterate((function(e){return r++,t(e[1],e[0],n)}),e),r},Ht.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?re(this.size,this._root,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)},Ht.isMap=Kt;var Ft,Zt="@@__IMMUTABLE_MAP__@@",Wt=Ht.prototype;function Gt(t,e){this.ownerID=t,this.entries=e}function Jt(t,e,n){this.ownerID=t,this.bitmap=e,this.nodes=n}function Yt(t,e,n){this.ownerID=t,this.count=e,this.nodes=n}function Xt(t,e,n){this.ownerID=t,this.keyHash=e,this.entries=n}function Qt(t,e,n){this.ownerID=t,this.keyHash=e,this.entry=n}function te(t,e,n){this._type=e,this._reverse=n,this._stack=t._root&&ne(t._root)}function ee(t,e){return B(t,e[0],e[1])}function ne(t,e){return{node:t,index:0,__prev:e}}function re(t,e,n,r){var o=Object.create(Wt);return o.size=t,o._root=e,o.__ownerID=n,o.__hash=r,o.__altered=!1,o}function oe(){return Ft||(Ft=re(0))}function ie(t,e,n){var r,o;if(t._root){var i=I(m),s=I(v);if(r=se(t._root,t.__ownerID,0,void 0,e,n,i,s),!s.value)return t;o=t.size+(i.value?n===w?-1:1:0)}else{if(n===w)return t;o=1,r=new Gt(t.__ownerID,[[e,n]])}return t.__ownerID?(t.size=o,t._root=r,t.__hash=void 0,t.__altered=!0,t):r?re(o,r):oe()}function se(t,e,n,r,o,i,s,a){return t?t.update(e,n,r,o,i,s,a):i===w?t:(k(a),k(s),new Qt(e,r,[o,i]))}function ae(t){return t.constructor===Qt||t.constructor===Xt}function ue(t,e,n,r,o){if(t.keyHash===r)return new Xt(e,r,[t.entry,o]);var i,s=(0===n?t.keyHash:t.keyHash>>>n)&b,a=(0===n?r:r>>>n)&b;return new Jt(e,1<<s|1<<a,s===a?[ue(t,e,n+_,r,o)]:(i=new Qt(e,r,o),s<a?[t,i]:[i,t]))}function ce(t,e,n,r){t||(t=new x);for(var o=new Qt(t,St(n),[n,r]),i=0;i<e.length;i++){var s=e[i];o=o.update(t,0,void 0,s[0],s[1])}return o}function le(t,e,n,r){for(var o=0,i=0,s=new Array(n),a=0,u=1,c=e.length;a<c;a++,u<<=1){var l=e[a];void 0!==l&&a!==r&&(o|=u,s[i++]=l)}return new Jt(t,o,s)}function he(t,e,n,r,o){for(var i=0,s=new Array(y),a=0;0!==n;a++,n>>>=1)s[a]=1&n?e[i++]:void 0;return s[r]=o,new Yt(t,i+1,s)}function fe(t,e,n){for(var o=[],i=0;i<n.length;i++){var a=n[i],u=r(a);s(a)||(u=u.map((function(t){return dt(t)}))),o.push(u)}return ge(t,e,o)}function de(t,e,n){return t&&t.mergeDeep&&s(e)?t.mergeDeep(e):yt(t,e)?t:e}function pe(t){return function(e,n,r){if(e&&e.mergeDeepWith&&s(n))return e.mergeDeepWith(t,n);var o=t(e,n,r);return yt(e,o)?e:o}}function ge(t,e,n){return 0===(n=n.filter((function(t){return 0!==t.size}))).length?t:0!==t.size||t.__ownerID||1!==n.length?t.withMutations((function(t){for(var r=e?function(n,r){t.update(r,w,(function(t){return t===w?n:e(t,n,r)}))}:function(e,n){t.set(n,e)},o=0;o<n.length;o++)n[o].forEach(r)})):t.constructor(n[0])}function _e(t,e,n,r){var o=t===w,i=e.next();if(i.done){var s=o?n:t,a=r(s);return a===s?t:a}mt(o||t&&t.set,"invalid keyPath");var u=i.value,c=o?w:t.get(u,w),l=_e(c,e,n,r);return l===c?t:l===w?t.remove(u):(o?oe():t).set(u,l)}function ye(t){return t=(t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135,t+=t>>8,127&(t+=t>>16)}function be(t,e,n,r){var o=r?t:E(t);return o[e]=n,o}function we(t,e,n,r){var o=t.length+1;if(r&&e+1===o)return t[e]=n,t;for(var i=new Array(o),s=0,a=0;a<o;a++)a===e?(i[a]=n,s=-1):i[a]=t[a+s];return i}function me(t,e,n){var r=t.length-1;if(n&&e===r)return t.pop(),t;for(var o=new Array(r),i=0,s=0;s<r;s++)s===e&&(i=1),o[s]=t[s+i];return o}Wt[Zt]=!0,Wt[g]=Wt.remove,Wt.removeIn=Wt.deleteIn,Gt.prototype.get=function(t,e,n,r){for(var o=this.entries,i=0,s=o.length;i<s;i++)if(yt(n,o[i][0]))return o[i][1];return r},Gt.prototype.update=function(t,e,n,r,o,i,s){for(var a=o===w,u=this.entries,c=0,l=u.length;c<l&&!yt(r,u[c][0]);c++);var h=c<l;if(h?u[c][1]===o:a)return this;if(k(s),(a||!h)&&k(i),!a||1!==u.length){if(!h&&!a&&u.length>=ve)return ce(t,u,r,o);var f=t&&t===this.ownerID,d=f?u:E(u);return h?a?c===l-1?d.pop():d[c]=d.pop():d[c]=[r,o]:d.push([r,o]),f?(this.entries=d,this):new Gt(t,d)}},Jt.prototype.get=function(t,e,n,r){void 0===e&&(e=St(n));var o=1<<((0===t?e:e>>>t)&b),i=this.bitmap;return 0==(i&o)?r:this.nodes[ye(i&o-1)].get(t+_,e,n,r)},Jt.prototype.update=function(t,e,n,r,o,i,s){void 0===n&&(n=St(r));var a=(0===e?n:n>>>e)&b,u=1<<a,c=this.bitmap,l=0!=(c&u);if(!l&&o===w)return this;var h=ye(c&u-1),f=this.nodes,d=l?f[h]:void 0,p=se(d,t,e+_,n,r,o,i,s);if(p===d)return this;if(!l&&p&&f.length>=Ie)return he(t,f,c,a,p);if(l&&!p&&2===f.length&&ae(f[1^h]))return f[1^h];if(l&&p&&1===f.length&&ae(p))return p;var g=t&&t===this.ownerID,y=l?p?c:c^u:c|u,m=l?p?be(f,h,p,g):me(f,h,g):we(f,h,p,g);return g?(this.bitmap=y,this.nodes=m,this):new Jt(t,y,m)},Yt.prototype.get=function(t,e,n,r){void 0===e&&(e=St(n));var o=(0===t?e:e>>>t)&b,i=this.nodes[o];return i?i.get(t+_,e,n,r):r},Yt.prototype.update=function(t,e,n,r,o,i,s){void 0===n&&(n=St(r));var a=(0===e?n:n>>>e)&b,u=o===w,c=this.nodes,l=c[a];if(u&&!l)return this;var h=se(l,t,e+_,n,r,o,i,s);if(h===l)return this;var f=this.count;if(l){if(!h&&--f<ke)return le(t,c,f,a)}else f++;var d=t&&t===this.ownerID,p=be(c,a,h,d);return d?(this.count=f,this.nodes=p,this):new Yt(t,f,p)},Xt.prototype.get=function(t,e,n,r){for(var o=this.entries,i=0,s=o.length;i<s;i++)if(yt(n,o[i][0]))return o[i][1];return r},Xt.prototype.update=function(t,e,n,r,o,i,s){void 0===n&&(n=St(r));var a=o===w;if(n!==this.keyHash)return a?this:(k(s),k(i),ue(this,t,e,n,[r,o]));for(var u=this.entries,c=0,l=u.length;c<l&&!yt(r,u[c][0]);c++);var h=c<l;if(h?u[c][1]===o:a)return this;if(k(s),(a||!h)&&k(i),a&&2===l)return new Qt(t,this.keyHash,u[1^c]);var f=t&&t===this.ownerID,d=f?u:E(u);return h?a?c===l-1?d.pop():d[c]=d.pop():d[c]=[r,o]:d.push([r,o]),f?(this.entries=d,this):new Xt(t,this.keyHash,d)},Qt.prototype.get=function(t,e,n,r){return yt(n,this.entry[0])?this.entry[1]:r},Qt.prototype.update=function(t,e,n,r,o,i,s){var a=o===w,u=yt(r,this.entry[0]);return(u?o===this.entry[1]:a)?this:(k(s),a?void k(i):u?t&&t===this.ownerID?(this.entry[1]=o,this):new Qt(t,this.keyHash,[r,o]):(k(i),ue(this,t,e,St(r),[r,o])))},Gt.prototype.iterate=Xt.prototype.iterate=function(t,e){for(var n=this.entries,r=0,o=n.length-1;r<=o;r++)if(!1===t(n[e?o-r:r]))return!1},Jt.prototype.iterate=Yt.prototype.iterate=function(t,e){for(var n=this.nodes,r=0,o=n.length-1;r<=o;r++){var i=n[e?o-r:r];if(i&&!1===i.iterate(t,e))return!1}},Qt.prototype.iterate=function(t,e){return t(this.entry)},e(te,N),te.prototype.next=function(){for(var t=this._type,e=this._stack;e;){var n,r=e.node,o=e.index++;if(r.entry){if(0===o)return ee(t,r.entry)}else if(r.entries){if(o<=(n=r.entries.length-1))return ee(t,r.entries[this._reverse?n-o:o])}else if(o<=(n=r.nodes.length-1)){var i=r.nodes[this._reverse?n-o:o];if(i){if(i.entry)return ee(t,i.entry);e=this._stack=ne(i,e)}continue}e=this._stack=this._stack.__prev}return $()};var ve=y/4,Ie=y/2,ke=y/4;function xe(t){var e=Le();if(null==t)return e;if(Ee(t))return t;var n=o(t),r=n.size;return 0===r?e:(Pt(r),r>0&&r<y?Ve(0,r,_,null,new Se(n.toArray())):e.withMutations((function(t){t.setSize(r),n.forEach((function(e,n){return t.set(n,e)}))})))}function Ee(t){return!(!t||!t[Oe])}e(xe,xt),xe.of=function(){return this(arguments)},xe.prototype.toString=function(){return this.__toString("List [","]")},xe.prototype.get=function(t,e){if((t=A(this,t))>=0&&t<this.size){var n=Me(this,t+=this._origin);return n&&n.array[t&b]}return e},xe.prototype.set=function(t,e){return Te(this,t,e)},xe.prototype.remove=function(t){return this.has(t)?0===t?this.shift():t===this.size-1?this.pop():this.splice(t,1):this},xe.prototype.insert=function(t,e){return this.splice(t,0,e)},xe.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=_,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):Le()},xe.prototype.push=function(){var t=arguments,e=this.size;return this.withMutations((function(n){Ne(n,0,e+t.length);for(var r=0;r<t.length;r++)n.set(e+r,t[r])}))},xe.prototype.pop=function(){return Ne(this,0,-1)},xe.prototype.unshift=function(){var t=arguments;return this.withMutations((function(e){Ne(e,-t.length);for(var n=0;n<t.length;n++)e.set(n,t[n])}))},xe.prototype.shift=function(){return Ne(this,1)},xe.prototype.merge=function(){return Be(this,void 0,arguments)},xe.prototype.mergeWith=function(e){return Be(this,e,t.call(arguments,1))},xe.prototype.mergeDeep=function(){return Be(this,de,arguments)},xe.prototype.mergeDeepWith=function(e){var n=t.call(arguments,1);return Be(this,pe(e),n)},xe.prototype.setSize=function(t){return Ne(this,0,t)},xe.prototype.slice=function(t,e){var n=this.size;return j(t,e,n)?this:Ne(this,R(t,n),C(e,n))},xe.prototype.__iterator=function(t,e){var n=0,r=ze(this,e);return new N((function(){var e=r();return e===Ce?$():B(t,n++,e)}))},xe.prototype.__iterate=function(t,e){for(var n,r=0,o=ze(this,e);(n=o())!==Ce&&!1!==t(n,r++,this););return r},xe.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?Ve(this._origin,this._capacity,this._level,this._root,this._tail,t,this.__hash):(this.__ownerID=t,this)},xe.isList=Ee;var Oe="@@__IMMUTABLE_LIST__@@",Ae=xe.prototype;function Se(t,e){this.array=t,this.ownerID=e}Ae[Oe]=!0,Ae[g]=Ae.remove,Ae.setIn=Wt.setIn,Ae.deleteIn=Ae.removeIn=Wt.removeIn,Ae.update=Wt.update,Ae.updateIn=Wt.updateIn,Ae.mergeIn=Wt.mergeIn,Ae.mergeDeepIn=Wt.mergeDeepIn,Ae.withMutations=Wt.withMutations,Ae.asMutable=Wt.asMutable,Ae.asImmutable=Wt.asImmutable,Ae.wasAltered=Wt.wasAltered,Se.prototype.removeBefore=function(t,e,n){if(n===e?1<<e:0===this.array.length)return this;var r=n>>>e&b;if(r>=this.array.length)return new Se([],t);var o,i=0===r;if(e>0){var s=this.array[r];if((o=s&&s.removeBefore(t,e-_,n))===s&&i)return this}if(i&&!o)return this;var a=De(this,t);if(!i)for(var u=0;u<r;u++)a.array[u]=void 0;return o&&(a.array[r]=o),a},Se.prototype.removeAfter=function(t,e,n){if(n===(e?1<<e:0)||0===this.array.length)return this;var r,o=n-1>>>e&b;if(o>=this.array.length)return this;if(e>0){var i=this.array[o];if((r=i&&i.removeAfter(t,e-_,n))===i&&o===this.array.length-1)return this}var s=De(this,t);return s.array.splice(o+1),r&&(s.array[o]=r),s};var je,Re,Ce={};function ze(t,e){var n=t._origin,r=t._capacity,o=$e(r),i=t._tail;return s(t._root,t._level,0);function s(t,e,n){return 0===e?a(t,n):u(t,e,n)}function a(t,s){var a=s===o?i&&i.array:t&&t.array,u=s>n?0:n-s,c=r-s;return c>y&&(c=y),function(){if(u===c)return Ce;var t=e?--c:u++;return a&&a[t]}}function u(t,o,i){var a,u=t&&t.array,c=i>n?0:n-i>>o,l=1+(r-i>>o);return l>y&&(l=y),function(){for(;;){if(a){var t=a();if(t!==Ce)return t;a=null}if(c===l)return Ce;var n=e?--l:c++;a=s(u&&u[n],o-_,i+(n<<o))}}}}function Ve(t,e,n,r,o,i,s){var a=Object.create(Ae);return a.size=e-t,a._origin=t,a._capacity=e,a._level=n,a._root=r,a._tail=o,a.__ownerID=i,a.__hash=s,a.__altered=!1,a}function Le(){return je||(je=Ve(0,0,_))}function Te(t,e,n){if((e=A(t,e))!=e)return t;if(e>=t.size||e<0)return t.withMutations((function(t){e<0?Ne(t,e).set(0,n):Ne(t,0,e+1).set(e,n)}));e+=t._origin;var r=t._tail,o=t._root,i=I(v);return e>=$e(t._capacity)?r=Ue(r,t.__ownerID,0,e,n,i):o=Ue(o,t.__ownerID,t._level,e,n,i),i.value?t.__ownerID?(t._root=o,t._tail=r,t.__hash=void 0,t.__altered=!0,t):Ve(t._origin,t._capacity,t._level,o,r):t}function Ue(t,e,n,r,o,i){var s,a=r>>>n&b,u=t&&a<t.array.length;if(!u&&void 0===o)return t;if(n>0){var c=t&&t.array[a],l=Ue(c,e,n-_,r,o,i);return l===c?t:((s=De(t,e)).array[a]=l,s)}return u&&t.array[a]===o?t:(k(i),s=De(t,e),void 0===o&&a===s.array.length-1?s.array.pop():s.array[a]=o,s)}function De(t,e){return e&&t&&e===t.ownerID?t:new Se(t?t.array.slice():[],e)}function Me(t,e){if(e>=$e(t._capacity))return t._tail;if(e<1<<t._level+_){for(var n=t._root,r=t._level;n&&r>0;)n=n.array[e>>>r&b],r-=_;return n}}function Ne(t,e,n){void 0!==e&&(e|=0),void 0!==n&&(n|=0);var r=t.__ownerID||new x,o=t._origin,i=t._capacity,s=o+e,a=void 0===n?i:n<0?i+n:o+n;if(s===o&&a===i)return t;if(s>=a)return t.clear();for(var u=t._level,c=t._root,l=0;s+l<0;)c=new Se(c&&c.array.length?[void 0,c]:[],r),l+=1<<(u+=_);l&&(s+=l,o+=l,a+=l,i+=l);for(var h=$e(i),f=$e(a);f>=1<<u+_;)c=new Se(c&&c.array.length?[c]:[],r),u+=_;var d=t._tail,p=f<h?Me(t,a-1):f>h?new Se([],r):d;if(d&&f>h&&s<i&&d.array.length){for(var g=c=De(c,r),y=u;y>_;y-=_){var w=h>>>y&b;g=g.array[w]=De(g.array[w],r)}g.array[h>>>_&b]=d}if(a<i&&(p=p&&p.removeAfter(r,0,a)),s>=f)s-=f,a-=f,u=_,c=null,p=p&&p.removeBefore(r,0,s);else if(s>o||f<h){for(l=0;c;){var m=s>>>u&b;if(m!==f>>>u&b)break;m&&(l+=(1<<u)*m),u-=_,c=c.array[m]}c&&s>o&&(c=c.removeBefore(r,u,s-l)),c&&f<h&&(c=c.removeAfter(r,u,f-l)),l&&(s-=l,a-=l)}return t.__ownerID?(t.size=a-s,t._origin=s,t._capacity=a,t._level=u,t._root=c,t._tail=p,t.__hash=void 0,t.__altered=!0,t):Ve(s,a,u,c,p)}function Be(t,e,n){for(var r=[],i=0,a=0;a<n.length;a++){var u=n[a],c=o(u);c.size>i&&(i=c.size),s(u)||(c=c.map((function(t){return dt(t)}))),r.push(c)}return i>t.size&&(t=t.setSize(i)),ge(t,e,r)}function $e(t){return t<y?0:t-1>>>_<<_}function qe(t){return null==t?Ke():Pe(t)?t:Ke().withMutations((function(e){var n=r(t);Pt(n.size),n.forEach((function(t,n){return e.set(n,t)}))}))}function Pe(t){return Kt(t)&&l(t)}function He(t,e,n,r){var o=Object.create(qe.prototype);return o.size=t?t.size:0,o._map=t,o._list=e,o.__ownerID=n,o.__hash=r,o}function Ke(){return Re||(Re=He(oe(),Le()))}function Fe(t,e,n){var r,o,i=t._map,s=t._list,a=i.get(e),u=void 0!==a;if(n===w){if(!u)return t;s.size>=y&&s.size>=2*i.size?(r=(o=s.filter((function(t,e){return void 0!==t&&a!==e}))).toKeyedSeq().map((function(t){return t[0]})).flip().toMap(),t.__ownerID&&(r.__ownerID=o.__ownerID=t.__ownerID)):(r=i.remove(e),o=a===s.size-1?s.pop():s.set(a,void 0))}else if(u){if(n===s.get(a)[1])return t;r=i,o=s.set(a,[e,n])}else r=i.set(e,s.size),o=s.set(s.size,[e,n]);return t.__ownerID?(t.size=r.size,t._map=r,t._list=o,t.__hash=void 0,t):He(r,o)}function Ze(t,e){this._iter=t,this._useKeys=e,this.size=t.size}function We(t){this._iter=t,this.size=t.size}function Ge(t){this._iter=t,this.size=t.size}function Je(t){this._iter=t,this.size=t.size}function Ye(t){var e=wn(t);return e._iter=t,e.size=t.size,e.flip=function(){return t},e.reverse=function(){var e=t.reverse.apply(this);return e.flip=function(){return t.reverse()},e},e.has=function(e){return t.includes(e)},e.includes=function(e){return t.has(e)},e.cacheResult=mn,e.__iterateUncached=function(e,n){var r=this;return t.__iterate((function(t,n){return!1!==e(n,t,r)}),n)},e.__iteratorUncached=function(e,n){if(e===T){var r=t.__iterator(e,n);return new N((function(){var t=r.next();if(!t.done){var e=t.value[0];t.value[0]=t.value[1],t.value[1]=e}return t}))}return t.__iterator(e===L?V:L,n)},e}function Xe(t,e,n){var r=wn(t);return r.size=t.size,r.has=function(e){return t.has(e)},r.get=function(r,o){var i=t.get(r,w);return i===w?o:e.call(n,i,r,t)},r.__iterateUncached=function(r,o){var i=this;return t.__iterate((function(t,o,s){return!1!==r(e.call(n,t,o,s),o,i)}),o)},r.__iteratorUncached=function(r,o){var i=t.__iterator(T,o);return new N((function(){var o=i.next();if(o.done)return o;var s=o.value,a=s[0];return B(r,a,e.call(n,s[1],a,t),o)}))},r}function Qe(t,e){var n=wn(t);return n._iter=t,n.size=t.size,n.reverse=function(){return t},t.flip&&(n.flip=function(){var e=Ye(t);return e.reverse=function(){return t.flip()},e}),n.get=function(n,r){return t.get(e?n:-1-n,r)},n.has=function(n){return t.has(e?n:-1-n)},n.includes=function(e){return t.includes(e)},n.cacheResult=mn,n.__iterate=function(e,n){var r=this;return t.__iterate((function(t,n){return e(t,n,r)}),!n)},n.__iterator=function(e,n){return t.__iterator(e,!n)},n}function tn(t,e,n,r){var o=wn(t);return r&&(o.has=function(r){var o=t.get(r,w);return o!==w&&!!e.call(n,o,r,t)},o.get=function(r,o){var i=t.get(r,w);return i!==w&&e.call(n,i,r,t)?i:o}),o.__iterateUncached=function(o,i){var s=this,a=0;return t.__iterate((function(t,i,u){if(e.call(n,t,i,u))return a++,o(t,r?i:a-1,s)}),i),a},o.__iteratorUncached=function(o,i){var s=t.__iterator(T,i),a=0;return new N((function(){for(;;){var i=s.next();if(i.done)return i;var u=i.value,c=u[0],l=u[1];if(e.call(n,l,c,t))return B(o,r?c:a++,l,i)}}))},o}function en(t,e,n){var r=Ht().asMutable();return t.__iterate((function(o,i){r.update(e.call(n,o,i,t),0,(function(t){return t+1}))})),r.asImmutable()}function nn(t,e,n){var r=a(t),o=(l(t)?qe():Ht()).asMutable();t.__iterate((function(i,s){o.update(e.call(n,i,s,t),(function(t){return(t=t||[]).push(r?[s,i]:i),t}))}));var i=bn(t);return o.map((function(e){return gn(t,i(e))}))}function rn(t,e,n,r){var o=t.size;if(void 0!==e&&(e|=0),void 0!==n&&(n===1/0?n=o:n|=0),j(e,n,o))return t;var i=R(e,o),s=C(n,o);if(i!=i||s!=s)return rn(t.toSeq().cacheResult(),e,n,r);var a,u=s-i;u==u&&(a=u<0?0:u);var c=wn(t);return c.size=0===a?a:t.size&&a||void 0,!r&&it(t)&&a>=0&&(c.get=function(e,n){return(e=A(this,e))>=0&&e<a?t.get(e+i,n):n}),c.__iterateUncached=function(e,n){var o=this;if(0===a)return 0;if(n)return this.cacheResult().__iterate(e,n);var s=0,u=!0,c=0;return t.__iterate((function(t,n){if(!u||!(u=s++<i))return c++,!1!==e(t,r?n:c-1,o)&&c!==a})),c},c.__iteratorUncached=function(e,n){if(0!==a&&n)return this.cacheResult().__iterator(e,n);var o=0!==a&&t.__iterator(e,n),s=0,u=0;return new N((function(){for(;s++<i;)o.next();if(++u>a)return $();var t=o.next();return r||e===L?t:B(e,u-1,e===V?void 0:t.value[1],t)}))},c}function on(t,e,n){var r=wn(t);return r.__iterateUncached=function(r,o){var i=this;if(o)return this.cacheResult().__iterate(r,o);var s=0;return t.__iterate((function(t,o,a){return e.call(n,t,o,a)&&++s&&r(t,o,i)})),s},r.__iteratorUncached=function(r,o){var i=this;if(o)return this.cacheResult().__iterator(r,o);var s=t.__iterator(T,o),a=!0;return new N((function(){if(!a)return $();var t=s.next();if(t.done)return t;var o=t.value,u=o[0],c=o[1];return e.call(n,c,u,i)?r===T?t:B(r,u,c,t):(a=!1,$())}))},r}function sn(t,e,n,r){var o=wn(t);return o.__iterateUncached=function(o,i){var s=this;if(i)return this.cacheResult().__iterate(o,i);var a=!0,u=0;return t.__iterate((function(t,i,c){if(!a||!(a=e.call(n,t,i,c)))return u++,o(t,r?i:u-1,s)})),u},o.__iteratorUncached=function(o,i){var s=this;if(i)return this.cacheResult().__iterator(o,i);var a=t.__iterator(T,i),u=!0,c=0;return new N((function(){var t,i,l;do{if((t=a.next()).done)return r||o===L?t:B(o,c++,o===V?void 0:t.value[1],t);var h=t.value;i=h[0],l=h[1],u&&(u=e.call(n,l,i,s))}while(u);return o===T?t:B(o,i,l,t)}))},o}function an(t,e){var n=a(t),o=[t].concat(e).map((function(t){return s(t)?n&&(t=r(t)):t=n?at(t):ut(Array.isArray(t)?t:[t]),t})).filter((function(t){return 0!==t.size}));if(0===o.length)return t;if(1===o.length){var i=o[0];if(i===t||n&&a(i)||u(t)&&u(i))return i}var c=new et(o);return n?c=c.toKeyedSeq():u(t)||(c=c.toSetSeq()),(c=c.flatten(!0)).size=o.reduce((function(t,e){if(void 0!==t){var n=e.size;if(void 0!==n)return t+n}}),0),c}function un(t,e,n){var r=wn(t);return r.__iterateUncached=function(r,o){var i=0,a=!1;function u(t,c){var l=this;t.__iterate((function(t,o){return(!e||c<e)&&s(t)?u(t,c+1):!1===r(t,n?o:i++,l)&&(a=!0),!a}),o)}return u(t,0),i},r.__iteratorUncached=function(r,o){var i=t.__iterator(r,o),a=[],u=0;return new N((function(){for(;i;){var t=i.next();if(!1===t.done){var c=t.value;if(r===T&&(c=c[1]),e&&!(a.length<e)||!s(c))return n?t:B(r,u++,c,t);a.push(i),i=c.__iterator(r,o)}else i=a.pop()}return $()}))},r}function cn(t,e,n){var r=bn(t);return t.toSeq().map((function(o,i){return r(e.call(n,o,i,t))})).flatten(!0)}function ln(t,e){var n=wn(t);return n.size=t.size&&2*t.size-1,n.__iterateUncached=function(n,r){var o=this,i=0;return t.__iterate((function(t,r){return(!i||!1!==n(e,i++,o))&&!1!==n(t,i++,o)}),r),i},n.__iteratorUncached=function(n,r){var o,i=t.__iterator(L,r),s=0;return new N((function(){return(!o||s%2)&&(o=i.next()).done?o:s%2?B(n,s++,e):B(n,s++,o.value,o)}))},n}function hn(t,e,n){e||(e=vn);var r=a(t),o=0,i=t.toSeq().map((function(e,r){return[r,e,o++,n?n(e,r,t):e]})).toArray();return i.sort((function(t,n){return e(t[3],n[3])||t[2]-n[2]})).forEach(r?function(t,e){i[e].length=2}:function(t,e){i[e]=t[1]}),r?W(i):u(t)?G(i):J(i)}function fn(t,e,n){if(e||(e=vn),n){var r=t.toSeq().map((function(e,r){return[e,n(e,r,t)]})).reduce((function(t,n){return dn(e,t[1],n[1])?n:t}));return r&&r[0]}return t.reduce((function(t,n){return dn(e,t,n)?n:t}))}function dn(t,e,n){var r=t(n,e);return 0===r&&n!==e&&(null==n||n!=n)||r>0}function pn(t,e,r){var o=wn(t);return o.size=new et(r).map((function(t){return t.size})).min(),o.__iterate=function(t,e){for(var n,r=this.__iterator(L,e),o=0;!(n=r.next()).done&&!1!==t(n.value,o++,this););return o},o.__iteratorUncached=function(t,o){var i=r.map((function(t){return t=n(t),H(o?t.reverse():t)})),s=0,a=!1;return new N((function(){var n;return a||(n=i.map((function(t){return t.next()})),a=n.some((function(t){return t.done}))),a?$():B(t,s++,e.apply(null,n.map((function(t){return t.value}))))}))},o}function gn(t,e){return it(t)?e:t.constructor(e)}function _n(t){if(t!==Object(t))throw new TypeError("Expected [K, V] tuple: "+t)}function yn(t){return Pt(t.size),O(t)}function bn(t){return a(t)?r:u(t)?o:i}function wn(t){return Object.create((a(t)?W:u(t)?G:J).prototype)}function mn(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):Z.prototype.cacheResult.call(this)}function vn(t,e){return t>e?1:t<e?-1:0}function In(t){var e=H(t);if(!e){if(!F(t))throw new TypeError("Expected iterable or array-like: "+t);e=H(n(t))}return e}function kn(t,e){var n,r=function(i){if(i instanceof r)return i;if(!(this instanceof r))return new r(i);if(!n){n=!0;var s=Object.keys(t);An(o,s),o.size=s.length,o._name=e,o._keys=s,o._defaultValues=t}this._map=Ht(i)},o=r.prototype=Object.create(xn);return o.constructor=r,r}e(qe,Ht),qe.of=function(){return this(arguments)},qe.prototype.toString=function(){return this.__toString("OrderedMap {","}")},qe.prototype.get=function(t,e){var n=this._map.get(t);return void 0!==n?this._list.get(n)[1]:e},qe.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Ke()},qe.prototype.set=function(t,e){return Fe(this,t,e)},qe.prototype.remove=function(t){return Fe(this,t,w)},qe.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},qe.prototype.__iterate=function(t,e){var n=this;return this._list.__iterate((function(e){return e&&t(e[1],e[0],n)}),e)},qe.prototype.__iterator=function(t,e){return this._list.fromEntrySeq().__iterator(t,e)},qe.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var e=this._map.__ensureOwner(t),n=this._list.__ensureOwner(t);return t?He(e,n,t,this.__hash):(this.__ownerID=t,this._map=e,this._list=n,this)},qe.isOrderedMap=Pe,qe.prototype[p]=!0,qe.prototype[g]=qe.prototype.remove,e(Ze,W),Ze.prototype.get=function(t,e){return this._iter.get(t,e)},Ze.prototype.has=function(t){return this._iter.has(t)},Ze.prototype.valueSeq=function(){return this._iter.valueSeq()},Ze.prototype.reverse=function(){var t=this,e=Qe(this,!0);return this._useKeys||(e.valueSeq=function(){return t._iter.toSeq().reverse()}),e},Ze.prototype.map=function(t,e){var n=this,r=Xe(this,t,e);return this._useKeys||(r.valueSeq=function(){return n._iter.toSeq().map(t,e)}),r},Ze.prototype.__iterate=function(t,e){var n,r=this;return this._iter.__iterate(this._useKeys?function(e,n){return t(e,n,r)}:(n=e?yn(this):0,function(o){return t(o,e?--n:n++,r)}),e)},Ze.prototype.__iterator=function(t,e){if(this._useKeys)return this._iter.__iterator(t,e);var n=this._iter.__iterator(L,e),r=e?yn(this):0;return new N((function(){var o=n.next();return o.done?o:B(t,e?--r:r++,o.value,o)}))},Ze.prototype[p]=!0,e(We,G),We.prototype.includes=function(t){return this._iter.includes(t)},We.prototype.__iterate=function(t,e){var n=this,r=0;return this._iter.__iterate((function(e){return t(e,r++,n)}),e)},We.prototype.__iterator=function(t,e){var n=this._iter.__iterator(L,e),r=0;return new N((function(){var e=n.next();return e.done?e:B(t,r++,e.value,e)}))},e(Ge,J),Ge.prototype.has=function(t){return this._iter.includes(t)},Ge.prototype.__iterate=function(t,e){var n=this;return this._iter.__iterate((function(e){return t(e,e,n)}),e)},Ge.prototype.__iterator=function(t,e){var n=this._iter.__iterator(L,e);return new N((function(){var e=n.next();return e.done?e:B(t,e.value,e.value,e)}))},e(Je,W),Je.prototype.entrySeq=function(){return this._iter.toSeq()},Je.prototype.__iterate=function(t,e){var n=this;return this._iter.__iterate((function(e){if(e){_n(e);var r=s(e);return t(r?e.get(1):e[1],r?e.get(0):e[0],n)}}),e)},Je.prototype.__iterator=function(t,e){var n=this._iter.__iterator(L,e);return new N((function(){for(;;){var e=n.next();if(e.done)return e;var r=e.value;if(r){_n(r);var o=s(r);return B(t,o?r.get(0):r[0],o?r.get(1):r[1],e)}}}))},We.prototype.cacheResult=Ze.prototype.cacheResult=Ge.prototype.cacheResult=Je.prototype.cacheResult=mn,e(kn,kt),kn.prototype.toString=function(){return this.__toString(On(this)+" {","}")},kn.prototype.has=function(t){return this._defaultValues.hasOwnProperty(t)},kn.prototype.get=function(t,e){if(!this.has(t))return e;var n=this._defaultValues[t];return this._map?this._map.get(t,n):n},kn.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var t=this.constructor;return t._empty||(t._empty=En(this,oe()))},kn.prototype.set=function(t,e){if(!this.has(t))throw new Error('Cannot set unknown key "'+t+'" on '+On(this));if(this._map&&!this._map.has(t)&&e===this._defaultValues[t])return this;var n=this._map&&this._map.set(t,e);return this.__ownerID||n===this._map?this:En(this,n)},kn.prototype.remove=function(t){if(!this.has(t))return this;var e=this._map&&this._map.remove(t);return this.__ownerID||e===this._map?this:En(this,e)},kn.prototype.wasAltered=function(){return this._map.wasAltered()},kn.prototype.__iterator=function(t,e){var n=this;return r(this._defaultValues).map((function(t,e){return n.get(e)})).__iterator(t,e)},kn.prototype.__iterate=function(t,e){var n=this;return r(this._defaultValues).map((function(t,e){return n.get(e)})).__iterate(t,e)},kn.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var e=this._map&&this._map.__ensureOwner(t);return t?En(this,e,t):(this.__ownerID=t,this._map=e,this)};var xn=kn.prototype;function En(t,e,n){var r=Object.create(Object.getPrototypeOf(t));return r._map=e,r.__ownerID=n,r}function On(t){return t._name||t.constructor.name||"Record"}function An(t,e){try{e.forEach(Sn.bind(void 0,t))}catch(t){}}function Sn(t,e){Object.defineProperty(t,e,{get:function(){return this.get(e)},set:function(t){mt(this.__ownerID,"Cannot set on an immutable record."),this.set(e,t)}})}function jn(t){return null==t?Un():Rn(t)&&!l(t)?t:Un().withMutations((function(e){var n=i(t);Pt(n.size),n.forEach((function(t){return e.add(t)}))}))}function Rn(t){return!(!t||!t[zn])}xn[g]=xn.remove,xn.deleteIn=xn.removeIn=Wt.removeIn,xn.merge=Wt.merge,xn.mergeWith=Wt.mergeWith,xn.mergeIn=Wt.mergeIn,xn.mergeDeep=Wt.mergeDeep,xn.mergeDeepWith=Wt.mergeDeepWith,xn.mergeDeepIn=Wt.mergeDeepIn,xn.setIn=Wt.setIn,xn.update=Wt.update,xn.updateIn=Wt.updateIn,xn.withMutations=Wt.withMutations,xn.asMutable=Wt.asMutable,xn.asImmutable=Wt.asImmutable,e(jn,Et),jn.of=function(){return this(arguments)},jn.fromKeys=function(t){return this(r(t).keySeq())},jn.prototype.toString=function(){return this.__toString("Set {","}")},jn.prototype.has=function(t){return this._map.has(t)},jn.prototype.add=function(t){return Ln(this,this._map.set(t,!0))},jn.prototype.remove=function(t){return Ln(this,this._map.remove(t))},jn.prototype.clear=function(){return Ln(this,this._map.clear())},jn.prototype.union=function(){var e=t.call(arguments,0);return 0===(e=e.filter((function(t){return 0!==t.size}))).length?this:0!==this.size||this.__ownerID||1!==e.length?this.withMutations((function(t){for(var n=0;n<e.length;n++)i(e[n]).forEach((function(e){return t.add(e)}))})):this.constructor(e[0])},jn.prototype.intersect=function(){var e=t.call(arguments,0);if(0===e.length)return this;e=e.map((function(t){return i(t)}));var n=this;return this.withMutations((function(t){n.forEach((function(n){e.every((function(t){return t.includes(n)}))||t.remove(n)}))}))},jn.prototype.subtract=function(){var e=t.call(arguments,0);if(0===e.length)return this;e=e.map((function(t){return i(t)}));var n=this;return this.withMutations((function(t){n.forEach((function(n){e.some((function(t){return t.includes(n)}))&&t.remove(n)}))}))},jn.prototype.merge=function(){return this.union.apply(this,arguments)},jn.prototype.mergeWith=function(e){var n=t.call(arguments,1);return this.union.apply(this,n)},jn.prototype.sort=function(t){return Dn(hn(this,t))},jn.prototype.sortBy=function(t,e){return Dn(hn(this,e,t))},jn.prototype.wasAltered=function(){return this._map.wasAltered()},jn.prototype.__iterate=function(t,e){var n=this;return this._map.__iterate((function(e,r){return t(r,r,n)}),e)},jn.prototype.__iterator=function(t,e){return this._map.map((function(t,e){return e})).__iterator(t,e)},jn.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var e=this._map.__ensureOwner(t);return t?this.__make(e,t):(this.__ownerID=t,this._map=e,this)},jn.isSet=Rn;var Cn,zn="@@__IMMUTABLE_SET__@@",Vn=jn.prototype;function Ln(t,e){return t.__ownerID?(t.size=e.size,t._map=e,t):e===t._map?t:0===e.size?t.__empty():t.__make(e)}function Tn(t,e){var n=Object.create(Vn);return n.size=t?t.size:0,n._map=t,n.__ownerID=e,n}function Un(){return Cn||(Cn=Tn(oe()))}function Dn(t){return null==t?qn():Mn(t)?t:qn().withMutations((function(e){var n=i(t);Pt(n.size),n.forEach((function(t){return e.add(t)}))}))}function Mn(t){return Rn(t)&&l(t)}Vn[zn]=!0,Vn[g]=Vn.remove,Vn.mergeDeep=Vn.merge,Vn.mergeDeepWith=Vn.mergeWith,Vn.withMutations=Wt.withMutations,Vn.asMutable=Wt.asMutable,Vn.asImmutable=Wt.asImmutable,Vn.__empty=Un,Vn.__make=Tn,e(Dn,jn),Dn.of=function(){return this(arguments)},Dn.fromKeys=function(t){return this(r(t).keySeq())},Dn.prototype.toString=function(){return this.__toString("OrderedSet {","}")},Dn.isOrderedSet=Mn;var Nn,Bn=Dn.prototype;function $n(t,e){var n=Object.create(Bn);return n.size=t?t.size:0,n._map=t,n.__ownerID=e,n}function qn(){return Nn||(Nn=$n(Ke()))}function Pn(t){return null==t?Gn():Hn(t)?t:Gn().unshiftAll(t)}function Hn(t){return!(!t||!t[Fn])}Bn[p]=!0,Bn.__empty=qn,Bn.__make=$n,e(Pn,xt),Pn.of=function(){return this(arguments)},Pn.prototype.toString=function(){return this.__toString("Stack [","]")},Pn.prototype.get=function(t,e){var n=this._head;for(t=A(this,t);n&&t--;)n=n.next;return n?n.value:e},Pn.prototype.peek=function(){return this._head&&this._head.value},Pn.prototype.push=function(){if(0===arguments.length)return this;for(var t=this.size+arguments.length,e=this._head,n=arguments.length-1;n>=0;n--)e={value:arguments[n],next:e};return this.__ownerID?(this.size=t,this._head=e,this.__hash=void 0,this.__altered=!0,this):Wn(t,e)},Pn.prototype.pushAll=function(t){if(0===(t=o(t)).size)return this;Pt(t.size);var e=this.size,n=this._head;return t.reverse().forEach((function(t){e++,n={value:t,next:n}})),this.__ownerID?(this.size=e,this._head=n,this.__hash=void 0,this.__altered=!0,this):Wn(e,n)},Pn.prototype.pop=function(){return this.slice(1)},Pn.prototype.unshift=function(){return this.push.apply(this,arguments)},Pn.prototype.unshiftAll=function(t){return this.pushAll(t)},Pn.prototype.shift=function(){return this.pop.apply(this,arguments)},Pn.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Gn()},Pn.prototype.slice=function(t,e){if(j(t,e,this.size))return this;var n=R(t,this.size);if(C(e,this.size)!==this.size)return xt.prototype.slice.call(this,t,e);for(var r=this.size-n,o=this._head;n--;)o=o.next;return this.__ownerID?(this.size=r,this._head=o,this.__hash=void 0,this.__altered=!0,this):Wn(r,o)},Pn.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?Wn(this.size,this._head,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)},Pn.prototype.__iterate=function(t,e){if(e)return this.reverse().__iterate(t);for(var n=0,r=this._head;r&&!1!==t(r.value,n++,this);)r=r.next;return n},Pn.prototype.__iterator=function(t,e){if(e)return this.reverse().__iterator(t);var n=0,r=this._head;return new N((function(){if(r){var e=r.value;return r=r.next,B(t,n++,e)}return $()}))},Pn.isStack=Hn;var Kn,Fn="@@__IMMUTABLE_STACK__@@",Zn=Pn.prototype;function Wn(t,e,n,r){var o=Object.create(Zn);return o.size=t,o._head=e,o.__ownerID=n,o.__hash=r,o.__altered=!1,o}function Gn(){return Kn||(Kn=Wn(0))}function Jn(t,e){var n=function(n){t.prototype[n]=e[n]};return Object.keys(e).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach(n),t}Zn[Fn]=!0,Zn.withMutations=Wt.withMutations,Zn.asMutable=Wt.asMutable,Zn.asImmutable=Wt.asImmutable,Zn.wasAltered=Wt.wasAltered,n.Iterator=N,Jn(n,{toArray:function(){Pt(this.size);var t=new Array(this.size||0);return this.valueSeq().__iterate((function(e,n){t[n]=e})),t},toIndexedSeq:function(){return new We(this)},toJS:function(){return this.toSeq().map((function(t){return t&&"function"==typeof t.toJS?t.toJS():t})).__toJS()},toJSON:function(){return this.toSeq().map((function(t){return t&&"function"==typeof t.toJSON?t.toJSON():t})).__toJS()},toKeyedSeq:function(){return new Ze(this,!0)},toMap:function(){return Ht(this.toKeyedSeq())},toObject:function(){Pt(this.size);var t={};return this.__iterate((function(e,n){t[n]=e})),t},toOrderedMap:function(){return qe(this.toKeyedSeq())},toOrderedSet:function(){return Dn(a(this)?this.valueSeq():this)},toSet:function(){return jn(a(this)?this.valueSeq():this)},toSetSeq:function(){return new Ge(this)},toSeq:function(){return u(this)?this.toIndexedSeq():a(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Pn(a(this)?this.valueSeq():this)},toList:function(){return xe(a(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(t,e){return 0===this.size?t+e:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+e},concat:function(){return gn(this,an(this,t.call(arguments,0)))},includes:function(t){return this.some((function(e){return yt(e,t)}))},entries:function(){return this.__iterator(T)},every:function(t,e){Pt(this.size);var n=!0;return this.__iterate((function(r,o,i){if(!t.call(e,r,o,i))return n=!1,!1})),n},filter:function(t,e){return gn(this,tn(this,t,e,!0))},find:function(t,e,n){var r=this.findEntry(t,e);return r?r[1]:n},forEach:function(t,e){return Pt(this.size),this.__iterate(e?t.bind(e):t)},join:function(t){Pt(this.size),t=void 0!==t?""+t:",";var e="",n=!0;return this.__iterate((function(r){n?n=!1:e+=t,e+=null!=r?r.toString():""})),e},keys:function(){return this.__iterator(V)},map:function(t,e){return gn(this,Xe(this,t,e))},reduce:function(t,e,n){var r,o;return Pt(this.size),arguments.length<2?o=!0:r=e,this.__iterate((function(e,i,s){o?(o=!1,r=e):r=t.call(n,r,e,i,s)})),r},reduceRight:function(t,e,n){var r=this.toKeyedSeq().reverse();return r.reduce.apply(r,arguments)},reverse:function(){return gn(this,Qe(this,!0))},slice:function(t,e){return gn(this,rn(this,t,e,!0))},some:function(t,e){return!this.every(er(t),e)},sort:function(t){return gn(this,hn(this,t))},values:function(){return this.__iterator(L)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some((function(){return!0}))},count:function(t,e){return O(t?this.toSeq().filter(t,e):this)},countBy:function(t,e){return en(this,t,e)},equals:function(t){return bt(this,t)},entrySeq:function(){var t=this;if(t._cache)return new et(t._cache);var e=t.toSeq().map(tr).toIndexedSeq();return e.fromEntrySeq=function(){return t.toSeq()},e},filterNot:function(t,e){return this.filter(er(t),e)},findEntry:function(t,e,n){var r=n;return this.__iterate((function(n,o,i){if(t.call(e,n,o,i))return r=[o,n],!1})),r},findKey:function(t,e){var n=this.findEntry(t,e);return n&&n[0]},findLast:function(t,e,n){return this.toKeyedSeq().reverse().find(t,e,n)},findLastEntry:function(t,e,n){return this.toKeyedSeq().reverse().findEntry(t,e,n)},findLastKey:function(t,e){return this.toKeyedSeq().reverse().findKey(t,e)},first:function(){return this.find(S)},flatMap:function(t,e){return gn(this,cn(this,t,e))},flatten:function(t){return gn(this,un(this,t,!0))},fromEntrySeq:function(){return new Je(this)},get:function(t,e){return this.find((function(e,n){return yt(n,t)}),void 0,e)},getIn:function(t,e){for(var n,r=this,o=In(t);!(n=o.next()).done;){var i=n.value;if((r=r&&r.get?r.get(i,w):w)===w)return e}return r},groupBy:function(t,e){return nn(this,t,e)},has:function(t){return this.get(t,w)!==w},hasIn:function(t){return this.getIn(t,w)!==w},isSubset:function(t){return t="function"==typeof t.includes?t:n(t),this.every((function(e){return t.includes(e)}))},isSuperset:function(t){return(t="function"==typeof t.isSubset?t:n(t)).isSubset(this)},keyOf:function(t){return this.findKey((function(e){return yt(e,t)}))},keySeq:function(){return this.toSeq().map(Qn).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return fn(this,t)},maxBy:function(t,e){return fn(this,e,t)},min:function(t){return fn(this,t?nr(t):ir)},minBy:function(t,e){return fn(this,e?nr(e):ir,t)},rest:function(){return this.slice(1)},skip:function(t){return this.slice(Math.max(0,t))},skipLast:function(t){return gn(this,this.toSeq().reverse().skip(t).reverse())},skipWhile:function(t,e){return gn(this,sn(this,t,e,!0))},skipUntil:function(t,e){return this.skipWhile(er(t),e)},sortBy:function(t,e){return gn(this,hn(this,e,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return gn(this,this.toSeq().reverse().take(t).reverse())},takeWhile:function(t,e){return gn(this,on(this,t,e))},takeUntil:function(t,e){return this.takeWhile(er(t),e)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=sr(this))}});var Yn=n.prototype;Yn[h]=!0,Yn[M]=Yn.values,Yn.__toJS=Yn.toArray,Yn.__toStringMapper=rr,Yn.inspect=Yn.toSource=function(){return this.toString()},Yn.chain=Yn.flatMap,Yn.contains=Yn.includes,Jn(r,{flip:function(){return gn(this,Ye(this))},mapEntries:function(t,e){var n=this,r=0;return gn(this,this.toSeq().map((function(o,i){return t.call(e,[i,o],r++,n)})).fromEntrySeq())},mapKeys:function(t,e){var n=this;return gn(this,this.toSeq().flip().map((function(r,o){return t.call(e,r,o,n)})).flip())}});var Xn=r.prototype;function Qn(t,e){return e}function tr(t,e){return[e,t]}function er(t){return function(){return!t.apply(this,arguments)}}function nr(t){return function(){return-t.apply(this,arguments)}}function rr(t){return"string"==typeof t?JSON.stringify(t):String(t)}function or(){return E(arguments)}function ir(t,e){return t<e?1:t>e?-1:0}function sr(t){if(t.size===1/0)return 0;var e=l(t),n=a(t),r=e?1:0;return ar(t.__iterate(n?e?function(t,e){r=31*r+ur(St(t),St(e))|0}:function(t,e){r=r+ur(St(t),St(e))|0}:e?function(t){r=31*r+St(t)|0}:function(t){r=r+St(t)|0}),r)}function ar(t,e){return e=Ot(e,3432918353),e=Ot(e<<15|e>>>-15,461845907),e=Ot(e<<13|e>>>-13,5),e=Ot((e=(e+3864292196|0)^t)^e>>>16,2246822507),e=At((e=Ot(e^e>>>13,3266489909))^e>>>16)}function ur(t,e){return t^e+2654435769+(t<<6)+(t>>2)|0}return Xn[f]=!0,Xn[M]=Yn.entries,Xn.__toJS=Yn.toObject,Xn.__toStringMapper=function(t,e){return JSON.stringify(e)+": "+rr(t)},Jn(o,{toKeyedSeq:function(){return new Ze(this,!1)},filter:function(t,e){return gn(this,tn(this,t,e,!1))},findIndex:function(t,e){var n=this.findEntry(t,e);return n?n[0]:-1},indexOf:function(t){var e=this.keyOf(t);return void 0===e?-1:e},lastIndexOf:function(t){var e=this.lastKeyOf(t);return void 0===e?-1:e},reverse:function(){return gn(this,Qe(this,!1))},slice:function(t,e){return gn(this,rn(this,t,e,!1))},splice:function(t,e){var n=arguments.length;if(e=Math.max(0|e,0),0===n||2===n&&!e)return this;t=R(t,t<0?this.count():this.size);var r=this.slice(0,t);return gn(this,1===n?r:r.concat(E(arguments,2),this.slice(t+e)))},findLastIndex:function(t,e){var n=this.findLastEntry(t,e);return n?n[0]:-1},first:function(){return this.get(0)},flatten:function(t){return gn(this,un(this,t,!1))},get:function(t,e){return(t=A(this,t))<0||this.size===1/0||void 0!==this.size&&t>this.size?e:this.find((function(e,n){return n===t}),void 0,e)},has:function(t){return(t=A(this,t))>=0&&(void 0!==this.size?this.size===1/0||t<this.size:-1!==this.indexOf(t))},interpose:function(t){return gn(this,ln(this,t))},interleave:function(){var t=[this].concat(E(arguments)),e=pn(this.toSeq(),G.of,t),n=e.flatten(!0);return e.size&&(n.size=e.size*t.length),gn(this,n)},keySeq:function(){return vt(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(t,e){return gn(this,sn(this,t,e,!1))},zip:function(){return gn(this,pn(this,or,[this].concat(E(arguments))))},zipWith:function(t){var e=E(arguments);return e[0]=this,gn(this,pn(this,t,e))}}),o.prototype[d]=!0,o.prototype[p]=!0,Jn(i,{get:function(t,e){return this.has(t)?t:e},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}}),i.prototype.has=Yn.includes,i.prototype.contains=i.prototype.includes,Jn(W,r.prototype),Jn(G,o.prototype),Jn(J,i.prototype),Jn(kt,r.prototype),Jn(xt,o.prototype),Jn(Et,i.prototype),{Iterable:n,Seq:Z,Collection:It,Map:Ht,OrderedMap:qe,List:xe,Stack:Pn,Set:jn,OrderedSet:Dn,Record:kn,Range:vt,Repeat:wt,is:yt,fromJS:dt}}()},function(t,e,n){const{Map:r,List:o,Set:i,fromJS:s}=n(36),{SkipList:a}=n(38),{decodeChange:u,decodeChangeMeta:c,appendEdit:l}=n(15),{parseOpId:h}=n(7);function f(t,e){for(let n of e.deps)if(!t.hasIn(["hashes",n]))return!1;return!0}function d(t,e){if("_root"===e)return"map";const n=t.getIn(["byObject",e,"_init","action"]),r={makeMap:"map",makeTable:"table",makeList:"list",makeText:"text"}[n];if(!r)throw new RangeError(`Unknown object type ${n} for ${e}`);return r}function p(t,e,n){const o=_(e),s=e.get("action");if(t.hasIn(["byObject",o,"_keys"]))throw new Error(`Duplicate creation of object ${o}`);let u=r({_init:e,_inbound:i(),_keys:r()});return"makeList"!==s&&"makeText"!==s||(u=u.set("_elemIds",new a)),t=t.setIn(["byObject",o],u),n&&(n.objectId=o,n.type=d(t,o),n.props={},"list"!==n.type&&"text"!==n.type||(n.edits=[])),t}function g(t){const e=t.get("action");return e.startsWith("make")||"link"===e}function _(t){return t.get("child",t.get("opId"))}function y(t){const e=t.get("key");if(e)return e;const n=t.get("insert")?t.get("opId"):t.get("elemId");if(!n)throw new RangeError(`operation has no key: ${t}`);return n}function b(t,e,n){const r=e.get("obj"),s=e.get("action"),a=y(e);if(!t.get("byObject").has(r))throw new RangeError(`Modification of unknown object ${r}`);const u=d(t,r);if(n){if(n.objectId=n.objectId||r,n.objectId!==r)throw new RangeError(`objectId mismatch in patch: ${n.objectId} != ${r}`);if(n.type=n.type||u,n.type!==u)throw new RangeError(`object type mismatch in patch: ${n.type} != ${u}`);"list"===u||"text"===u||n.props[a]||(n.props[a]={})}if(s.startsWith("make"))if(n){const r={};t=p(t,e,r),"map"!==u&&"table"!==u||(n.props[a][e.get("opId")]=r)}else t=p(t,e);"link"===s&&n&&(n.props[a][e.get("opId")]=L(t,_(e)));const c=O(t,r,a);let l,h;if("inc"===s)l=o(),h=c.map((t=>"set"===t.get("action")&&"number"==typeof t.get("value")&&"counter"===t.get("datatype")&&e.get("pred").includes(t.get("opId"))?t.set("value",t.get("value")+e.get("value")):t));else{const t=c.groupBy((t=>e.get("pred").includes(t.get("opId"))));l=t.get(!0,o()),h=t.get(!1,o())}for(let e of l.filter(g))t=t.updateIn(["byObject",_(e),"_inbound"],(t=>t.remove(e)));return g(e)&&(t=t.updateIn(["byObject",_(e),"_inbound"],i(),(t=>t.add(e)))),("set"===s||g(e))&&(h=h.push(e)),h=h.sort(S).reverse(),t=t.setIn(["byObject",r,"_keys",a],h),"list"===u||"text"===u?t=function(t,e,n,r){const o=O(t,e,n);let i=t.getIn(["byObject",e,"_elemIds"]),s=i.indexOf(n);if(s>=0)i=o.isEmpty()?i.removeIndex(s):i.setValue(n,o.first().get("value")),I(t,e,n,s,!1,r);else{if(o.isEmpty())return t;let a=n;for(;s=-1,a=z(t,e,a),a&&(s=i.indexOf(a),!(s>=0)););s+=1,i=i.insertIndex(s,n,o.first().get("value")),I(t,e,n,s,!0,r)}return t.setIn(["byObject",e,"_elemIds"],i)}(t,r,a,n):v(t,r,a,n),t}function w(t,e,n){const r=e.get("obj"),o=e.get("opId"),i=y(e),s=d(t,r);if(n.objectId=n.objectId||r,n.type=n.type||s,n.objectId!==r)throw new RangeError(`objectId mismatch in path: ${n.objectId} != ${r}`);if(n.type!==s)throw new RangeError(`object type mismatch in path: ${n.type} != ${s}`);if(!n.props[i]||!n.props[i][o])if("list"===s||"text"===s){const e=t.getIn(["byObject",r,"_elemIds"]).indexOf(i);I(t,r,i,e,!1,n)}else v(t,r,i,n);if(void 0===n.props[i][o])throw new RangeError(`field ops for ${i} did not contain opId ${o}`);return n.props[i][o]}function m(t,e){if("set"===e.get("action")){const t={type:"value",value:e.get("value")};return e.get("datatype")&&(t.datatype=e.get("datatype")),t}if(g(e)){const n=_(e),r=d(t,n);return"list"===r||"text"===r?{objectId:n,type:r,props:{},edits:[]}:{objectId:n,type:r,props:{}}}throw new RangeError(`Unexpected operation in field ops: ${e.get("action")}`)}function v(t,e,n,r){if(!r)return;r.props[n]||(r.props[n]={});const o={};for(let i of O(t,e,n)){const e=i.get("opId");o[e]=!0,g(i)&&r.props[n][e]||(r.props[n][e]=m(t,i))}for(let t of Object.keys(r.props[n]))o[t]||delete r.props[n][t]}function I(t,e,n,r,o,i){if(i)if(v(t,e,n,i),0!==Object.keys(i.props[n]).length){for(;!o&&i.edits.length>0&&i.edits[i.edits.length-1].index===r&&["insert","update"].includes(i.edits[i.edits.length-1].action);){o="insert"===i.edits.pop().action}for(const t of Object.keys(i.props[n]).sort(j)){const e=i.props[n][t];l(i.edits,o?{action:"insert",index:r,elemId:n,opId:t,value:e}:{action:"update",index:r,opId:t,value:e}),o=!1}}else l(i.edits,{action:"remove",index:r,count:1})}function k(t,e,n){const r=e.get("actor"),s=e.get("startOp");let a=i();return e.get("ops").forEach(((e,u)=>{const c=e.get("action"),l=e.get("obj"),h=e.get("insert");if(!["set","del","inc","link","makeMap","makeList","makeText","makeTable"].includes(c))throw new RangeError(`Unknown operation action: ${c}`);if(!e.get("pred"))throw new RangeError(`Missing 'pred' field in operation ${e}`);let f;if(n){const e=function(t,e){let n=[];for(;"_root"!==e;){const r=t.getIn(["byObject",e,"_inbound"],i()).first();if(!r)return null;n.unshift(r),e=r.get("obj")}return n}(t,l);if(null!==e){f=n;for(let n of e)f=w(t,n,f)}}const d=e.merge({opId:`${s+u}@${r}`});h&&(t=function(t,e){const n=e.get("obj"),r=e.get("opId");if(!t.get("byObject").has(n))throw new Error(`Modification of unknown object ${n}`);if(t.hasIn(["byObject",n,"_insertion",r]))throw new Error(`Duplicate list element ID ${r}`);if(!e.get("elemId"))throw new RangeError("insert operation has no key");return t.updateIn(["byObject",n,"_following",e.get("elemId")],o(),(t=>t.push(e))).setIn(["byObject",n,"_insertion",r],e)}(t,d)),c.startsWith("make")&&(a=a.add(_(d))),t=b(t,d,f)})),t}function x(t,e,n){const a=s(u(e)),c=a.get("actor"),l=a.get("seq"),h=a.get("startOp"),f=a.get("hash");if("string"!=typeof c||"number"!=typeof l||"number"!=typeof h)throw new TypeError(`Missing change metadata: actor = ${c}, seq = ${l}, startOp = ${h}`);if(t.hasIn(["hashes",f]))return t;const d=t.getIn(["states",c],o()).size+1;if(l!==d)throw new RangeError(`Expected change ${d} by ${c}, got change ${l}`);let p=0;for(let e of a.get("deps")){const n=t.getIn(["hashes",e,"maxOpId"]);if(void 0===n)throw new RangeError(`Unknown dependency hash ${e}`);p=Math.max(p,n),t=t.updateIn(["hashes",e,"depsFuture"],i(),(t=>t.add(f)))}if(h!==p+1)throw new RangeError(`Expected startOp to be ${p+1}, was ${h}`);let g=a.get("deps"),_=1===l;for(;!_&&!g.isEmpty();){const e=t.getIn(["hashes",g.first()]);g=g.shift(),e.get("actor")===c&&e.get("seq")===l-1?_=!0:g=g.concat(e.get("depsPast"))}if(!_)throw new RangeError("Change lacks dependency on prior sequence number by the same actor");const y=r({actor:c,seq:l,startOp:h,change:e,maxOpId:h+a.get("ops").size-1,depsPast:a.get("deps").toSet(),depsFuture:i()});return(t=k(t,a,n)).setIn(["hashes",f],y).updateIn(["states",c],o(),(t=>t.push(f))).update("deps",(t=>t.subtract(a.get("deps")).add(f))).update("maxOp",(t=>Math.max(t,y.get("maxOpId")))).update("history",(t=>t.push(f)))}function E(t,e){return t.getIn(["hashes",e,"change"])}function O(t,e,n){return t.getIn(["byObject",e,"_keys",n],o())}function A(t,e,n){if("_head"===n)return;const r=t.getIn(["byObject",e,"_insertion",n]);if(!r)throw new TypeError(`Missing index entry for list element ${n}`);return r.get("elemId")}function S(t,e){return j(t.get("opId"),e.get("opId"))}function j(t,e){const n=h(t),r=h(e);return n.counter<r.counter?-1:n.counter>r.counter?1:n.actorId<r.actorId?-1:n.actorId>r.actorId?1:0}function R(t,e,n,i){let s=null;return i&&(s=r({opId:i})),t.getIn(["byObject",e,"_following",n],o()).filter((t=>t.get("insert")&&(!s||S(t,s)<0))).sort(S).reverse().map((t=>t.get("opId")))}function C(t,e,n){const r=R(t,e,n);if(!r.isEmpty())return r.first();let o;for(;;){if(o=A(t,e,n),!o)return;const r=R(t,e,o,n);if(!r.isEmpty())return r.first();n=o}}function z(t,e,n){const r=A(t,e,n);let o,i=R(t,e,r);if(i.first()===n)return"_head"===r?null:r;for(let t of i){if(t===n)break;o=t}for(;;){if(i=R(t,e,o),i.isEmpty())return o;o=i.last()}}function V(t,e){if(g(e))return L(t,_(e));if("set"===e.get("action")){const t={value:e.get("value")};return e.get("datatype")&&(t.datatype=e.get("datatype")),t}throw new TypeError(`Unexpected operation action: ${e.get("action")}`)}function L(t,e){const n=d(t,e);if("map"===n||"table"===n)return function(t,e,n){const r={objectId:e,type:n,props:{}};for(let[n,o]of t.getIn(["byObject",e,"_keys"]).entries())if(!o.isEmpty()){r.props[n]={};for(let e of o)r.props[n][e.get("opId")]=V(t,e)}return r}(t,e,n);if("list"===n||"text"===n)return function(t,e,n){const r={objectId:e,type:n,props:{},edits:[]};let o="_head",i=0,s=0;for(;;){if(o=C(t,e,o),!o)return r;s=Math.max(s,h(o).counter);const n=O(t,e,o);if(!n.isEmpty()){r.props[i]={};for(let e of n)r.props[i][e.get("opId")]=V(t,e);i+=1}}}(t,e,n);throw new RangeError(`Unknown object type: ${n}`)}t.exports={init:function(){return r().set("states",r()).set("history",o()).set("byObject",r().set("_root",r().set("_keys",r()))).set("hashes",r()).set("deps",i()).set("maxOp",0).set("queue",o())},addChange:function(t,e,n){return function(t,e){let n=o();for(;;){for(let r of t.get("queue"))f(t,c(r,!1))?t=x(t,r,e):n=n.push(r);if(n.count()===t.get("queue").count())return t;t=t.set("queue",n),n=o()}}(t=t.update("queue",(t=>t.push(e))),n)},addLocalChange:function(t,e,n){return x(t,e,n)},getHeads:function(t){return t.get("deps").toArray().sort()},getChangeByHash:E,getMissingChanges:function(t,e){if(e.isEmpty())return t.get("history").toArray().map((e=>E(t,e)));let n=o(),r={},i=[];for(let o of e){r[o]=!0;const e=t.getIn(["hashes",o,"depsFuture"]);if(!e)throw new RangeError(`hash not found: ${o}`);n=n.concat(e)}for(;!n.isEmpty();){const e=n.last();if(r[e]=!0,i.push(e),!t.getIn(["hashes",e,"depsPast"]).every((t=>r[t])))break;n=n.pop().concat(t.getIn(["hashes",e,"depsFuture"]))}if(n.isEmpty()&&t.get("deps").every((t=>r[t])))return i.map((e=>E(t,e)));for(n=e,r={};!n.isEmpty();){const e=n.last();if(n=n.pop(),!r[e]){const o=t.getIn(["hashes",e,"depsPast"]);if(!o)throw new RangeError(`hash not found: ${e}`);n=n.concat(o),r[e]=!0}}return t.get("history").filter((t=>!r[t])).map((e=>E(t,e))).toArray()},getChangesAdded:function(t,e){let n=e.get("deps").toArray(),r={},o=[];for(;n.length>0;){const i=n.pop();r[i]||E(t,i)||(r[i]=!0,o.push(i),n.push(...e.getIn(["hashes",i,"depsPast"])))}return o.reverse().map((t=>E(e,t)))},getMissingDeps:function(t,e=[]){let n={},r={};for(let e of t.get("queue")){const o=c(e,!0);r[o.hash]=!0;for(let e of o.deps)t.hasIn(["hashes",e])||(n[e]=!0)}for(let r of e)t.hasIn(["hashes",r])||(n[r]=!0);return Object.keys(n).filter((t=>!r[t])).sort()},constructObject:L,getFieldOps:O,getOperationKey:y,finalizePatch:function t(e){if(e)if("list"===e.type||"text"===e.type){delete e.props;for(let n of e.edits)t(n.value)}else if("map"===e.type||"table"===e.type)for(const n of Object.keys(e.props))for(const r of Object.keys(e.props[n]))t(e.props[n][r])}}},function(t,e,n){const{Map:r}=n(36);class o{constructor(t,e,n,r,o,i,s){this.key=t,this.value=e,this.level=n,this.prevKey=r,this.nextKey=o,this.prevCount=i,this.nextCount=s}setValue(t){return new o(this.key,t,this.level,this.prevKey,this.nextKey,this.prevCount,this.nextCount)}insertAfter(t,e,n,r){if(e>this.level&&null!==this.key)throw new RangeError("Cannot increase the level of a non-head node");const i=Math.max(this.level,e),s=this.nextKey.slice(),a=this.nextCount.slice();for(let o=n;o<i;o++)o<e?(s[o]=t,a[o]=r):a[o]+=1;return new o(this.key,this.value,i,this.prevKey,s,this.prevCount,a)}insertBefore(t,e,n,r){if(e>this.level)throw new RangeError("Cannot increase node level");const i=this.prevKey.slice(),s=this.prevCount.slice();for(let o=n;o<this.level;o++)o<e?(i[o]=t,s[o]=r):s[o]+=1;return new o(this.key,this.value,this.level,i,this.nextKey,s,this.nextCount)}removeAfter(t,e,n,r){const i=this.nextKey.slice(),s=this.nextCount.slice();for(let o=t;o<this.level;o++)o<e?(i[o]=n[o],s[o]=r[o]):s[o]-=1;return new o(this.key,this.value,this.level,this.prevKey,i,this.prevCount,s)}removeBefore(t,e,n,r){const i=this.prevKey.slice(),s=this.prevCount.slice();for(let o=t;o<this.level;o++)o<e?(i[o]=n[o],s[o]=r[o]):s[o]-=1;return new o(this.key,this.value,this.level,i,this.nextKey,s,this.nextCount)}}class i{constructor(t){const e=new o(null,null,1,[],[null],[],[null]),n=t?t():{next(){const t=Math.floor(4294967296*Math.random());let e=1;for(;t<1<<32-2*e&&e<16;)e+=1;return{value:e,done:!1}}};return s(0,r().set(null,e),n)}get headNode(){return this._nodes.get(null)}predecessors(t,e){const n=[t],r=[1];for(let t=1;t<e;t++){let e=n[t-1],o=r[t-1];for(;e;){let n=this._nodes.get(e);if(n.level>t)break;if(n.level<t)throw new RangeError("Node "+e+" below expected level "+(t-1));o+=n.prevCount[t-1],e=n.prevKey[t-1]}n[t]=e,r[t]=o}return{preKeys:n,preCounts:r}}successors(t,e){const n=[t],r=[1];for(let t=1;t<e;t++){let e=n[t-1],o=r[t-1];for(;e;){let n=this._nodes.get(e);if(n.level>t)break;if(n.level<t)throw new RangeError("Node "+e+" below expected level "+(t-1));o+=n.nextCount[t-1],e=n.nextKey[t-1]}n[t]=e,r[t]=o}return{sucKeys:n,sucCounts:r}}insertAfter(t,e,n){if("string"!=typeof e||""===e)throw new RangeError("Key must be a nonempty string");if(!this._nodes.has(t))throw new RangeError("The referenced predecessor key does not exist");if(this._nodes.has(e))throw new RangeError("Cannot insert a key that already exists");const r=this._randomSource.next().value,i=Math.max(r,this.headNode.level),a=this._nodes.get(t).nextKey[0]||null,{preKeys:u,preCounts:c}=this.predecessors(t,i),{sucKeys:l,sucCounts:h}=this.successors(a,i);return s(this.length+1,this._nodes.withMutations((t=>{let s=0,a=0;for(let n=1;n<=i;n++){const o=Math.min(n,r);n!==i&&u[n]===u[s]||(t.update(u[s],(t=>t.insertAfter(e,o,s,c[s]))),s=n),!l[a]||n!==i&&l[n]===l[a]||(t.update(l[a],(t=>t.insertBefore(e,o,a,h[a]))),a=n)}t.set(e,new o(e,n,r,u.slice(0,r),l.slice(0,r),c.slice(0,r),h.slice(0,r)))})),this._randomSource)}insertIndex(t,e,n){if("number"!=typeof t||t<0)throw new RangeError("Index must be a non-negative integer");return 0===t?this.insertAfter(null,e,n):this.insertAfter(this.keyOf(t-1),e,n)}removeKey(t){if("string"!=typeof t||!this._nodes.has(t))throw new RangeError("The given key cannot be removed because it does not exist");const e=this._nodes.get(t),n=this.headNode.level,{preKeys:r,preCounts:o}=this.predecessors(e.prevKey[0],n),{sucKeys:i,sucCounts:a}=this.successors(e.nextKey[0],n),u=new Array(n);for(let t=0;t<n;t++)u[t]=o[t]+a[t]-1;return s(this.length-1,this._nodes.withMutations((o=>{o.remove(t);let s=0,a=0;for(let t=1;t<=n;t++){const c=Math.min(t,e.level);t!==n&&r[t]===r[s]||(o.update(r[s],(t=>t.removeAfter(s,c,i,u))),s=t),!i[a]||t!==n&&i[t]===i[a]||(o.update(i[a],(t=>t.removeBefore(a,c,r,u))),a=t)}})),this._randomSource)}removeIndex(t){return this.removeKey(this.keyOf(t))}indexOf(t){if("string"!=typeof t||""===t||!this._nodes.has(t))return-1;let e=this._nodes.get(t),n=0;for(;e&&e.key;)n+=e.prevCount[e.level-1],e=this._nodes.get(e.prevKey[e.level-1]);return n-1}keyOf(t){if("number"!=typeof t)return null;if(t<0&&(t+=this.length),t<0||t>=this.length)return null;let e=this._nodes.get(null),n=e.level-1,r=0;for(;;){if(r===t+1)return e.key;r+e.nextCount[n]>t+1?n-=1:(r+=e.nextCount[n],e=this._nodes.get(e.nextKey[n]))}}getValue(t){if("string"!=typeof t||""===t)throw new RangeError("Key must be a nonempty string");const e=this._nodes.get(t);return e&&e.value}setValue(t,e){if("string"!=typeof t||""===t)throw new RangeError("Key must be a nonempty string");let n=this._nodes.get(t);if(!n)throw new RangeError("The referenced key does not exist");return n=n.setValue(e),s(this.length,this._nodes.set(t,n),this._randomSource)}iterator(t){const e=this._nodes;let n=e.get(null).nextKey[0];return{next(){if(!n)return{value:void 0,done:!0};const r=e.get(n);let o;switch(t){case"keys":o={value:n,done:!1};break;case"values":o={value:r.value,done:!1};break;case"entries":o={value:[n,r.value],done:!1}}return n=r.nextKey[0],o},[Symbol.iterator]:()=>this.iterator(t)}}[Symbol.iterator](){return this.iterator("values")}}function s(t,e,n){const r=Object.create(i.prototype);return r.length=t,r._nodes=e,r._randomSource=n,r}t.exports={SkipList:i}},function(t){t.exports={backendState:function(t){if(t.frozen)throw new Error("Attempting to use an outdated Automerge document that has already been updated. Please use the latest document state, or call Automerge.clone() if you really need to use this old document state.");return t.state}}},function(t,e,n){const{List:r}=n(36),{backendState:o}=n(39),i=n(35),s=n(37),{hexStringToBytes:a,bytesToHexString:u,Encoder:c,Decoder:l}=n(32),{decodeChangeMeta:h}=n(15),{copyObject:f}=n(7);class d{constructor(t){if(Array.isArray(t)){this.numEntries=t.length,this.numBitsPerEntry=10,this.numProbes=7,this.bits=new Uint8Array(Math.ceil(this.numEntries*this.numBitsPerEntry/8));for(let e of t)this.addHash(e)}else{if(!(t instanceof Uint8Array))throw new TypeError("invalid argument");if(0===t.byteLength)this.numEntries=0,this.numBitsPerEntry=0,this.numProbes=0,this.bits=t;else{const e=new l(t);this.numEntries=e.readUint32(),this.numBitsPerEntry=e.readUint32(),this.numProbes=e.readUint32(),this.bits=e.readRawBytes(Math.ceil(this.numEntries*this.numBitsPerEntry/8))}}}get bytes(){if(0===this.numEntries)return new Uint8Array(0);const t=new c;return t.appendUint32(this.numEntries),t.appendUint32(this.numBitsPerEntry),t.appendUint32(this.numProbes),t.appendRawBytes(this.bits),t.buffer}getProbes(t){const e=a(t),n=8*this.bits.byteLength;if(32!==e.byteLength)throw new RangeError(`Not a 256-bit hash: ${t}`);let r=((e[0]|e[1]<<8|e[2]<<16|e[3]<<24)>>>0)%n,o=((e[4]|e[5]<<8|e[6]<<16|e[7]<<24)>>>0)%n,i=((e[8]|e[9]<<8|e[10]<<16|e[11]<<24)>>>0)%n;const s=[r];for(let t=1;t<this.numProbes;t++)r=(r+o)%n,o=(o+i)%n,s.push(r);return s}addHash(t){for(let e of this.getProbes(t))this.bits[e>>>3]|=1<<(7&e)}containsHash(t){if(0===this.numEntries)return!1;for(let e of this.getProbes(t))if(0==(this.bits[e>>>3]&1<<(7&e)))return!1;return!0}}function p(t,e){if(!Array.isArray(e))throw new TypeError("hashes must be an array");t.appendUint32(e.length);for(let n=0;n<e.length;n++){if(n>0&&e[n-1]>=e[n])throw new RangeError("hashes must be sorted");const r=a(e[n]);if(32!==r.byteLength)throw new TypeError("heads hashes must be 256 bits");t.appendRawBytes(r)}}function g(t){let e=t.readUint32(),n=[];for(let r=0;r<e;r++)n.push(u(t.readRawBytes(32)));return n}function _(t){const e=new c;e.appendByte(66),p(e,t.heads),p(e,t.need),e.appendUint32(t.have.length);for(let n of t.have)p(e,n.lastSync),e.appendPrefixedBytes(n.bloom);e.appendUint32(t.changes.length);for(let n of t.changes)e.appendPrefixedBytes(n);return e.buffer}function y(t){const e=new l(t),n=e.readByte();if(66!==n)throw new RangeError(`Unexpected message type: ${n}`);const r=g(e),o=g(e),i=e.readUint32();let s={heads:r,need:o,have:[],changes:[]};for(let t=0;t<i;t++){const t=g(e),n=e.readPrefixedBytes(e);s.have.push({lastSync:t,bloom:n})}const a=e.readUint32();for(let t=0;t<a;t++){const t=e.readPrefixedBytes();s.changes.push(t)}return s}function b(t,e){const n=s.getMissingChanges(t.get("opSet"),r(e)).map((t=>h(t,!0).hash));return{lastSync:e,bloom:new d(n).bytes}}function w(){return{sharedHeads:[],lastSentHeads:[],theirHeads:null,theirNeed:null,theirHave:null,sentHashes:{}}}function m(t,e){return t.length===e.length&&t.every(((t,n)=>t===e[n]))}t.exports={receiveSyncMessage:function(t,e,n){if(!t)throw new Error("generateSyncMessage called with no Automerge document");if(!e)throw new Error("generateSyncMessage requires a syncState, which can be created with initSyncState()");let{sharedHeads:r,lastSentHeads:o,sentHashes:s}=e,a=null;const u=y(n),c=i.getHeads(t);u.changes.length>0&&([t,a]=i.applyChanges(t,u.changes),r=function(t,e,n){const r=e.filter((e=>!t.includes(e))),o=n.filter((t=>e.includes(t)));return[...new Set([...r,...o])].sort()}(c,i.getHeads(t),r)),0===u.changes.length&&m(u.heads,c)&&(o=u.heads);const l=u.heads.filter((e=>i.getChangeByHash(t,e)));l.length===u.heads.length?(r=u.heads,0===u.heads.length&&(o=[],s=[])):r=[...new Set(l.concat(r))].sort();const h={sharedHeads:r,lastSentHeads:o,theirHave:u.have,theirHeads:u.heads,theirNeed:u.need,sentHashes:s};return[t,h,a]},generateSyncMessage:function(t,e){if(!t)throw new Error("generateSyncMessage called with no Automerge document");if(!e)throw new Error("generateSyncMessage requires a syncState, which can be created with initSyncState()");let{sharedHeads:n,lastSentHeads:a,theirHeads:u,theirNeed:c,theirHave:l,sentHashes:p}=e;const g=i.getHeads(t),y=o(t),w=i.getMissingDeps(t,u||[]);let v=[];if(u&&!w.every((t=>u.includes(t)))||(v=[b(y,n)]),l&&l.length>0){if(!l[0].lastSync.every((e=>i.getChangeByHash(t,e)))){return[e,_({heads:g,need:[],have:[{lastSync:[],bloom:new Uint8Array(0)}],changes:[]})]}}let I=Array.isArray(l)&&Array.isArray(c)?function(t,e,n){const o=t.get("opSet");if(0===e.length)return n.map((t=>s.getChangeByHash(o,t))).filter((t=>void 0!==t));let i={},a=[];for(let t of e){for(let e of t.lastSync)i[e]=!0;a.push(new d(t.bloom))}const u=s.getMissingChanges(o,r(Object.keys(i))).map((t=>h(t,!0)));let c={},l={},f={};for(let t of u){c[t.hash]=!0;for(let e of t.deps)l[e]||(l[e]=[]),l[e].push(t.hash);a.every((e=>!e.containsHash(t.hash)))&&(f[t.hash]=!0)}let p=Object.keys(f);for(;p.length>0;){const t=p.pop();if(l[t])for(let e of l[t])f[e]||(f[e]=!0,p.push(e))}let g=[];for(let t of n)if(f[t]=!0,!c[t]){const e=s.getChangeByHash(o,t);e&&g.push(e)}for(let t of u)f[t.hash]&&g.push(t.change);return g}(y,l,c):[];const k=Array.isArray(a)&&m(g,a),x=Array.isArray(u)&&m(g,u);if(k&&x&&0===I.length)return[e,null];I=I.filter((t=>!p[h(t,!0).hash]));const E={heads:g,have:v,need:w,changes:I};if(I.length>0){p=f(p);for(const t of I)p[h(t,!0).hash]=!0}return[e=Object.assign({},e,{lastSentHeads:g,sentHashes:p}),_(E)]},encodeSyncMessage:_,decodeSyncMessage:y,initSyncState:w,encodeSyncState:function(t){const e=new c;return e.appendByte(67),p(e,t.sharedHeads),e.buffer},decodeSyncState:function(t){const e=new l(t),n=e.readByte();if(67!==n)throw new RangeError(`Unexpected record type: ${n}`);const r=g(e);return Object.assign({sharedHeads:[],lastSentHeads:[],theirHeads:null,theirNeed:null,theirHave:null,sentHashes:{}},{sharedHeads:r})},BloomFilter:d}}],e={};var n=function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}(0);globalThis.Automerge=n;